<!DOCTYPE html>
<html lang="ko">
<head>
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ë£¨í‹´íŠ¸ë˜ì»¤">
    <link rel="apple-touch-icon" href="icon-192.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜ë£¨ ë£¨í‹´ íŠ¸ë˜ì»¤ v3.2</title>
    <style>
    @font-face {
        font-family: 'KBIZHanmaumMyungjo';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    :root {
        --bg-color: #f4f7f9;
        --primary-color: #4A90E2;
        --primary-dark: #3a7ac8;
        --primary-light: #eaf2fa;
        --text-color: #2c3e50;
        --text-color-light: #7f8c8d;
        --border-color: #dfe3e8;
        --container-bg: #ffffff;
        --danger-color: #e74c3c;
        --warning-color: #f39c12;
        --success-color: #2ecc71;
        --neutral-color: #95a5a6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'KBIZHanmaumMyungjo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-color); min-height: 100vh; padding: 20px; color: var(--text-color); }
    button, input, select, textarea { font-family: inherit; }
    .container { 
        background: var(--container-bg); 
        border-radius: 20px; 
        padding: 50px 30px 100px 30px; /* ì²« ë²ˆì§¸ ê°’(50px)ì´ ìƒë‹¨ íŒ¨ë”© */
        width: 100%; 
        max-width: 500px; 
        margin: 0 auto; 
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        position: relative;
    }
    .header { text-align: center; margin-bottom: 25px; position: relative; }
    .header h1 { color: var(--text-color); font-size: 26px; font-weight: 700; margin-bottom: 8px; }
    .header p { color: var(--text-color-light); font-size: 14px; }
    #gameWarning { background: #fffbe6; color: #b77900; border: 1px solid #ffe58f; border-radius: 8px; padding: 10px; font-size: 14px; font-weight: 500; margin-bottom: 20px; display: none; }
    .page { display: none; }
    .page.active { display: block; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .month-nav { background: none; border: none; font-size: 24px; color: var(--text-color-light); cursor: pointer; padding: 10px; border-radius: 50%; transition: background 0.3s ease; }
    .month-nav:hover { background: var(--bg-color); }
    .month-year { font-size: 20px; font-weight: 700; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 20px; }
    .calendar-header-cell { text-align: center; padding: 10px 5px; font-weight: 600; color: var(--text-color-light); font-size: 12px; }
    .calendar-cell { aspect-ratio: 1; display: grid; grid-template-rows: 1fr auto 1fr; padding: 2px; align-items: center; justify-items: center; position: relative }
    .cell-top-icons { grid-row: 1; display: flex; justify-content: center; gap: 2px; font-size: 9px; width: 100%; height: 100%; align-items: center; }
    .cell-day-number { grid-row: 2; font-weight: 500; }
    .calendar-cell.today .cell-day-number { font-weight: 700; }
    .cell-bottom-info { grid-row: 3; font-size: 8px; font-weight: 600; color: var(--text-color-light); width: 100%; text-align: left; padding-right: 4px; align-self: end; padding-bottom: 2px; }

    .calendar-cell.has-data .cell-bottom-info { color: rgba(255, 255, 255, 0.8); }
    .calendar-cell.off-day { background: #e9ecef; color: var(--neutral-color); }
    .off-day-indicator { position: absolute; top: 4px; right: 4px; font-size: 10px; }
    .calendar-cell:hover { transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .calendar-cell.other-month { color: #ccc; background: var(--bg-color); border-color: transparent; pointer-events: none; }
    .calendar-cell.today { border-color: var(--primary-color); font-weight: 700; color: var(--primary-color); box-shadow: 0 0 0 2px var(--primary-light); }
    .calendar-cell.has-data { color: white; border: none; font-weight: bold; }
    .calendar-cell.score-high { background: var(--success-color); }
    .calendar-cell.score-medium { background: var(--warning-color); }
    .calendar-cell.score-low { background: var(--danger-color); }
    .calendar-cell.score-negative { background: #34495e; }
    .score-indicator { position: absolute; bottom: 4px; right: 4px; font-size: 9px; background: rgba(0,0,0,0.25); color: white; padding: 1px 4px; border-radius: 4px; font-weight: 700; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease, box-shadow 0.3s ease; font-family: 'KBIZHanmaumMyungjo', sans-serif; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-light); }
    .main-actions { display: flex; gap: 10px; margin-bottom: 10px; }
    .btn { width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .btn:hover { background-color: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .btn:active { transform: translateY(0); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    .main-actions .btn { flex: 1; }
    .btn.secondary { background: var(--neutral-color); }
    .btn.secondary:hover { background: #7f8c8d; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.5); backdrop-filter: blur(4px); z-index: 1000; align-items: center; justify-content: center; }
    .modal-content { background: var(--bg-color); padding: 0; border-radius: 16px; width: 90%; max-width: 800px; max-height: 95vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    #dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--border-color); background: #fff; border-top-left-radius: 16px; border-top-right-radius: 16px; }
    #dayModal .modal-body { padding: 25px; }
    .modal-layout { display: block; }
    @media (min-width: 768px) { .modal-layout { display: block; } }
    .modal-side-column { display: flex; flex-direction: column; }
    .modal-input-group { background: #fff; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); }
    .modal-input-group h4 { font-size: 16px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
    .modal-input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
    
    #commentDetails summary { font-weight: 600; color: var(--text-color); cursor: pointer; padding: 10px; border-radius: 8px; background-color: var(--bg-color); border: 1px solid var(--border-color); list-style: none; position: relative; padding-left: 30px; }
    #commentDetails summary::-webkit-details-marker { display: none; }
    #commentDetails summary::before { content: 'â–¶'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 10px; transition: transform 0.2s; }
    #commentDetails[open] > summary::before { transform: translateY(-50%) rotate(90deg); }

    #dayModal .form-group { margin-bottom: 0; }
    #dayModal .form-group label { font-size: 13px; margin-bottom: 6px; }
    #dayModal .form-group input { padding: 10px; font-size: 16px; }
    #dayModal .modal-input-group,
    #dayModal .score-display-card { margin-bottom: 5px; }
    #dayModal .modal-layout > div:last-child { margin-bottom: 0; }
    .modal-header { display: flex; justify-content: center; align-items: center; position: relative; gap: 20px; }
    .modal-title { flex: none; text-align: center; margin: 0; }

    .date-nav-btn { background: none; border: none; font-size: 24px; color: var(--text-color-light); cursor: pointer; padding: 10px; border-radius: 50%; transition: all 0.2s ease; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
    .date-nav-btn:hover { background: var(--bg-color); color: var(--text-color); }
    .close-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-color-light); line-height: 1; position: absolute; right: 0; top: 50%; transform: translateY(-50%); }
    .score-display-card { background: #fff; border-radius: 12px; padding: 20px; text-align: center; border: 1px solid var(--border-color); }
    .score-display-card .score { font-size: 40px; font-weight: 700; color: var(--primary-color); line-height: 1; }
    .score-display-card .score.is-off { color: var(--neutral-color); }
    .score-display-card div:last-child { font-size: 14px; color: var(--text-color-light); margin-top: 5px; }
    .exercise-toggle-group { margin-bottom: 15px; }
    .exercise-toggle-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    .exercise-toggle-btns { display: flex; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
    .exercise-toggle-btn { flex: 1; padding: 10px; border: none; background: #fff; cursor: pointer; font-weight: 600; transition: all 0.2s ease; font-size: 14px; }
    .exercise-toggle-btn.active { background: var(--success-color); color: #fff; }
    .legend { display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0 0; font-size: 12px; gap: 15px; }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    .legend-color { width: 12px; height: 12px; border-radius: 3px; }
    .goal-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .goal-tab { padding: 8px 16px; background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; }
    .goal-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    .goal-type-toggle { display: flex; gap: 5px; margin-bottom: 15px; }
    .goal-type-toggle button { flex: 1; padding: 8px; font-size: 14px; border: 1px solid var(--border-color); background: var(--bg-color); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; }
    .goal-type-toggle button.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    #personalGoalsPage .header { text-align: left; }
    .dday-header-container { height: auto; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: flex-start; position: absolute; top: 10px; left: 10px; right: 10px; z-index: 10; pointer-events: none; }
    .dday-chip { background: var(--primary-light); backdrop-filter: blur(5px); color: var(--primary-color); padding: 4px 10px; border-radius: 12px; font-weight: 700; font-size: 11px; display: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1); pointer-events: all; border: 1px solid rgba(0,0,0,0.05); }
    .battery { display: none; width: 30px; height: 14px; border: 1.5px solid var(--text-color-light); border-radius: 4px; position: relative; padding: 1.5px; }
    .battery::after { content: ''; position: absolute; top: 50%; right: -4px; transform: translateY(-50%); width: 2px; height: 6px; background: var(--text-color-light); border-radius: 0 1px 1px 0; }
    .battery-level { height: 100%; border-radius: 2px; transition: width 0.3s ease; }
    .battery-level.green { background: var(--success-color); } .battery-level.yellow { background: var(--warning-color); } .battery-level.red { background: var(--danger-color); } .battery-level.black { background: var(--text-color); }
    .budget-summary { display: flex; gap: 10px; margin-bottom: 20px; }
    .budget-card { flex: 1; background: var(--primary-light); color: var(--primary-color); padding: 15px; border-radius: 12px; text-align: center; }
    .budget-card-title { font-size: 12px; opacity: 0.9; margin-bottom: 8px; font-weight: 600; }
    .budget-card-value { font-size: 22px; font-weight: 700; }
    #budgetPage .header p { font-size: 16px; font-weight: 600; color: var(--text-color); }
    .personal-goals-section { background: #fff; padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); }
    #modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }
    .personal-goal-checkbox { display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border-radius: 10px; margin-bottom: 10px; border: 1px solid var(--border-color); }
    .personal-goal-item { background: #fff; border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 10px; }
    .personal-goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .personal-goal-name { font-weight: 600; }
    .personal-goal-actions button { padding: 5px 10px; border-radius: 6px; font-size: 12px; border: none; cursor: pointer; color: white; }
    .edit-btn { background: var(--warning-color); }
    .delete-btn { background: var(--danger-color); }
    .complete-btn { background: var(--success-color); }
    .reopen-btn { background: var(--primary-color); }
    .empty-goals { text-align: center; color: var(--text-color-light); padding: 40px 20px; background: var(--bg-color); border-radius: 12px; margin-top: 20px; border: 1px solid var(--border-color); }
    .budget-settings, .dday-settings { margin-bottom: 30px; }
    .budget-input, .dday-actions { display: flex; gap: 10px; align-items: center; }
    .dday-item { background: var(--bg-color); border-radius: 12px; padding: 12px 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .budget-input button { padding: 12px 20px; background: var(--success-color); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .wakeup-prompt { background: var(--primary-light); color: var(--primary-color); padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; }
    .monthly-summary { display: flex; justify-content: space-around; gap: 15px; margin-bottom: 30px; }
    .summary-card { flex-basis: 30%; background: var(--primary-light); color: var(--primary-color); padding: 20px; border-radius: 15px; text-align: center; }
    .summary-title { font-size: 14px; opacity: 0.9; margin-bottom: 10px; font-weight: 600; }
    .summary-value { font-size: 24px; font-weight: 700; }
    .week-card { background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-color); }
    .week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: 600; }
    .week-stats { display: flex; justify-content: space-around; align-items: center; text-align: center; font-size: 22px; font-weight: 600; }
    .empty-expenses { text-align: center; color: var(--text-color-light); padding: 40px 20px; }
    .feedback-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 2000; animation: fadeIn 0.3s ease; justify-content: center; align-items: center; }
    .feedback-content { position: relative; background: white; padding: 40px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: popIn 0.5s ease; }
    .feedback-emoji { font-size: 60px; margin-bottom: 20px; display: block; }
    .feedback-title { font-size: 24px; font-weight: 700; margin-bottom: 15px; color: #333; }
    .feedback-message { font-size: 16px; color: #666; line-height: 1.5; margin-bottom: 25px; }
    .feedback-celebration .feedback-title, .feedback-celebration .feedback-message, .feedback-reflection .feedback-title, .feedback-reflection .feedback-message, .feedback-disaster .feedback-title, .feedback-disaster .feedback-message, .feedback-encouragement .feedback-title, .feedback-encouragement .feedback-message, .feedback-warning .feedback-title, .feedback-warning .feedback-message { color: rgba(255,255,255,0.95); }
    .feedback-celebration { background: linear-gradient(135deg, #2ecc71, #28b463); } .feedback-reflection { background: linear-gradient(135deg, #f39c12, #e67e22); } .feedback-disaster { background: linear-gradient(135deg, #34495e, #2c3e50); } .feedback-encouragement { background: linear-gradient(135deg, #3498db, #2980b9); } .feedback-warning { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    .feedback-btn { background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 12px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 0 10px; }
    .feedback-btn:hover { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.5); transform: translateY(-2px); }
    .feedback-budget-red { background: linear-gradient(135deg, #e74c3c, #c0392b) !important; }
    .feedback-budget-black { background: linear-gradient(135deg, #34495e, #2c3e50) !important; }
    .expense-input-row { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
    .expense-input-row input { flex: 1; padding: 12px; font-size: 14px; border-radius: 8px; }
    .expense-input-row button { flex-shrink: 0; width: 44px; height: 44px; border-radius: 12px; background: var(--primary-color); border: none; color: white; font-weight: bold; cursor: pointer; font-size: 24px; line-height: 44px; transition: background 0.2s ease; }
    .expense-input-row button:hover { background: var(--primary-dark); }
    .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; font-size: 14px; }
    .dday-settings h4 { margin-bottom: 15px; }
    .dday-item .dday-actions { display: flex; gap: 5px; }
    .dday-item .dday-actions button { background: none; border: 1px solid var(--border-color); width: 30px; height: 30px; border-radius: 50%; font-size: 16px; cursor: pointer; transition: all 0.2s ease; color: var(--text-color-light); }
    .dday-item .dday-actions button:hover { background: var(--bg-color); color: var(--text-color); transform: scale(1.1); }
    .excel-option-item { display: flex; align-items: center; padding: 8px 0; cursor: pointer; }
    .excel-option-item input[type="radio"] { width: 18px; height: 18px; margin-right: 12px; }
    .excel-option-item label { font-size: 16px; }
    #customDateRange { display: flex; gap: 10px; align-items: center; margin-top: 10px; margin-bottom: 20px; }
    #customDateRange input[type="date"] { padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); flex: 1; font-family: inherit; }

    .number-input-group { display: flex; align-items: center; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
    .number-input-group input { border: none; text-align: center; flex: 1; padding: 10px 5px; background: white; }
    .number-input-group input:focus { box-shadow: none; border: none; }
    .number-btn {
    width: 32px;
    height: 42px;
    border: none;
    background: var(--bg-color);
    color: var(--text-color);
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

        /* ìˆ«ì ì…ë ¥ í•„ë“œì˜ ìŠ¤í•€ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    .number-btn:hover { background: var(--primary-light); }
    .number-btn:active { background: var(--primary-color);  color: white; }

    .food-page-actions { display: flex; gap: 10px; margin-bottom: 10px; }
    .food-page-actions .btn.secondary.danger { background-color: var(--danger-color); color: white; }
    .food-date-header { display: flex; align-items: center; text-align: center; margin: 30px 0 10px; color: var(--text-color-light); }
    .food-date-header::before, .food-date-header::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color); }
    .food-date-header span { padding: 0 15px; font-size: 13px; font-weight: 600; }
    .food-record-item { display: grid; grid-template-columns: 50px 30px 1fr auto; gap: 15px; align-items: center; padding: 14px 5px; border-bottom: 1px solid var(--bg-color); position: relative; }
    .food-record-item .food-admin-actions { position: absolute; right: 0px; top: 50%; transform: translateY(-50%); display: flex; gap: 5px; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
    .food-records.admin-mode .food-record-item .food-admin-actions { opacity: 1; pointer-events: auto; }
    .food-admin-actions button { background: none; border: 1px solid var(--border-color); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 13px; transition: background-color 0.2s; }
    .food-admin-actions button.edit { color: var(--warning-color); }
    .food-admin-actions button.delete { color: var(--danger-color); }
    .food-admin-actions button:hover { background-color: var(--bg-color); }
    
#foodExportModal .modal-content { max-width: 90vw; background: white; padding: 0; }
#foodExportPreview { background: white; border-radius: 8px; padding: 0; margin: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-family: 'Courier New', monospace; }
.food-receipt-header { padding: 15px 20px 10px; background: var(--primary-light); }
.food-receipt-title { display: block; text-align: center; margin-bottom: 5px; }
.food-receipt-title h3 { margin: 0; font-size: 16px; color: var(--primary-color); font-weight: 700; }
.food-receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
.food-receipt-divider {
    height: 1px;
    background: repeating-linear-gradient(
        to right,
        var(--border-color) 0px,
        var(--border-color) 3px,
        transparent 3px,
        transparent 6px
    );
    margin: 0 15px;
}
.food-receipt-items { padding: 15px 20px 10px; }
.food-receipt-date-header { font-weight: 700; color: var(--primary-color); font-size: 13px; margin: 15px 0 8px 0; padding-bottom: 5px; border-bottom: 1px dashed var(--border-color); }
.food-receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; font-size: 13px; line-height: 1.3; }
.food-receipt-time { color: var(--text-color-light); font-size: 11px; min-width: 45px; margin-right: 10px; }
.food-receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 10px; }
.food-receipt-quantity { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 60px; }
#foodExportModal .close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.1);
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    font-size: 20px;
    color: var(--text-color);
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
}

#foodExportModal .close-btn:hover { background: rgba(0, 0, 0, 0.2); }

@media (max-width: 767px) { #foodExportModal.modal-overlay { background: white; backdrop-filter: none; }
    
    #foodExportModal .modal-content { max-width: 100vw; width: 100vw; height: 100vh; margin: 0; padding: 0; border-radius: 0; box-shadow: none; }
    #foodExportPreview { margin: 0; border-radius: 0; box-shadow: none; height: calc(100vh - 50px); overflow-y: auto; }
    
    /* ë‹«ê¸° ë²„íŠ¼ */
    #foodExportModal .close-btn {
        position: fixed;                /* absolute â†’ fixed */
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 22px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        z-index: 1000;
    }
    
    /* ì•ˆë‚´ í…ìŠ¤íŠ¸ */
    #foodExportModal .modal-content > div:last-child { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; border-top: 1px solid var(--border-color); } }
    .food-modal { max-width: 420px; background-color: white; overflow: hidden; }
    .food-modal .modal-header { padding: 15px 20px; background-color: var(--bg-color); border-bottom: 1px solid var(--border-color); }
    .food-modal .modal-header h2 { font-size: 18px; }
    .food-modal .modal-body { padding: 20px; }
    .food-modal .form-group { margin-bottom: 15px; }
    .food-modal .form-group label { font-size: 13px; margin-bottom: 6px; }
    .food-modal .form-group input, .food-modal .form-group select { padding: 10px; font-size: 15px; }
    .food-modal .quantity-input { display: flex; gap: 8px; }
    .food-modal .quantity-input select { width: 90px; }
    .food-modal .food-modal-actions { margin-top: 20px; display: flex; gap: 10px; }
    .food-modal .food-modal-actions .btn { flex: 1; padding: 12px; }

    .fame-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; }
    .fame-card { background: #fff; border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; text-align: center; }
    .fame-card-title { font-size: 18px; margin-bottom: 8px; }
    .fame-card-value { font-size: 20px; font-weight: 700; color: var(--primary-color); }
    .fame-card-date { font-size: 12px; color: var(--text-color-light); margin-top: 4px; }
    #wallOfShame .fame-card-value { color: var(--danger-color); }

    #modalCommentSection { margin-top: 20px; }
    #modalComment { width: 100%; margin-top: 15px; height: 80px; resize: vertical; font-size: 16px; }
    #modalPersonalGoalsList input[type="number"] { font-size: 16px; }

    .comment-history-list { max-height: 450px; overflow-y: auto; padding-right: 5px; }
    .comment-item { background: #fff; border: 1px solid var(--border-color); border-radius: 12px; padding: 15px 20px; margin-bottom: 12px; }
    .comment-item-header { font-size: 13px; color: var(--text-color-light); font-weight: 600; margin-bottom: 10px; }
    .comment-item-body { font-size: 15px; line-height: 1.7; white-space: pre-wrap; word-break: break-word; }
    .empty-comments { text-align: center; color: var(--text-color-light); padding: 50px 20px; background: var(--bg-color); border-radius: 12px; border: 1px solid var(--border-color); }
    
    .receipt-container { background: white; border-radius: 8px; padding: 0; margin-top: 0; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-family: 'Courier New', monospace; max-width: 100%; overflow: hidden; }
    .receipt-header { padding: 15px 20px 10px; background: var(--primary-light); }
    .receipt-title { display: block; text-align: center; margin-bottom: 5px; position: relative; }
    .receipt-title h3 { margin: 0; font-size: 16px; color: var(--primary-color); font-weight: 700; }
    .budget-info { display: flex; flex-direction: column; gap: 3px; font-size: 11px; color: var(--text-color); font-weight: 600; text-align: right; position: absolute; top: -5px; right: -8px; }
    .receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
    .receipt-divider { height: 1px; background: repeating-linear-gradient(to right, var(--border-color) 0px, var(--border-color) 3px, transparent 3px, transparent 6px); margin: 0 15px; }
    .receipt-items { padding: 15px 20px 10px; }
    .receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 8px; font-size: 13px; line-height: 1.3; }
    .receipt-date { color: var(--text-color-light); font-size: 11px; min-width: 60px; margin-right: 15px; }
    .receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 15px; }
    .receipt-amount { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 70px; }
    .receipt-total { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--bg-color); font-weight: 700; font-size: 16px; font-family: 'Courier New', monospace; color: var(--primary-color); }

.calendar-cell.skeleton { background: #fafafa; border: 1px solid #f0f0f0; position: relative; overflow: hidden; }
.calendar-cell.skeleton::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shimmer 2s infinite; }
.calendar-cell.skeleton .cell-day-number { color: #d0d0d0; background: transparent; }
.calendar-cell.skeleton .cell-top-icons,
.calendar-cell.skeleton .cell-bottom-info { background: transparent; }
@keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }

/* ë¡œë”© ìƒíƒœ í‘œì‹œ */
.loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--text-color-light);
    font-size: 12px;
    z-index: 10;
    background: rgba(255, 255, 255, 0.9);
    padding: 5px 10px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

    #dailyQuestModal .modal-header { padding-top: 25px; padding-bottom: 15px; }
    /* í€˜ìŠ¤íŠ¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .quest-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .quest-tab { padding: 8px 16px; background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; }
    .quest-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    .quest-list { display: flex; flex-direction: column; gap: 10px; }
    .quest-item { background: #fff; border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; transition: all 0.2s ease; }
    .quest-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .quest-item.completed { background: var(--success-color); color: white; border-color: var(--success-color); }
    .quest-item.completed .quest-reward { color: rgba(255,255,255,0.9); }
    .quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .quest-title { font-weight: 600; font-size: 14px; }
    .quest-reward { font-size: 12px; color: var(--primary-color); font-weight: 600; }
    .quest-desc { font-size: 13px; color: var(--text-color-light); margin-bottom: 10px; }
    .quest-progress { display: flex; justify-content: space-between; align-items: center; }
    .quest-progress-bar { flex: 1; height: 6px; background: var(--bg-color); border-radius: 3px; margin-right: 10px; overflow: hidden; }
    .quest-progress-fill { height: 100%; background: var(--primary-color); transition: width 0.3s ease; }
    .quest-progress-text { font-size: 11px; color: var(--text-color-light); min-width: 40px; text-align: right; }
    .quest-item.completed .quest-progress-bar { background: rgba(255,255,255,0.3); }
    .quest-item.completed .quest-progress-fill { background: rgba(255,255,255,0.8); }
    .quest-item.completed .quest-progress-text { color: rgba(255,255,255,0.9); }

    /* ë³´ìƒ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
    #rewardsModal .modal-header { padding: 30px 25px 20px 25px; border-bottom: 1px solid var(--border-color); background: #fff; border-top-left-radius: 16px; border-top-right-radius: 16px; }
    .rewards-list { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; }
    .reward-item { background: #fff; border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s ease; }
    .reward-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .reward-item.bronze { border-color: #CD7F32; background: linear-gradient(135deg, #FFF8DC, #F5F5DC); }
    .reward-item.silver { border-color: #C0C0C0; background: linear-gradient(135deg, #F8F8FF, #E6E6FA); }
    .reward-item.gold { border-color: #FFD700; background: linear-gradient(135deg, #FFFACD, #FFEFD5); }
    .reward-item.legend { border-color: #9400D3; background: linear-gradient(135deg, #F8F0FF, #E6E6FA); }
    .reward-item.used { opacity: 0.5; filter: grayscale(50%); }
    .reward-info { flex: 1; }
    .reward-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; }
    .reward-desc { font-size: 13px; color: var(--text-color-light); }
    .reward-tier { font-size: 11px; font-weight: 600; padding: 2px 6px; border-radius: 4px; margin-bottom: 4px; display: inline-block; }
    .reward-tier.bronze { background: #CD7F32; color: white; }
    .reward-tier.silver { background: #C0C0C0; color: white; }
    .reward-tier.gold { background: #FFD700; color: #333; }
    .reward-tier.legend { background: #9400D3; color: white; }
    .reward-actions { display: flex; gap: 8px; }
    .reward-btn { padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .reward-btn.use { background: var(--success-color); color: white; }
    .reward-btn.use:hover { background: #27ae60; }
    .reward-btn.delete { background: var(--danger-color); color: white; }
    .reward-btn.delete:hover { background: #c0392b; }
    .reward-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .empty-rewards { text-align: center; padding: 40px 20px; color: var(--text-color-light); }

    /* í”„ë¡œí•„ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    .profile-menu-item:hover { background: var(--primary-light); color: var(--primary-color); }
    
    #profileWidget:hover { transform: translateY(-2px); }
    #profileWidget { transition: transform 0.2s ease; }

    .achievements-list { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; }
    .achievement-item { background: #fff; border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; transition: all 0.2s ease; }
    .achievement-item.unlocked { border-color: var(--success-color); background: linear-gradient(135deg, #f8fff8, #e8f5e8); }
    .achievement-item.locked { opacity: 0.6; }
    .achievement-emoji { font-size: 24px; min-width: 40px; text-align: center; }
    .achievement-info { flex: 1; }
    .achievement-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; }
    .achievement-desc { font-size: 13px; color: var(--text-color-light); }
    .achievement-status { font-size: 12px; font-weight: 600; padding: 4px 8px; border-radius: 6px; }
    .achievement-status.unlocked { background: var(--success-color); color: white; }
    .achievement-status.locked { background: var(--border-color); color: var(--text-color-light); }
    .achievement-item.hidden { background: linear-gradient(135deg, #2c3e50, #34495e); color: #ecf0f1; border-color: #34495e; }
    .achievement-item.hidden .achievement-desc { color: #bdc3c7; font-style: italic; }

    @media (max-width: 767px) {
        .modal-content { padding: 0; width: 100%; height: 100%; border-radius: 0; max-height: 100vh; }
        .food-modal { width: 90%; height: auto; border-radius: 16px; max-height: 90vh; }
        .food-modal .modal-body { overflow-y: auto; max-height: calc(90vh - 120px); }
        #dayModal .modal-body { padding: 20px 15px; }
        .modal-input-group { padding: 15px; }
        .modal-input-group h4 { font-size: 15px; }
        #dayModal .form-group label { font-size: 13px; }
        #dayModal .modal-input-row { grid-template-columns: 1fr; gap: 15px; }
        .exercise-toggle-btns { max-width: 180px; }
        .score-display-card, .personal-goals-section { width: 100%; max-width: none; margin: 0; padding: 15px; }
        .score-display-card .score { font-size: 36px; }

        #modalTotalExpense { text-align: left !important; }
        .expense-item { font-size: 13px; word-break: break-all; }
        .expense-item span:first-child { flex-grow: 1; margin-right: 10px; }
        .expense-item > div { flex-shrink: 0; }
        
        .modal-actions-container { padding: 0 15px 20px; display: flex; flex-direction: column; align-items: center; }
        .modal-actions-container .btn.delete { order: 2; background-color: transparent; color: var(--text-color-light); font-size: 14px; font-weight: normal; padding: 8px; box-shadow: none; margin-top: 10px; max-width: 150px; }
        .modal-actions-container .btn.delete:hover { background-color: transparent; color: var(--danger-color); }
        .modal-actions-container .btn.save { order: 1; }

        #budgetPage .budget-summary { flex-wrap: wrap; }
        #budgetPage .budget-summary .budget-card:first-child { flex-basis: 100%; }
        #budgetPage .budget-card-value { font-size: 20px; }
        #dayModal .expense-input-row { flex-direction: column; gap: 10px; }
        #dayModal .expense-input-row input,
        #dayModal .expense-input-row button { width: 100%; }
        .dday-header-container { top: 8px; left: 3px; right: 3px; }
        .container { padding: 40px 20px 95px 20px; }
        .dday-chip { font-size: 10px; padding: 3px 8px; }
        .battery { width: 25px; height: 12px; }
        .receipt-item { font-size: 12px; }
        .receipt-date { min-width: 50px; margin-right: 10px; font-size: 10px; }
        .receipt-desc { margin-right: 10px; }
        .receipt-amount { min-width: 60px; font-size: 12px; }
        .budget-info { flex-direction: column; gap: 2px; font-size: 10px; text-align: right; }
    }
    
    /* ì˜ì–´ ëª¨ë“œì¼ ë•Œ í°íŠ¸ í¬ê¸° ì¡°ì • */
body.lang-en { font-size: 10px; }
body.lang-en .header h1 { font-size: 24px; }
body.lang-en .header p { font-size: 12px; }
body.lang-en .btn { font-size: 12px; }
body.lang-en .modal-content { font-size: 9px; }
body.lang-en .form-group label { font-size: 9px; }
body.lang-en .form-group input,
body.lang-en .form-group textarea,
body.lang-en .form-group select { font-size: 10px; }

    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Profile Widget (Outside Container) -->
    <div id="profileWidget" style="position: fixed; bottom: 20px; left: 20px; z-index: 15; cursor: pointer;" onclick="showProfileMenu()">
        <div style="background: var(--container-bg); border-radius: 0; padding: 8px 12px; border: 3px solid var(--primary-color); min-width: 120px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                <span id="profileEmoji" style="font-size: 18px;">ğŸ‘¾</span>
                <div>
                    <div id="profileLevel" style="font-size: 8px; font-weight: normal; color: var(--primary-color); text-transform: uppercase;">LV.1</div>
                    <div id="profileTitle" style="font-size: 12px; color: var(--text-color-light); text-transform: uppercase;">ë‰´ë¹„</div>
                </div>
            </div>
            <div style="background: var(--bg-color); border-radius: 0; height: 4px; overflow: hidden; border: 1px solid var(--border-color);">
                <div id="expBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--success-color)); transition: width 0.3s ease;"></div>
            </div>
            <div id="expText" style="font-size: 9px; color: var(--text-color-light); text-align: center; margin-top: 2px; text-transform: uppercase;">0/10 EXP</div>
        </div>
    </div>

    <!-- Profile Menu (Dropdown) -->
    <div id="profileMenu" style="position: fixed; bottom: 100px; left: 20px; z-index: 16; display: none;">
        <div style="background: var(--container-bg); border-radius: 0; padding: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.15); border: 2px solid var(--border-color); min-width: 160px;">
            <div class="profile-menu-item" onclick="showQuestPage()" style="padding: 8px 12px; border-radius: 0; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 8px; margin-bottom: 4px; transition: background 0.2s ease; text-transform: uppercase;">
                <span>ğŸ¯</span> í€˜ìŠ¤íŠ¸
            </div>
            <div class="profile-menu-item" onclick="showRewardsModal()" style="padding: 8px 12px; border-radius: 0; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 8px; margin-bottom: 4px; transition: background 0.2s ease; text-transform: uppercase;">
                <span>ğŸ</span> ë³´ìƒ ëª©ë¡
            </div>
            <div class="profile-menu-item" onclick="showAchievementsModal()" style="padding: 8px 12px; border-radius: 0; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 8px; transition: background 0.2s ease; text-transform: uppercase;">
                <span>ğŸ…</span> ì—…ì 
            </div>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="authContainer" style="position: fixed; bottom: 15px; right: 20px; text-align: right; z-index: 10;">
        <div id="userInfo" style="display: none; font-size: 6px; margin-bottom: 5px; text-transform: uppercase; color: var(--text-color-light);"></div>
        <button id="loginBtn" class="btn" style="padding: 5px 10px; font-size: 12px; text-transform: uppercase;">Google ë¡œê·¸ì¸</button>
        <button id="logoutBtn" class="btn secondary" style="display: none; padding: 5px 10px; font-size: 12px; text-transform: uppercase;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="container">

        <!-- Goal Setup Page -->
        <div id="goalSetup" class="page">
             <div class="header"><h1>ğŸ¯ ëª©í‘œ ì„¤ì •</h1><p>ì‹œì‘ì´ ë°˜! ëª©í‘œ ê¸°ìƒ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</p></div>
             <div class="form-group">
                <label for="targetWakeTime">ëª©í‘œ ê¸°ìƒ ì‹œê°„</label>
                <input type="text" id="targetWakeTime" placeholder="HH:MM (ì˜ˆ: 07:30)">
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">í•œ ë²ˆ ì„¤ì •í•˜ë©´ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</small>
            </div>
            <button class="btn" onclick="saveGoalAndContinue()">ì €ì¥í•˜ê³  ì‹œì‘í•˜ê¸°</button>
        </div>
        
        <!-- Wake Up Prompt Page -->
        <div id="wakeUpPrompt" class="page">
            <div class="wakeup-prompt">
                <h2>ğŸŒ… ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”!</h2>
                <p id="wakeupDate"></p>
                <p>ì˜¤ëŠ˜ì˜ ê¸°ìƒ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="form-group">
                <label for="promptWakeTime">ì‹¤ì œ ê¸°ìƒ ì‹œê°„</label>
                <input type="text" id="promptWakeTime" placeholder="HH:MM (ì˜ˆ: 07:30)">
            </div>
            <button class="btn" onclick="saveWakeTimeFromPrompt()">ì €ì¥í•˜ê³  ì‹œì‘</button>
            <button class="btn secondary" onclick="skipToCalendar()" style="margin-top:10px;">ë‚˜ì¤‘ì— ì…ë ¥</button>
        </div>

        <!-- Calendar Page -->
        <div id="calendarPage" class="page active">
            <div class="dday-header-container">
                <div id="ddayContainer" style="display: flex; flex-direction: column; gap: 3px; pointer-events:all; padding-left: 5px;"></div>
                <div class="dday-right-container" style="display: flex; align-items: center; gap: 10px; pointer-events:all; padding-right: 5px;">
                    <div id="budgetBarSmall" class="battery">
                        <div class="battery-level" id="budgetBarFillSmall"></div>
                    </div>
                </div>
            </div>
            <div class="header">
                <h1>ğŸ—“ï¸ ë£¨í‹´ ìº˜ë¦°ë”</h1>
                <div id="gameWarning"></div>
                <div id="syncStatus" style="
                    position: absolute; 
                    top: 10px; 
                    right: 120px; 
                    font-size: 11px; 
                    color: var(--text-color-light);
                    background: rgba(255,255,255,0.9);
                    padding: 3px 8px;
                    border-radius: 12px;
                    display: none;
                    ">â˜ï¸ ë™ê¸°í™” ì¤‘...</div>
            </div>
            <div class="calendar-header">
                <button class="month-nav" onclick="changeMonth(-1)"><</button>
                <div class="month-year" id="monthYear"></div>
                <button class="month-nav" onclick="changeMonth(1)">></button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
            <div class="legend"><div class="legend-item"><div class="legend-color" style="background: var(--success-color)"></div><span>ìš°ìˆ˜(80+)</span></div><div class="legend-item"><div class="legend-color" style="background: var(--warning-color)"></div><span>ë³´í†µ(40+)</span></div><div class="legend-item"><div class="legend-color" style="background: var(--danger-color)"></div><span>ë¯¸í¡(1+)</span></div><div class="legend-item"><div class="legend-color" style="background: #34495e"></div><span>ìµœì•…(0ë¯¸ë§Œ)</span></div><div class="legend-item"><div class="legend-color" style="background: #e9ecef"></div><span>íœ´ì‹ì¼</span></div></div>
            <div class="main-actions" style="margin-top: 20px;">
                <button class="btn" onclick="showMonthlyStats()">í†µê³„</button>
                <button class="btn" onclick="showPersonalGoals()">ëª©í‘œ</button>
            </div>
            <div class="main-actions" style="margin-top: 10px;">
                <button class="btn" onclick="showBudgetPage()">ê°€ê³„ë¶€</button>
                <button class="btn" onclick="showFoodPage()">ì‹ë‹¨</button>
            </div>
            <button class="btn secondary" onclick="showSettings()" style="margin-top:0px;">âš™ï¸ ì„¤ì •</button>
        </div>

        <!-- Day Modal -->
        <div id="dayModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="date-nav-btn" onclick="navigateModalDate(-1)"><</button>
                    <div class="modal-title" id="modalTitle"></div>
                    <button class="date-nav-btn" onclick="navigateModalDate(1)">></button>
                    <button class="close-btn" onclick="closeDayModal()">Ã—</button>
                </div>
            <div class="modal-body">
            <div class="modal-layout">
    
    <!-- 1. ì¸ìƒì€ íƒ€ì´ë° -->
    <div class="modal-input-group">
        <h4>â° ì¸ìƒì€ íƒ€ì´ë°</h4>
        <div class="modal-input-row">
            <div class="form-group"><label for="modalWakeTime">ê¸°ìƒ ì‹œê°„</label><input type="text" id="modalWakeTime" placeholder="HH:MM"></div>
            <div class="form-group"><label for="modalSeatTime">ì°©ì„ ì‹œê°„</label><input type="text" id="modalSeatTime" placeholder="HH:MM"></div>
            <div class="form-group"><label for="modalSleepTime">ì·¨ì¹¨ ì‹œê°„</label><input type="text" id="modalSleepTime" placeholder="HH:MM (ìµì¼ 1ì‹œâ†’25:00)"></div>
        </div>
    </div>

    <!-- 2. ì§‘ì¤‘ì˜ ë½€ëª¨ë„ë¡œ -->
    <div class="modal-input-group">
        <h4>ğŸ… ì§‘ì¤‘ì˜ ë½€ëª¨ë„ë¡œ</h4>
        <div class="modal-input-row">
            <div class="form-group">
                <label for="modalMorningPomodoro">ì˜¤ì „</label>
                <div class="number-input-group">
                    <button type="button" class="number-btn minus" onclick="adjustPomodoro('modalMorningPomodoro', -1)">âˆ’</button>
                    <input type="number" id="modalMorningPomodoro" min="0" value="0" readonly>
                    <button type="button" class="number-btn plus" onclick="adjustPomodoro('modalMorningPomodoro', 1)">+</button>
                </div>
            </div>
            <div class="form-group">
                <label for="modalAfternoonPomodoro">ì˜¤í›„</label>
                <div class="number-input-group">
                    <button type="button" class="number-btn minus" onclick="adjustPomodoro('modalAfternoonPomodoro', -1)">âˆ’</button>
                    <input type="number" id="modalAfternoonPomodoro" min="0" value="0" readonly>
                    <button type="button" class="number-btn plus" onclick="adjustPomodoro('modalAfternoonPomodoro', 1)">+</button>
                </div>
            </div>
            <div class="form-group">
                <label for="modalEveningPomodoro">ì €ë…</label>
                <div class="number-input-group">
                    <button type="button" class="number-btn minus" onclick="adjustPomodoro('modalEveningPomodoro', -1)">âˆ’</button>
                    <input type="number" id="modalEveningPomodoro" min="0" value="0" readonly>
                    <button type="button" class="number-btn plus" onclick="adjustPomodoro('modalEveningPomodoro', 1)">+</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. ê°œì¸ ëª©í‘œ -->
    <div class="personal-goals-section modal-input-group">
        <h4>ğŸ¯ ê°œì¸ ëª©í‘œ</h4>
        <div id="modalPersonalGoalsList"></div>
    </div>

    <!-- 4. ìê¸°ê³„ë°œ -->
    <div class="modal-input-group">
        <h4>ğŸ’ª ìê¸°ê³„ë°œ</h4>
        <div class="exercise-toggle-group">
            <label>ì˜¤ëŠ˜ ìš´ë™í–ˆë‚˜ìš”?</label>
            <div class="exercise-toggle-btns">
                <button id="exerciseBtnYes" class="exercise-toggle-btn" onclick="toggleExercise(true)">âœ”ï¸ Yes</button>
                <button id="exerciseBtnNo" class="exercise-toggle-btn active" onclick="toggleExercise(false)">âœ–ï¸ No</button>
            </div>
        </div>
        <div class="modal-input-row" style="align-items: flex-end;">
            <div class="form-group" id="modalExerciseTimeGroup" style="display: none; width: 100%;">
                <label for="modalExerciseMinutes">ìš´ë™ ì‹œê°„ (ë¶„)</label>
                <input type="number" id="modalExerciseMinutes" min="0" value="0">
            </div>
            <div class="form-group" style="width: 100%;">
                <label for="modalWriting">ê¸€ì“°ê¸° (ì)</label>
                <input type="text" id="modalWriting" value="0" inputmode="numeric" oninput="formatNumberWithCommas(this)">
            </div>
            <div class="form-group" style="width: 100%;">
                <label for="modalGameTime">ê²Œì„ (ë¶„)</label>
                <input type="number" id="modalGameTime" min="0" value="0">
            </div>
        </div>
    </div>

    <!-- 5. ì§€ì¶œ ê¸°ë¡ -->
    <div class="modal-input-group">
        <h4>ğŸ’° ì§€ì¶œ ê¸°ë¡</h4>
        <div id="modalTotalExpense" style="text-align: left; font-weight: 600; margin-bottom: 10px; color: var(--primary-color); font-size: 14px;"></div>
        <div id="modalExpenseList" class="expense-list"></div>
        <div class="expense-input-row">
            <input type="text" id="expenseDesc" placeholder="ì§€ì¶œ ë‚´ì—­">
            <input type="text" id="expenseAmount" placeholder="ê¸ˆì•¡" inputmode="numeric" oninput="formatNumberWithCommas(this)">
            <button onclick="addExpense()">+</button>
        </div>
    </div>

    <!-- 6. ì˜¤ëŠ˜ì˜ ì ìˆ˜ -->
    <div class="score-display-card">
        <div class="score" id="modalScore">0</div>
        <div>ì˜¤ëŠ˜ì˜ ì ìˆ˜</div>
    </div>

    <!-- 7. ì˜¤ëŠ˜ì˜ í•œë§ˆë”” -->
    <div class="modal-input-group" id="modalCommentSection">
        <details id="commentDetails">
            <summary>ğŸ’¬ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ë‚¨ê¸°ê¸°</summary>
                <textarea id="modalComment" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë• ë‚˜ìš”? (ìµœëŒ€ 500ì)" maxlength="500" oninput="updateCommentCounter()"></textarea>
                <div id="commentCharCounter" style="text-align: right; font-size: 12px; color: var(--text-color-light); margin-top: 5px;">0/500</div>
        </details>
    </div>

    <!-- 8. ì˜¤ëŠ˜ì€ ì‰¬ê¸° -->
    <div class="modal-input-group">
        <div class="checkbox-group" style="display:flex; align-items:center; gap:10px; padding: 5px 0;">
            <input type="checkbox" id="modalOffDay" style="width:18px; height:18px;">
            <label for="modalOffDay" style="margin:0; font-weight:normal;">â˜•ï¸ ì˜¤ëŠ˜ ì‰¬ê¸° (Off Day)</label>
        </div>
    </div>
</div>
                </div>
                <div id="saveStatus" style="text-align: center; font-size: 12px; color: var(--text-color-light); height: 20px; margin-bottom: 5px;"></div>
                <div class="modal-actions-container">
                    <button class="btn save" onclick="finalizeDay()">ì˜¤ëŠ˜ì˜ ì¼ì • ì¢…ë£Œ</button>
                    <button class="btn delete" onclick="deleteModalData()">ì‚­ì œ</button>
                </div>
            </div>
        </div>
        
        <!-- Quest Page -->
        <div id="questPage" class="page">
            <div class="header">
                <h1>ğŸ§© í€˜ìŠ¤íŠ¸</h1>
                <p>ê²½í—˜ì¹˜ë¥¼ íšë“í•˜ê³  ë ˆë²¨ì—…í•˜ì„¸ìš”!</p>
            </div>
            
            <!-- í€˜ìŠ¤íŠ¸ íƒ­ -->
            <div class="quest-tabs" style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="quest-tab active" onclick="switchQuestTab('daily')">ì¼ê°„</button>
                <button class="quest-tab" onclick="switchQuestTab('weekly')">ì£¼ê°„</button>
                <button class="quest-tab" onclick="switchQuestTab('monthly')">ì›”ê°„</button>
            </div>
            
            <!-- ì¼ê°„ í€˜ìŠ¤íŠ¸ -->
            <div id="dailyQuestTab" class="quest-tab-content">
                <h3>ğŸ”– ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸ (5ê°œ)</h3>
                <div id="dailyQuestList" class="quest-list">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
                <div style="text-align: center; margin: 15px 0; font-size: 12px; color: var(--text-color-light);">
                    ì™„ë£Œí•œ í€˜ìŠ¤íŠ¸ë§ˆë‹¤ +2 ê²½í—˜ì¹˜ íšë“!
                </div>
            </div>
            
            <!-- ì£¼ê°„ í€˜ìŠ¤íŠ¸ -->
            <div id="weeklyQuestTab" class="quest-tab-content" style="display: none;">
                <h3>ğŸ¥ ì´ë²ˆ ì£¼ í€˜ìŠ¤íŠ¸ (8ê°œ)</h3>
                <div id="weeklyQuestList" class="quest-list">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
                <div style="text-align: center; margin: 15px 0; font-size: 12px; color: var(--text-color-light);">
                    ì™„ë£Œí•œ í€˜ìŠ¤íŠ¸ë§ˆë‹¤ +3~5 ê²½í—˜ì¹˜ íšë“!
                </div>
            </div>
            
            <!-- ì›”ê°„ í€˜ìŠ¤íŠ¸ -->
            <div id="monthlyQuestTab" class="quest-tab-content" style="display: none;">
                <h3>â›³ ì´ë²ˆ ë‹¬ í€˜ìŠ¤íŠ¸</h3>
                <div id="monthlyQuestList" class="quest-list">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
                <div style="text-align: center; margin: 15px 0; font-size: 12px; color: var(--text-color-light);">
                    ì™„ë£Œí•œ í€˜ìŠ¤íŠ¸ë§ˆë‹¤ +7~10 ê²½í—˜ì¹˜ íšë“!
                </div>
            </div>
            
            <button class="btn secondary" onclick="backToCalendar()" style="margin-top: 20px;">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- Personal Goals Page -->
        <div id="personalGoalsPage" class="page">
            <div class="header">
                <h1>ğŸ¯ ì§‘ì¤‘ ëª©í‘œ</h1>
                <p>ë‚˜ë§Œì˜ ëª©í‘œë¥¼ ì¶”ê°€í•˜ê³  ë‹¬ì„±ë¥ ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
            </div>
            <div class="goal-tabs">
                <button class="goal-tab active" onclick="switchGoalTab('active')">ì§„í–‰ ì¤‘</button>
                <button class="goal-tab" onclick="switchGoalTab('completed')">ì™„ë£Œ</button>
            </div>
            <div id="personalGoalsList" class="personal-goals-list"></div>
            <div class="modal-input-group" style="margin-top:20px;">
                <h4>ìƒˆ ëª©í‘œ ì¶”ê°€</h4>
                <div class="goal-type-toggle">
                    <button id="goalTypePositive" class="active" onclick="toggleGoalType('positive')">ğŸ‘ ëŠ˜ë¦¬ê¸° (Good Habits)</button>
                    <button id="goalTypeNegative" onclick="toggleGoalType('negative')">ğŸ‘ ì¤„ì´ê¸° (Bad Habits)</button>
                </div>
                <div class="form-group">
                   <label for="newGoalName">ëª©í‘œ ì´ë¦„</label>
                   <input type="text" id="newGoalName" placeholder="ì˜ˆ: ìˆ˜í•™ ë¬¸ì œì§‘ í’€ê¸°">
                </div>
                <div class="modal-input-row">
                    <div class="form-group">
                        <label for="newGoalTarget">ëª©í‘œëŸ‰</label>
                        <input type="number" id="newGoalTarget" placeholder="ì˜ˆ: 200" min="1">
                    </div>
                    <div class="form-group">
                        <label for="newGoalUnit">ê¸°ê°„ (ì¼)</label>
                        <input type="number" id="newGoalUnit" placeholder="ì˜ˆ: 10" min="1">
                    </div>
                </div>
                <div class="form-group">
                    <label for="newGoalCustomUnit">ë‹¨ìœ„</label>
                    <input type="text" id="newGoalCustomUnit" placeholder="ì˜ˆ: ìª½, ë¶„, ê°œ">
                </div>
                <button class="btn" onclick="addPersonalGoal()">ëª©í‘œ ì¶”ê°€</button>
            </div>
            <button class="btn secondary" onclick="backToCalendar()" style="margin-top:20px;">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- Budget Page -->
        <div id="budgetPage" class="page">
            <div id="expenseList" class="expense-list-page"></div>
            <button class="btn secondary" onclick="backToCalendar()" style="margin-top: 30px;">ëŒì•„ê°€ê¸°</button>
        </div>

                <!-- Food Page -->
                <div id="foodPage" class="page">
                    <div class="header">
                        <h1>ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡</h1>
                        <p>ì˜¤ëŠ˜ ë­˜ ë“œì…¨ë‚˜ìš”?</p>
                    </div>
        
                    <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                    <div class="food-page-actions">
                        <button class="btn" onclick="showAddFoodModal()">+ ì‹ë‹¨ ì¶”ê°€</button>
                        <button class="btn secondary" onclick="toggleFoodManageMode()" id="foodManageBtn">ğŸ”§ ê´€ë¦¬</button>
                    </div>
        
                    <!-- ì‹ë‹¨ ê¸°ë¡ì´ í‘œì‹œë  ì˜ì—­ -->
                    <div id="foodRecordsList" class="food-records"></div>
        
                    <!-- [ìœ„ì¹˜ ë³€ê²½] ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ì„ ì‹ë‹¨ ëª©ë¡ ì•„ë˜, ëŒì•„ê°€ê¸° ë²„íŠ¼ ìœ„ë¡œ ì´ë™ -->
                    <div class="main-actions" style="margin-top: 30px; margin-bottom: 10px;">
                         <button class="btn" onclick="exportFoodAsImage()" style="background-color: var(--primary-dark);">ğŸ“¸ ì´ë¯¸ì§€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                    </div>
        
                    <!-- ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
                    <button class="btn secondary" onclick="backToCalendar()">ëŒì•„ê°€ê¸°</button>
                </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="page">
            <div class="header"><h1>âš™ï¸ ì„¤ì •</h1></div>
            <div class="form-group"><label for="settingsWakeTime">â˜€ï¸ ëª©í‘œ ê¸°ìƒ ì‹œê°„</label><input type="text" id="settingsWakeTime" placeholder="HH:MM (ì˜ˆ: 07:30)"></div>
            <div class="budget-settings form-group">
                <label for="monthlyBudgetInput">ğŸ’° ì›” ì˜ˆì‚° ì„¤ì •</label>
                <input type="text" id="monthlyBudgetInput" placeholder="ì›” ì˜ˆì‚° (ì›)" inputmode="numeric" oninput="formatNumberWithCommas(this)">
            </div>
            <div class="form-group">
                <label for="partnerEmailInput">ğŸ¤ ì±…ì„ ê³µìœ  íŒŒíŠ¸ë„ˆ ì´ë©”ì¼</label>
                <input type="email" id="partnerEmailInput" placeholder="ì£¼ê°„ ë¦¬í¬íŠ¸ë¥¼ ë°›ì„ íŒŒíŠ¸ë„ˆì˜ ì´ë©”ì¼">
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">ì£¼ê°„ í‰ê·  ì ìˆ˜ê°€ 40ì  ë¯¸ë§Œì¼ ê²½ìš°, íŒŒíŠ¸ë„ˆì—ê²Œ ìë™ìœ¼ë¡œ ì„±ê³¼ ë³´ê³ ì„œê°€ ë°œì†¡ë©ë‹ˆë‹¤.</small>
            </div>
            <div class="dday-settings form-group">
                <label>â° D-Day ì„¤ì •</label>
                <div id="ddaySettingsList" class="dday-settings-list"></div>
                <button id="addDdayBtn" class="btn secondary" onclick="addDday()" style="margin-top: 10px;">D-Day ì¶”ê°€</button>
            </div>
            <button class="btn" onclick="updateSettings()" style="margin-top:20px;">ì„¤ì • ì €ì¥</button>
            <button class="btn secondary" onclick="showCommentHistory()" style="margin-top:10px;">ğŸ’¬ ë‚˜ì˜ ê¸°ë¡ë“¤ ë³´ê¸°</button>
            <button class="btn secondary" onclick="openExcelModal()" style="margin-top:10px;">ğŸ“ˆ ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn secondary" onclick="exportData()" style="flex: 1;">ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)</button>
                <button class="btn secondary" onclick="document.getElementById('importFile').click()" style="flex: 1;">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ë³µêµ¬)</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn" onclick="syncAllToFirebase()" style="flex: 1;">â˜ï¸ í´ë¼ìš°ë“œ ë°±ì—…</button>
                <button class="btn secondary" onclick="loadFromFirebase()" style="flex: 1;">ğŸ“¥ í´ë¼ìš°ë“œì—ì„œ ë³µì›</button>
            </div>
            <button class="btn secondary" onclick="backToCalendar()" style="margin-top:10px;">ëŒì•„ê°€ê¸°</button>
            
            <!-- ìˆ¨ê²¨ì§„ ê°œë°œì ë„êµ¬ -->
            <div id="devTools" style="display: none; background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; border: 2px solid #e74c3c;">
                <h4 style="margin: 0 0 15px 0;">ğŸ”§ ì‹œí¬ë¦¿ ê°œë°œì ë„êµ¬</h4>
                <p style="font-size: 12px; opacity: 0.8; margin-bottom: 15px;">ì œëª©ì„ 5ë²ˆ ì—°ì† í´ë¦­í•˜ë©´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤</p>
                
                <!-- í…Œë§ˆ & ì–¸ì–´ ì„¹ì…˜ -->
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <h5 style="margin: 0 0 10px 0; font-size: 14px;">ğŸ¨ í…Œë§ˆ & ì–¸ì–´</h5>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px;">
                        <button onclick="changeTheme('light')" style="background: #f8f9fa; color: #333; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ë¼ì´íŠ¸</button>
                        <button onclick="changeTheme('dark')" style="background: #343a40; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ë‹¤í¬</button>
                        <button onclick="changeTheme('excel')" style="background: #00ff41; color: black; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ì—‘ì…€</button>
                        <button onclick="changeTheme('sakura')" style="background: #ec4899; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ë²šê½ƒ</button>
                        <button onclick="changeTheme('paperbook')" style="background: #2563eb; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">í˜ì´í¼ë¶</button>
                        <button onclick="changeTheme('nature')" style="background: #256c2f; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ìì—°</button>
                        <button onclick="changeTheme('military')" style="background: #323238; color: rgba(255, 255, 255, 0.758); padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ë°€ë¦¬í„°ë¦¬</button>
                    </div>
                    <button onclick="toggleLanguage()" style="background: #6c757d; color: white; padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">ğŸŒ ì–¸ì–´ ì „í™˜ (<span id="currentLangDisplay">í•œêµ­ì–´</span>)</button>
                </div>
                
                <!-- ê¸°ì¡´ ê°œë°œì ë„êµ¬ë“¤ -->
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                    <button onclick="resetQuests()" style="background: #e74c3c; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ—‘ï¸ í€˜ìŠ¤íŠ¸ ë¦¬ì…‹</button>
                    <button onclick="resetExperience()" style="background: #f39c12; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">âš¡ ê²½í—˜ì¹˜ ë¦¬ì…‹</button>
                    <button onclick="resetAchievements()" style="background: #e67e22; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ… ì—…ì  ë¦¬ì…‹</button>
                    <button onclick="resetAll()" style="background: #8e44ad; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ’€ ì „ì²´ ë¦¬ì…‹</button>
                    <button onclick="testPersonalGoalAchievements()" style="background: #9b59b6; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ¯ ëª©í‘œ ì—…ì  í…ŒìŠ¤íŠ¸</button>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="addExperience(100, 'ê°œë°œì ì¹˜íŠ¸')" style="background: #27ae60; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ +100 EXP</button>
                    <button onclick="addExperience(1000, 'ê°œë°œì ëŒ€ë°•ì¹˜íŠ¸')" style="background: #16a085; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ’ +1000 EXP</button>
                    <button onclick="toggleDevTools()" style="background: #95a5a6; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ‘» ìˆ¨ê¸°ê¸°</button>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(231, 76, 60, 0.2); border-radius: 8px;">
                    <small>âš ï¸ <strong>ì£¼ì˜:</strong> ì´ ê¸°ëŠ¥ë“¤ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”!</small>
                </div>
            </div>
        
        </div> <!-- ì´ íƒœê·¸ê°€ settingsPageì˜ ë‹«ëŠ” íƒœê·¸ì…ë‹ˆë‹¤. -->

        <!-- Monthly Stats Page -->
        <div id="monthlyStatsPage" class="page">
            <div class="header">
                <h1>ğŸ“Š ì›”ê°„í†µê³„</h1>
                <p id="statsMonth"></p>
            </div>
            <div class="monthly-summary">
                <div class="summary-card">
                    <div class="summary-title">í‰ê·  ì ìˆ˜</div>
                    <div class="summary-value" id="avgScore">ğŸ“ˆ 0ì </div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">ê°œì¸ëª©í‘œ ë‹¬ì„±ë¥ </div>
                    <div class="summary-value" id="avgGoalRate">ğŸ˜ 0%</div>
                </div>
                <div class="summary-card">
                    <div class="summary-title">ê¸€ì“°ê¸° ì™„ì„±</div>
                    <div class="summary-value" id="writingBooks">ğŸ“– 0ê¶Œ</div>
                </div>
            </div>
            <div class="hall-of-fame-container" style="margin-bottom: 30px;">
                <h3 style="text-align: center; margin-bottom: 15px;">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ†</h3>
                <div id="hallOfFame" class="fame-grid">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
            </div>
            
            <div class="wall-of-shame-container" style="margin-bottom: 30px;">
                <h3 style="text-align: center; margin-bottom: 15px;">ğŸ§± ë°˜ì„±ì˜ ë²½ ğŸ§±</h3>
                <div id="wallOfShame" class="fame-grid">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
            </div>
            <div id="weeklyDetails" class="weekly-details"></div>
            <button class="btn secondary" onclick="backToCalendar()">ëŒì•„ê°€ê¸°</button>
        </div>
        
        <!-- Feedback and Reason Modals -->
        <div id="feedbackPopup" class="feedback-popup"> <div class="feedback-content"><div class="feedback-emoji" id="feedbackEmoji">ğŸ‰</div><div class="feedback-title" id="feedbackTitle"></div><div class="feedback-message" id="feedbackMessage"></div><div style="margin-top: 20px;"><button class="feedback-btn" onclick="closeFeedbackPopup()">í™•ì¸</button></div></div></div>
        <div id="reasonModal" class="modal-overlay"> <div class="modal-content" style="background:white; padding: 25px;"><div class="modal-header"><h2 class="modal-title">ì£¼ê°„ ì„±ì°°</h2><button class="close-btn" onclick="closeReasonModal()">Ã—</button></div><p style="margin-bottom: 15px; color: #555;">ì´ë²ˆ ì£¼ í‰ê·  ì ìˆ˜ê°€ 25ì  ë¯¸ë§Œì…ë‹ˆë‹¤. ì„±ê³¼ê°€ ì €ì¡°í–ˆë˜ ì´ìœ ë¥¼ ì†”ì§í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”.</p><div class="form-group"><textarea id="reasonText" rows="5" placeholder="ì˜ˆ: íšŒì‚¬ í”„ë¡œì íŠ¸ ë§ˆê° ë•Œë¬¸ì— ë„ˆë¬´ ë°”ë¹´ì–´ìš”."></textarea></div><button class="btn" onclick="submitReason()">ì œì¶œí•˜ê³  í”¼ë“œë°± ë°›ê¸°</button></div></div>
        
        <!-- Comment History Page -->
        <div id="commentHistoryPage" class="page">
            <div class="header">
                <h1>ğŸ’¬ ë‚˜ì˜ ê¸°ë¡ë“¤</h1>
                <p>ë‚´ê°€ ë‚¨ê¸´ í•˜ë£¨ì˜ í”ì ë“¤</p>
            </div>
            <div id="commentHistoryList" class="comment-history-list">
                <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
            </div>
            <button class="btn secondary" onclick="showSettings()" style="margin-top:20px;">ëŒì•„ê°€ê¸°</button>
        </div>

        <!-- Excel Export Modal -->
        <div id="excelExportModal" class="modal-overlay">
            <div class="modal-content" style="max-width: 450px;">
                <div class="modal-header">
                    <h2 class="modal-title">ì—‘ì…€ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h2>
                    <button class="close-btn" onclick="closeExcelModal()">Ã—</button>
                </div>
                <div style="padding: 25px;">
                    <p style="margin-bottom: 15px; color: #555;">ë‚´ë³´ë‚¼ ë°ì´í„°ì˜ ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                    <div id="periodSelector">
                        <div class="excel-option-item"><input type="radio" id="periodThisMonth" name="period" value="thisMonth" checked onchange="toggleDateInputs(false)"><label for="periodThisMonth">ì´ë²ˆ ë‹¬</label></div>
                        <div class="excel-option-item"><input type="radio" id="periodLastMonth" name="period" value="lastMonth" onchange="toggleDateInputs(false)"><label for="periodLastMonth">ì§€ë‚œë‹¬</label></div>
                        <div class="excel-option-item"><input type="radio" id="periodAllTime" name="period" value="allTime" onchange="toggleDateInputs(false)"><label for="periodAllTime">ì „ì²´ ê¸°ê°„</label></div>
                        <div class="excel-option-item"><input type="radio" id="periodCustom" name="period" value="custom" onchange="toggleDateInputs(true)"><label for="periodCustom">ê¸°ê°„ ì§ì ‘ ì„ íƒ</label></div>
                    </div>
                    <div id="customDateRange" style="display: none;"><input type="date" id="startDate"><span>~</span><input type="date" id="endDate"></div>
                    <button class="btn" onclick="exportToExcel()" style="margin-top: 20px;">í™•ì¸ ë° ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>
        </div>
    </div>

        <!-- [ì»´íŒ©íŠ¸ ëª¨ë‹¬] Food Modals (í‚¤ì›Œë“œ/ìˆ˜ë™) -->
        <div id="foodSuggestionModal" class="modal-overlay">
            <div class="modal-content food-modal">
                <div class="modal-header"><h2 class="modal-title">ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡</h2><button class="close-btn" onclick="closeFoodSuggestion()">Ã—</button></div>
                <div class="modal-body">
                    <p style="text-align:center; color: var(--text-color-light); margin-bottom: 20px;">ì§€ì¶œ ë‚´ì—­ì— ìŒì‹ ê´€ë ¨ í‚¤ì›Œë“œê°€ ê°ì§€ë˜ì—ˆì–´ìš”!</p>
                    <div class="form-group"><label for="foodNameInput">ë¬´ì—‡ì„ ë“œì…¨ë‚˜ìš”?</label><input type="text" id="foodNameInput" placeholder="ì˜ˆ: ì•„ë©”ë¦¬ì¹´ë…¸"></div>
                    <div class="form-group"><label for="foodQuantityInput">ì–¼ë§ˆë‚˜ ë“œì…¨ë‚˜ìš”?</label><div class="quantity-input"><input type="text" id="foodQuantityInput" placeholder="1" inputmode="decimal"><select id="foodUnitSelect"><option>ê°œ</option><option>ì”</option><option>ml</option><option>g</option><option>ë´‰ì§€</option><option>ì¡°ê°</option><option>ê·¸ë¦‡</option><option>ì¸ë¶„</option><option>ë³‘</option></select></div></div>
                    <div class="food-modal-actions"><button class="btn" onclick="saveFoodRecord()">ì‹ë‹¨ ì €ì¥</button><button class="btn secondary" onclick="closeFoodSuggestion()">ì·¨ì†Œ</button></div>
                </div>
            </div>
        </div>
    
        <div id="manualFoodModal" class="modal-overlay">
            <div class="modal-content food-modal">
                <div class="modal-header"><h2 class="modal-title" id="manualFoodModalTitle">ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡ ì¶”ê°€</h2><button class="close-btn" onclick="closeManualFoodModal()">Ã—</button></div>
                <div class="modal-body">
                    <div class="form-group"><label for="manualFoodDate">ë‚ ì§œ</label><input type="date" id="manualFoodDate"></div>
                    <div class="form-group"><label for="manualFoodTime">ì‹œê°„</label><input type="time" id="manualFoodTime"></div>
                    <div class="form-group"><label for="manualFoodName">ë¬´ì—‡ì„ ë“œì…¨ë‚˜ìš”?</label><input type="text" id="manualFoodName" placeholder="ì˜ˆ: ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ"></div>
                    <div class="form-group"><label for="manualFoodQuantity">ì–¼ë§ˆë‚˜ ë“œì…¨ë‚˜ìš”?</label><div class="quantity-input"><input type="text" id="manualFoodQuantity" placeholder="1" inputmode="decimal"><select id="manualFoodUnit"><option>ê°œ</option><option>ì”</option><option>ml</option><option>g</option><option>ë´‰ì§€</option><option>ì¡°ê°</option><option>ê·¸ë¦‡</option><option>ì¸ë¶„</option><option>ë³‘</option></select></div></div>
                    <div class="food-modal-actions"><button class="btn" onclick="saveManualFoodRecord()">ì‹ë‹¨ ì €ì¥</button><button class="btn secondary" onclick="closeManualFoodModal()">ì·¨ì†Œ</button></div>
                </div>
            </div>
        </div>

        <!-- Gacha Modal -->
    <div id="gachaModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px; background: white;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ° ë ˆë²¨ì—… ë³´ìƒ ë½‘ê¸°</h2>
                <button class="close-btn" onclick="closeGachaModal()">Ã—</button>
            </div>
            <div style="padding: 25px; text-align: center;">
                <div id="gachaContent">
                    <p style="font-size: 16px; margin-bottom: 20px; color: var(--text-color);">
                        ë ˆë²¨ì—…ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸŠ<br>
                        íŠ¹ë³„í•œ ë³´ìƒì„ íšë“í•  ê¸°íšŒì…ë‹ˆë‹¤!
                    </p>
                    
                    <div style="background: var(--bg-color); border-radius: 12px; padding: 20px; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 14px;">
                            <div><span style="color: #CD7F32;">â—</span> ë¸Œë¡ ì¦ˆ 70%</div>
                            <div><span style="color: #C0C0C0;">â—</span> ì‹¤ë²„ 25%</div>
                            <div><span style="color: #FFD700;">â—</span> ê³¨ë“œ 4%</div>
                            <div><span style="color: #9400D3;">â—</span> ë ˆì „ë“œ 1%</div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="executeGacha()" style="font-size: 18px; padding: 15px 30px;">
                        ğŸ° ë½‘ê¸° ì‹¤í–‰!
                    </button>
                </div>
                
                <div id="gachaResult" style="display: none;">
                    <div id="gachaResultCard" style="background: linear-gradient(135deg, #CD7F32, #A0522D); color: white; border-radius: 16px; padding: 30px; margin: 20px 0;">
                        <div id="gachaResultEmoji" style="font-size: 60px; margin-bottom: 15px;">ğŸ</div>
                        <div id="gachaResultTier" style="font-size: 24px; font-weight: 700; margin-bottom: 10px;">BRONZE</div>
                        <div id="gachaResultName" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">ë³´ìƒ ì´ë¦„</div>
                        <div id="gachaResultDesc" style="font-size: 14px; opacity: 0.9;">ë³´ìƒ ì„¤ëª…</div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="useRewardNow()" id="useNowBtn">ì§€ê¸ˆ ì‚¬ìš©</button>
                        <button class="btn secondary" onclick="saveForLater()">ë‚˜ì¤‘ì— ì‚¬ìš©</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rewards Inventory Modal -->
    <div id="rewardsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px; background: white;">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ ë³´ìƒ ëª©ë¡</h2>
                <button class="close-btn" onclick="closeRewardsModal()">Ã—</button>
            </div>
            <div style="padding: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>ë³´ìœ í•œ ë³´ìƒë“¤</h3>
                    <div id="availableGachaCount" style="background: var(--primary-light); color: var(--primary-color); padding: 8px 12px; border-radius: 8px; font-weight: 600;">
                        ë½‘ê¸° ê¸°íšŒ: 0íšŒ
                    </div>
                </div>
                
                <div id="rewardsList" class="rewards-list">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn secondary" onclick="closeRewardsModal()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px; background: white;">
            <div class="modal-header" style="padding: 30px 25px 20px 25px; border-bottom: 1px solid var(--border-color);">
                <h2 class="modal-title">ğŸ… ì—…ì  ëª©ë¡</h2>
                <button class="close-btn" onclick="closeAchievementsModal()">Ã—</button>
            </div>
            <div style="padding: 25px;">
                <div id="achievementsList" class="achievements-list">
                    <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn secondary" onclick="closeAchievementsModal()">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Food Export Modal for Image Capture -->
    <div id="foodExportModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeFoodExportModal()">Ã—</button>
            <div id="foodExportPreview">
                <!-- ì—¬ê¸°ì— ë‚´ë³´ë‚¼ ì‹ë‹¨ ê¸°ë¡ì´ ë Œë”ë§ë©ë‹ˆë‹¤. -->
            </div>
            <div style="padding: 20px; text-align: center;">
                <p style="color: var(--text-color-light); font-size: 14px; margin: 0;">ì´ í™”ë©´ì„ ìº¡ì²˜í•˜ì—¬ ì €ì¥í•˜ê±°ë‚˜ ê³µìœ í•˜ì„¸ìš”!</p>
            </div>
        </div>
    </div>

    <!-- Daily Quest Modal -->
<div id="dailyQuestModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 450px; background: white;">
        <div class="modal-header">
            <h2 class="modal-title">ğŸ”– ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸</h2>
            <!-- "X" ë²„íŠ¼ í´ë¦­ ì‹œ, ì˜¤ëŠ˜ ë‹¤ì‹œ ë³´ì§€ ì•Šë„ë¡ ì„¤ì • -->
            <button class="close-btn" onclick="closeDailyQuestModal(true)">Ã—</button>
        </div>
        <div style="padding: 25px;">
            <p style="font-size: 14px; color: var(--text-color-light); margin-bottom: 20px; text-align: center;">
                í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ì—¬ ê²½í—˜ì¹˜ë¥¼ íšë“í•˜ì„¸ìš”!
            </p>
            <div id="dailyQuestModalList" class="quest-list">
                <!-- JSë¡œ ë‚´ìš©ì´ ì±„ì›Œì§ˆ ì˜ˆì • -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <!-- "í™•ì¸" ë²„íŠ¼ì€ ë‹¨ìˆœíˆ ì°½ë§Œ ë‹«ìŒ -->
                <button class="btn" onclick="closeDailyQuestModal(false)">í™•ì¸</button>
                <!-- "ì „ì²´ í€˜ìŠ¤íŠ¸ ë³´ê¸°" í´ë¦­ ì‹œ, ì°½ì„ ë‹«ê³  ì˜¤ëŠ˜ ë‹¤ì‹œ ë³´ì§€ ì•Šë„ë¡ ì„¤ì • -->
                <button class="btn secondary" onclick="openQuestPage(); closeDailyQuestModal(true);">ì „ì²´ í€˜ìŠ¤íŠ¸ ë³´ê¸°</button>
            </div>
        </div>
    </div>
</div>

    <script>
        // IndexedDB ê´€ë¦¬ í´ë˜ìŠ¤
class IndexedDBManager {
    constructor() {
        this.dbName = 'RoutineTrackerDB';
        this.version = 1;
        this.db = null;
    }
    
    async init() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.version);
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                resolve();
            };
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains('data')) {
                    db.createObjectStore('data', { keyPath: 'key' });
                }
            };
        });
    }
    
    async set(key, value) {
        const transaction = this.db.transaction(['data'], 'readwrite');
        const store = transaction.objectStore('data');
        return store.put({ key, value, timestamp: Date.now() });
    }
    
    async get(key) {
        const transaction = this.db.transaction(['data'], 'readonly');
        const store = transaction.objectStore('data');
        const result = await new Promise((resolve) => {
            const request = store.get(key);
            request.onsuccess = () => resolve(request.result);
        });
        return result ? result.value : null;
    }
    
    async getAll() {
        const transaction = this.db.transaction(['data'], 'readonly');
        const store = transaction.objectStore('data');
        return new Promise((resolve) => {
            const request = store.getAll();
            request.onsuccess = () => {
                resolve(request.result.map(item => ({ key: item.key, value: item.value })));
            };
        });
    }
    
    async delete(key) {
        const transaction = this.db.transaction(['data'], 'readwrite');
        const store = transaction.objectStore('data');
        return store.delete(key);
    }
}

const localDB = new IndexedDBManager();
let syncQueue = new Set(); // ë™ê¸°í™” ëŒ€ê¸° í
        
        // ë ˆë²¨ ì‹œìŠ¤í…œ ë°ì´í„° êµ¬ì¡°
const LEVEL_SYSTEM = {
    // ë ˆë²¨ë³„ í•„ìš” ê²½í—˜ì¹˜ (2ë°°ì”© ì¦ê°€)
    getRequiredExp: (level) => {
        if (level <= 1) return 10;
        return 10 * Math.pow(2, level - 1);
    },
    
    // ê²½í—˜ì¹˜ë¡œ ë ˆë²¨ ê³„ì‚°
    calculateLevel: (totalExp) => {
        let level = 1;
        let requiredExp = 0;
        
        while (totalExp >= requiredExp + LEVEL_SYSTEM.getRequiredExp(level)) {
            requiredExp += LEVEL_SYSTEM.getRequiredExp(level);
            level++;
        }
        
        return {
            level: level,
            currentExp: totalExp - requiredExp,
            maxExp: LEVEL_SYSTEM.getRequiredExp(level),
            totalExp: totalExp
        };
    }
};

// í”„ë¡œí•„ ì •ë³´ (ë ˆë²¨ë³„ ì´ëª¨í‹°ì½˜ê³¼ íƒ€ì´í‹€)
const PROFILE_DATA = {
    1: { emoji: 'ğŸ‘¶', title: 'ë£¨í‹´ ê°“ë‚œì•„ê¸°', subtitle: 'ì•„ë¬´ê²ƒë„ ëª¨ë¥´ëŠ” ìƒíƒœì—ì„œ ì‹œì‘í•˜ëŠ” ë£¨í‹´ì˜ ì²«ê±¸ìŒ!' },
    3: { emoji: 'ğŸ‘§', title: 'ëª…ë‘í•œ ì†Œë…€', subtitle: 'ì„¸ìƒ ë°–ìœ¼ë¡œ ë‚˜ì˜¨ ë‹¹ì‹ , ì´ì œ í€˜ìŠ¤íŠ¸ë¥¼ ì°¾ì•„ ë– ë‚  ì‹œê°„ì…ë‹ˆë‹¤!' },
    5: { emoji: 'ğŸš¶â€â™€ï¸', title: 'í’‹ë‚´ê¸° ëª¨í—˜ê°€', subtitle: 'ì–´ìƒ‰í•œ ë°œê±¸ìŒì´ì§€ë§Œ, í•œ ê±¸ìŒì”© ë‚˜ì•„ê°€ë©´ ë©ë‹ˆë‹¤.' },
    8: { emoji: 'ğŸ§‘â€ğŸ“', title: 'í˜¸ê·¸ì™€íŠ¸ ì…í•™ìƒ', subtitle: 'ë‹¹ì‹ ì—ê²Œ ë§ˆë²•ì‚¬ë¡œì„œì˜ ìì§ˆì´ ë³´ì´ëŠ”êµ°ìš”! ğŸ§™â€â™€ï¸' },
    12: { emoji: 'ğŸ‘©â€ğŸ“', title: 'ê·¸ë¦¬í•€ë„ë¥´ ìš©ì‚¬', subtitle: 'ìš©ê°í•˜ê³  ëŒ€ë‹´í•œ ì •ì‹ ìœ¼ë¡œ ë£¨í‹´ì— ì„í•˜ì„¸ìš”!' },
    16: { emoji: 'ğŸ§™â€â™€ï¸', title: 'ë§ˆë²•ë¶€ ìœ ëŠ¥í•œ ì˜¤ëŸ¬', subtitle: 'ì–´ë‘ ì˜ ë§ˆë²•ì‚¬ì²˜ëŸ¼ ë‹¹ì‹ ì˜ ë‚˜íƒœí•¨ì„ ì¶”ì í•˜ì„¸ìš”!' },
    20: { emoji: 'ğŸ¹', title: 'í•˜ì´ë„ì˜ ì‹ ì… ìš©ì‚¬', subtitle: 'ì ¤ë‹¤ ê³µì£¼ê°€ ë‹¹ì‹ ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. âš”ï¸' },
    25: { emoji: 'ğŸŒ²', title: 'ìˆ²ì˜ í˜„ì', subtitle: 'ì½”ë¡œê·¸ë¥¼ ëª¨ë‘ ì°¾ì„ ê¸°ì„¸ë¡œ ìˆ¨ê²¨ì§„ ë£¨í‹´ì„ ë°œê²¬í•˜ì„¸ìš”.' },
    30: { emoji: 'âš¡', title: 'ì¬ì•™ ê°€ë…¼ ê²©íŒŒì', subtitle: 'ëª¨ë“  ë‚œê´€ì„ ê·¹ë³µí•˜ê³  ë§ˆì¹¨ë‚´ ì¬ì•™ì„ ë¬¼ë¦¬ì³¤ìŠµë‹ˆë‹¤!' },
    35: { emoji: 'ğŸ“', title: 'íŒŒì´ì–´ ì— ë¸”ë ˜ ì „í•™ìƒ', subtitle: 'ìƒˆë¡œìš´ í•™ê¸‰ì—ì„œ ë‹¹ì‹ ì˜ ë¹›ì„ ë³´ì—¬ì¤„ ì‹œê°„ì…ë‹ˆë‹¤!' },
    40: { emoji: 'âš”ï¸', title: 'ì²­ì‚¬ìë°˜ ì§€íœ˜ê´€', subtitle: 'ë””ë¯¸íŠ¸ë¦¬ì™€ í•¨ê»˜ ìµœê°•ì˜ í•™ê¸‰ì„ ë§Œë“œì„¸ìš”! ğŸ›¡ï¸' },
    45: { emoji: 'ğŸ¦…', title: 'í‘ìˆ˜ë¦¬ë°˜ ì§€íœ˜ê´€', subtitle: 'ì—ë¸ê°€ë¥´íŠ¸ì˜ ê¸¸ì„ ë”°ë¥¼ ê²ƒì¸ê°€, ë§ ê²ƒì¸ê°€! âš”ï¸' },
    50: { emoji: 'ğŸ‰', title: 'ê¸ˆì‚¬ìŠ´ë°˜ ì§€íœ˜ê´€', subtitle: 'í´ë¡œë“œì™€ í•¨ê»˜ ë¹„ì±…ìœ¼ë¡œ ìŠ¹ë¦¬í•˜ì„¸ìš”! ğŸ¹' },
    55: { emoji: 'ğŸª–', title: 'ì½œ ì˜¤ë¸Œ ë“€í‹° ì‹ ë³‘', subtitle: 'ì „ì¥ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ìƒì¡´ì´ ìµœìš°ì„ ì…ë‹ˆë‹¤.' },
    60: { emoji: 'ğŸ’¥', title: 'SAS ë² í…Œë‘ ë³‘ì‚¬', subtitle: 'í”„ë¼ì´ìŠ¤ ëŒ€ìœ„ê°€ ë‹¹ì‹ ì˜ ì‹¤ë ¥ì„ ì¸ì •í•©ë‹ˆë‹¤.' },
    65: { emoji: 'ğŸ–ï¸', title: 'ìµœì •ì˜ˆ ì˜¤í¼ë ˆì´í„°', subtitle: 'ê°€ì¥ ìœ„í—˜í•œ ì„ë¬´ë¥¼ ì™„ìˆ˜í•˜ëŠ” ë‹¹ì‹ ì€ ì „ì„¤ì…ë‹ˆë‹¤.' },
    70: { emoji: 'âœ¨', title: 'ë°œë”ìŠ¤ ê²Œì´íŠ¸ì˜ ë“œë£¨ì´ë“œ', subtitle: 'ìì—°ì˜ í˜ìœ¼ë¡œ ë‹¹ì‹ ì˜ ë£¨í‹´ì„ ìˆ˜í˜¸í•˜ì„¸ìš”! ğŸŒ¿' },
    75: { emoji: 'âš–ï¸', title: 'ëª…ì˜ˆë¡œìš´ íŒ”ë¼ë”˜', subtitle: 'ì •ì˜ë¡œìš´ ë£¨í‹´ìœ¼ë¡œ ì„ ì„ ì‹¤ì²œí•˜ëŠ” ìˆ˜í˜¸ìì…ë‹ˆë‹¤!' }, 
    80: { emoji: 'ğŸ­', title: 'ì „ì„¤ì˜ ë°”ë“œ', subtitle: 'ìŒì•…ê³¼ ì´ì•¼ê¸°ë¡œ ì‚¬ëŒë“¤ì˜ ë£¨í‹´ì— ì˜ê°ì„ ì£¼ëŠ” ì! ğŸ¶' }, 
    85: { emoji: 'ğŸ•µï¸â€â™€ï¸', title: 'ì–´ë‘  ì†ì˜ ë¡œê·¸', subtitle: 'ìˆ¨ê²¨ì§„ ë£¨í‹´ í•¨ì •ì„ ì°¾ì•„ë‚´ê³  ì˜ë¦¬í•˜ê²Œ íšŒí”¼í•©ë‹ˆë‹¤!' }, 
    90: { emoji: 'ğŸ‘‘', title: 'í˜ì´ë£¬ì˜ ì—¬ì™•', subtitle: 'ë°œë”ìŠ¤ ê²Œì´íŠ¸ ëŒ€ë¥™ì„ í‰ì •í•œ ë£¨í‹´ì˜ ì§€ë°°ì!' }, 
    95: { emoji: 'ğŸ—¡ï¸', title: 'ì „ì„¤ì˜ ì˜ì›…', subtitle: 'ëª¨ë“  ê²Œì„ ì„¸ê³„ê´€ì„ ì•„ìš°ë¥´ëŠ” ë£¨í‹´ì˜ ê¶ê·¹ì ì¸ ì˜ì›…!' }, 
    100: { emoji: 'ğŸŒŒ', title: 'ë£¨í‹´ ì„¸ê³„ê´€ ì°½ì¡°ì', subtitle: 'ë‹¹ì‹ ì€ ë£¨í‹´ì´ë¼ëŠ” ì¥ë¥´ë¥¼ ê°œì²™í•œ ì§„ì •í•œ ê°œì²™ìì…ë‹ˆë‹¤.' } 
};

// í€˜ìŠ¤íŠ¸ ì •ì˜
const QUEST_DEFINITIONS = {
    daily: [
    { id: 'attendance', title: 'âœ… ì¶œì„í•˜ê¸°', desc: 'ê¸°ìƒ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”', reward: 2 },
    { id: 'pomodoro_3', title: 'ğŸ… ë½€ëª¨ë„ë¡œ 3ê°œ ë‹¬ì„±', desc: 'ì§‘ì¤‘ì˜ ë½€ëª¨ë„ë¡œë¥¼ 3ê°œ ì´ìƒ ì™„ë£Œí•˜ì„¸ìš”', reward: 2 },
    { id: 'sleep_time', title: 'ğŸ’¤ ì·¨ì¹¨ì‹œê°„ ì…ë ¥í•˜ê¸°', desc: 'ì·¨ì¹¨ ì‹œê°„ì„ ê¸°ë¡í•˜ì„¸ìš”', reward: 2 },
    { id: 'seat_time', title: 'ğŸª‘ ì°©ì„ì‹œê°„ ì…ë ¥í•˜ê¸°', desc: 'ì°©ì„ ì‹œê°„ì„ ê¸°ë¡í•˜ì„¸ìš”', reward: 2 },
    { id: 'writing_300', title: 'âœï¸ ê¸€ì“°ê¸° 300ì ì´ìƒ', desc: '300ì ì´ìƒ ê¸€ì„ ì¨ë³´ì„¸ìš”', reward: 2 },
    { id: 'exercise_10min', title: 'ğŸ’ª ìš´ë™ 10ë¶„ ì´ìƒ', desc: '10ë¶„ ì´ìƒ ìš´ë™í•˜ì„¸ìš”', reward: 2 },
    { id: 'personal_goal_50', title: 'ğŸ¯ ê°œì¸ëª©í‘œ í‰ê·  50% ë‹¬ì„±', desc: 'ê°œì¸ ëª©í‘œë¥¼ 50% ì´ìƒ ë‹¬ì„±í•˜ì„¸ìš”', reward: 2 },
    { id: 'expense_under_10k', title: 'ğŸ’° ì§€ì¶œ â‚©10,000 ì´í•˜', desc: 'í•˜ë£¨ ì§€ì¶œì„ 1ë§Œì› ì´í•˜ë¡œ ê´€ë¦¬í•˜ì„¸ìš”', reward: 2 },
    { id: 'food_record_1', title: 'ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡ 1íšŒ ì´ìƒ', desc: 'ì‹ë‹¨ì„ 1íšŒ ì´ìƒ ê¸°ë¡í•˜ì„¸ìš”', reward: 2 },
    { id: 'daily_comment', title: 'ğŸ“ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ì‘ì„±', desc: 'í•˜ë£¨ë¥¼ ëŒì•„ë³´ë©° í•œë§ˆë”” ë‚¨ê²¨ë³´ì„¸ìš”', reward: 2 },
    { id: 'game_under_60min', title: 'ğŸ® ê²Œì„ì‹œê°„ 60ë¶„ ì´í•˜', desc: 'ê²Œì„ ì‹œê°„ì„ 60ë¶„ ì´í•˜ë¡œ ê´€ë¦¬í•˜ì„¸ìš”', reward: 2 },
    { id: 'wake_on_time_1hour', title: 'ğŸŒ… ëª©í‘œì‹œê°„ Â±1ì‹œê°„ ë‚´ ê¸°ìƒ', desc: 'ëª©í‘œ ê¸°ìƒ ì‹œê°„ ì „í›„ 1ì‹œê°„ ì´ë‚´ì— ì¼ì–´ë‚˜ì„¸ìš”', reward: 2 },
    { id: 'no_negative_score_today', title: 'âœ¨ ë§ˆì´ë„ˆìŠ¤ ì ìˆ˜ í”¼í•˜ê¸°', desc: 'ì˜¤ëŠ˜ ë£¨í‹´ ì ìˆ˜ê°€ 0ì  ì•„ë˜ë¡œ ë–¨ì–´ì§€ì§€ ì•Šê²Œ ê´€ë¦¬í•˜ì„¸ìš”.', reward: 2 }
    ],
    
    weekly: [
    { id: 'weekly_attendance_6days', title: 'ğŸ“… ì£¼ê°„ ì¶œì„ 6ì¼', desc: 'ì¶œì„ ì²´í¬í•˜ë‹¤ ë³´ë©´ ê¼­ í•˜ë‚˜ì¯¤ì€ ë¹ ì§€ì£ . ê·¼ë° ì²­ì‚¬ìë°˜ì€, ê·¸ê±° ë†“ì¹˜ë©´ ë¶„ìœ„ê¸° ì‹¸í•´ì¡ŒìŠµë‹ˆë‹¤.', reward: 6 }, //ê¸°ìƒ ì‹œê°„ ì…ë ¥ìœ¼ë¡œ ì¶œì„ ì²´í¬
{ id: 'weekly_early_sleep_4times', title: 'ğŸŒ™ 01:00 ì´ì „ ì·¨ì¹¨ 4íšŒ', desc: 'ë§í¬ëŠ” ì „íˆ¬ ì „ì— ë°˜ë“œì‹œ ì‰¼ì„ ì±™ê²¼ìŠµë‹ˆë‹¤. í•˜ì´ë„ì„ êµ¬í•˜ëŠ” ê±´ í”¼ë¡œí•œ ìƒíƒœë¡  ì–´ë µê±°ë“ ìš”.', reward: 4 },
{ id: 'weekly_no_game_weekend', title: 'ğŸ® ì£¼ë§ ë””ì§€í„¸ ë””í†¡ìŠ¤', desc: 'ì ¤ë‹¤ëŠ” ê¸°ë‹¤ë¦¬ë©´ì„œë„ í•œ ë§ˆë””ë„ ì•ˆ í–ˆìŠµë‹ˆë‹¤. ê·¸ ì¹¨ë¬µ, ìš°ë¦¬ ì–‘ì‹¬ì— ë§¡ê²¨ë³¼ê¹Œìš”.', reward: 7 },
{ id: 'weekly_expense_under_100k', title: 'ğŸ’° ì£¼ê°„ ì§€ì¶œ â‚©100,000 ì´í•˜', desc: 'í•œë•Œ í¬ë¡œì»¤ë‹¤ì¼ë„ ì¬ì •ê´€ë¦¬ë¥¼ í–ˆë‹µë‹ˆë‹¤. ë¬´ë„ˆì§„ ì¡°ì§, ëˆë¶€í„° ë‹¤ì‹œ ì±™ê²¼ê±°ë“ ìš”.', reward: 5 },
{ id: 'weekly_high_score_5days', title: 'âœ¨ ì£¼ê°„ ìš°ìˆ˜ìƒ (5ì¼)', desc: 'ì„ ìƒë‹˜ë“¤ ì‚¬ì´ì—ì„œ â€œìš”ì¦˜ ì–˜ ì¢€ í•´â€ ì†Œë¦¬ ë“¤ìœ¼ë ¤ë©´, ë”± 5ì¼ì´ë©´ ì¶©ë¶„í–ˆìŠµë‹ˆë‹¤.', reward: 6 }, //ì¼ì¼ ë£¨í‹´ ì ìˆ˜ 50ì  ì´ìƒ 5ë²ˆ
{ id: 'weekly_no_fastfood', title: 'ğŸ” íŒ¨ìŠ¤íŠ¸í‘¸ë“œ ì£¼ 1íšŒ ë¯¸ë§Œ', desc: 'êµ°ì¥ì„ ì˜¤ë˜ ë“¤ê³  ë›°ë ¤ë©´ ëª¸ì´ ê°€ë²¼ì›Œì•¼ì£ . ì˜¤í¼ë ˆì´í„°ë“¤ì´ ê°ìíŠ€ê¹€ì„ ë©€ë¦¬í•œ ì´ìœ , ì´í•´ë©ë‹ˆë‹¤.', reward: 6 },
{ id: 'weekly_low_game_total', title: 'ğŸ‘¾ ì£¼ê°„ ê²Œì„ 3ì‹œê°„ ì´í•˜', desc: 'ë§í¬ëŠ” ê²Œì„ ì•ˆ í–ˆì–´ìš”. ì™œëƒë©´ ì§€ê¸ˆë„ ê³„ì†, ì§„ì§œ ë¯¸ì…˜ì„ ë›°ê³  ìˆìœ¼ë‹ˆê¹Œìš”.', reward: 5 },
{ id: 'weekly_expense_tracking_7days', title: 'ğŸ’³ ì§€ì¶œ ê¸°ë¡ 7ì¼', desc: 'ë‹ˆí”Œí•˜ì„ íšŒê³„ë¶€ì„œë„ ì—¬ê¸°ê¹Œì§„ ì•ˆ í•©ë‹ˆë‹¤. ê·¼ë° ìš°ë¦¬ê°€ í•´ë‚¸ë‹¤ë©´? ì „ëµì´ì£ , ê·¸ê±´.', reward: 5 },
{ id: 'weekly_stress_relief_comment', title: 'ğŸ§˜â€â™€ï¸ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ê¸°ë¡', desc: 'ë²„í‚¤ë¥¼ ì•ˆì •ì‹œí‚¨ ê±´ ì™€ì¹¸ë‹¤ì—ì„œì˜ ëª…ìƒì´ì—ˆìŠµë‹ˆë‹¤. ë§ˆìŒì„ ë¹„ìš°ê³ , í„¸ì–´ë†“ëŠ” ê²ƒâ€¦ í•„ìš”í•œ ì¼ì´ì£ .', reward: 4 }, // â€˜ì˜¤ëŠ˜ì˜ í•œë§ˆë””â€™ì— ëª…ìƒ ê°™ì€ íŠ¹ì • í‚¤ì›Œë“œ ê°ì§€
{ id: 'weekly_all_time_input_5days', title: 'â° ëª¨ë“  ì‹œê°„ ê¸°ë¡ 5ì¼', desc: 'ê¸°ë¡ì€ ë§ˆë²•ë³´ë‹¤ ê°•ë ¥í•˜ì£ . í—¤ë¥´ë¯¸ì˜¨ëŠê°€ ê³„íš ì§¤ ë•Œ í•´ë¦¬ë„ ë­ë¼ í•  ìˆ˜ ì—†ì—ˆê±°ë“ ìš”.', reward: 5 }, // ê¸°ìƒ, ì°©ì„, ì·¨ì¹¨ ì‹œê°„ì„ ê¸°ë¡
{ id: 'weekly_no_alcohol', title: 'ğŸ· ì£¼ê°„ ê¸ˆì£¼ ì±Œë¦°ì§€', desc: 'ìƒ¹í¬ìŠ¤ê°€ ìˆ ì”ì„ ë‚´ë ¤ë†“ìŠµë‹ˆë‹¤. ì§„ì§€í•˜ê²Œ í•  ë§ì´ ìˆë‚˜ë´ìš”.', reward: 4 },
{ id: 'weekly_writing_8000', title: 'âœï¸ ì£¼ê°„ ê¸€ì“°ê¸° 8,000ì', desc: 'í˜¸ê·¸ì™€íŠ¸ì—ì„œ ì¼ê¸°ì¥ ì•ˆ ì“°ëŠ” ì‚¬ëŒ ì—†ì—ˆì–´ìš”. í†° ë¦¬ë“¤ë„ ì¼ìŠµë‹ˆë‹¤, ì•„ì£¼ ì—´ì‹¬íˆ.', reward: 6 },
{ id: 'weekly_personal_goal_avg_70', title: 'ğŸ¯ ê°œì¸ ëª©í‘œ ì£¼í‰ê·  70%', desc: 'í´ë¡œë“œëŠ” 70%ë§Œ ë³´ì—¬ì£¼ê³ ë„ ëª¨ë‘ë¥¼ ì†ì˜€ìŠµë‹ˆë‹¤. ë³´ì‹œëŠ” ë¶„ì´ ì¤‘ìš”í•œ ê±°ì£ .', reward: 6 },
{ id: 'weekly_perfect_morning_3', title: 'ğŸŒ… ì™„ë²½í•œ ì•„ì¹¨ 3íšŒ', desc: 'ì²­ì‚¬ìë°˜ í›ˆë ¨ì€ ì•„ì¹¨ë¶€í„° ì‹œì‘í–ˆì–´ìš”. ë””ë¯¸íŠ¸ë¦¬ ëˆˆì¹˜ ë³´ë ¤ë©´ ê·¸ê²Œ ê¸°ë³¸ì´ì£ .', reward: 6 }, //ëª©í‘œì‹œê°„ Â±1ì‹œê°„ ë‚´ ê¸°ìƒ 3ë²ˆ ì„±ê³µ
{ id: 'weekly_exercise_4times', title: 'ğŸƒâ€â™€ï¸ ì£¼ê°„ ìš´ë™ 4íšŒ ë‹¬ì„±', desc: 'ë²„ê¸°ë„ ë„ì£¼ë¥¼ ìœ„í•´ ì—´ì‹¬íˆ ëœë‹ˆë‹¤. ì´ ì •ë„ëŠ” ëª¸ í’€ê¸°ì£ .', reward: 5 },
{ id: 'weekly_pomodoro_25', title: 'ğŸ… ì£¼ê°„ ë½€ëª¨ë„ë¡œ 25ê°œ', desc: 'ê³ ìŠ¤íŠ¸ê°€ ì§‘ì¤‘ ëŠê¸´ ì‚¬ëŒ ì³ë‹¤ë³´ëŠ” ê±°, ì†”ì§íˆ ë¬´ì„­ì§€ ì•Šìœ¼ì„¸ìš”?', reward: 5 }
    ],
    
    monthly: [
    { id: 'monthly_perfect_attendance', title: 'ğŸŒŸ ì™„ë²½í•œ í•œ ë‹¬ (ì•„ì´ì–¸ë§¨)', desc: 'í† ë‹ˆ ìŠ¤íƒ€í¬ê°€ ì•„í¬ ë¦¬ì•¡í„°ë¥¼ ì™„ì„±í•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„ì€ í•œ ë‹¬. ë§¤ì¼ í•œ ê±¸ìŒì”©, ë‹¹ì‹ ë§Œì˜ ë¦¬ì•¡í„°ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.', reward: 30 }, // í•œ ë‹¬ ë™ì•ˆ ë§¤ì¼ ê¸°ìƒ ì‹œê°„ ê¸°ë¡
{ id: 'monthly_consistent_seat_time_input', title: 'ğŸª‘ ì™•ì¢Œì˜ ì£¼ì¸ (ì•„ì´ì–¸ ì“°ë¡ )', desc: 'ì§„ì§œ ì™•ì€ ì™•ì¢Œì— ì•‰ì•„ìˆëŠ” ì‹œê°„ì´ ì•„ë‹ˆë¼ ê·¸ ìë¦¬ë¥¼ ì§€í‚¤ëŠ” ì˜ì§€ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ìë¦¬ë¥¼ ì§€ì¼œë³´ì„¸ìš”.', reward: 20 }, // í•œ ë‹¬ ë™ì•ˆ 20ë²ˆ ì°©ì„ ì‹œê°„ ê¸°ë¡
{ id: 'monthly_exercise_15times', title: 'ğŸ’ª ì›”ê°„ í”¼íŠ¸ë‹ˆìŠ¤ ì±”í”¼ì–¸', desc: 'ì¾¨ë‹ˆíˆê°€ ê·¸ ëª¸ì„ ë§Œë“  ê±´ í•˜ë£¨ì•„ì¹¨ì´ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤. ê¾¸ì¤€í•œ ë‹¨ë ¨ì´ ë§Œë“  ì™„ë²½í•œ ì†”ì ¸ì˜ ê¸¸ì„ ê±¸ì–´ë³´ì„¸ìš”.', reward: 8 }, // í•œ ë‹¬ ë™ì•ˆ 15íšŒ ì´ìƒ ìš´ë™ ê¸°ë¡
{ id: 'monthly_budget_50percent', title: 'ğŸ’ ì ˆì•½ì˜ ë‹¬ì¸', desc: 'í¬ë¡œì»¤ë‹¤ì¼ì´ ë°”ë¡œí¬ì›Œí¬ìŠ¤ë¥¼ ìš´ì˜í•  ë•Œë„ ì˜ˆì‚° ê´€ë¦¬ëŠ” ì² ì €í–ˆìŠµë‹ˆë‹¤. ì§„ì§œ ë³´ìŠ¤ëŠ” ëˆë„ ì•„ë¼ê±°ë“ ìš”.', reward: 10 }, // í•œ ë‹¬ ë™ì•ˆ ì´ ì§€ì¶œì„ ì›” ì˜ˆì‚°ì˜ 50% ì´ë‚´ë¡œ ê´€ë¦¬
{ id: 'monthly_early_bird_15times', title: 'ğŸŒ… ìƒˆë²½í˜• ì¸ê°„ì˜ ë“±ë¶ˆ', desc: 'ë²„ê¸° ì„ ì¥ì€ ë³´ë¬¼ì„ ì´ ë– ë‚˜ê¸° ì „ì—ëŠ” ì¼ì° ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤. ê¸°íšŒëŠ” ì¼ì° ì¼ì–´ë‚˜ëŠ” ìì˜ ëª«ì…ë‹ˆë‹¤.', reward: 9 }, // í•œ ë‹¬ ë™ì•ˆ 15íšŒ ì´ìƒ ëª©í‘œ ê¸°ìƒì‹œê°„ ì „í›„ 30ë¶„ ë‚´ì— ê¸°ìƒ
{ id: 'monthly_no_game_entire_month', title: 'ğŸ® ë§í¬ì˜ ë…ë¦½ ì„ ì–¸', desc: 'ë‹¹ì‹ ì´ ì—†ì–´ë„ ë§í¬ëŠ” ì„¸ìƒì„ êµ¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê±±ì • ë§ê³  í•œ ë‹¬ ë™ì•ˆ ê²Œì„ ì„¸ìƒì„ ë– ë‚˜ë³´ì„¸ìš”.', reward: 10 }, // í•œ ë‹¬ ë™ì•ˆ ê²Œì„ ì‹œê°„ 0ë¶„ ìœ ì§€
{ id: 'monthly_writing_80k', title: 'ğŸ“š í’í™”ì„¤ì›” ë¹„ë°€ ë¬¸ì„œ (8ë§Œ ì)', desc: 'ê°€ë¥´ê·¸ ë§ˆí¬ì—ì„œ ë°œê²¬ëœ ê³ ëŒ€ ë¬¸ëª…ì˜ ê¸°ë¡ë“¤. 8ë§Œ ìë©´ ì„¸ì´ë¡œìŠ¤ êµë‹¨ì˜ ë¹„ë°€ë„ ë°í˜€ë‚¼ ìˆ˜ ìˆì–´ìš”.', reward: 9 }, // í•œ ë‹¬ ë™ì•ˆ ëˆ„ì  ê¸€ì“°ê¸° 80,000ì ì´ìƒ
{ id: 'monthly_consistent_sleep_input', title: 'ğŸŒ™ ë¯¸í˜¸í¬ì˜ ëª…ìƒ ì‹œê°„ (20ì¼)', desc: 'ì„¸ê³„ ìµœê°•ì˜ ê²€ì‚¬ë„ ë§¤ì¼ ë°¤ ëª…ìƒìœ¼ë¡œ ë§ˆìŒì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. ê²€ì€ ì¹¼ë‚ ë³´ë‹¤ ì¤‘ìš”í•œ ê±´ ë§‘ì€ ì •ì‹ ì´ë‹ˆê¹Œìš”.', reward: 7 }, // í•œ ë‹¬ ë™ì•ˆ 20ì¼ ì´ìƒ ì·¨ì¹¨ ì‹œê°„ ê¸°ë¡
{ id: 'monthly_high_score_15days', title: 'ğŸ† ì›”ê°„ ìš°ìˆ˜ìƒ', desc: 'í˜¸ë‘ì´ëŠ” "ìš´" ëŒ€ì‹  "ê¾¸ì¤€í•¨"ì„ íƒí–ˆìŠµë‹ˆë‹¤. 15ì¼ê°„ì˜ ì••ë„ì ì¸ ë£¨í‹´ ì ìˆ˜! 15ì¼ì´ë©´ ìƒˆë¡œìš´ ì¸ìƒì˜ ì‹œì‘ì´ì—ìš”.', reward: 10 }, // í•œ ë‹¬ ë™ì•ˆ ë£¨í‹´ ì ìˆ˜ 80ì  ì´ìƒì¸ ë‚ ì´ 15ì¼ ì´ìƒ
{ id: 'monthly_personal_goal_avg_70', title: 'ğŸ¯ ë””ë¯¸íŠ¸ë¦¬ì˜ ì´ìƒê³¼ í˜„ì‹¤ (ì›”í‰ê·  70%)', desc: 'ë””ë¯¸íŠ¸ë¦¬ëŠ” ì™„ë²½ì„ ê¿ˆê¿¨ì§€ë§Œ, ë•Œë¡  í˜„ì‹¤ì ì¸ 70%ì˜ ë…¸ë ¥ìœ¼ë¡œë„ ë¹›ë‚¬ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ê¾¸ì¤€í•¨, ì™•ë„ë¥¼ ê±·ëŠ” ë‹¹ì‹ ë§Œì˜ ë°©ì‹ì…ë‹ˆë‹¤.', reward: 9 } // í•œ ë‹¬ ëª¨ë“  ê°œì¸ ëª©í‘œì˜ í‰ê·  ë‹¬ì„±ë¥  70% ì´ìƒ ìœ ì§€
    ]
};

// ë½‘ê¸° ë³´ìƒ ì •ì˜
const ENHANCED_GACHA_REWARDS = {
    bronze: [
        { 
            id: 'golden_day_token', 
            name: 'ğŸŒŸ ê³¨ë“ ë°ì´ í† í°', 
            desc: 'ì„ íƒí•œ í•˜ë£¨ì˜ ë£¨í‹´ ì ìˆ˜ê°€ ì•„ë¬´ë¦¬ ë‚®ì•„ë„ ë§ˆì´ë„ˆìŠ¤ ì ìˆ˜ëŠ” ì±…ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 
            probability: 20,
            type: 'date_selector',
            immediate: false
        },
        { 
            id: 'double_exp_booster', 
            name: 'âš¡ ë”ë¸” ê²½í—˜ì¹˜ ë¶€ìŠ¤í„°', 
            desc: 'ë‹¤ìŒ 24ì‹œê°„ ë™ì•ˆ íšë“í•˜ëŠ” ëª¨ë“  ê²½í—˜ì¹˜ê°€ 2ë°°ë¡œ ì¦ê°€í•©ë‹ˆë‹¤!', 
            probability: 20,
            type: 'immediate_buff',
            immediate: true
        },
        { 
            id: 'quest_reroll', 
            name: 'ğŸ² í€˜ìŠ¤íŠ¸ ë¦¬ë¡¤ê¶Œ', 
            desc: 'ì˜¤ëŠ˜ ì¼ì¼ í€˜ìŠ¤íŠ¸ ëª©ë¡ì´ ë§ˆìŒì— ë“¤ì§€ ì•Šë‚˜ìš”? í•œ ë²ˆ ë‹¤ì‹œ ë½‘ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!', 
            probability: 20,
            type: 'immediate_action',
            immediate: true
        },
        { 
            id: 'cheat_day_gaming', 
            name: 'ğŸ¥³ ì¹˜íŒ… ë°ì´ ë¯¸ë‹ˆ í† í°', 
            desc: 'ì˜¤ëŠ˜ í•˜ë£¨, ë£¨í‹´ ì ìˆ˜ì— ëŒ€í•œ ê²Œì„ ì‹œê°„ í˜ë„í‹°ê°€ ì™„ì „íˆ ì‚¬ë¼ì§‘ë‹ˆë‹¤!', 
            probability: 20,
            type: 'today_flag',
            immediate: true
        },
        { 
            id: 'coach_encouragement', 
            name: 'ğŸ’¬ ì½”ì¹˜ì˜ ì‘ì› í•œë§ˆë””', 
            desc: 'ë‹¹ì‹ ì˜ í˜„ì¬ ë£¨í‹´ ìƒíƒœì— ë§ì¶° ì½”ì¹˜ê°€ ì§„ì‹¬ìœ¼ë¡œ ì‘ì„±í•œ ê°œì¸í™”ëœ ì‘ì› ë©”ì‹œì§€ë¥¼ ë“œë¦½ë‹ˆë‹¤.', 
            probability: 20,
            type: 'ai_message',
            immediate: true
        }
    ],
    
    silver: [
        { 
            id: 'cafe_budget_bonus', 
            name: 'â˜• ì¹´í˜ ì§€ì¶œ ë³´ë„ˆìŠ¤', 
            desc: 'ì›” ì˜ˆì‚°ê³¼ ë³„ë„ë¡œ 5,000ì›ì˜ ì¹´í˜ ì§€ì¶œ ì—¬ìœ ë¥¼ ë“œë¦½ë‹ˆë‹¤. ë§›ìˆëŠ” ì»¤í”¼ í•œ ì” ì¦ê¸°ì„¸ìš”!', 
            probability: 20,
            type: 'budget_bonus',
            amount: 5000,
            immediate: true
        },
        { 
            id: 'streaming_free_pass', 
            name: 'ğŸ“º ë„·í”Œë¦­ìŠ¤/ìœ íŠœë¸Œ í”„ë¦¬ íŒ¨ìŠ¤', 
            desc: 'ì˜¤ëŠ˜ ë£¨í‹´ ì ìˆ˜ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê³  3ì‹œê°„ ë™ì•ˆ ë§ˆìŒê» ì‹œì²­í•˜ì„¸ìš”.', 
            probability: 20,
            type: 'today_flag',
            immediate: true
        },
        { 
            id: 'sleep_in_permit', 
            name: 'ğŸ›Œ ëŠ¦ì  í—ˆê°€ì¦', 
            desc: 'ë‚´ì¼ ëª©í‘œ ê¸°ìƒ ì‹œê°„ë³´ë‹¤ 2ì‹œê°„ ëŠ¦ê²Œ ì¼ì–´ë‚˜ë„ ì •ì‹œ ê¸°ìƒìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤.', 
            probability: 20,
            type: 'tomorrow_buff',
            immediate: true
        },
        { 
            id: 'meal_freedom', 
            name: 'ğŸ• ì›í•˜ëŠ” ì‹ì‚¬ ììœ ê¶Œ', 
            desc: 'ì˜¤ëŠ˜ í•œ ë¼ëŠ” ì–´ë–¤ ì‹ë‹¨ ê·œì¹™ì´ë‚˜ ì§€ì¶œ ê±±ì • ì—†ì´ ì›í•˜ëŠ” ê²ƒì„ ë¨¹ìœ¼ì„¸ìš”!', 
            probability: 20,
            type: 'today_flag',
            immediate: true
        },
        { 
            id: 'audio_focus_time', 
            name: 'ğŸ§ ê²Œì„ ì§‘ì¤‘ê¶Œ', 
            desc: '3ì‹œê°„ ë™ì•ˆ ì•„ë¬´ ë°©í•´ ì—†ì´ ì¢‹ì•„í•˜ëŠ” ìŒì•…ì´ë‚˜ ì˜¤ë””ì˜¤ë¶ìœ¼ë¡œ ì˜¨ì „íˆ íœ´ì‹í•˜ì„¸ìš”.', 
            probability: 20,
            type: 'timer_reward',
            duration: 180, // 3ì‹œê°„ (ë¶„)
            immediate: false
        }
    ],
    
    gold: [
        { 
            id: 'book_budget_bonus', 
            name: 'ğŸ“š ë„ì„œ êµ¬ë§¤ ì§€ì›ê¸ˆ', 
            desc: 'ì›” ì˜ˆì‚°ê³¼ ë³„ë„ë¡œ 30,000ì›ì˜ ë„ì„œ êµ¬ë§¤ ì—¬ìœ ë¥¼ ë“œë¦½ë‹ˆë‹¤. ì½ê³  ì‹¶ì—ˆë˜ ì±…ì„ êµ¬ë§¤í•˜ì„¸ìš”!', 
            probability: 20,
            type: 'budget_bonus',
            amount: 30000,
            immediate: true
        },
        { 
            id: 'luxury_budget_bonus', 
            name: 'ğŸ›ï¸ ì‘ì€ ì‚¬ì¹˜ ì§€ì¶œ ë³´ë„ˆìŠ¤', 
            desc: 'ì›” ì˜ˆì‚°ê³¼ ë³„ë„ë¡œ 50,000ì›ì„ ë§ˆìŒê» ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë³´ë„ˆìŠ¤. ë‚˜ë¥¼ ìœ„í•œ ì‘ì€ ì„ ë¬¼ì„ í•´ë³´ì„¸ìš”!', 
            probability: 20,
            type: 'budget_bonus',
            amount: 50000,
            immediate: true
        },
        { 
            id: 'movie_ticket', 
            name: 'ğŸ¬ ì˜í™” í•œ í¸ ê´€ëŒê¶Œ', 
            desc: 'ì˜í™” í•œ í¸ì„ ê°ìƒí•˜ëŠ” ì‹œê°„ì€ ë£¨í‹´ ì ìˆ˜ì— ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì£„ì±…ê° ì—†ì´ ì¦ê¸°ì„¸ìš”!', 
            probability: 20,
            type: 'today_flag',
            immediate: true
        },
        { 
            id: 'unlimited_gaming', 
            name: 'ğŸ® ê²Œì„ ì‹œê°„ ë¬´ì œí•œ íŒ¨ìŠ¤', 
            desc: 'ì˜¤ëŠ˜ í•˜ë£¨ ë£¨í‹´ ì ìˆ˜ í˜ë„í‹° ê±±ì • ì—†ì´ ì›í•˜ëŠ” ë§Œí¼ ê²Œì„ì„ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 
            probability: 20,
            type: 'today_flag',
            immediate: true
        },
        { 
            id: 'gratitude_message', 
            name: 'ğŸ’– ë‚˜ë¥¼ ìœ„í•œ ê°ì‚¬ ë©”ì‹œì§€', 
            desc: 'ì§€ê¸ˆê¹Œì§€ ë£¨í‹´ì„ ì—´ì‹¬íˆ ì§€ì¼œì˜¨ ë‹¹ì‹ ì—ê²Œ ì½”ì¹˜ê°€ ì‹¬ë¦¬ì  ìœ„ì•ˆê³¼ ê¹Šì€ ê°ì‚¬ë¥¼ ë‹´ì€ ì¥ë¬¸ì˜ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.', 
            probability: 20,
            type: 'ai_message_deep',
            immediate: true
        }
    ],
    
    legend: [
        { 
            id: 'ultimate_wish', 
            name: 'ğŸ’ ê¶ê·¹ì˜ ì†Œì› ì„±ì·¨ê¶Œ', 
            desc: 'ë‹¹ì‹ ì´ ì§„ì •ìœ¼ë¡œ ì›í•˜ëŠ” ê²ƒ í•œ ê°€ì§€ë¥¼ 100,000ì› ì´ë‚´ì—ì„œ ì´ë£° ìˆ˜ ìˆëŠ” ê¶Œë¦¬. ë£¨í‹´ ì•±ì´ ë‹¹ì‹ ì˜ ì†Œì›ì„ ì ê·¹ì ìœ¼ë¡œ ì‘ì›í•©ë‹ˆë‹¤!', 
            probability: 33,
            type: 'wish_fulfillment',
            amount: 100000,
            immediate: false
        },
        { 
            id: 'complete_freedom_day', 
            name: 'ğŸŒŸ ì™„ì „ ììœ ì˜ ë‚ ', 
            desc: 'í•˜ë£¨ ë™ì•ˆ ëª¨ë“  ë£¨í‹´ ê·œì¹™ì—ì„œ ì™„ë²½í•˜ê²Œ í•´ë°©ë©ë‹ˆë‹¤! ëª¨ë“  ì œí•œê³¼ ì ìˆ˜ ê³„ì‚°ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.', 
            probability: 33,
            type: 'date_selector_special',
            immediate: false
        },
        { 
            id: 'routine_king_day', 
            name: 'ğŸ† ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ë‚´ê°€ ì™•ì´ë‹¤!', 
            desc: 'ë‹¹ì‹ ì´ ì„ íƒí•œ ë‚ ì§œì— ë£¨í‹´ì˜ ì™•ìœ¼ë¡œ ì„ ì–¸ë©ë‹ˆë‹¤. ê·¸ë‚  ëª¨ë“  í–‰ë™ì„ ì¹­ì°¬í•˜ê³  ê²©ë ¤í•©ë‹ˆë‹¤.', 
            probability: 34,
            type: 'date_selector_special',
            immediate: false
        }
    ]
};

// ì‚¬ìš©ì ë ˆë²¨ ë°ì´í„° ê´€ë¦¬
async function getUserLevelData() {
    const defaultData = {
        totalExp: 0,
        level: 1,
        currentExp: 0,
        maxExp: 10,
        unlockedRewards: [],
        activeBuffs: {}
    };
    
    const saved = await dbGet('userLevelData');
    return saved || defaultData;
}

        async function saveUserLevelData(data) { await dbSet('userLevelData', data); }

// ê²½í—˜ì¹˜ ì¶”ê°€ ë° ë ˆë²¨ì—… ì²˜ë¦¬ (ë²„í”„ ì ìš©)
async function addExperience(amount, source = '') {
    const userData = await getUserLevelData();
    
    // ë”ë¸” ê²½í—˜ì¹˜ ë²„í”„ ì²´í¬
    let finalAmount = amount;
    if (userData.activeBuffs.doubleExp && userData.activeBuffs.doubleExp > Date.now()) {
        finalAmount = amount * 2;
        source += ' (ë”ë¸” EXP ì ìš©)';
    }
    
    const oldLevel = userData.level;
    userData.totalExp += finalAmount;
    const levelInfo = LEVEL_SYSTEM.calculateLevel(userData.totalExp);
    
    userData.level = levelInfo.level;
    userData.currentExp = levelInfo.currentExp;
    userData.maxExp = levelInfo.maxExp;
    
    await saveUserLevelData(userData);
    
    // ë ˆë²¨ì—… ì²´í¬
    if (userData.level > oldLevel) {
        await handleLevelUp(oldLevel, userData.level);
    }
    
    // í”„ë¡œí•„ ìœ„ì ¯ ì—…ë°ì´íŠ¸
    await updateProfileWidget();
    
    // ê²½í—˜ì¹˜ íšë“ ì•Œë¦¼ (ì¡°ê±´ë¶€)
    if (finalAmount >= 5) {
        showExpGainNotification(finalAmount, source);
    }
    
    return {
        gained: finalAmount,
        levelUp: userData.level > oldLevel,
        newLevel: userData.level,
        source: source
    };
}

// ê²½í—˜ì¹˜ íšë“ ì•Œë¦¼
function showExpGainNotification(amount, source) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 120px;
        right: 20px;
        background: var(--primary-color);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        z-index: 9998;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
    `;
    notification.innerHTML = `âš¡ +${amount} EXP ${source ? `<br><span style="font-size:10px; opacity:0.8;">${source}</span>` : ''}`;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => notification.remove(), 300);
    }, 2000);
}

// ë ˆë²¨ì—… ì²˜ë¦¬ (ë½‘ê¸° ê¸°íšŒ ì œê³µ)
async function handleLevelUp(oldLevel, newLevel) {
    const profileInfo = getProfileInfo(newLevel);
    
    // ë ˆë²¨ì—… ì¶•í•˜ íŒì—…
    showFeedbackPopup(100, {
        class: 'feedback-celebration',
        emoji: profileInfo.emoji,
        title: `ë ˆë²¨ì—…! Lv.${newLevel}`,
        message: `ì¶•í•˜í•©ë‹ˆë‹¤! ${profileInfo.title}ì´(ê°€) ë˜ì…¨ìŠµë‹ˆë‹¤!${profileInfo.subtitle ? '\n\n' + profileInfo.subtitle : ''}`
    });
    
    // ë½‘ê¸° ê¸°íšŒ ì œê³µ (10ë ˆë²¨ë§ˆë‹¤)
    if (newLevel % 10 === 0) {
        const rewardData = await getUserRewards();
        rewardData.availableGacha += 1;
        
        // 50ë ˆë²¨, 100ë ˆë²¨ì€ ì¶”ê°€ ê¸°íšŒ
        if (newLevel % 50 === 0) {
            rewardData.availableGacha += 1;
        }
        
        await saveUserRewards(rewardData);
        
        setTimeout(() => {
            showGachaModal();
        }, 2500);
    }
    
    // íŠ¹ë³„ ë ˆë²¨ ë³´ë„ˆìŠ¤
    if (newLevel === 50) {
        await addExperience(50, '50ë ˆë²¨ ë‹¬ì„± ë³´ë„ˆìŠ¤');
    } else if (newLevel === 100) {
        await addExperience(100, '100ë ˆë²¨ ë‹¬ì„± ë³´ë„ˆìŠ¤');
    }
}

// í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
function getProfileInfo(level) {
    // ê°€ì¥ ê°€ê¹Œìš´ í•˜ìœ„ ë ˆë²¨ì˜ í”„ë¡œí•„ ì •ë³´ ë°˜í™˜
    const availableLevels = Object.keys(PROFILE_DATA).map(Number).sort((a, b) => b - a);
    const targetLevel = availableLevels.find(l => l <= level) || 1;
    return PROFILE_DATA[targetLevel];
}

// í€˜ìŠ¤íŠ¸ ë°ì´í„° ê´€ë¦¬
async function getDailyQuests(date) {
    const dateStr = formatDate(date);
    const saved = await dbGet(`dailyQuests_${dateStr}`);
    
    if (saved) return saved;
    
    // ìƒˆë¡œìš´ ì¼ê°„ í€˜ìŠ¤íŠ¸ ìƒì„± (ëœë¤ 5ê°œ)
    const allDailyQuests = [...QUEST_DEFINITIONS.daily];
    const selectedQuests = [];
    
    // í˜¹ì‹œ ëª¨ë¥¼ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì •ì˜ëœ í€˜ìŠ¤íŠ¸ ìˆ˜ì™€ 5ê°œ ì¤‘ ì‘ì€ ê°’ì„ ì„ íƒ
    const numQuestsToSelect = Math.min(5, allDailyQuests.length);

    for (let i = 0; i < numQuestsToSelect; i++) {
        const randomIndex = Math.floor(Math.random() * allDailyQuests.length);
        
        // 1. ì„ íƒëœ í€˜ìŠ¤íŠ¸ë¥¼ ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.
        const selectedQuestObject = allDailyQuests[randomIndex]; 
        
        selectedQuests.push({
            // 2. í• ë‹¹ëœ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.
            ...selectedQuestObject,
            completed: false,
            progress: 0,
            // 3. í• ë‹¹ëœ ë³€ìˆ˜ì—ì„œ idë¥¼ ê°€ì ¸ì™€ í•¨ìˆ˜ì— ì „ë‹¬í•©ë‹ˆë‹¤.
            maxProgress: getQuestMaxProgress(selectedQuestObject.id)
        });
        
        // ì¤‘ë³µ ì„ íƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°°ì—´ì—ì„œ ì œê±°
        allDailyQuests.splice(randomIndex, 1);
    }
    
    const questData = {
        date: dateStr,
        quests: selectedQuests,
        completedCount: 0
    };
    
    await dbSet(`dailyQuests_${dateStr}`, questData);
    return questData;
}

async function getWeeklyQuests(date) {
    const weekStart = getWeekDates(date)[0];
    const saved = await dbGet(`weeklyQuests_${weekStart}`);
    
    if (saved) return saved;
    
    // ìƒˆë¡œìš´ ì£¼ê°„ í€˜ìŠ¤íŠ¸ ìƒì„± (ëœë¤ 8ê°œ)
    const allWeeklyQuests = [...QUEST_DEFINITIONS.weekly];
    const selectedQuests = [];
    
    for (let i = 0; i < Math.min(8, allWeeklyQuests.length); i++) {
        const randomIndex = Math.floor(Math.random() * allWeeklyQuests.length);
        const quest = allWeeklyQuests[randomIndex];
        
        selectedQuests.push({
            ...quest,
            completed: false,
            progress: 0,
            maxProgress: getQuestMaxProgress(quest.id)
        });
        allWeeklyQuests.splice(randomIndex, 1);
    }
    
    const questData = {
        weekStart: weekStart,
        quests: selectedQuests,
        completedCount: 0
    };
    
    await dbSet(`weeklyQuests_${weekStart}`, questData);
    return questData;
}

async function getMonthlyQuests(date) {
    const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;
    const saved = await dbGet(`monthlyQuests_${monthKey}`);
    
    if (saved) return saved;
    
    // ì›”ê°„ í€˜ìŠ¤íŠ¸ëŠ” ëª¨ë“  í€˜ìŠ¤íŠ¸ í¬í•¨
    const selectedQuests = QUEST_DEFINITIONS.monthly.map(quest => ({
        ...quest,
        completed: false,
        progress: 0,
        maxProgress: getQuestMaxProgress(quest.id)
    }));
    
    const questData = {
        month: monthKey,
        quests: selectedQuests,
        completedCount: 0
    };
    
    await dbSet(`monthlyQuests_${monthKey}`, questData);
    return questData;
}

// í€˜ìŠ¤íŠ¸ë³„ ìµœëŒ€ ì§„í–‰ë„ ì„¤ì •
function getQuestMaxProgress(questId) {
    const progressMap = {
        // ì¼ê°„
        'attendance': 1,
        'pomodoro_3': 3, 
        'sleep_time': 1,
        'seat_time': 1,
        'writing_300': 300,
        'exercise_10min': 10,
        'personal_goal_50': 50,
        'expense_under_10k': 10000, 
        'food_record_1': 1,
        'daily_comment': 1,
        'game_under_60min': 1,
        'wake_on_time_1hour': 1,
        'no_negative_score_today': 1, 
        
        // ì£¼ê°„
        'weekly_attendance_6days': 6,
        'weekly_early_sleep_4times': 4,
        'weekly_no_game_weekend': 1,
        'weekly_expense_under_100k': 1,
        'weekly_high_score_5days': 5,
        'weekly_no_fastfood': 1,
        'weekly_low_game_total': 1,
        'weekly_expense_tracking_7days': 7,
        'weekly_stress_relief_comment': 1,
        'weekly_all_time_input_5days': 5,
        'weekly_no_alcohol': 1,
        'weekly_writing_8000': 8000,
        'weekly_personal_goal_avg_70': 1,
        'weekly_perfect_morning_3': 3,
        'weekly_exercise_4times': 4,
        'weekly_pomodoro_25': 25,
        
        // ì›”ê°„
        'monthly_perfect_attendance': 30,
        'monthly_consistent_seat_time_input': 20,
        'monthly_exercise_15times': 15,
        'monthly_budget_50percent': 1,
        'monthly_early_bird_15times': 15,
        'monthly_no_game_entire_month': 1,
        'monthly_writing_80k': 80000,
        'monthly_consistent_sleep_input': 20,
        'monthly_high_score_15days': 15,
        'monthly_personal_goal_avg_70': 1
    };
    
    return progressMap[questId] || 1;
}

// ë½‘ê¸° ì‹œìŠ¤í…œ ê´€ë¦¬
async function getUserRewards() {
    const defaultData = {
        availableGacha: 0,
        unlockedRewards: [],
        activeBuffs: {},
        gachaHistory: []
    };
    
    const saved = await dbGet('userRewards');
    return saved || defaultData;
}

        async function saveUserRewards(data) { await dbSet('userRewards', data); }

// ë½‘ê¸° ì‹¤í–‰
async function executeGacha() {
    const rewardData = await getUserRewards();
    
    if (rewardData.availableGacha <= 0) {
        alert('ë½‘ê¸° ê¸°íšŒê°€ ì—†ìŠµë‹ˆë‹¤!');
        return;
    }
    
    // í™•ë¥  ê³„ì‚°
    const rand = Math.random() * 100;
    let rewardTier;
    
    if (rand < 1) rewardTier = 'legend';        // 1%
    else if (rand < 5) rewardTier = 'gold';     // 4%
    else if (rand < 30) rewardTier = 'silver';  // 25%
    else rewardTier = 'bronze';                 // 70%
    
    // í•´ë‹¹ í‹°ì–´ì—ì„œ ë³´ìƒ ì„ íƒ
    const tierRewards = ENHANCED_GACHA_REWARDS[rewardTier];
    const totalProbability = tierRewards.reduce((sum, reward) => sum + reward.probability, 0);
    let randReward = Math.random() * totalProbability;
    
    let selectedReward = null;
    for (const reward of tierRewards) {
        randReward -= reward.probability;
        if (randReward <= 0) {
            selectedReward = reward;
            break;
        }
    }
    
    // ë³´ìƒ ì €ì¥
    rewardData.availableGacha--;
    rewardData.unlockedRewards.push({
        ...selectedReward,
        obtainedAt: new Date().toISOString(),
        used: false
    });
    rewardData.gachaHistory.push({
        date: new Date().toISOString(),
        tier: rewardTier,
        reward: selectedReward
    });
    
    await saveUserRewards(rewardData);
    
    // ê²°ê³¼ í‘œì‹œ
    showGachaResult(selectedReward, rewardTier);

    // íˆë“  ì—…ì : ë ˆì „ë“œ ë³´ë¬¼ ì‚¬ëƒ¥ê¾¼
if (rewardTier === 'legend') {
        const unlocked = await dbGet('unlockedAchievements') || [];
        if (!unlocked.includes('ACH_HIDDEN_LEGEND_GACHA')) {
            await unlockAchievement('ACH_HIDDEN_LEGEND_GACHA');
        }
    }
    
    return selectedReward;
}

// ë½‘ê¸° ê²°ê³¼ í‘œì‹œ
function showGachaResult(reward, tier) {
    const tierColors = {
        bronze: 'linear-gradient(135deg, #CD7F32, #A0522D)',
        silver: 'linear-gradient(135deg, #C0C0C0, #808080)',
        gold: 'linear-gradient(135deg, #FFD700, #FFA500)',
        legend: 'linear-gradient(135deg, #9400D3, #FF1493)'
    };
    
    showFeedbackPopup(100, {
        class: 'feedback-celebration',
        emoji: reward.name.split(' ')[0],
        title: `${tier.toUpperCase()} ë“±ê¸‰!`,
        message: `${reward.name}ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!\n\n${reward.desc}`
    });
}

// ë½‘ê¸° ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
let currentGachaReward = null;

        function showGachaModal() { document.getElementById('gachaContent').style.display = 'block'; document.getElementById('gachaResult').style.display = 'none'; document.getElementById('gachaModal').style.display = 'flex'; }
        function closeGachaModal() { document.getElementById('gachaModal').style.display = 'none'; currentGachaReward = null; }

async function executeGacha() {
    const rewardData = await getUserRewards();
    
    if (rewardData.availableGacha <= 0) {
        alert('ë½‘ê¸° ê¸°íšŒê°€ ì—†ìŠµë‹ˆë‹¤!');
        return;
    }
    
    // ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    const gachaBtn = document.querySelector('#gachaContent button');
    gachaBtn.disabled = true;
    gachaBtn.textContent = 'ë½‘ëŠ” ì¤‘...';
    
    setTimeout(async () => {
        const reward = await performGacha();
        if (reward) {
            showGachaResult(reward);
        }
    }, 1500);
}

async function performGacha() {
    const rewardData = await getUserRewards();
    
    // í™•ë¥  ê³„ì‚°
    const rand = Math.random() * 100;
    let rewardTier;
    
    if (rand < 1) rewardTier = 'legend';        // 1%
    else if (rand < 5) rewardTier = 'gold';     // 4%
    else if (rand < 30) rewardTier = 'silver';  // 25%
    else rewardTier = 'bronze';                 // 70%
    
    // í•´ë‹¹ í‹°ì–´ì—ì„œ ë³´ìƒ ì„ íƒ
    const tierRewards = ENHANCED_GACHA_REWARDS[rewardTier];
    const totalProbability = tierRewards.reduce((sum, reward) => sum + reward.probability, 0);
    let randReward = Math.random() * totalProbability;
    
    let selectedReward = null;
    for (const reward of tierRewards) {
        randReward -= reward.probability;
        if (randReward <= 0) {
            selectedReward = reward;
            break;
        }
    }
    
    // ë³´ìƒ ì €ì¥
    rewardData.availableGacha--;
    const rewardInstance = {
        ...selectedReward,
        tier: rewardTier,
        obtainedAt: new Date().toISOString(),
        used: false,
        instanceId: Date.now().toString()
    };
    
    rewardData.unlockedRewards.push(rewardInstance);
    rewardData.gachaHistory.push({
        date: new Date().toISOString(),
        tier: rewardTier,
        reward: selectedReward
    });
    
    await saveUserRewards(rewardData);
    currentGachaReward = rewardInstance;
    
    return rewardInstance;
}

function showGachaResult(reward) {
    document.getElementById('gachaContent').style.display = 'none';
    
    const tierColors = {
        bronze: 'linear-gradient(135deg, #CD7F32, #A0522D)',
        silver: 'linear-gradient(135deg, #C0C0C0, #808080)',
        gold: 'linear-gradient(135deg, #FFD700, #FFA500)',
        legend: 'linear-gradient(135deg, #9400D3, #FF1493)'
    };
    
    document.getElementById('gachaResultCard').style.background = tierColors[reward.tier];
    document.getElementById('gachaResultEmoji').textContent = reward.name.split(' ')[0];
    document.getElementById('gachaResultTier').textContent = reward.tier.toUpperCase();
    document.getElementById('gachaResultName').textContent = reward.name;
    document.getElementById('gachaResultDesc').textContent = reward.desc;
    
    // ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ë³´ìƒì¸ì§€ ì²´í¬
    const immediateUseRewards = ['golden_day', 'fail_shield', 'double_exp', 'reroll', 'cheat_day'];
    const useNowBtn = document.getElementById('useNowBtn');
    if (immediateUseRewards.includes(reward.id)) {
        useNowBtn.style.display = 'inline-block';
        useNowBtn.textContent = 'ì§€ê¸ˆ ì‚¬ìš©';
    } else {
        useNowBtn.style.display = 'inline-block';
        useNowBtn.textContent = 'ë³´ìƒ í™•ì¸';
    }
    
    document.getElementById('gachaResult').style.display = 'block';
}

        async function useRewardNow() { if (!currentGachaReward) return; await useEnhancedReward(currentGachaReward.instanceId); closeGachaModal(); }
        function saveForLater() { alert('ë³´ìƒì´ ì¸ë²¤í† ë¦¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!'); closeGachaModal(); }
        async function showRewardsModal() { document.getElementById('rewardsModal').style.display = 'flex'; await renderEnhancedRewardsList(); }
        function closeRewardsModal() { document.getElementById('rewardsModal').style.display = 'none'; }

        // ë³´ìƒ ëª©ë¡ ë Œë”ë§ ê°œì„  (ì‚¬ìš©ëœ ë³´ìƒì˜ ì„¸ë¶€ ì •ë³´ í‘œì‹œ)
async function renderEnhancedRewardsList() {
    const rewardData = await getUserRewards();
    const container = document.getElementById('rewardsList');
    const countElement = document.getElementById('availableGachaCount');
    
    countElement.textContent = `ë½‘ê¸° ê¸°íšŒ: ${rewardData.availableGacha}íšŒ`;
    
    if (rewardData.unlockedRewards.length === 0) {
        container.innerHTML = `
            <div class="empty-rewards">
                <div style="font-size: 48px; margin-bottom: 15px;">ğŸ</div>
                <p>ì•„ì§ íšë“í•œ ë³´ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <p>ë ˆë²¨ì—…ì„ í†µí•´ ë³´ìƒì„ íšë“í•´ë³´ì„¸ìš”!</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    for (const reward of rewardData.unlockedRewards.reverse()) {
        const usedClass = reward.used ? 'used' : '';
        const obtainedDate = new Date(reward.obtainedAt).toLocaleDateString('ko-KR');
        
        // ì‚¬ìš©ëœ ë³´ìƒì˜ ì¶”ê°€ ì •ë³´
        let usageInfo = '';
        if (reward.used) {
            const usedDate = new Date(reward.usedAt).toLocaleDateString('ko-KR');
            usageInfo = `<div style="font-size: 11px; color: var(--text-color-light); margin-top: 4px;">ì‚¬ìš©ì¼: ${usedDate}</div>`;
            
            // ì†Œì› ì„±ì·¨ê¶Œì˜ ê²½ìš° ì†Œì› ë‚´ìš© í‘œì‹œ
            if (reward.wishText) {
                usageInfo += `<div style="font-size: 11px; color: var(--primary-color); margin-top: 2px; font-style: italic;">"${reward.wishText}"</div>`;
            }
        }
        
        html += `
            <div class="reward-item ${reward.tier} ${usedClass}">
                <div class="reward-info">
                    <div class="reward-tier ${reward.tier}">${reward.tier.toUpperCase()}</div>
                    <div class="reward-name">${reward.name}</div>
                    <div class="reward-desc">${reward.desc}</div>
                    <div style="font-size: 11px; color: var(--text-color-light); margin-top: 4px;">
                        íšë“ì¼: ${obtainedDate}
                    </div>
                    ${usageInfo}
                </div>
                <div class="reward-actions">
                    ${!reward.used ? `
                        <button class="reward-btn use" onclick="useEnhancedReward('${reward.instanceId}')">ì‚¬ìš©</button>
                        <button class="reward-btn delete" onclick="deleteReward('${reward.instanceId}')">ì‚­ì œ</button>
                    ` : `
                        <span style="color: var(--text-color-light); font-size: 12px;">ì‚¬ìš©ë¨</span>
                    `}
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// ë³´ìƒ ì‚¬ìš© ì²˜ë¦¬
async function useEnhancedReward(instanceId) {
    const rewardData = await getUserRewards();
    const reward = rewardData.unlockedRewards.find(r => r.instanceId === instanceId);
    
    if (!reward || reward.used) {
        alert('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë³´ìƒì…ë‹ˆë‹¤.');
        return;
    }

    // ë³´ìƒ íƒ€ì…ë³„ ì²˜ë¦¬
    switch(reward.type) {
        case 'immediate_buff':
            await applyImmediateBuff(reward);
            break;
        case 'immediate_action':
            await applyImmediateAction(reward);
            break;
        case 'today_flag':
            await applyTodayFlag(reward);
            break;
        case 'tomorrow_buff':
            await applyTomorrowBuff(reward);
            break;
        case 'budget_bonus':
            await applyBudgetBonus(reward);
            break;
        case 'date_selector':
            await showDateSelector(reward, instanceId);
            return; // ë‚ ì§œ ì„ íƒ í›„ ì²˜ë¦¬ë˜ë¯€ë¡œ ì—¬ê¸°ì„œ return
        case 'date_selector_special':
            await showSpecialDateSelector(reward, instanceId);
            return;
        case 'timer_reward':
            await startTimerReward(reward);
            break;
        case 'ai_message':
            await generateAIMessage(reward, false);
            break;
        case 'ai_message_deep':
            await generateAIMessage(reward, true);
            break;
        case 'wish_fulfillment':
            await showWishFulfillment(reward, instanceId);
            return;
        default:
            alert(`${reward.name}ì„(ë¥¼) ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤! ë§ˆìŒê» ì¦ê¸°ì„¸ìš”! ğŸ‰`);
            break;
    }
    
    // ë³´ìƒì„ ì‚¬ìš©ë¨ìœ¼ë¡œ í‘œì‹œ
    reward.used = true;
    reward.usedAt = new Date().toISOString();
    
    await saveUserRewards(rewardData);
    
    // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
    if (document.getElementById('rewardsModal').style.display === 'flex') {
        await renderEnhancedRewardsList();
    }
}

// ì¦‰ì‹œ ë²„í”„ ì ìš©
async function applyImmediateBuff(reward) {
    switch(reward.id) {
        case 'double_exp_booster':
            const expiryTime = Date.now() + (24 * 60 * 60 * 1000);
            const userData = await getUserLevelData();
            userData.activeBuffs.doubleExp = expiryTime;
            await saveUserLevelData(userData);
            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'âš¡',
                title: 'ë”ë¸” ê²½í—˜ì¹˜ í™œì„±í™”!',
                message: '24ì‹œê°„ ë™ì•ˆ ëª¨ë“  ê²½í—˜ì¹˜ê°€ 2ë°°ì…ë‹ˆë‹¤! ì§€ê¸ˆì´ ë£¨í‹´ì„ ì—´ì‹¬íˆ í•  ë•Œì˜ˆìš”!'
            });
            break;
    }
}

// ì¦‰ì‹œ ì•¡ì…˜ ì ìš©
async function applyImmediateAction(reward) {
    switch(reward.id) {
        case 'quest_reroll':
            const today = new Date();
            const todayStr = formatDate(today);
            
            // ê¸°ì¡´ ì¼ê°„ í€˜ìŠ¤íŠ¸ ì‚­ì œ
            await dbDelete(`dailyQuests_${todayStr}`);
            
            // ìƒˆë¡œìš´ í€˜ìŠ¤íŠ¸ ìƒì„±
            await getDailyQuests(today);
            
            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'ğŸ²',
                title: 'í€˜ìŠ¤íŠ¸ ë¦¬ë¡¤ ì™„ë£Œ!',
                message: 'ìƒˆë¡œìš´ ì¼ê°„ í€˜ìŠ¤íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! í€˜ìŠ¤íŠ¸ í˜ì´ì§€ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.'
            });
            break;
    }
}

// ì˜¤ëŠ˜ í”Œë˜ê·¸ ì ìš©
async function applyTodayFlag(reward) {
    const today = formatDate(new Date());
    let flagKey = '';
    let message = '';
    
    switch(reward.id) {
        case 'cheat_day_gaming':
            flagKey = `cheatDayGaming_${today}`;
            message = 'ğŸ¥³ ì¹˜íŒ… ë°ì´ ë¯¸ë‹ˆ í† í°ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì˜¤ëŠ˜ì€ ê²Œì„ ì‹œê°„ í˜ë„í‹°ê°€ ì—†ìŠµë‹ˆë‹¤.';
            break;
        case 'streaming_free_pass':
            flagKey = `streamingFreePass_${today}`;
            message = 'ğŸ“º ë„·í”Œë¦­ìŠ¤/ìœ íŠœë¸Œ í”„ë¦¬ íŒ¨ìŠ¤ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! 3ì‹œê°„ ë™ì•ˆ ë§ˆìŒê» ì‹œì²­í•˜ì„¸ìš”.';
            break;
        case 'meal_freedom':
            flagKey = `mealFreedom_${today}`;
            message = 'ğŸ• ì›í•˜ëŠ” ì‹ì‚¬ ììœ ê¶Œì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì˜¤ëŠ˜ í•œ ë¼ëŠ” ììœ ë¡­ê²Œ!';
            break;
        case 'movie_ticket':
            flagKey = `movieTicket_${today}`;
            message = 'ğŸ¬ ì˜í™” í•œ í¸ ê´€ëŒê¶Œì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì£„ì±…ê° ì—†ì´ ì˜í™”ë¥¼ ì¦ê¸°ì„¸ìš”.';
            break;
        case 'unlimited_gaming':
            flagKey = `unlimitedGaming_${today}`;
            message = 'ğŸ® ê²Œì„ ì‹œê°„ ë¬´ì œí•œ íŒ¨ìŠ¤ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì˜¤ëŠ˜ì€ ì§„ì •í•œ ììœ !';
            break;
    }
    
    await dbSet(flagKey, true);
    alert(message);
}

// ë‚´ì¼ ë²„í”„ ì ìš©
async function applyTomorrowBuff(reward) {
    switch(reward.id) {
        case 'sleep_in_permit':
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = formatDate(tomorrow);
            await dbSet(`sleepInPermit_${tomorrowStr}`, 120); // 2ì‹œê°„ (ë¶„)
            alert('ğŸ›Œ ëŠ¦ì  í—ˆê°€ì¦ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ë‚´ì¼ì€ 2ì‹œê°„ ëŠ¦ê²Œ ì¼ì–´ë‚˜ë„ ì •ì‹œ ê¸°ìƒìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤.');
            break;
    }
}

// ì˜ˆì‚° ë³´ë„ˆìŠ¤ ì ìš©
async function applyBudgetBonus(reward) {
    const currentBonusBudget = await dbGet('currentMonthBonusBudget') || 0;
    const newBonusBudget = currentBonusBudget + reward.amount;
    await dbSet('currentMonthBonusBudget', newBonusBudget);
    
    // ì†Œí˜• ì˜ˆì‚° ë°” ì—…ë°ì´íŠ¸
    await renderSmallBudgetBarEnhanced();
    
    showFeedbackPopup(100, {
        class: 'feedback-celebration',
        emoji: reward.name.split(' ')[0],
        title: 'ì˜ˆì‚° ë³´ë„ˆìŠ¤ ì ìš©!',
        message: `${reward.amount.toLocaleString()}ì›ì´ ì´ë²ˆ ë‹¬ ì˜ˆì‚°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ë§ˆìŒê»Ÿ ì‚¬ìš©í•˜ì„¸ìš”.`
    });
}

// ë‚ ì§œ ì„ íƒê¸° í‘œì‹œ
async function showDateSelector(reward, instanceId) {
    const selectedDate = prompt(`${reward.name}ì„(ë¥¼) ì ìš©í•  ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD í˜•ì‹):`, formatDate(new Date()));
    
    if (!selectedDate || !/^\d{4}-\d{2}-\d{2}$/.test(selectedDate)) {
        alert('ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
        return;
    }
    
    switch(reward.id) {
        case 'golden_day_token':
            await dbSet(`goldenDay_${selectedDate}`, true);
            alert(`ğŸŒŸ ê³¨ë“ ë°ì´ í† í°ì´ ${selectedDate}ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ê·¸ë‚ ì€ ë§ˆì´ë„ˆìŠ¤ ì ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.`);
            break;
    }
    
    // ë³´ìƒì„ ì‚¬ìš©ë¨ìœ¼ë¡œ í‘œì‹œ
    const rewardData = await getUserRewards();
    const rewardToUse = rewardData.unlockedRewards.find(r => r.instanceId === instanceId);
    if (rewardToUse) {
        rewardToUse.used = true;
        rewardToUse.usedAt = new Date().toISOString();
        await saveUserRewards(rewardData);
    }
    
    if (document.getElementById('rewardsModal').style.display === 'flex') {
        await renderEnhancedRewardsList();
    }
}

// íŠ¹ë³„ ë‚ ì§œ ì„ íƒê¸° í‘œì‹œ
async function showSpecialDateSelector(reward, instanceId) {
    const selectedDate = prompt(`${reward.name}ì„(ë¥¼) ì ìš©í•  ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD í˜•ì‹):`, formatDate(new Date()));
    
    if (!selectedDate || !/^\d{4}-\d{2}-\d{2}$/.test(selectedDate)) {
        alert('ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
        return;
    }
    
    switch(reward.id) {
        case 'complete_freedom_day':
            await dbSet(`completeFreedomDay_${selectedDate}`, true);
            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'ğŸŒŸ',
                title: 'ì™„ì „ ììœ ì˜ ë‚  ì˜ˆì•½ ì™„ë£Œ!',
                message: `${selectedDate}ì— ì™„ì „ ììœ ì˜ ë‚ ì´ ì ìš©ë©ë‹ˆë‹¤! ê·¸ë‚ ì€ ëª¨ë“  ê·œì¹™ì—ì„œ í•´ë°©ë©ë‹ˆë‹¤.`
            });
            break;
        case 'routine_king_day':
            await dbSet(`routineKingDay_${selectedDate}`, true);
            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'ğŸ†',
                title: 'ë£¨í‹´ì˜ ì™• ì„ ì–¸ ì™„ë£Œ!',
                message: `${selectedDate}ì— ë‹¹ì‹ ì€ ë£¨í‹´ì˜ ì™•ì…ë‹ˆë‹¤! ê·¸ë‚ ì€ ëª¨ë“  í–‰ë™ì´ ì¹­ì°¬ë°›ì„ ê²ƒì…ë‹ˆë‹¤.`
            });
            break;
    }
    
    // ë³´ìƒì„ ì‚¬ìš©ë¨ìœ¼ë¡œ í‘œì‹œ
    const rewardData = await getUserRewards();
    const rewardToUse = rewardData.unlockedRewards.find(r => r.instanceId === instanceId);
    if (rewardToUse) {
        rewardToUse.used = true;
        rewardToUse.usedAt = new Date().toISOString();
        await saveUserRewards(rewardData);
    }
    
    if (document.getElementById('rewardsModal').style.display === 'flex') {
        await renderEnhancedRewardsList();
    }
}

// íƒ€ì´ë¨¸ ë³´ìƒ ì‹œì‘
async function startTimerReward(reward) {
    if (reward.id === 'audio_focus_time') {
        const startTime = Date.now();
        const endTime = startTime + (reward.duration * 60 * 1000);
        
        // íƒ€ì´ë¨¸ UI í‘œì‹œ (ê°„ë‹¨í•œ ì•Œë¦¼)
        showFeedbackPopup(100, {
            class: 'feedback-celebration',
            emoji: 'ğŸ§',
            title: 'ê²Œì„ ì§‘ì¤‘ê¶Œ ì‹œì‘!',
            message: `3ì‹œê°„ ë™ì•ˆ ë§ˆìŒê» íœ´ì‹í•˜ì„¸ìš”! íƒ€ì´ë¨¸ê°€ ëë‚˜ë©´ 10XPë¥¼ ë“œë¦½ë‹ˆë‹¤.`
        });
        
        // 3ì‹œê°„ í›„ ê²½í—˜ì¹˜ ì§€ê¸‰
        setTimeout(async () => {
            await addExperience(10, 'ê²Œì„ ì§‘ì¤‘ê¶Œ ì™„ë£Œ ë³´ë„ˆìŠ¤');
            alert('ğŸ§ ê²Œì„ ì§‘ì¤‘ê¶Œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! 10XPë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤.');
        }, reward.duration * 60 * 1000);
    }
}

// AI ë©”ì‹œì§€ ìƒì„± (ì‹¤ì œë¡œëŠ” ë¯¸ë¦¬ ì •ì˜ëœ ë©”ì‹œì§€ ì‚¬ìš©)
async function generateAIMessage(reward, isDeep = false) {
    const userData = await getUserLevelData();
    const allData = await dbGetAll();
    const dayRecords = allData.filter(item => item.key.startsWith('day_')).length;
    
    let message = '';
    
    if (isDeep) {
        // ê¹Šì€ ê°ì‚¬ ë©”ì‹œì§€
        const messages = [
            `ì§€ê¸ˆê¹Œì§€ ${dayRecords}ì¼ ë™ì•ˆ ê¸°ë¡ì„ ë‚¨ê²¨ì£¼ì…¨êµ°ìš”. ë ˆë²¨ ${userData.level}ê¹Œì§€ ì˜¬ë¼ì˜¨ ë‹¹ì‹ ì˜ ì—¬ì •ì´ ì •ë§ ëŒ€ë‹¨í•©ë‹ˆë‹¤. ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ì•„ì§€ë ¤ëŠ” ë‹¹ì‹ ì˜ ì˜ì§€ê°€ ì €ì—ê²Œë„ í° ê°ë™ì„ ì¤ë‹ˆë‹¤. ì•ìœ¼ë¡œë„ í•¨ê»˜ ì„±ì¥í•´ë‚˜ê°€ìš”.`,
            `ë‹¹ì‹ ì€ ì´ë¯¸ ì¶©ë¶„íˆ í›Œë¥­í•©ë‹ˆë‹¤. ${userData.totalExp}ì˜ ê²½í—˜ì¹˜ë¥¼ ìŒ“ìœ¼ë©° ì—¬ê¸°ê¹Œì§€ ì˜¨ ê²ƒì´ ê·¸ ì¦ê±°ì˜ˆìš”. ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ìŠµë‹ˆë‹¤. ë§¤ì¼ ê¸°ë¡í•˜ê³ , ë°˜ì„±í•˜ê³ , ë‹¤ì‹œ ì‹œì‘í•˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµì´ ì§„ì •í•œ ì„±ì¥ì…ë‹ˆë‹¤.`,
            `í˜¹ì‹œ í˜ë“¤ ë•Œê°€ ìˆë‚˜ìš”? ë£¨í‹´ì„ ì§€í‚¤ëŠ” ê²ƒì´ ë•Œë¡œëŠ” ë²„ê²ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆì–´ìš”. í•˜ì§€ë§Œ ì§€ê¸ˆê¹Œì§€ ${dayRecords}ì¼ì„ ê¸°ë¡í•œ ë‹¹ì‹ ì´ë¼ë©´ ì¶©ë¶„íˆ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” ì–¸ì œë‚˜ ë‹¹ì‹ ì„ ì‘ì›í•˜ê³  ìˆì–´ìš”.`
        ];
        message = messages[Math.floor(Math.random() * messages.length)];
    } else {
        // ì¼ë°˜ ì‘ì› ë©”ì‹œì§€
        const messages = [
            `ë ˆë²¨ ${userData.level}! ì •ë§ ë©‹ì§€ë„¤ìš”! ì§€ê¸ˆê¹Œì§€ì˜ ë…¸ë ¥ì´ í—›ë˜ì§€ ì•Šì•˜ì–´ìš”. ê³„ì† ì´ëŸ° ì‹ìœ¼ë¡œ í•´ë‚˜ê°€ì‹œë©´ ê³§ ë” í° ì„±ì·¨ë¥¼ ì´ë£° ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!`,
            `${dayRecords}ì¼ ë™ì•ˆì˜ ê¸°ë¡, ì •ë§ ëŒ€ë‹¨í•©ë‹ˆë‹¤! ë§¤ì¼ë§¤ì¼ ì„±ì‹¤í•˜ê²Œ ê¸°ë¡í•˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµì´ ì €ì—ê²ŒëŠ” ì˜ê°ì´ ë©ë‹ˆë‹¤.`,
            `ìš”ì¦˜ ì–´ë– ì„¸ìš”? ë£¨í‹´ì´ ë§ì´ ìë¦¬ì¡í˜”ë‚˜ìš”? ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”. ì¤‘ìš”í•œ ê±´ í¬ê¸°í•˜ì§€ ì•ŠëŠ” ë§ˆìŒì´ë‹ˆê¹Œìš”!`,
            `ë‹¹ì‹ ì˜ ${userData.totalExp} ê²½í—˜ì¹˜ í•˜ë‚˜í•˜ë‚˜ê°€ ëª¨ë‘ ì†Œì¤‘í•œ ë…¸ë ¥ì˜ ê²°ê³¼ì˜ˆìš”. ì•ìœ¼ë¡œë„ í•¨ê»˜ ì„±ì¥í•´ë‚˜ê°€ìš”!`
        ];
        message = messages[Math.floor(Math.random() * messages.length)];
    }
    
    showFeedbackPopup(100, {
        class: 'feedback-celebration',
        emoji: isDeep ? 'ğŸ’–' : 'ğŸ’¬',
        title: isDeep ? 'ì½”ì¹˜ì˜ ê¹Šì€ ê°ì‚¬ ì¸ì‚¬' : 'ì½”ì¹˜ì˜ ì‘ì› í•œë§ˆë””',
        message: message
    });
}

// ì†Œì› ì„±ì·¨ ì²˜ë¦¬
async function showWishFulfillment(reward, instanceId) {
    const wish = prompt('ë‹¹ì‹ ì´ ì§„ì •ìœ¼ë¡œ ì›í•˜ëŠ” ê²ƒì„ ì ì–´ì£¼ì„¸ìš”:');
    
    if (!wish || wish.trim() === '') {
        alert('ì†Œì›ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì˜ˆì‚° ë³´ë„ˆìŠ¤ ì ìš©
    const currentBonusBudget = await dbGet('currentMonthBonusBudget') || 0;
    const newBonusBudget = currentBonusBudget + reward.amount;
    await dbSet('currentMonthBonusBudget', newBonusBudget);
    
    // ì†Œì› ê¸°ë¡
    await dbSet(`userWish_${Date.now()}`, {
        wish: wish,
        grantedAt: new Date().toISOString(),
        budget: reward.amount
    });
    
    showFeedbackPopup(100, {
        class: 'feedback-celebration',
        emoji: 'ğŸ’',
        title: 'ì†Œì› ì„±ì·¨ê¶Œ ë°œë™!',
        message: `"${wish}" - ë‹¹ì‹ ì˜ ì†Œì›ì„ ì ê·¹ ì‘ì›í•©ë‹ˆë‹¤! ${reward.amount.toLocaleString()}ì›ì´ ì´ë²ˆ ë‹¬ ì˜ˆì‚°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ê¼­ ì´ë£¨ì‹œê¸¸ ë°”ë¼ìš”!`
    });
    
    // ë³´ìƒì„ ì‚¬ìš©ë¨ìœ¼ë¡œ í‘œì‹œ
    const rewardData = await getUserRewards();
    const rewardToUse = rewardData.unlockedRewards.find(r => r.instanceId === instanceId);
    if (rewardToUse) {
        rewardToUse.used = true;
        rewardToUse.usedAt = new Date().toISOString();
        rewardToUse.wishText = wish; // ì†Œì› í…ìŠ¤íŠ¸ ì €ì¥
        await saveUserRewards(rewardData);
    }
    
    if (document.getElementById('rewardsModal').style.display === 'flex') {
        await renderEnhancedRewardsList();
    }
}

// ë£¨í‹´ì˜ ì™• ë°ì´ íŠ¹ë³„ UI ì²˜ë¦¬
async function checkRoutineKingDay() {
    const today = formatDate(new Date());
    const isRoutineKingDay = await dbGet(`routineKingDay_${today}`);
    
    if (isRoutineKingDay) {
        // í—¤ë”ì— ì™•ê´€ ì¶”ê°€
        const header = document.querySelector('.header h1');
        if (header && !header.textContent.includes('ğŸ‘‘')) {
            header.textContent = 'ğŸ‘‘ ' + header.textContent + ' ğŸ‘‘';
            header.style.color = 'gold';
        }
        
        // íŠ¹ë³„í•œ í™˜ì˜ ë©”ì‹œì§€
        setTimeout(() => {
            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'ğŸ†',
                title: 'ë£¨í‹´ì˜ ì™•ì´ ì˜¤ì…¨ìŠµë‹ˆë‹¤!',
                message: 'ì˜¤ëŠ˜ í•˜ë£¨ ë‹¹ì‹ ì€ ë£¨í‹´ì˜ ì™•ì…ë‹ˆë‹¤! ëª¨ë“  í–‰ë™ì´ ì¹­ì°¬ë°›ì„ ê²ƒì´ë©°, ìµœì†Œ 50ì ì´ ë³´ì¥ë©ë‹ˆë‹¤!'
            });
        }, 1000);
    }
}

// ì™„ì „ ììœ ì˜ ë‚  UI ì²˜ë¦¬
async function checkCompleteFreedomDay() {
    const today = formatDate(new Date());
    const isCompleteFreedomDay = await dbGet(`completeFreedomDay_${today}`);
    
    if (isCompleteFreedomDay) {
        // í—¤ë” ë©”ì‹œì§€ ë³€ê²½
        const header = document.querySelector('.header h1');
        if (header) {
            header.textContent = 'ğŸŒŸ ì™„ì „ ììœ ì˜ ë‚  ğŸŒŸ';
            header.style.color = 'var(--success-color)';
        }
        
        // ì„¤ëª… ë©”ì‹œì§€ ë³€ê²½
        const headerP = document.querySelector('.header p');
        if (headerP) {
            headerP.textContent = 'ì˜¤ëŠ˜ì€ ëª¨ë“  ê·œì¹™ì—ì„œ í•´ë°©ëœ ì™„ì „ ììœ ì˜ ë‚ ì…ë‹ˆë‹¤!';
        }
        
        // íŠ¹ë³„í•œ í™˜ì˜ ë©”ì‹œì§€
        setTimeout(() => {
            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'ğŸŒŸ',
                title: 'ì™„ì „ ììœ ì˜ ë‚ ì…ë‹ˆë‹¤!',
                message: 'ì˜¤ëŠ˜ì€ ëª¨ë“  ë£¨í‹´ ê·œì¹™ì—ì„œ í•´ë°©ë©ë‹ˆë‹¤! ë§ˆìŒê» ììœ ë¡­ê²Œ ë³´ë‚´ì„¸ìš”!'
            });
        }, 1000);
    }
}

// ë³´ìƒ íš¨ê³¼ ì ìš© í•¨ìˆ˜ë“¤
async function applyGoldenDay() {
    const today = formatDate(new Date());
    await dbSet(`goldenDay_${today}`, true);
    alert('ğŸŒŸ ê³¨ë“ ë°ì´ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì˜¤ëŠ˜ì€ ë§ˆì´ë„ˆìŠ¤ ì ìˆ˜ê°€ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
}

async function applyFailShield() {
    const userData = await getUserLevelData();
    userData.activeBuffs.failShield = (userData.activeBuffs.failShield || 0) + 1;
    await saveUserLevelData(userData);
    alert('ğŸ›¡ï¸ ì‹¤íŒ¨ ë°©ì–´ê¶Œì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ í€˜ìŠ¤íŠ¸ ì‹¤íŒ¨ê°€ ë¬´íš¨í™”ë©ë‹ˆë‹¤.');
}

async function applyDoubleExp() {
    const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // 24ì‹œê°„
    const userData = await getUserLevelData();
    userData.activeBuffs.doubleExp = expiryTime;
    await saveUserLevelData(userData);
    alert('âš¡ ë”ë¸” ê²½í—˜ì¹˜ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! 24ì‹œê°„ ë™ì•ˆ ëª¨ë“  ê²½í—˜ì¹˜ê°€ 2ë°°ì…ë‹ˆë‹¤.');
}

async function applyReroll() {
    const today = new Date();
    const todayStr = formatDate(today);
    
    // ê¸°ì¡´ ì¼ê°„ í€˜ìŠ¤íŠ¸ ì‚­ì œ
    await dbDelete(`dailyQuests_${todayStr}`);
    
    // ìƒˆë¡œìš´ í€˜ìŠ¤íŠ¸ ìƒì„±
    await getDailyQuests(today);
    
    alert('ğŸ² ì¼ê°„ í€˜ìŠ¤íŠ¸ê°€ ìƒˆë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
    
    // í€˜ìŠ¤íŠ¸ í˜ì´ì§€ê°€ ì—´ë ¤ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
    if (document.getElementById('questPage').classList.contains('active')) {
        await renderQuestPage();
    }
}

async function applyCheatDay() {
    const today = formatDate(new Date());
    await dbSet(`cheatDay_${today}`, true);
    alert('ğŸ• ì¹˜íŒ…ë°ì´ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤! ì˜¤ëŠ˜ì€ ê²Œì„ì‹œê°„ê³¼ ì§€ì¶œì— ì œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
}

async function deleteReward(instanceId) {
    if (!confirm('ì •ë§ë¡œ ì´ ë³´ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    const rewardData = await getUserRewards();
    rewardData.unlockedRewards = rewardData.unlockedRewards.filter(r => r.instanceId !== instanceId);
    
    await saveUserRewards(rewardData);
    await renderEnhancedRewardsList();
}

// í”„ë¡œí•„ ë©”ë‰´ ê´€ë ¨ í•¨ìˆ˜ë“¤
function showProfileMenu() {
    const menu = document.getElementById('profileMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

// ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener('click', function(event) {
    const profileWidget = document.getElementById('profileWidget');
    const profileMenu = document.getElementById('profileMenu');
    
    if (!profileWidget.contains(event.target) && !profileMenu.contains(event.target)) {
        profileMenu.style.display = 'none';
    }
});

// ê¸°ì¡´ showQuestPage í•¨ìˆ˜ ìˆ˜ì •
function showQuestPage() {
    document.getElementById('profileMenu').style.display = 'none';
    showPage('questPage');
    renderQuestPage();
}

// ê¸°ì¡´ updateQuestProgress í•¨ìˆ˜ë¥¼ ì°¾ì•„ì„œ ìˆ˜ì •:
async function updateQuestProgress(questType, questId, currentValue, date = new Date()) {
    // === ì˜¤ëŠ˜ ë‚ ì§œê°€ ì•„ë‹ˆë©´ í€˜ìŠ¤íŠ¸ ì§„í–‰ë„ ì—…ë°ì´íŠ¸ ì•ˆí•¨ ===
    const today = new Date();
    const targetDate = new Date(date);
    
    // ë‚ ì§œë§Œ ë¹„êµ (ì‹œê°„ ì œì™¸)
    today.setHours(0, 0, 0, 0);
    targetDate.setHours(0, 0, 0, 0);
    
    if (targetDate.getTime() !== today.getTime()) {
        // ì˜¤ëŠ˜ì´ ì•„ë‹Œ ë‚ ì§œë¥¼ ìˆ˜ì •í•´ë„ í€˜ìŠ¤íŠ¸ ì§„í–‰ë„ì— ë°˜ì˜ ì•ˆí•¨
        return false;
    }
    
    let questData;
    let saveKey;
    
    switch(questType) {
        case 'daily':
            questData = await getDailyQuests(date);
            saveKey = `dailyQuests_${formatDate(date)}`;
            break;
        case 'weekly':
            const weekStart = getWeekDates(date)[0];
            questData = await getWeeklyQuests(date);
            saveKey = `weeklyQuests_${weekStart}`;
            break;
        case 'monthly':
            const monthKey = `${date.getFullYear()}-${date.getMonth() + 1}`;
            questData = await getMonthlyQuests(date);
            saveKey = `monthlyQuests_${monthKey}`;
            break;
    }
    
    if (!questData) return false;
    
    const quest = questData.quests.find(q => q.id === questId);
    if (!quest) return false;
    
    const oldProgress = quest.progress;
    quest.progress = Math.min(currentValue, quest.maxProgress);
    
    // í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì²´í¬
    if (!quest.completed && quest.progress >= quest.maxProgress) {
        quest.completed = true;
        questData.completedCount++;
        
        // ê²½í—˜ì¹˜ ì§€ê¸‰
        await addExperience(quest.reward, `${questType} í€˜ìŠ¤íŠ¸: ${quest.title}`);
        
        // ì™„ë£Œ ì•Œë¦¼
        showQuestCompleteNotification(quest);
        
        // === í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì—…ì  ì²´í¬ ===
        await checkQuestCompletionAchievements(questType, questData, date);
    }
    
    await dbSet(saveKey, questData);
    
    return quest.completed && oldProgress < quest.maxProgress;
}

// í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì—…ì  ì²´í¬ í•¨ìˆ˜
async function checkQuestCompletionAchievements(questType, questData, date) {
    const unlocked = await dbGet('unlockedAchievements') || [];
    const totalQuests = questData.quests.length;
    const completedQuests = questData.completedCount;
    
    // ëª¨ë“  í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì‹œ
    if (completedQuests >= totalQuests) {
        
        if (questType === 'daily') {
            // ì¼ì¼ í€˜ìŠ¤íŠ¸ ëª¨ë‘ ì™„ë£Œ
            if (!unlocked.includes('ACH_DAILY_QUEST_ALL_CLEAR_FIRST')) {
                await unlockAchievement('ACH_DAILY_QUEST_ALL_CLEAR_FIRST');
            }
            
            // ì¼ì¼ í€˜ìŠ¤íŠ¸ ì™„ë£Œ íšŸìˆ˜ ì²´í¬
            const allData = await dbGetAll();
            const allDailyQuests = allData.filter(item => item.key.startsWith('dailyQuests_'));
            const dailyCompletionCount = allDailyQuests.filter(item => 
                item.value.completedCount >= item.value.quests.length
            ).length;
            
            if (!unlocked.includes('ACH_DAILY_QUEST_ALL_CLEAR_50') && dailyCompletionCount >= 50) {
                await unlockAchievement('ACH_DAILY_QUEST_ALL_CLEAR_50');
            } else if (!unlocked.includes('ACH_DAILY_QUEST_ALL_CLEAR_10') && dailyCompletionCount >= 10) {
                await unlockAchievement('ACH_DAILY_QUEST_ALL_CLEAR_10');
            }
        }
        
        else if (questType === 'weekly') {
            // ì£¼ê°„ í€˜ìŠ¤íŠ¸ ëª¨ë‘ ì™„ë£Œ
            if (!unlocked.includes('ACH_WEEKLY_QUEST_ALL_CLEAR_FIRST')) {
                await unlockAchievement('ACH_WEEKLY_QUEST_ALL_CLEAR_FIRST');
            }
            
            // ì£¼ê°„ í€˜ìŠ¤íŠ¸ ì™„ë£Œ íšŸìˆ˜ ì²´í¬
            const allData = await dbGetAll();
            const allWeeklyQuests = allData.filter(item => item.key.startsWith('weeklyQuests_'));
            const weeklyCompletionCount = allWeeklyQuests.filter(item => 
                item.value.completedCount >= item.value.quests.length
            ).length;
            
            if (!unlocked.includes('ACH_WEEKLY_QUEST_ALL_CLEAR_5') && weeklyCompletionCount >= 5) {
                await unlockAchievement('ACH_WEEKLY_QUEST_ALL_CLEAR_5');
            }
        }
        
        else if (questType === 'monthly') {
            // ì›”ê°„ í€˜ìŠ¤íŠ¸ ëª¨ë‘ ì™„ë£Œ
            if (!unlocked.includes('ACH_MONTHLY_QUEST_ALL_CLEAR_FIRST')) {
                await unlockAchievement('ACH_MONTHLY_QUEST_ALL_CLEAR_FIRST');
            }
            
            // ì›”ê°„ í€˜ìŠ¤íŠ¸ ì™„ë£Œ íšŸìˆ˜ ì²´í¬
            const allData = await dbGetAll();
            const allMonthlyQuests = allData.filter(item => item.key.startsWith('monthlyQuests_'));
            const monthlyCompletionCount = allMonthlyQuests.filter(item => 
                item.value.completedCount >= item.value.quests.length
            ).length;
            
            if (!unlocked.includes('ACH_MONTHLY_QUEST_ALL_CLEAR_3') && monthlyCompletionCount >= 3) {
                await unlockAchievement('ACH_MONTHLY_QUEST_ALL_CLEAR_3');
            }
        }
    }
}

// ì‹ë‹¨ ê´€ë ¨ ì—…ì  ì²´í¬ í•¨ìˆ˜
async function checkFoodRecordAchievements() {
    const unlocked = await dbGet('unlockedAchievements') || [];
    const allData = await dbGetAll();
    
    // 7ì¼ ì—°ì† ì‹ë‹¨ ê¸°ë¡ ì²´í¬
    if (!unlocked.includes('ACH_FOOD_DIARIST_7DAYS')) {
        let consecutiveFoodDays = 0;
        const today = new Date();
        
        for (let i = 0; i < 7; i++) {
            const checkDate = new Date(today);
            checkDate.setDate(checkDate.getDate() - i);
            const dateStr = formatDate(checkDate);
            
            const hasFoodRecord = allData.some(item => 
                item.key.startsWith('food_') && item.value.date === dateStr
            );
            
            if (hasFoodRecord) {
                consecutiveFoodDays++;
            } else {
                break;
            }
        }
        
        if (consecutiveFoodDays >= 7) {
            await unlockAchievement('ACH_FOOD_DIARIST_7DAYS');
        }
    }
}

// ì›”ë§ì—ë§Œ ì²´í¬í•˜ëŠ” ì—…ì ë“¤ ===
async function checkMonthEndAchievements(date) {
    const unlocked = await dbGet('unlockedAchievements') || [];
    const today = new Date(date);
    const { start, end } = getMonthDateRange(today);
    const allData = await dbGetAll();
    
    // ê±´ê°• ì‹ë‹¨ì˜ ë‹¬ì¸ (í•œ ë‹¬ ê°„ì‹/ì™¸ì‹ 5íšŒ ë¯¸ë§Œ)
    if (!unlocked.includes('ACH_HEALTHY_EATER_MONTH')) {
        const junkFoodKeywords = ['ë§¥ë„ë‚ ë“œ', 'ë²„ê±°í‚¹', 'kfc', 'ë¡¯ë°ë¦¬ì•„', 'í–„ë²„ê±°', 'ë²„ê±°', 'ì¹˜í‚¨', 'í”¼ì', 
                                  'ê³¼ì', 'ì´ˆì½œë¦¿', 'ì‚¬íƒ•', 'ì•„ì´ìŠ¤í¬ë¦¼', 'ì ¤ë¼ë˜', 'ì¼€ì´í¬', 'ë„ë„›', 'ë–¡ë³¶ì´'];
        
        const junkFoodCount = allData.filter(item => 
            item.key.startsWith('food_') && 
            item.value.date >= start && 
            item.value.date <= end &&
            junkFoodKeywords.some(keyword => 
                item.value.foodName.toLowerCase().includes(keyword.toLowerCase())
            )
        ).length;
        
        if (junkFoodCount < 5) {
            await unlockAchievement('ACH_HEALTHY_EATER_MONTH');
        }
    }
    
    // ë¬´ì§€ì¶œì˜ ë‹¬ (í•œ ë‹¬ ì´ ì§€ì¶œ 0ì›)
    if (!unlocked.includes('ACH_ZERO_SPEND_MONTH')) {
        const expenses = allData.filter(item => 
            item.key.startsWith('expense_') && 
            item.value.date >= start && 
            item.value.date <= end
        );
        const totalSpent = expenses.reduce((sum, item) => sum + item.value.amount, 0);
        
        if (totalSpent === 0) {
            await unlockAchievement('ACH_ZERO_SPEND_MONTH');
        }
    }
    
    // ì €ì¶•ì˜ ì™• (í•œ ë‹¬ ì˜ˆì‚°ì˜ 50% ë¯¸ë§Œ ì§€ì¶œ)
    if (!unlocked.includes('ACH_SAVING_KING')) {
        const budget = await dbGet('monthlyBudget') || 0;
        if (budget > 0) {
            const expenses = allData.filter(item => 
                item.key.startsWith('expense_') && 
                item.value.date >= start && 
                item.value.date <= end
            );
            const totalSpent = expenses.reduce((sum, item) => sum + item.value.amount, 0);
            
            if (totalSpent < budget * 0.5) {
                await unlockAchievement('ACH_SAVING_KING');
            }
        }
    }
    
    // ì² ì˜ ìœ„ì¥ (í•œ ë‹¬ ë™ì•ˆ ë¼ë©´ ì—†ìŒ)
    if (!unlocked.includes('ACH_NO_RAMEN')) {
        const ramenRecords = allData.filter(item => 
            item.key.startsWith('food_') && 
            item.value.date >= start && 
            item.value.date <= end &&
            item.value.foodName.toLowerCase().includes('ë¼ë©´')
        );
        
        if (ramenRecords.length === 0) {
            await unlockAchievement('ACH_NO_RAMEN');
        }
    }
    
    // ì•¡ìƒê³¼ë‹¹ ì•ˆë…• (í•œ ë‹¬ ë™ì•ˆ ë¼ë–¼ ì—†ìŒ)
    if (!unlocked.includes('ACH_NO_LATTE')) {
        const latteRecords = allData.filter(item => 
            item.key.startsWith('food_') && 
            item.value.date >= start && 
            item.value.date <= end &&
            item.value.foodName.toLowerCase().includes('ë¼ë–¼')
        );
        
        if (latteRecords.length === 0) {
            await unlockAchievement('ACH_NO_LATTE');
        }
    }
    
    // ê°•ì²  ì²´ë ¥ (í•œ ë‹¬ ìš´ë™ 20íšŒ ì´ìƒ)
    if (!unlocked.includes('ACH_IRON_BODY')) {
        const exerciseCount = allData.filter(item => 
            item.key.startsWith('day_') && 
            item.value.date >= start && 
            item.value.date <= end &&
            item.value.exercise?.done
        ).length;
        
        if (exerciseCount >= 20) {
            await unlockAchievement('ACH_IRON_BODY');
        }
    }
    
    // ì™„ë²½í•œ í•œ ë‹¬ (ë§¤ì¼ ê¸°ìƒì‹œê°„ ê¸°ë¡)
    if (!unlocked.includes('ACH_PERFECT_MONTH')) {
        const monthDates = getMonthDates(today);
        const recordedDays = allData.filter(item => 
            item.key.startsWith('day_') && 
            monthDates.includes(item.value.date) &&
            item.value.wakeTime
        ).length;
        
        if (recordedDays === monthDates.length) {
            await unlockAchievement('ACH_PERFECT_MONTH');
        }
    }
    
    // ì—°ì† ì˜ˆì‚° ê´€ë¦¬ ì²´í¬ (3ê°œì›”, 6ê°œì›”)
    const budget = await dbGet('monthlyBudget') || 0;
    if (budget > 0) {
        const currentExpenses = allData.filter(item => 
            item.key.startsWith('expense_') && 
            item.value.date >= start && 
            item.value.date <= end
        );
        const currentTotal = currentExpenses.reduce((sum, item) => sum + item.value.amount, 0);
        
        if (currentTotal < budget * 0.8) {
            // 3ê°œì›” ì—°ì† ì²´í¬
            let consecutiveBudgetMonths = 1; // ì´ë²ˆ ë‹¬ í¬í•¨
            
            for (let i = 1; i < 6; i++) {
                const checkDate = new Date(today);
                checkDate.setMonth(checkDate.getMonth() - i);
                const { start: checkStart, end: checkEnd } = getMonthDateRange(checkDate);
                
                const checkExpenses = allData.filter(item => 
                    item.key.startsWith('expense_') && 
                    item.value.date >= checkStart && 
                    item.value.date <= checkEnd
                );
                const checkTotal = checkExpenses.reduce((sum, item) => sum + item.value.amount, 0);
                
                if (checkTotal < budget * 0.8) {
                    consecutiveBudgetMonths++;
                } else {
                    break;
                }
            }
            
            if (!unlocked.includes('ACH_FINANCIAL_FREEDOM') && consecutiveBudgetMonths >= 6) {
                await unlockAchievement('ACH_FINANCIAL_FREEDOM');
            } else if (!unlocked.includes('ACH_BUDGET_MASTER_3MONTH') && consecutiveBudgetMonths >= 3) {
                await unlockAchievement('ACH_BUDGET_MASTER_3MONTH');
            }
        }
    }
}

// ì£¼ê°„ ì—…ì  ì¤‘ íŠ¹ë³„í•œ ì²´í¬ê°€ í•„ìš”í•œ ê²ƒë“¤
async function checkWeekEndAchievements(date) {
    const unlocked = await dbGet('unlockedAchievements') || [];
    const allData = await dbGetAll();
    
    // ë””ì§€í„¸ ë””í†¡ìŠ¤ (ì£¼ë§ ì´í‹€ ë™ì•ˆ ê²Œì„ 0ë¶„)
    if (!unlocked.includes('ACH_DIGITAL_DETOX')) {
        const today = new Date(date);
        const dayOfWeek = today.getDay();
        
        if (dayOfWeek === 0) { // ì¼ìš”ì¼ì¸ ê²½ìš°ë§Œ ì²´í¬
            const saturday = new Date(today);
            saturday.setDate(saturday.getDate() - 1);
            
            const saturdayData = await dbGet(`day_${formatDate(saturday)}`);
            const sundayData = await dbGet(`day_${formatDate(today)}`);
            
            const saturdayGameTime = saturdayData?.gameTime || 0;
            const sundayGameTime = sundayData?.gameTime || 0;
            
            if (saturdayGameTime === 0 && sundayGameTime === 0) {
                await unlockAchievement('ACH_DIGITAL_DETOX');
            }
        }
    }
    
    // í˜„ìíƒ€ì„ (7ì¼ ì—°ì† ê²Œì„ 0ë¶„)
    if (!unlocked.includes('ACH_SAGE_MODE')) {
        let consecutiveNoGameDays = 0;
        
        for (let i = 0; i < 7; i++) {
            const checkDate = new Date(date);
            checkDate.setDate(checkDate.getDate() - i);
            const dayData = await dbGet(`day_${formatDate(checkDate)}`);
            
            if (dayData && (dayData.gameTime === 0 || !dayData.gameTime)) {
                consecutiveNoGameDays++;
            } else {
                break;
            }
        }
        
        if (consecutiveNoGameDays >= 7) {
            await unlockAchievement('ACH_SAGE_MODE');
        }
    }
    
    // í´ë¦° ì´í„° (ì¼ì£¼ì¼ ê°„ì‹/ì™¸ì‹ 3íšŒ ë¯¸ë§Œ)
    if (!unlocked.includes('ACH_CLEAN_EATER')) {
        const weekDates = getWeekDates(new Date(date));
        
        const junkFoodKeywords = ['ë§¥ë„ë‚ ë“œ', 'ë²„ê±°í‚¹', 'kfc', 'ë¡¯ë°ë¦¬ì•„', 'í–„ë²„ê±°', 'ë²„ê±°', 'ì¹˜í‚¨', 'í”¼ì', 
                                  'ê³¼ì', 'ì´ˆì½œë¦¿', 'ì‚¬íƒ•', 'ì•„ì´ìŠ¤í¬ë¦¼', 'ì ¤ë¼ë˜', 'ì¼€ì´í¬', 'ë„ë„›', 'ë–¡ë³¶ì´'];
        
        const junkFoodCount = allData.filter(item => 
            item.key.startsWith('food_') && 
            weekDates.includes(item.value.date) &&
            junkFoodKeywords.some(keyword => 
                item.value.foodName.toLowerCase().includes(keyword.toLowerCase())
            )
        ).length;
        
        if (junkFoodCount < 3) {
            await unlockAchievement('ACH_CLEAN_EATER');
        }
    }
    
    // ì™„ë²½í•œ í†µì œ (ë¶€ì •ì  ìŠµê´€ ëª©í‘œ 7ì¼ ì—°ì† 100% ë‹¬ì„±)
    if (!unlocked.includes('ACH_PERFECT_CONTROL')) {
        const weekDates = getWeekDates(new Date(date));
        const allGoals = await getPersonalGoals();
        const negativeGoals = allGoals.filter(goal => goal.type === 'negative' && !goal.isCompleted);
        
        if (negativeGoals.length > 0) {
            let perfectWeek = true;
            
            for (const dateStr of weekDates) {
                const dayData = await dbGet(`day_${dateStr}`);
                if (!dayData) {
                    perfectWeek = false;
                    break;
                }
                
                for (const goal of negativeGoals) {
                    const achieved = dayData.personalGoals?.[goal.id] || 0;
                    const usageRatio = achieved / goal.target;
                    const percentage = Math.max(0, (1 - usageRatio) * 100);
                    
                    if (percentage < 100) {
                        perfectWeek = false;
                        break;
                    }
                }
                
                if (!perfectWeek) break;
            }
            
            if (perfectWeek) {
                await unlockAchievement('ACH_PERFECT_CONTROL');
            }
        }
    }
    
    // ì˜¬ë¹¼ë¯¸, ì•„ë‹ˆ ë…ìˆ˜ë¦¬ (ìƒˆë²½ 5ì‹œ ì´ì „ 3ì¼ ì—°ì† ê¸°ìƒ)
    if (!unlocked.includes('ACH_EARLY_BIRD')) {
        let consecutiveEarlyDays = 0;
        
        for (let i = 0; i < 3; i++) {
            const checkDate = new Date(date);
            checkDate.setDate(checkDate.getDate() - i);
            const dayData = await dbGet(`day_${formatDate(checkDate)}`);
            
            if (dayData?.wakeTime) {
                const wakeMinutes = timeToMinutes(dayData.wakeTime);
                if (wakeMinutes < 300) { // 5ì‹œ ì´ì „
                    consecutiveEarlyDays++;
                } else {
                    break;
                }
            } else {
                break;
            }
        }
        
        if (consecutiveEarlyDays >= 3) {
            await unlockAchievement('ACH_EARLY_BIRD');
        }
    }
    
    // ê·œì¹™ì ì¸ ì·¨ì¹¨ (ì¼ì£¼ì¼ ë‚´ë‚´ ëª©í‘œ ì·¨ì¹¨ì‹œê°„ Â±15ë¶„)
    if (!unlocked.includes('ACH_REGULAR_SLEEP')) {
        const weekDates = getWeekDates(new Date(date));
        let regularSleepWeek = true;
        
        // ëª©í‘œ ì·¨ì¹¨ì‹œê°„ì„ 1ì‹œë¡œ ê°€ì • (ì‚¬ìš©ì ì„¤ì •ì´ ì—†ìœ¼ë©´)
        const targetSleepMinutes = 60; // 1:00 AM = 60ë¶„
        
        for (const dateStr of weekDates) {
            const dayData = await dbGet(`day_${dateStr}`);
            
            if (dayData?.sleepTime) {
                const sleepMinutes = timeToMinutes(dayData.sleepTime);
                const adjustedSleep = sleepMinutes < 360 ? sleepMinutes + 1440 : sleepMinutes;
                const diff = Math.abs(adjustedSleep - (targetSleepMinutes + 1440));
                
                if (diff > 15) { // Â±15ë¶„ ë²—ì–´ë‚¨
                    regularSleepWeek = false;
                    break;
                }
            } else {
                regularSleepWeek = false;
                break;
            }
        }
        
        if (regularSleepWeek) {
            await unlockAchievement('ACH_REGULAR_SLEEP');
        }
    }
}

// í€˜ìŠ¤íŠ¸ ì™„ë£Œ ì•Œë¦¼
function showQuestCompleteNotification(quest) {
    // ê°„ë‹¨í•œ í† ìŠ¤íŠ¸ ì•Œë¦¼
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: var(--success-color);
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
    `;
    notification.innerHTML = `âœ… ${quest.title} ì™„ë£Œ! (+${quest.reward} EXP)`;
    
    // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// ì¼ì¼ ë°ì´í„° ë³€ê²½ ì‹œ í€˜ìŠ¤íŠ¸ ì§„í–‰ë„ ìë™ ì—…ë°ì´íŠ¸
async function checkAndUpdateAllQuests(dayData, date = new Date()) {
    // === ì˜¤ëŠ˜ ë‚ ì§œê°€ ì•„ë‹ˆë©´ í€˜ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì•ˆí•¨ ===
    const today = new Date();
    const targetDate = new Date(date);
    
    today.setHours(0, 0, 0, 0);
    targetDate.setHours(0, 0, 0, 0);
    
    if (targetDate.getTime() !== today.getTime()) {
        // ì˜¤ëŠ˜ì´ ì•„ë‹Œ ë‚ ì§œë¥¼ ìˆ˜ì •í•´ë„ í€˜ìŠ¤íŠ¸ì— ë°˜ì˜ ì•ˆí•¨
        return;
    }
    
    const promises = [];
    
    // ì…ë ¥ ì¦‰ì‹œ ì²´í¬ë˜ì–´ì•¼ í•˜ëŠ” í€˜ìŠ¤íŠ¸ë“¤ (ì˜¤ëŠ˜ ë‚ ì§œë§Œ)
    if (dayData.wakeTime) {
        promises.push(updateQuestProgress('daily', 'attendance', 1, date));
    }
    
    if (dayData.sleepTime) {
        promises.push(updateQuestProgress('daily', 'sleep_time', 1, date));
    }
    
    if (dayData.seatTime) {
        promises.push(updateQuestProgress('daily', 'seat_time', 1, date));
    }
    
    const totalPomodoro = (dayData.pomodoro?.morning || 0) + (dayData.pomodoro?.afternoon || 0) + (dayData.pomodoro?.evening || 0);
    if (totalPomodoro > 0) {
        promises.push(updateQuestProgress('daily', 'pomodoro_3', totalPomodoro, date)); 
    }
    
    if (dayData.writing > 0) {
        promises.push(updateQuestProgress('daily', 'writing_300', dayData.writing, date));
    }
    
    // ìš´ë™ ì‹œê°„ ì…ë ¥ ì¦‰ì‹œ ì²´í¬ (10ë¶„ ì´ìƒ ì¡°ê±´ ì œê±°í•˜ê³  ì…ë ¥ë§Œìœ¼ë¡œ ì²´í¬)
    if (dayData.exercise?.done || (dayData.exercise?.minutes > 0)) {
        const minutes = dayData.exercise?.minutes || 0;
        promises.push(updateQuestProgress('daily', 'exercise_10min', minutes, date));
    }
    
    if (dayData.comment) {
        promises.push(updateQuestProgress('daily', 'daily_comment', 1, date));
    }
    
    // ê°œì¸ëª©í‘œ ì…ë ¥ ì¦‰ì‹œ ì²´í¬ (50% ì¡°ê±´ ì œê±°í•˜ê³  ì…ë ¥ë§Œìœ¼ë¡œ ì²´í¬)
    const goalAverage = await calculatePersonalGoalAverage(dayData, formatDate(date));
    if (goalAverage > 0) { 
        promises.push(updateQuestProgress('daily', 'personal_goal_50', goalAverage, date));
    }
    
    // ì‹ë‹¨ ê¸°ë¡ ì²´í¬
    const foodRecordCount = await getDailyFoodRecordCount(date);
    if (foodRecordCount >= 1) { 
        promises.push(updateQuestProgress('daily', 'food_record_1', foodRecordCount, date));
    }
    
    // ëª©í‘œ ì‹œê°„ ê¸°ìƒ ì²´í¬
    const targetWakeTime = await dbGet('targetWakeTime');
    if (targetWakeTime && dayData.wakeTime) {
        const targetMinutes = timeToMinutes(targetWakeTime);
        const actualMinutes = timeToMinutes(dayData.wakeTime);
        const diff = Math.abs(actualMinutes - targetMinutes);
        if (diff <= 60) { 
            promises.push(updateQuestProgress('daily', 'wake_on_time_1hour', 1, date));
        }
    }
    
    await Promise.all(promises);
    
    // ì£¼ê°„/ì›”ê°„ í€˜ìŠ¤íŠ¸ë„ ì—…ë°ì´íŠ¸ (ì˜¤ëŠ˜ë§Œ)
    await updateWeeklyQuests(date);
    await updateMonthlyQuests(date);
}

// ì¼ê°„ ì¢…ë£Œ ì‹œì  í€˜ìŠ¤íŠ¸ ì²´í¬
async function checkEndOfDayQuests(dayData, date) {
    // === ì˜¤ëŠ˜ ë‚ ì§œê°€ ì•„ë‹ˆë©´ ì¢…ë£Œ ì‹œì  í€˜ìŠ¤íŠ¸ ì²´í¬ ì•ˆí•¨ ===
    const today = new Date();
    const targetDate = new Date(date);
    
    today.setHours(0, 0, 0, 0);
    targetDate.setHours(0, 0, 0, 0);
    
    if (targetDate.getTime() !== today.getTime()) {
        return; // ì˜¤ëŠ˜ì´ ì•„ë‹ˆë©´ ì²´í¬ ì•ˆí•¨
    }
    
    const promises = [];
    
    // 1. ì§€ì¶œ 1ë§Œì› ì´í•˜ ì²´í¬
    const dailyExpenses = await getDailyExpenseTotal(date);
    if (dailyExpenses <= 10000) {
        promises.push(updateQuestProgress('daily', 'expense_under_10k', 1, date));
    }
    
    // 2. ê²Œì„ì‹œê°„ 60ë¶„ ì´í•˜ ì²´í¬
    if (dayData.gameTime <= 60) {
        promises.push(updateQuestProgress('daily', 'game_under_60min', 1, date));
    }
    
    // 3. ë§ˆì´ë„ˆìŠ¤ ì ìˆ˜ í”¼í•˜ê¸° ì²´í¬
    if (dayData.score >= 0) {
        promises.push(updateQuestProgress('daily', 'no_negative_score_today', 1, date));
    }
    
    await Promise.all(promises);
}

// ë³´ì¡° í•¨ìˆ˜ë“¤
async function getDailyExpenseTotal(date) {
    const dateStr = formatDate(date);
    const allData = await dbGetAll();
    const expenses = allData.filter(item => 
        item.key.startsWith('expense_') && item.value.date === dateStr
    );
    return expenses.reduce((sum, item) => sum + item.value.amount, 0);
}

async function getDailyFoodRecordCount(date) {
    const dateStr = formatDate(date);
    const allData = await dbGetAll();
    const foodRecords = allData.filter(item => 
        item.key.startsWith('food_') && item.value.date === dateStr
    );
    return foodRecords.length;
}

// ì£¼ê°„ í€˜ìŠ¤íŠ¸ ì§„í–‰ë„ ì—…ë°ì´íŠ¸
async function updateWeeklyQuests(date) {
    const weekDates = getWeekDates(date);
    const weekStart = weekDates[0];
    
    // ì´ë²ˆ ì£¼ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const weekDataPromises = weekDates.map(d => dbGet(`day_${d}`));
    const weekData = await Promise.all(weekDataPromises);
    
    // ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const allData = await dbGetAll();
    const weekExpenses = allData.filter(item => 
        item.key.startsWith('expense_') && 
        weekDates.includes(item.value.date)
    );
    
    // ì‹ë‹¨ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const weekFoodRecords = allData.filter(item => 
        item.key.startsWith('food_') && 
        weekDates.includes(item.value.date)
    );
    
    // 1. ì£¼ê°„ ì¶œì„ 6ì¼
    const attendanceCount = weekData.filter(d => d?.wakeTime).length;
    await updateQuestProgress('weekly', 'weekly_attendance_6days', attendanceCount, date);
    
    // 2. 01:00 ì´ì „ ì·¨ì¹¨ 4íšŒ
    const earlySleepCount = weekData.filter(d => {
        if (!d?.sleepTime) return false;
        const sleepMinutes = timeToMinutes(d.sleepTime);
        return sleepMinutes <= 60 || sleepMinutes >= 1440; // 01:00 ì´ì „
    }).length;
    await updateQuestProgress('weekly', 'weekly_early_sleep_4times', earlySleepCount, date);
    
    // 5. ì£¼ê°„ ìš°ìˆ˜ìƒ (50ì  ì´ìƒ 5ì¼)
    const highScoreDays = weekData.filter(d => d && d.score >= 50).length;
    await updateQuestProgress('weekly', 'weekly_high_score_5days', highScoreDays, date);
    
    // 8. ì§€ì¶œ ê¸°ë¡ 7ì¼
    const expenseRecordDays = new Set(weekExpenses.map(item => item.value.date)).size;
    await updateQuestProgress('weekly', 'weekly_expense_tracking_7days', expenseRecordDays, date);
    
    // 9. ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ê¸°ë¡ (ëª…ìƒ ê´€ë ¨ í‚¤ì›Œë“œ)
    const stressReliefKeywords = ['ëª…ìƒ', 'íœ´ì‹', 'ì‚°ì±…', 'ë…ì„œ', 'ìŒì•…', 'ì˜í™”', 'ì—¬í–‰', 'ë§ˆì‚¬ì§€', 'ìš”ê°€', 'ìŠ¤íŠ¸ë ˆì¹­'];
    const hasStressRelief = weekData.some(d => 
        d?.comment && stressReliefKeywords.some(keyword => 
            d.comment.includes(keyword)
        )
    );
    if (hasStressRelief) {
        await updateQuestProgress('weekly', 'weekly_stress_relief_comment', 1, date);
    }
    
    // 10. ëª¨ë“  ì‹œê°„ ê¸°ë¡ 5ì¼
    const allTimeInputDays = weekData.filter(d => 
        d?.wakeTime && d?.seatTime && d?.sleepTime
    ).length;
    await updateQuestProgress('weekly', 'weekly_all_time_input_5days', allTimeInputDays, date);

    // 12. ì£¼ê°„ ê¸€ì“°ê¸° 8,000ì
    const totalWriting = weekData.reduce((sum, d) => sum + (d?.writing || 0), 0);
    await updateQuestProgress('weekly', 'weekly_writing_8000', totalWriting, date);
    
    // 13. ê°œì¸ ëª©í‘œ ì£¼í‰ê·  70%
    const goalAverages = await Promise.all(weekData.map(async (d, index) => {
        if (!d) return 0;
        return await calculatePersonalGoalAverage(d, weekDates[index]);
    }));
    const weekGoalAverage = goalAverages.reduce((sum, avg) => sum + avg, 0) / goalAverages.length;
    if (weekGoalAverage >= 70) {
        await updateQuestProgress('weekly', 'weekly_personal_goal_avg_70', 1, date);
    }
    
    // 14. ì™„ë²½í•œ ì•„ì¹¨ 3íšŒ (ëª©í‘œì‹œê°„ Â±1ì‹œê°„ ë‚´ ê¸°ìƒ)
    const targetWakeTime = await dbGet('targetWakeTime');
    let perfectMorningCount = 0;
    if (targetWakeTime) {
        const targetMinutes = timeToMinutes(targetWakeTime);
        perfectMorningCount = weekData.filter(d => {
            if (!d?.wakeTime) return false;
            const actualMinutes = timeToMinutes(d.wakeTime);
            const diff = Math.abs(actualMinutes - targetMinutes);
            return diff <= 60; // Â±1ì‹œê°„
        }).length;
    }
    await updateQuestProgress('weekly', 'weekly_perfect_morning_3', perfectMorningCount, date);
    
    // 15. ì£¼ê°„ ìš´ë™ 4íšŒ
    const exerciseCount = weekData.filter(d => d?.exercise?.done).length;
    await updateQuestProgress('weekly', 'weekly_exercise_4times', exerciseCount, date);
    
    // 16. ì£¼ê°„ ë½€ëª¨ë„ë¡œ 25ê°œ
    const totalPomodoro = weekData.reduce((sum, d) => {
        if (!d) return sum;
        return sum + (d.pomodoro?.morning || 0) + (d.pomodoro?.afternoon || 0) + (d.pomodoro?.evening || 0);
    }, 0);
    await updateQuestProgress('weekly', 'weekly_pomodoro_25', totalPomodoro, date);
}

// ì£¼ê°„ ì¢…ë£Œ ì‹œì  í€˜ìŠ¤íŠ¸ ì²´í¬ (ì¼ìš”ì¼ì—ë§Œ ì‹¤í–‰)
async function checkEndOfWeekQuests(date) {
    const weekDates = getWeekDates(date);
    const weekDataPromises = weekDates.map(d => dbGet(`day_${d}`));
    const weekData = await Promise.all(weekDataPromises);
    
    const allData = await dbGetAll();
    const weekExpenses = allData.filter(item => 
        item.key.startsWith('expense_') && 
        weekDates.includes(item.value.date)
    );
    const weekFoodRecords = allData.filter(item => 
        item.key.startsWith('food_') && 
        weekDates.includes(item.value.date)
    );
    
    // 1. ì£¼ê°„ ì§€ì¶œ 10ë§Œì› ì´í•˜
    const totalWeekExpense = weekExpenses.reduce((sum, item) => sum + item.value.amount, 0);
    if (totalWeekExpense <= 100000) {
        await updateQuestProgress('weekly', 'weekly_expense_under_100k', 1, date);
    }
    
    // 2. ì£¼ê°„ ê²Œì„ 3ì‹œê°„ ì´í•˜
    const totalGameTime = weekData.reduce((sum, d) => sum + (d?.gameTime || 0), 0);
    if (totalGameTime <= 180) {
        await updateQuestProgress('weekly', 'weekly_low_game_total', 1, date);
    }
    
    // 3. ì£¼ë§ ë””ì§€í„¸ ë””í†¡ìŠ¤
    const weekendGameTime = weekData
        .filter((d, index) => (index === 5 || index === 6) && d)
        .reduce((sum, d) => sum + (d.gameTime || 0), 0);
    if (weekendGameTime === 0) {
        await updateQuestProgress('weekly', 'weekly_no_game_weekend', 1, date);
    }
    
    // 4. íŒ¨ìŠ¤íŠ¸í‘¸ë“œ 1íšŒ ë¯¸ë§Œ
    const fastfoodKeywords = ['ë§¥ë„ë‚ ë“œ', 'ë²„ê±°í‚¹', 'kfc', 'ë¡¯ë°ë¦¬ì•„', 'í–„ë²„ê±°', 'ë²„ê±°', 'ì¹˜í‚¨', 'í”¼ì'];
    const fastfoodCount = weekFoodRecords.filter(item => 
        fastfoodKeywords.some(keyword => 
            item.value.foodName.toLowerCase().includes(keyword.toLowerCase())
        )
    ).length;
    if (fastfoodCount < 1) {
        await updateQuestProgress('weekly', 'weekly_no_fastfood', 1, date);
    }
    
    // 5. ê¸ˆì£¼ ì±Œë¦°ì§€
    const alcoholKeywords = ['ìˆ ', 'ë§¥ì£¼', 'ì†Œì£¼', 'ì™€ì¸', 'ì¹µí…Œì¼', 'ìœ„ìŠ¤í‚¤', 'ë³´ë“œì¹´'];
    const hasAlcohol = weekFoodRecords.some(item => 
        alcoholKeywords.some(keyword => 
            item.value.foodName.toLowerCase().includes(keyword.toLowerCase())
        )
    ) || weekData.some(d => 
        d?.comment && alcoholKeywords.some(keyword => 
            d.comment.includes(keyword)
        )
    );
    if (!hasAlcohol) {
        await updateQuestProgress('weekly', 'weekly_no_alcohol', 1, date);
    }
}

// ì›”ê°„ í€˜ìŠ¤íŠ¸ ì§„í–‰ë„ ì—…ë°ì´íŠ¸
async function updateMonthlyQuests(date) {
    const monthDates = getMonthDates(date);
    
    // ì´ë²ˆ ë‹¬ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const monthDataPromises = monthDates.map(d => dbGet(`day_${d}`));
    const monthData = (await Promise.all(monthDataPromises)).filter(d => d);
    
    // ì§€ì¶œ ë° ì‹ë‹¨ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const allData = await dbGetAll();
    const monthExpenses = allData.filter(item => 
        item.key.startsWith('expense_') && 
        monthDates.includes(item.value.date)
    );
    const monthFoodRecords = allData.filter(item => 
        item.key.startsWith('food_') && 
        monthDates.includes(item.value.date)
    );
    
    // 1. ì™„ë²½í•œ í•œ ë‹¬ (ë§¤ì¼ ê¸°ìƒì‹œê°„ ê¸°ë¡ 30ë²ˆ)
    const wakeTimeRecordDays = monthData.filter(d => d.wakeTime).length;
    await updateQuestProgress('monthly', 'monthly_perfect_attendance', wakeTimeRecordDays, date);

    // 2. ì™•ì¢Œì˜ ì£¼ì¸ (ì°©ì„ ì‹œê°„ ê¸°ë¡ 20ë²ˆ)
    const seatTimeRecordDays = monthData.filter(d => d.seatTime).length;
    await updateQuestProgress('monthly', 'monthly_consistent_seat_time_input', seatTimeRecordDays, date);
    
    // 3. ì›”ê°„ í”¼íŠ¸ë‹ˆìŠ¤ ì±”í”¼ì–¸ (15íšŒ ìš´ë™)
    const exerciseCount = monthData.filter(d => d.exercise?.done).length;
    await updateQuestProgress('monthly', 'monthly_exercise_15times', exerciseCount, date);
    
    // 5. ìƒˆë²½í˜• ì¸ê°„ì˜ ë“±ë¶ˆ (15íšŒ ëª©í‘œì‹œê°„ Â±30ë¶„ ë‚´ ê¸°ìƒ)
    const targetWakeTime = await dbGet('targetWakeTime');
    let earlyBirdCount = 0;
    if (targetWakeTime) {
        const targetMinutes = timeToMinutes(targetWakeTime);
        earlyBirdCount = monthData.filter(d => {
            if (!d.wakeTime) return false;
            const actualMinutes = timeToMinutes(d.wakeTime);
            const diff = Math.abs(actualMinutes - targetMinutes);
            return diff <= 30; // Â±30ë¶„
        }).length;
    }
    await updateQuestProgress('monthly', 'monthly_early_bird_15times', earlyBirdCount, date);
    
    // 7. í’í™”ì„¤ì›” ë¹„ë°€ ë¬¸ì„œ (8ë§Œ ì ê¸€ì“°ê¸°)
    const totalWriting = monthData.reduce((sum, d) => sum + (d.writing || 0), 0);
    await updateQuestProgress('monthly', 'monthly_writing_80k', totalWriting, date);
    
    // 8. ë¯¸í˜¸í¬ì˜ ëª…ìƒ ì‹œê°„ (20ì¼ ì·¨ì¹¨ ì‹œê°„ ê¸°ë¡)
    const sleepTimeRecordDays = monthData.filter(d => d.sleepTime).length;
    await updateQuestProgress('monthly', 'monthly_consistent_sleep_input', sleepTimeRecordDays, date);
    
    // 9. ì›”ê°„ ìš°ìˆ˜ìƒ (80ì  ì´ìƒ 15ì¼)
    const highScoreDays = monthData.filter(d => d.score >= 80).length;
    await updateQuestProgress('monthly', 'monthly_high_score_15days', highScoreDays, date);
    
    // 10. ë””ë¯¸íŠ¸ë¦¬ì˜ ì´ìƒê³¼ í˜„ì‹¤ (ì›”í‰ê·  70% ê°œì¸ëª©í‘œ ë‹¬ì„±ë¥ )
    if (monthData.length > 0) {
        const goalAverages = await Promise.all(monthData.map(async (d) => {
            return await calculatePersonalGoalAverage(d, d.date);
        }));
        const monthGoalAverage = goalAverages.reduce((sum, avg) => sum + avg, 0) / goalAverages.length;
        if (monthGoalAverage >= 70) {
            await updateQuestProgress('monthly', 'monthly_personal_goal_avg_70', 1, date);
        }
    }
}

// ì›”ê°„ ì¢…ë£Œ ì‹œì  í€˜ìŠ¤íŠ¸ ì²´í¬ (ì›”ë§ì—ë§Œ ì‹¤í–‰)
async function checkEndOfMonthQuests(date) {
    const monthDates = getMonthDates(date);
    const monthDataPromises = monthDates.map(d => dbGet(`day_${d}`));
    const monthData = (await Promise.all(monthDataPromises)).filter(d => d);
    
    const allData = await dbGetAll();
    const monthExpenses = allData.filter(item => 
        item.key.startsWith('expense_') && 
        monthDates.includes(item.value.date)
    );
    
    // 1. ì˜ˆì‚° 50% ì´í•˜
    const budget = await dbGet('monthlyBudget') || 0;
    const totalMonthExpense = monthExpenses.reduce((sum, item) => sum + item.value.amount, 0);
    if (budget > 0 && totalMonthExpense <= budget * 0.5) {
        await updateQuestProgress('monthly', 'monthly_budget_50percent', 1, date);
    }
    
    // 2. ê²Œì„ ì‹œê°„ 0ë¶„
    const totalGameTime = monthData.reduce((sum, d) => sum + (d.gameTime || 0), 0);
    if (totalGameTime === 0) {
        await updateQuestProgress('monthly', 'monthly_no_game_entire_month', 1, date);
    }
}

// ì—…ì  ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
async function showAchievementsModal() {
    document.getElementById('profileMenu').style.display = 'none';
    document.getElementById('achievementsModal').style.display = 'flex';
    await renderAchievementsList();
}

function closeAchievementsModal() {
    document.getElementById('achievementsModal').style.display = 'none';
}

async function renderAchievementsList() {
    const container = document.getElementById('achievementsList');
    const unlockedAchievements = await dbGet('unlockedAchievements') || [];
    
    let html = '';
    let unlockedCount = 0;
    
    for (const [id, achievement] of Object.entries(ACHIEVEMENTS_LIST)) {
    const isUnlocked = unlockedAchievements.includes(id);
    if (isUnlocked) unlockedCount++;
    
    const statusClass = isUnlocked ? 'unlocked' : 'locked';
    const emoji = isUnlocked ? 'ğŸ…' : 'ğŸ”’';
    const statusText = isUnlocked ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';
    
    // íˆë“  ì—…ì  ì²˜ë¦¬
    const isHidden = id.startsWith('ACH_HIDDEN_') && !isUnlocked;
    const displayName = isHidden ? 'ìˆ¨ê²¨ì§' : achievement.name;
    const displayDesc = isHidden ? 'ì„¤ëª…ì´ ìˆ¨ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤.' : achievement.desc;
    const hiddenClass = isHidden ? 'hidden' : '';
    
    html += `
        <div class="achievement-item ${statusClass} ${hiddenClass}">
            <div class="achievement-emoji">${emoji}</div>
            <div class="achievement-info">
                <div class="achievement-name">${displayName}</div>
                <div class="achievement-desc">${displayDesc}</div>
            </div>
            <div class="achievement-status ${statusClass}">${statusText}</div>
        </div>
    `;
}
    
    // ì§„í–‰ë¥  í‘œì‹œ
    const totalAchievements = Object.keys(ACHIEVEMENTS_LIST).length;
    const progressText = `ë‹¬ì„±ë¥ : ${unlockedCount}/${totalAchievements} (${Math.round(unlockedCount/totalAchievements*100)}%)`;
    
    container.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: var(--primary-light); border-radius: 12px; color: var(--primary-color); font-weight: 600;">
            ${progressText}
        </div>
        ${html}
    `;
}

        // Firebase ì•± ì´ˆê¸°í™” ë° ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyCiHL1nkWtAh6xSXLi9V-TqWwmfPLUfX0U",
            authDomain: "routine-tracker-be367.firebaseapp.com",
            projectId: "routine-tracker-be367",
            storageBucket: "routine-tracker-be367.appspot.com",
            messagingSenderId: "687819364391",
            appId: "1:687819364391:web:f30b0660887af52e16d602"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore(); 
        let currentUser = null; 
        let currentUserName = "ì‚¬ìš©ì";
        const EMAILJS_SERVICE_ID = 'service_kjtvf9i';
        const EMAILJS_TEMPLATE_ID = 'template_hq8bm4c';
        const EMAILJS_PUBLIC_KEY = 'irHy1AuEA7_OkkyrC';

// ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜: íŠ¹ì • ì‹œê°„ ë™ì•ˆ ë°˜ë³µ í˜¸ì¶œ ì‹œ ë§ˆì§€ë§‰ í˜¸ì¶œë§Œ ì‹¤í–‰
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// ëª…ì–¸ ë° ê°ì„± ë¶„ì„ ë°ì´í„°
const SENTIMENT_DATA = {
    positive: {
        keywords: ['ì¢‹ì•˜ë‹¤', 'ê¸°ì˜ë‹¤', 'ì‹ ë‚œë‹¤', 'ë¿Œë“¯', 'í–‰ë³µ', 'ì„±ê³µ', 'ë§Œì¡±', 'ìµœê³ ', 'ë‹¬ì„±', 'ì¦ê²'],
        quotes: [
            { title: "ê¸°ì¨ì€ í˜ì´ë‹¤!", msg: "ì˜¤ëŠ˜ì˜ ê¸°ì¨ì´ ë‚´ì¼ì˜ ë” í° ì„±ê³µì„ ë¶ˆëŸ¬ì˜¬ ê²ƒì…ë‹ˆë‹¤." },
            { title: "ëˆê¸°ê°€ ë‹µì´ë‹¤", msg: "ì„±ê³µì€ ê°€ì¥ ëˆê¸° ìˆëŠ” ì‚¬ëŒì—ê²Œ ì°¾ì•„ì˜¨ë‹¤. - ë‚˜í´ë ˆì˜¹" },
            { title: "ìµœê³ ì˜ ë‚˜ë‚ ", msg: "ê·¸ ì¢‹ì€ ê¸°ìš´ì„ ê³„ì† ì´ì–´ë‚˜ê°€ì„¸ìš”. ë‹¹ì‹ ì€ ë¬´ì—‡ì´ë“  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!" },
            { title: "ì—­ì‚¬ë¥¼ ì“°ë‹¤", msg: "ë‹¹ì‹ ì´ ê°€ëŠ” ê¸¸ì´ ë°”ë¡œ ì—­ì‚¬ê°€ ë©ë‹ˆë‹¤. ê³„ì† ì „ì§„í•˜ì„¸ìš”." },
            { title: "ì„±ì¥ì˜ ì¦ê±°", msg: "ì˜¤ëŠ˜ ëŠë‚€ ë¿Œë“¯í•¨, ê·¸ê²ƒì´ ë°”ë¡œ ë‹¹ì‹ ì´ ì„±ì¥í•˜ê³  ìˆë‹¤ëŠ” ì¦ê±°ì…ë‹ˆë‹¤." },
            { title: "ë¯¿ìŒì˜ í˜", msg: "ìŠ¤ìŠ¤ë¡œë¥¼ ë¯¿ëŠ” ê²ƒì²˜ëŸ¼ ê°•ë ¥í•œ ë™ê¸°ë¶€ì—¬ëŠ” ì—†ë‹¤." },
            { title: "í‹°ëŒ ëª¨ì•„ íƒœì‚°", msg: "ì‘ì€ ì„±ê³µë“¤ì´ ëª¨ì—¬ ìœ„ëŒ€í•œ ì„±ì·¨ë¥¼ ì´ë£¹ë‹ˆë‹¤." },
            { title: "ê¸ì • ì—ë„ˆì§€", msg: "ë‹¹ì‹ ì˜ ê¸ì •ì ì¸ ì—ë„ˆì§€ê°€ ì£¼ë³€ê¹Œì§€ ë°ê²Œ ë§Œë“¤ê³  ìˆì–´ìš”." },
            { title: "ì •ìƒì—ì„œ ë§Œë‚˜ìš”", msg: "ê³„ì† ê·¸ë ‡ê²Œ ë‚˜ì•„ê°€ì„¸ìš”. ì •ìƒì—ì„œ ë§Œë‚©ì‹œë‹¤!" },
            { title: "ë” ë†’ì€ ê³³ìœ¼ë¡œ", msg: "ì˜¤ëŠ˜ì˜ ë§Œì¡±ì— ì•ˆì£¼í•˜ì§€ ë§ê³ , ë” ë†’ì€ ê³³ì„ í–¥í•´ ë„ì „í•˜ì„¸ìš”." }
        ]
    },
    negative: {
        keywords: ['ìš°ìš¸', 'ìŠ¬í”„ë‹¤', 'ì§œì¦', 'ë¶„ë…¸', 'í˜ë“¤ë‹¤', 'ì§€ì¹œë‹¤', 'ìµœì•…', 'ë§í–ˆë‹¤', 'ì‹¤íŒ¨', 'í™”ë‚œ'],
        quotes: [
            { title: "ìƒˆë²½ì´ ì˜¨ë‹¤", msg: "ê°€ì¥ ì–´ë‘ìš´ ì‹œê°„ì€ í•´ ëœ¨ê¸° ë°”ë¡œ ì§ì „ì´ë‹¤. - íŒŒìš¸ë¡œ ì½”ì—˜ë£Œ" },
            { title: "ë´„ì€ ì˜¨ë‹¤", msg: "ê²¨ìš¸ì´ ì˜¤ë©´ ë´„ì´ ë©€ì§€ ì•Šìœ¼ë¦¬. - í¼ì‹œ ë¹„ì‹œ ì…¸ë¦¬" },
            { title: "ê°•ë ¥í•œ ì£¼ë¬¸", msg: "'ë‚˜ëŠ” í•  ìˆ˜ ìˆë‹¤.' ì´ ë§ì€ ìŠ¤ìŠ¤ë¡œì—ê²Œ í•˜ëŠ” ê°€ì¥ ê°•ë ¥í•œ ì£¼ë¬¸ì…ë‹ˆë‹¤." },
            { title: "ë¬´í•œí•œ ê°€ëŠ¥ì„±", msg: "ë„ˆ ìì‹ ì„ ë¯¿ì–´ë¼. ë„¤ ì•ˆì—ëŠ” ë¬´í•œí•œ ê°€ëŠ¥ì„±ì´ ìˆë‹¤. - ê°„ë””" },
            { title: "ì‹¬í˜¸í¡", msg: "ê¹Šì€ ìˆ¨ì„ ì‰¬ê³ , ì²œì²œíˆ ìƒê°í•˜ê³ , ëª¨ë“  ê²ƒì´ ì˜ ë  ê²ƒì´ë¼ê³  ìŠ¤ìŠ¤ë¡œì—ê²Œ ë§í•˜ë¼." },
            { title: "ê°•ì¸í•¨", msg: "ë‹¹ì‹ ì€ ìƒê°ë³´ë‹¤ í›¨ì”¬ ê°•í•œ ì‚¬ëŒì…ë‹ˆë‹¤. í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”." },
            { title: "íœ´ì‹ì˜ í•„ìš”ì„±", msg: "ì˜¤ëŠ˜ í•˜ë£¨ë„ ì •ë§ ìˆ˜ê³  ë§ì•˜ì–´ìš”. ì ì‹œ ì‰¬ì–´ê°€ë„ ê´œì°®ì•„ìš”." },
            { title: "ì§„ì •í•œ ì˜ê´‘", msg: "ê°€ì¥ í° ì˜ê´‘ì€ ì‹¤íŒ¨í•  ë•Œë§ˆë‹¤ ë‹¤ì‹œ ì¼ì–´ë‚˜ëŠ” ë°ì— ìˆë‹¤. - ê³µì" },
            { title: "ì‚´ì•„ìˆë‹¤ëŠ” ì¦ê±°", msg: "í˜ë“  ê°ì •ì€ ì•½í•¨ì˜ í‘œì‹œê°€ ì•„ë‹ˆë¼, ì¹˜ì—´í•˜ê²Œ ì‚´ì•„ìˆë‹¤ëŠ” ì¦ê±°ì…ë‹ˆë‹¤." },
            { title: "ë‚´ë ¤ë†“ê¸°", msg: "í˜ë“¤ ë•ŒëŠ” ì ì‹œ ëª¨ë“  ê²ƒì„ ë‚´ë ¤ë†“ê³  ê¹Šê²Œ ìˆ¨ì„ ì‰¬ì–´ë³´ì„¸ìš”." }
        ]
    }
};

        function formatNumberWithCommas(inputElement) {
            let value = inputElement.value.replace(/[^0-9]/g, '');
            if (value === '') {
                inputElement.value = '';
            } else {
                inputElement.value = parseInt(value, 10).toLocaleString('ko-KR');
            }
        }
        function unformatNumber(formattedValue) {
            if (typeof formattedValue !== 'string') return formattedValue;
            return Number(formattedValue.replace(/,/g, '')) || 0;
        }

        let currentDate = new Date();
        let selectedDate = null;
        let currentModalData = {};
        let currentGoalTab = 'active';
        let newGoalType = 'positive';
        const foodKeywords = [
            'ì¹´í˜', 'ìŠ¤íƒ€ë²…ìŠ¤', 'ì»´í¬ì¦ˆ', 'ë©”ê°€', 'ë§¤ë¨¸ë“œ', 'ì´ë””ì•¼', 'í• ë¦¬ìŠ¤', 'íˆ¬ì¸', 'ë¹½ë‹¤ë°©', 'ì»¤í”¼ë¹ˆ',
            'ë² ì´ì»¤ë¦¬', 'ë¹µ', 'íŒŒë¦¬ë°”ê²ŒíŠ¸', 'ëšœë ˆì¥¬ë¥´', 'ë˜í‚¨', 'í¬ë¡œí”Œ', 'ë„ë„›', 'í¬ë¦¬ìŠ¤í”¼',
            'ê°„ì‹', 'ì£¼ì „ë¶€ë¦¬', 'ë””ì €íŠ¸', 'íŒì½˜', 'ì•„ì´ìŠ¤í¬ë¦¼', 'ì ¤ë¼ë˜', 'ê³¼ì', 'ì´ˆì½œë¦¿', 'ì‚¬íƒ•', 'ë–¡ë³¶ì´', 'ë² ìŠ¤í‚¨',
            'í¸ì˜ì ', 'ë§ˆíŠ¸', 'ì”¨ìœ ', 'cu', 'gs25', 'ì„¸ë¸ì¼ë ˆë¸', '7eleven',
            'ì¹˜í‚¨', 'í”¼ì', 'í–„ë²„ê±°', 'ë§¥ë„ë‚ ë“œ', 'ë²„ê±°í‚¹', 'kfc', 'ë¡¯ë°ë¦¬ì•„', 'ë¼ë©´',
            'ìŒë£Œ', 'ì£¼ìŠ¤', 'íƒ„ì‚°', 'ì½œë¼', 'ì‚¬ì´ë‹¤', 'ë°€í¬í‹°', 'ë²„ë¸”í‹°', 'ìŠ¤ë¬´ë””'
        ];
        let currentFoodExpenseData = null;
        let foodManageMode = false;
        const nf = new Intl.NumberFormat('ko-KR');
        const formatCurrency = (value) => `â‚©${nf.format(value)}`;
    
    // ì‚¬ìš©ìë³„ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ê²½ë¡œ ìƒì„± í•¨ìˆ˜
    function getUserDataRef() {
    if (!currentUser) throw new Error("ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.");
    return db.collection('users').doc(currentUser.uid).collection('data');
}

async function dbSet(key, value) {
    const sanitizedValue = JSON.parse(JSON.stringify(value, (k, v) => v === undefined ? null : v));
    
    // 1. IndexedDBì— ì¦‰ì‹œ ì €ì¥
    await localDB.set(key, sanitizedValue);
    
    // 2. ë™ê¸°í™” íì— ì¶”ê°€
    syncQueue.add(key);
    
    // 3. ë°±ê·¸ë¼ìš´ë“œ Firebase ë™ê¸°í™” (ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œë§Œ)
    if (currentUser) {
        setTimeout(() => syncToFirebase(key, sanitizedValue), 0);
    }
}

async function dbGet(key) {
    // IndexedDBì—ì„œ ë¨¼ì € ì¡°íšŒ (ì´ˆê³ ì†)
    return await localDB.get(key);
}

async function dbGetAll() {
    // IndexedDBì—ì„œ ëª¨ë“  ë°ì´í„° ì¡°íšŒ
    return await localDB.getAll();
}

async function dbDelete(key) {
    // 1. IndexedDBì—ì„œ ì‚­ì œ
    await localDB.delete(key);
    
    // 2. Firebaseì—ì„œë„ ì‚­ì œ (ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ)
    if (currentUser) {
        setTimeout(() => deleteFromFirebase(key), 0);
    }
}

    // ì•± ë°ì´í„° ì „ì²´ ì´ˆê¸°í™” (ì£¼ì˜í•´ì„œ ì‚¬ìš©)
    async function dbClear() {
        if (!confirm("ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;
        const snapshot = await getUserDataRef().get();
        const batch = db.batch();
        snapshot.docs.forEach(doc => {
            batch.delete(doc.ref);
        });
        await batch.commit();
        alert("ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        location.reload();
    }

    // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
    async function signIn() {
    const provider = new firebase.auth.GoogleAuthProvider();
    
    // Cross-Origin-Opener-Policy ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ì„¤ì •
    provider.setCustomParameters({
        prompt: 'select_account'
    });
    
    try {
        console.log("ë¡œê·¸ì¸ ì‹œë„ ì¤‘...");
        const result = await auth.signInWithPopup(provider);
        console.log("ë¡œê·¸ì¸ ì„±ê³µ:", result.user.displayName);
        
        // íŒì—… ë‹«ê¸° ì—ëŸ¬ ë¬´ì‹œë¥¼ ìœ„í•œ ì§€ì—°
        setTimeout(() => {
            console.log("ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ");
        }, 100);
        
    } catch (error) {
        console.error("ë¡œê·¸ì¸ ì—ëŸ¬:", error);
        
        // íŒì—… ê´€ë ¨ ì—ëŸ¬ë“¤ì€ ë¬´ì‹œ (ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ì´ ì„±ê³µí•  ìˆ˜ ìˆìŒ)
        if (error.code === 'auth/popup-blocked' || 
            error.code === 'auth/popup-closed-by-user' ||
            error.code === 'auth/cancelled-popup-request') {
            console.log("íŒì—… ê´€ë ¨ ì—ëŸ¬ - ë¦¬ë””ë ‰ì…˜ìœ¼ë¡œ ëŒ€ì²´");
            try {
                await auth.signInWithRedirect(provider);
            } catch (redirectError) {
                console.error("ë¦¬ë””ë ‰ì…˜ ë¡œê·¸ì¸ë„ ì‹¤íŒ¨:", redirectError);
                alert("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì´ ë˜ì–´ìˆë‹¤ë©´ í•´ì œí•´ì£¼ì„¸ìš”.");
            }
        } else {
            // ì‹¤ì œ ì‹¬ê°í•œ ì—ëŸ¬ë§Œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            if (error.code !== 'auth/web-storage-unsupported') {
                alert(`ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }
    }
}
    
    async function signOut() {
    if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        try {
            // ìë™ ë™ê¸°í™” ì¤‘ë‹¨
            stopAutoSync();
            
            // Firebaseì—ì„œ ë¡œê·¸ì•„ì›ƒ
            await auth.signOut();
            
            // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            currentUser = null;
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
            
            // ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSyncStatus('ğŸ’¾ ë¡œì»¬ ì €ì¥ ì¤‘ (ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„° ë³´í˜¸)');
            
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            
        } catch (error) {
            console.error("ë¡œê·¸ì•„ì›ƒ ì—ëŸ¬:", error);
            alert("ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }
}

    // Firebaseì™€ì˜ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”
async function syncToFirebase(key, value) {
    if (!currentUser) return;
    try {
        await getUserDataRef().doc(key).set({ value });
        syncQueue.delete(key);
        updateSyncStatus('âœ… ë™ê¸°í™” ì™„ë£Œ');
    } catch (error) {
        console.error('Firebase ë™ê¸°í™” ì‹¤íŒ¨:', error);
        updateSyncStatus('âš ï¸ ë™ê¸°í™” ëŒ€ê¸° ì¤‘');
    }
}

// ìë™ ë™ê¸°í™” ì‹œìŠ¤í…œ
let autoSyncInterval = null;

function startAutoSync() {
    if (!currentUser || autoSyncInterval) return;
    
    autoSyncInterval = setInterval(async () => {
        if (syncQueue.size > 0) {
            updateSyncStatus('â˜ï¸ ìë™ ë°±ì—… ì¤‘...');
            // ëŒ€ê¸° ì¤‘ì¸ ë°ì´í„°ë§Œ ë™ê¸°í™”
            const pendingKeys = Array.from(syncQueue);
            for (const key of pendingKeys) {
                const data = await localDB.get(key);
                if (data) {
                    await syncToFirebase(key, data);
                }
            }
        }
    }, 300000);
}

function stopAutoSync() { if (autoSyncInterval) { clearInterval(autoSyncInterval); autoSyncInterval = null; } }

async function deleteFromFirebase(key) {
    if (!currentUser) return;
    try {
        await getUserDataRef().doc(key).delete();
    } catch (error) {
        console.error('Firebase ì‚­ì œ ì‹¤íŒ¨:', error);
    }
}

// ì „ì²´ ë™ê¸°í™” (ìˆ˜ë™ ë°±ì—…ìš©)
async function syncAllToFirebase() {
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    if (!confirm('í˜„ì¬ ë¡œì»¬ ë°ì´í„°ë¥¼ í´ë¼ìš°ë“œì— ë°±ì—…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» í´ë¼ìš°ë“œì˜ ê¸°ì¡´ ë°ì´í„°ê°€ ë®ì–´ì¨ì§‘ë‹ˆë‹¤.')) {
        return;
    }
    
    try {
        updateSyncStatus('â˜ï¸ í´ë¼ìš°ë“œ ë°±ì—… ì¤‘...');
        const allData = await localDB.getAll();
        
        let successCount = 0;
        for (const item of allData) {
            await syncToFirebase(item.key, item.value);
            successCount++;
        }
        
        updateSyncStatus(`âœ… ë°±ì—… ì™„ë£Œ (${successCount}ê°œ í•­ëª©)`);
        setTimeout(() => {
            alert(`í´ë¼ìš°ë“œ ë°±ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në°±ì—…ëœ í•­ëª©: ${successCount}ê°œ`);
        }, 500);
        
    } catch (error) {
        console.error('ë°±ì—… ì‹¤íŒ¨:', error);
        updateSyncStatus('âŒ ë°±ì—… ì‹¤íŒ¨');
        alert('ë°±ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
    }
}

// Firebaseì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³µì›ìš©)
async function loadFromFirebase() {
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    if (!confirm('í´ë¼ìš°ë“œì—ì„œ ë°ì´í„°ë¥¼ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ í˜„ì¬ ë¡œì»¬ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ê³  í´ë¼ìš°ë“œ ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤.\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
    }
    
    try {
        updateSyncStatus('ğŸ“¥ í´ë¼ìš°ë“œì—ì„œ ë°ì´í„° ë¡œë”© ì¤‘...');
        
        // ê¸°ì¡´ ë¡œì»¬ ë°ì´í„° ì‚­ì œ
        const existingData = await localDB.getAll();
        for (const item of existingData) {
            await localDB.delete(item.key);
        }
        
        // Firebaseì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const snapshot = await getUserDataRef().get();
        
        let restoredCount = 0;
        for (const doc of snapshot.docs) {
            await localDB.set(doc.id, doc.data().value);
            restoredCount++;
        }
        
        updateSyncStatus(`âœ… ë³µì› ì™„ë£Œ (${restoredCount}ê°œ í•­ëª©)`);
        
        // ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
        await renderCalendar();
        
        setTimeout(() => {
            alert(`í´ë¼ìš°ë“œ ë³µì›ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në³µì›ëœ í•­ëª©: ${restoredCount}ê°œ\n\nìº˜ë¦°ë”ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }, 500);
        
    } catch (error) {
        console.error('ë³µì› ì‹¤íŒ¨:', error);
        updateSyncStatus('âŒ ë³µì› ì‹¤íŒ¨');
        alert('ë³µì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
    }
}

function updateSyncStatus(message) {
    const statusEl = document.getElementById('syncStatus');
    if (statusEl) {
        statusEl.textContent = message;
        statusEl.style.display = 'block';
        
        // ë¡œê·¸ì¸ ì•ˆëœ ìƒíƒœì—ì„œëŠ” ê²½ê³  ìƒ‰ìƒ
        if (!currentUser && message.includes('ë¡œì»¬')) {
            statusEl.style.background = 'rgba(255, 243, 205, 0.95)';
            statusEl.style.color = '#b7791f';
            statusEl.style.border = '1px solid #ffd666';
        } else {
            statusEl.style.background = 'rgba(255,255,255,0.9)';
            statusEl.style.color = 'var(--text-color-light)';
            statusEl.style.border = 'none';
        }
        
        // ëª¨ë“  ë©”ì‹œì§€ë¥¼ 3ì´ˆ í›„ ìˆ¨ê¹€ (í™œì„±í™”/ë¡œì»¬ì €ì¥ ë©”ì‹œì§€ë„ í¬í•¨)
        setTimeout(() => {
            statusEl.style.display = 'none';
        }, 3000);
    }
}
        
        function formatDate(date) { const year = date.getFullYear(); const month = String(date.getMonth() + 1).padStart(2, '0'); const day = String(date.getDate()).padStart(2, '0'); return `${year}-${month}-${day}`; }
        function formatDateForLabel(dateString) { const d = parseDate(dateString); return `${d.getMonth() + 1}/${d.getDate()}`; }
        function parseDate(dateString) { return new Date(dateString + 'T00:00:00'); }
        function timeToMinutes(time) { if (!time) return 0; const [h, m] = time.split(':').map(Number); return h * 60 + m; }
        function getWeekDates(date) { const d = new Date(date); const day = d.getDay(); const diff = d.getDate() - day + (day === 0 ? -6 : 1); const mon = new Date(d.setDate(diff)); const week = []; for (let i = 0; i < 7; i++) { const day = new Date(mon); day.setDate(mon.getDate() + i); week.push(formatDate(new Date(day))); } return week; }
        function getMonthDates(date) { const y = date.getFullYear(), m = date.getMonth(); const lastDay = new Date(y, m + 1, 0); const dates = []; for (let d = new Date(y, m, 1); d <= lastDay; d.setDate(d.getDate() + 1)) { dates.push(formatDate(new Date(d))); } return dates; }
        function getMonthDateRange(date) { const year = date.getFullYear(); const month = date.getMonth(); const start = formatDate(new Date(year, month, 1)); const end = formatDate(new Date(year, month + 1, 0)); return { start, end }; }
        async function getPersonalGoals() { return await dbGet('personalGoals') || []; }
        function getEmojiForAchievement(percentage) { if (percentage <= 20) return 'ğŸ˜¡'; if (percentage <= 40) return 'ğŸ˜¢'; if (percentage <= 60) return 'ğŸ˜'; if (percentage <= 80) return 'ğŸ˜Š'; return 'ğŸ‰'; }
        async function getDayData(date) { return await dbGet(`day_${formatDate(date)}`) || { date: formatDate(date), wakeTime: null, seatTime: null, pomodoro: { morning: 0, afternoon: 0, evening: 0 }, exercise: { done: false, minutes: 0 }, gameTime: 0, writing: 0, sleepTime: null, personalGoals: {}, score: 0, isOffDay: false, comment: "" }; }
        async function saveDayData(date, data) { const dateString = formatDate(date); data.date = dateString; data.score = data.isOffDay ? 0 : await calculateScoreEnhanced(data); await dbSet(`day_${dateString}`, data); 
            await checkAndUpdateAllQuests(data, date); }
        
function adjustPomodoro(inputId, change) {
    const input = document.getElementById(inputId);
    const currentValue = parseInt(input.value) || 0;
    const newValue = Math.max(0, currentValue + change);
    input.value = newValue;
    
    // ì ìˆ˜ ì—…ë°ì´íŠ¸ ë° ìë™ ì €ì¥
    updateModalScore();
    autoSaveModalData();
}

async function calculatePersonalGoalAverage(data, date) {
    const allGoals = await getPersonalGoals();
    const checkDate = parseDate(date);
    checkDate.setHours(0, 0, 0, 0);
    const applicableGoals = allGoals.filter(goal => {
        const goalDate = new Date(goal.createdAt);
        goalDate.setHours(0, 0, 0, 0);
        return checkDate >= goalDate && !goal.isCompleted;
    });
    if (applicableGoals.length === 0) return 0;
    const personalGoalsData = data.personalGoals || {};
    let totalPercentage = 0;
    applicableGoals.forEach(goal => {
        const achieved = personalGoalsData[goal.id] || 0;
        let percentage = 0;
        if (goal.type === 'negative') {
            const usageRatio = achieved / goal.dailyTarget; // í•˜ë£¨ ëª©í‘œ ê¸°ì¤€
            percentage = Math.max(0, (1 - usageRatio) * 100);
        } else {
            percentage = Math.min(100, (achieved / goal.dailyTarget) * 100); // í•˜ë£¨ ëª©í‘œ ê¸°ì¤€
        }
        totalPercentage += percentage;
    });
    return applicableGoals.length > 0 ? Math.round(totalPercentage / applicableGoals.length) : 0;
}

        // calculateScore í•¨ìˆ˜ì— ìƒˆë¡œìš´ í”Œë˜ê·¸ë“¤ ì ìš©
async function calculateScoreEnhanced(data) {
    if (data.isOffDay) return 0;
    
    const today = formatDate(new Date());
    
    // ì™„ì „ ììœ ì˜ ë‚  ì²´í¬
    const isCompleteFreedomDay = await dbGet(`completeFreedomDay_${today}`);
    if (isCompleteFreedomDay) {
        return 0; // ì ìˆ˜ ê³„ì‚° ì•ˆí•¨
    }
    
    // ë£¨í‹´ì˜ ì™• ë°ì´ ì²´í¬
    const isRoutineKingDay = await dbGet(`routineKingDay_${today}`);
    
    let score = 0;
    const targetWakeTime = await dbGet('targetWakeTime');
    if (!targetWakeTime || !data.wakeTime) return Math.max(0, (data.bonusPoints || 0));
    
    // ëŠ¦ì  í—ˆê°€ì¦ ì²´í¬
    const sleepInPermit = await dbGet(`sleepInPermit_${today}`) || 0;
    const adjustedTargetTime = timeToMinutes(targetWakeTime) + sleepInPermit;
    
    const actualMinutes = timeToMinutes(data.wakeTime);
    const wakeDiff = actualMinutes - adjustedTargetTime;
    if (wakeDiff < 0) score += 10; 
    else if (wakeDiff <= 30) score += 5; 
    else if (wakeDiff <= 60) score += 3; 
    else if (wakeDiff <= 90) score += 1; 
    else score -= Math.floor((wakeDiff - 120) / 30 + 1) * 2;
    
    // ì°©ì„ ì‹œê°„ ì ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼)
    if (data.seatTime) { 
        const seatMinutes = timeToMinutes(data.seatTime); 
        const seatDiff = seatMinutes - actualMinutes; 
        if (seatDiff >= 0 && seatDiff <= 60) score += 5; 
        else if (seatDiff >= 0 && seatDiff <= 90) score += 3; 
    }
    
    // ë½€ëª¨ë„ë¡œ ì ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼)
    const totalPomodoro = (data.pomodoro.morning || 0) + (data.pomodoro.afternoon || 0) + (data.pomodoro.evening || 0);
    score += totalPomodoro * 5;
    
    if (data.pomodoro.morning >= 6) score += 5; 
    if (data.pomodoro.afternoon >= 6) score += 5; 
    if (data.pomodoro.evening >= 4) score += 5;
    
    // ìš´ë™ ì ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼)
    if (data.exercise.done) { 
        score += 10; 
        score += Math.floor((data.exercise.minutes || 0) / 30) * 5; 
    }
    
    // ê²Œì„ ì‹œê°„ í˜ë„í‹° (ìƒˆë¡œìš´ í”Œë˜ê·¸ë“¤ ì ìš©)
    const cheatDayGaming = await dbGet(`cheatDayGaming_${today}`);
    const unlimitedGaming = await dbGet(`unlimitedGaming_${today}`);
    const cheatDay = await dbGet(`cheatDay_${today}`); // ê¸°ì¡´ ì¹˜íŒ…ë°ì´
    
    if (!cheatDayGaming && !unlimitedGaming && !cheatDay && data.gameTime > 60) {
        score -= Math.floor((data.gameTime - 60) / 30) * 2;
    }
    
    // ì·¨ì¹¨ ì‹œê°„ ì ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼)
    if (data.sleepTime) { 
        const sleepMinutes = timeToMinutes(data.sleepTime); 
        let adjustedSleep = sleepMinutes < 360 ? sleepMinutes + 1440 : sleepMinutes; 
        if (adjustedSleep >= 1440 && adjustedSleep <= 1470) score += 5; 
        else if (adjustedSleep <= 1500) score += 3; 
        else if (adjustedSleep <= 1560) score += 1; 
        else if (adjustedSleep > 1560) score -= Math.floor((adjustedSleep - 1560) / 30 + 1) * 3; 
    }
    
    score += (data.bonusPoints || 0);
    
    // ê³¨ë“ ë°ì´ í† í° ì²´í¬
    const isGoldenDay = await dbGet(`goldenDay_${today}`);
    if (isGoldenDay && score < 0) {
        score = 0;
    }
    
    // ë£¨í‹´ì˜ ì™• ë°ì´ì—ëŠ” ìµœì†Œ ì ìˆ˜ ë³´ì •
    if (isRoutineKingDay && score < 50) {
        score = Math.max(50, score);
    }
    
    return score;
}
        
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    
    // ì¸ì¦ ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€/í‘œì‹œ
    const authContainer = document.getElementById('authContainer');
    if (authContainer) {
        if (pageId === 'goalSetup' || pageId === 'wakeUpPrompt') {
            authContainer.style.display = 'none';
        } else {
            authContainer.style.display = 'block';
        }
    }
    
    // í”„ë¡œí•„ ìœ„ì ¯ ìˆ¨ê¹€/í‘œì‹œ
    const profileWidget = document.getElementById('profileWidget');
    if (profileWidget) {
        if (pageId === 'goalSetup' || pageId === 'wakeUpPrompt') {
            profileWidget.style.display = 'none';
        } else {
            updateProfileWidget(); 
            profileWidget.style.display = 'block';
        }
    }
    
    // ìƒˆë¡œ ì¶”ê°€: í˜ì´ì§€ë³„ ì–¸ì–´ ì—…ë°ì´íŠ¸
    setTimeout(async () => {
        await updatePageLanguage(pageId);
    }, 100);
}
        async function saveGoalAndContinue() { const targetTime = document.getElementById('targetWakeTime').value; if (!/^\d{2}:\d{2}$/.test(targetTime)) { alert('ëª©í‘œ ê¸°ìƒ ì‹œê°„ì„ HH:MM í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; } await dbSet('targetWakeTime', targetTime); await initApp(); }
        async function saveWakeTimeFromPrompt() { 
            const wakeTime = document.getElementById('promptWakeTime').value; 
            if (!/^\d{2}:\d{2}$/.test(wakeTime)) { alert('ê¸°ìƒ ì‹œê°„ì„ HH:MM í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; } 
            const today = new Date(); 
            const todayData = await getDayData(today); 
            todayData.wakeTime = wakeTime; 
            await saveDayData(today, todayData); 
            sessionStorage.setItem('promptSkipped', 'true'); 
            showPage('calendarPage'); 
            await renderCalendar(); 
            await triggerDailyQuests();
        }
        async function skipToCalendar() { 
            sessionStorage.setItem('promptSkipped', 'true'); 
            showPage('calendarPage'); 
            await renderCalendar();
            await triggerDailyQuests();
        }
        async function changeMonth(direction) { currentDate.setMonth(currentDate.getMonth() + direction); updateMonthYearDisplay(); await renderCalendar(); }
        async function backToCalendar() { showPage('calendarPage'); await renderCalendar(); }
        async function updateSettings() {
            const targetTime = document.getElementById('settingsWakeTime').value;
            if (targetTime && !/^\d{2}:\d{2}$/.test(targetTime)) { alert('ëª©í‘œ ê¸°ìƒ ì‹œê°„ì„ HH:MM í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
            await dbSet('targetWakeTime', targetTime);
            const budget = unformatNumber(document.getElementById('monthlyBudgetInput').value);
            if (budget) { await dbSet('monthlyBudget', budget); } else { await dbDelete('monthlyBudget'); }
            const partnerEmail = document.getElementById('partnerEmailInput').value.trim();
            if (partnerEmail) {
                await dbSet('partnerEmail', partnerEmail);
            } else {
                await dbDelete('partnerEmail');
            }
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            await backToCalendar();
        }
        async function showSettings() {
            showPage('settingsPage');
            document.getElementById('settingsWakeTime').value = await dbGet('targetWakeTime') || '';
            const budgetSetting = await dbGet('monthlyBudget');
            document.getElementById('monthlyBudgetInput').value = budgetSetting ? budgetSetting.toLocaleString('ko-KR') : '';
            const partnerEmail = await dbGet('partnerEmail');
            document.getElementById('partnerEmailInput').value = partnerEmail || '';
            await renderDdaySettings();
        }
        async function showPersonalGoals() { showPage('personalGoalsPage'); await renderPersonalGoalsList(); }
        async function showMonthlyStats() { showPage('monthlyStatsPage'); await renderMonthlyStats(); }
        async function showBudgetPage() { showPage('budgetPage'); await renderBudgetPage(); }
        async function closeDayModal() { document.getElementById('dayModal').style.display = 'none'; await renderCalendar(); }
        async function navigateModalDate(direction) {
        // í˜„ì¬ ì„ íƒëœ ë‚ ì§œì—ì„œ directionë§Œí¼ ì´ë™
            const newDate = new Date(selectedDate);
            newDate.setDate(newDate.getDate() + direction);
    
        // ìƒˆë¡œìš´ ë‚ ì§œë¡œ ëª¨ë‹¬ ë‹¤ì‹œ ì—´ê¸°
        await openDayModal(newDate);
        }

        async function initApp() {
    // 1. ëª©í‘œ ê¸°ìƒ ì‹œê°„ ì„¤ì • ì—¬ë¶€ë¶€í„° í™•ì¸
    const targetWakeTime = await dbGet('targetWakeTime');
    if (!targetWakeTime) { 
        showPage('goalSetup'); 
        return; 
    }

    // 2. ê¸°ìƒ ì‹œê°„ ì…ë ¥ ìµœìš°ì„  (ì´ê±´ ì¦‰ì‹œ ì²˜ë¦¬)
    const today = new Date();
    const todayData = await getDayData(today);
    if (!todayData.wakeTime && today.getHours() >= 6 && !sessionStorage.getItem('promptSkipped')) { 
        document.getElementById('wakeupDate').textContent = today.toLocaleDateString('ko-KR'); 
        showPage('wakeUpPrompt'); 
        return;
    }
    
    // 3. ìº˜ë¦°ë” í˜ì´ì§€ë¡œ ì´ë™ í›„ ì¦‰ì‹œ ë Œë”ë§
    showPage('calendarPage');
    
    // 4. ì „ì²´ ìº˜ë¦°ë” ë Œë”ë§ (ë°ì´í„° í¬í•¨)
    await renderCalendar();
    
    // 5. ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ë“¤ì€ ë³„ë„ë¡œ ì‹¤í–‰
    setTimeout(async () => {
        await triggerDailyQuests();
    }, 100);
}

// ì£¼ê°„ ì„±ê³¼ ë¶„ì„ ë° ë¦¬í¬íŠ¸ ë°œì†¡ ë¡œì§
async function checkWeeklyPerformance() {
    const partnerEmail = await dbGet('partnerEmail');
    if (!partnerEmail) return; // íŒŒíŠ¸ë„ˆ ì´ë©”ì¼ì´ ì—†ìœ¼ë©´ ì‹¤í–‰ ì•ˆí•¨

    const today = new Date();
    const lastWeekCheckKey = `weeklyReportSent_${getWeekDates(today)[0]}`;
    if (await dbGet(lastWeekCheckKey)) return; // ì´ë¯¸ ì´ë²ˆ ì£¼ì— ë³´ëƒˆìœ¼ë©´ ì‹¤í–‰ ì•ˆí•¨

    const lastWeek = new Date();
    lastWeek.setDate(lastWeek.getDate() - 7);
    const lastWeekDates = getWeekDates(lastWeek);

    let totalScore = 0;
    let validDays = 0;
    let performanceDetails = {
        lateWakeUp: 0,
        totalGameMinutes: 0,
        exerciseCount: 0,
        targetWakeTime: await dbGet('targetWakeTime') || "ë¯¸ì„¤ì •"
    };

    for (const dateStr of lastWeekDates) {
        const dayData = await getDayData(parseDate(dateStr));
        if (dayData && !dayData.isOffDay && dayData.wakeTime) {
            validDays++;
            totalScore += dayData.score || 0;
            
            if (dayData.wakeTime && performanceDetails.targetWakeTime !== "ë¯¸ì„¤ì •") {
                const diff = timeToMinutes(dayData.wakeTime) - timeToMinutes(performanceDetails.targetWakeTime);
                if (diff > 0) performanceDetails.lateWakeUp += diff;
            }
            performanceDetails.totalGameMinutes += dayData.gameTime || 0;
            if (dayData.exercise.done) performanceDetails.exerciseCount++;
        }
    }

    if (validDays === 0) return;

    const avgScore = Math.round(totalScore / validDays);

    if (avgScore < 40) {
        if (confirm(`ì§€ë‚œì£¼ í‰ê·  ì ìˆ˜ê°€ ${avgScore}ì ì…ë‹ˆë‹¤. ì±…ì„ ê³µìœ  íŒŒíŠ¸ë„ˆì—ê²Œ ì„±ê³¼ ë³´ê³ ì„œë¥¼ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            const analysisHtml = analyzeWeeklyPerformance(performanceDetails, validDays);
            const weekRange = `${formatDateForLabel(lastWeekDates[0])} ~ ${formatDateForLabel(lastWeekDates[6])}`;
            
            await sendAccountabilityReport(partnerEmail, avgScore, analysisHtml, weekRange);
            await dbSet(lastWeekCheckKey, true); // ë°œì†¡ ì™„ë£Œ ê¸°ë¡
        }
    }
}

// ì£¼ê°„ ì„±ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ HTML í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
function analyzeWeeklyPerformance(details, validDays) {
    let html = '<ul>';
    if (details.lateWakeUp > 0 && validDays > 0) {
        const avgLateMinutes = Math.round(details.lateWakeUp / validDays);
        html += `<li><strong>ê¸°ìƒ ì‹œê°„:</strong> ëª©í‘œ ì‹œê°„ë³´ë‹¤ í‰ê·  ${avgLateMinutes}ë¶„ ëŠ¦ê²Œ ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤. (ëª©í‘œ: ${details.targetWakeTime})</li>`;
    }
    if (details.totalGameMinutes > 60 * validDays) { // í•˜ë£¨ í‰ê·  1ì‹œê°„ ì´ìƒ ê²Œì„ ì‹œ
        const avgGameMinutes = Math.round(details.totalGameMinutes / validDays);
        html += `<li><strong>ê²Œì„ ì‹œê°„:</strong> ì£¼ê°„ ì´ ê²Œì„ ì‹œê°„ì´ ${Math.round(details.totalGameMinutes / 60)}ì‹œê°„ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (í•˜ë£¨ í‰ê·  ${avgGameMinutes}ë¶„)</li>`;
    }
    if (details.exerciseCount < 3) {
        html += `<li><strong>ìš´ë™:</strong> ì£¼ 3íšŒ ì´ìƒ ëª©í‘œì˜€ìœ¼ë‚˜, ${details.exerciseCount}íšŒë§Œ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.</li>`;
    }
    if (html === '<ul>') {
        html += '<li>ì „ë°˜ì ìœ¼ë¡œ ê¾¸ì¤€í•œ ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤. ì‘ì€ ëª©í‘œë¶€í„° ë‹¤ì‹œ ì‹œì‘í•´ë³´ì„¸ìš”!</li>';
    }
    html += '</ul>';
    return html;
}

// EmailJSë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ì„ ë°œì†¡í•˜ëŠ” í•¨ìˆ˜
async function sendAccountabilityReport(partnerEmail, avgScore, analysisHtml, weekRange) {
    try {
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
            user_name: currentUserName,
            partner_email: partnerEmail,
            avg_score: avgScore,
            analysis_html: analysisHtml,
            week_range: weekRange
        }, EMAILJS_PUBLIC_KEY);
        alert('íŒŒíŠ¸ë„ˆì—ê²Œ ë³´ê³ ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        unlockAchievement('ACH_ACCOUNTABILITY'); // ì—…ì  ë‹¬ì„±
    } catch (error) {
        alert('ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        console.error('EmailJS Error:', error);
    }
}

async function renderBasicCalendar() {
    updateMonthYearDisplay();
    
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    
    // ìš”ì¼ í—¤ë” ì¶”ê°€
    const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    weekdays.forEach(day => {
        const headerCell = document.createElement('div');
        headerCell.className = 'calendar-header-cell';
        headerCell.textContent = day;
        grid.appendChild(headerCell);
    });
    
    // ë‹¬ë ¥ ì…€ ìƒì„± (ìŠ¤ì¼ˆë ˆí†¤ ìƒíƒœ)
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    // ì´ì „ ë‹¬ì˜ ë¹ˆ ì…€ë“¤
    for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-cell empty';
        grid.appendChild(emptyCell);
    }
    
    // í˜„ì¬ ë‹¬ì˜ ì…€ë“¤ (ìŠ¤ì¼ˆë ˆí†¤ìœ¼ë¡œ ì‹œì‘)
    for (let day = 1; day <= daysInMonth; day++) {
        const cellDate = new Date(year, month, day);
        const cell = document.createElement('div');
        cell.className = 'calendar-cell skeleton';
        cell.dataset.date = formatDate(cellDate);
        
        cell.innerHTML = `
            <div class="cell-top-icons"></div>
            <div class="cell-day-number">${day}</div>
            <div class="cell-bottom-info"></div>
        `;
        
        grid.appendChild(cell);
    }
    
    // ë¡œë”© í‘œì‹œ
    showLoadingIndicator();
}

async function enhanceCalendarWithData() {
    const allDbData = await dbGetAll();
    const allPersonalGoals = await getPersonalGoals();
    const year = currentDate.getFullYear(), month = currentDate.getMonth();
    const dataMap = new Map(allDbData.map(item => [item.key, item.value]));

    const skeletonCells = document.querySelectorAll('.calendar-cell.skeleton');
    
    skeletonCells.forEach((cell, index) => {
        setTimeout(() => {
            const dateStr = cell.dataset.date;
            const cellDate = parseDate(dateStr);
            
            cell.classList.remove('skeleton');
            
            const topIconsContainer = cell.querySelector('.cell-top-icons');
            const bottomInfoContainer = cell.querySelector('.cell-bottom-info');
            
            const dayData = dataMap.get(`day_${dateStr}`);
            
            if (dayData) {
                // íœ´ì‹ì¼ ì²´í¬ë¥¼ ë¨¼ì € ìˆ˜í–‰
    if (dayData.isOffDay) {
        cell.classList.add('off-day');
        cell.querySelector('.cell-day-number').innerHTML += `<div class="off-day-indicator">â˜•ï¸</div>`;
        topIconsContainer.innerHTML = ''; // íœ´ì‹ì¼ì—ëŠ” ê°œì¸ëª©í‘œ ì•„ì´ì½˜ í‘œì‹œ ì•ˆí•¨
    } else {
        // íœ´ì‹ì¼ì´ ì•„ë‹ ë•Œë§Œ ê°œì¸ëª©í‘œ ì•„ì´ì½˜ í‘œì‹œ
        const applicableGoals = allPersonalGoals.filter(goal => {
            if (goal.isCompleted) return false;
            const goalCreatedDate = new Date(goal.createdAt);
            goalCreatedDate.setHours(0, 0, 0, 0);
            return goalCreatedDate <= cellDate;
        });
        
        if (applicableGoals.length > 0 && dayData.personalGoals) {
            let iconsHtml = '';
            applicableGoals.slice(0, 3).forEach(goal => {
                const achieved = dayData.personalGoals[goal.id] || 0;
                let percentage = 0;
                if (goal.type === 'negative') {
                    const usageRatio = achieved / goal.dailyTarget;
                    percentage = Math.max(0, (1 - usageRatio) * 100);
                } else {
                    percentage = Math.min(100, (achieved / goal.dailyTarget) * 100);  
                }
                iconsHtml += `<span>${getEmojiForAchievement(percentage)}</span>`;
            });
            topIconsContainer.innerHTML = iconsHtml;
        } else {
            topIconsContainer.innerHTML = '';
        }

        if (dayData.wakeTime || dayData.exercise?.done || dayData.sleepTime || (dayData.bonusPoints && dayData.bonusPoints > 0) || Object.keys(dayData.personalGoals || {}).length > 0) {
            cell.classList.add('has-data');
            const score = dayData.score !== undefined ? dayData.score : 0;
            if (score >= 80) cell.classList.add('score-high');
            else if (score >= 40) cell.classList.add('score-medium');
            else if (score >= 1) cell.classList.add('score-low');
            else cell.classList.add('score-negative');
        }
    }
} else {
    topIconsContainer.innerHTML = '';
    bottomInfoContainer.innerHTML = '';
}
            
            if (cellDate.getDay() === 0) {
                const weekDates = getWeekDates(cellDate);
                let weeklyWritingTotal = 0;
                for (const dateStr of weekDates) {
                    const weeklyDayData = dataMap.get(`day_${dateStr}`);
                    if (weeklyDayData) {
                        weeklyWritingTotal += weeklyDayData.writing || 0;
                    }
                }
                if (weeklyWritingTotal > 0) {
                    const bookCount = (weeklyWritingTotal / 100000).toFixed(2);
                    bottomInfoContainer.innerHTML += `<span>ğŸ“–${bookCount}</span>`;
                }
            }

            cell.addEventListener('click', () => openDayModal(cellDate));
            
        }, index * 30); 
    });
    
    setTimeout(() => {
        hideLoadingIndicator();
    }, skeletonCells.length * 30 + 100);
}

function showLoadingIndicator() {
    const container = document.querySelector('.container');
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loadingIndicator';
    loadingDiv.className = 'loading-indicator';
    loadingDiv.innerHTML = 'ë°ì´í„° ë¡œë”© ì¤‘...';
    container.appendChild(loadingDiv);
}

function hideLoadingIndicator() {
    const loadingDiv = document.getElementById('loadingIndicator');
    if (loadingDiv) {
        loadingDiv.style.opacity = '0';
        setTimeout(() => loadingDiv.remove(), 300);
    }
}

async function runBackgroundTasks() {
    try {
        await renderDdayDisplay();
        await renderSmallBudgetBarEnhanced();
        await checkAndDisplayGameWarning();
        setTimeout(async () => {
            const today = new Date();
            
            if (today.getDay() === 1) {
                await checkWeeklyPerformance();
            }
            if (today.getDate() === 1) {
                await checkForMonthlyBonus();
            }
            await triggerDailyQuests();
            
        }, 1000); 
        
    } catch (error) {
        console.error('ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì˜¤ë¥˜:', error);
    }
}

async function renderCalendar() {
    // ê¸°ë³¸ êµ¬ì¡°ê°€ ì—†ìœ¼ë©´ ìƒì„±
    if (document.querySelectorAll('.calendar-cell').length === 0) {
        await renderBasicCalendar();
    }
    
    // ë°ì´í„°ë¡œ ìº˜ë¦°ë” í–¥ìƒ
    await enhanceCalendarWithData();
    
    // ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ë“¤
    await runBackgroundTasks();
}

        async function renderMonthlyStats() {
            const monthDates = getMonthDates(currentDate);
            document.getElementById('statsMonth').textContent = currentDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' });
            
            let totalScore = 0, totalGoalRate = 0, totalWriting = 0, validDays = 0;
            const dataPromises = monthDates.map(date => dbGet(`day_${date}`));
            const monthlyData = (await Promise.all(dataPromises)).filter(d => d);

            for (const dayData of monthlyData) {
                totalWriting += (dayData.writing || 0);
                if (!dayData.isOffDay && (dayData.wakeTime || dayData.exercise.done || dayData.sleepTime || dayData.bonusPoints)) {
                    totalScore += dayData.score || 0;
                    totalGoalRate += await calculatePersonalGoalAverage(dayData, dayData.date);
                    validDays++;
                }
            }
            const avgScore = validDays > 0 ? Math.round(totalScore / validDays) : 0;
            const avgGoalRate = validDays > 0 ? Math.round(totalGoalRate / validDays) : 0;
            document.getElementById('avgScore').textContent = `â­ ${avgScore}ì `;
            document.getElementById('avgGoalRate').textContent = `${getEmojiForAchievement(avgGoalRate)} ${avgGoalRate}%`;
            document.getElementById('writingBooks').textContent = `ğŸ“– ${(totalWriting / 100000).toFixed(2)}ê¶Œ`;

            const fameContainer = document.getElementById('hallOfFame');
            const shameContainer = document.getElementById('wallOfShame');
            fameContainer.innerHTML = '';
            shameContainer.innerHTML = '';
            
            if (monthlyData.length > 0) {
                const validDataDays = monthlyData.filter(d => !d.isOffDay);

                if (validDataDays.length > 0) {
                    const bestScoreDay = [...validDataDays].sort((a, b) => (b.score || 0) - (a.score || 0))[0];
                    const worstScoreDay = [...validDataDays].sort((a, b) => (a.score || 0) - (b.score || 0))[0];

                    fameContainer.innerHTML += `<div class="fame-card"><div class="fame-card-title">âœ¨</div><div class="fame-card-value">${bestScoreDay.score}ì </div><div class="fame-card-date">ìµœê³  ì ìˆ˜ (${formatDateForLabel(bestScoreDay.date)})</div></div>`;
                    shameContainer.innerHTML += `<div class="fame-card"><div class="fame-card-title">ğŸ’€</div><div class="fame-card-value">${worstScoreDay.score}ì </div><div class="fame-card-date">ìµœì € ì ìˆ˜ (${formatDateForLabel(worstScoreDay.date)})</div></div>`;
                    
                    const pomoKingDay = [...validDataDays].sort((a, b) => {
                        const totalA = (a.pomodoro?.morning || 0) + (a.pomodoro?.afternoon || 0) + (a.pomodoro?.evening || 0);
                        const totalB = (b.pomodoro?.morning || 0) + (b.pomodoro?.afternoon || 0) + (b.pomodoro?.evening || 0);
                        return totalB - totalA;
                    })[0];
                    const totalPomos = (pomoKingDay.pomodoro?.morning || 0) + (pomoKingDay.pomodoro?.afternoon || 0) + (pomoKingDay.pomodoro?.evening || 0);
                    if (totalPomos > 0) {
                        fameContainer.innerHTML += `<div class="fame-card"><div class="fame-card-title">ğŸ…</div><div class="fame-card-value">${totalPomos}ê°œ</div><div class="fame-card-date">ë½€ëª¨ë„ë¡œ í‚¹ (${formatDateForLabel(pomoKingDay.date)})</div></div>`;
                    }

                    const exerciseGodDay = [...validDataDays].sort((a,b) => (b.exercise?.minutes || 0) - (a.exercise?.minutes || 0))[0];
                    if (exerciseGodDay.exercise?.minutes > 0) {
                         fameContainer.innerHTML += `<div class="fame-card"><div class="fame-card-title">ğŸ’ª</div><div class="fame-card-value">${exerciseGodDay.exercise.minutes}ë¶„</div><div class="fame-card-date">ìš´ë™ ê´´ë¬¼ (${formatDateForLabel(exerciseGodDay.date)})</div></div>`;
                    }

                    const gameAddictDay = [...validDataDays].sort((a,b) => (b.gameTime || 0) - (a.gameTime || 0))[0];
                    if (gameAddictDay.gameTime > 0) {
                        shameContainer.innerHTML += `<div class="fame-card"><div class="fame-card-title">ğŸ®</div><div class="fame-card-value">${gameAddictDay.gameTime}ë¶„</div><div class="fame-card-date">ê²Œì„ ì¤‘ë… (${formatDateForLabel(gameAddictDay.date)})</div></div>`;
                    }
                }
            }

            if (fameContainer.innerHTML === '') {
                fameContainer.innerHTML = '<p style="text-align:center; color:#999;">ì´ë²ˆ ë‹¬ ê¸°ë¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>';
            }
            if (shameContainer.innerHTML === '') {
                shameContainer.innerHTML = '<p style="text-align:center; color:#999;">ì´ë²ˆ ë‹¬ ê¸°ë¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>';
            }
            
            await renderWeeklyDetails();
        }
        async function renderWeeklyDetails() {
            const container = document.getElementById('weeklyDetails');
            container.innerHTML = '<h3>ğŸ“… ì£¼ê°„ë³„ ìš”ì•½</h3>';

            const monthDates = getMonthDates(currentDate);
            const mondays = [...new Set(monthDates.map(dateStr => getWeekDates(parseDate(dateStr))[0]))];
            let hasAnyData = false;

            for (const mondayStr of mondays.sort().reverse()) {
                const weekDates = getWeekDates(parseDate(mondayStr));
                const dayDatas = await Promise.all(weekDates.map(dateStr => getDayData(parseDate(dateStr))));
                const isWeekRecorded = dayDatas.some(d => d.wakeTime || d.writing > 0 || d.exercise.done || Object.keys(d.personalGoals).length > 0);

                if (isWeekRecorded) {
                    hasAnyData = true;
                    const validDays = dayDatas.filter(d => d && !d.isOffDay && d.wakeTime);
                    
                    let avgScore = 0;
                    if (validDays.length > 0) { avgScore = Math.round(validDays.reduce((sum, d) => sum + (d.score || 0), 0) / validDays.length); }
                    let avgGoalRate = 0;
                    if (validDays.length > 0) { const goalRates = await Promise.all(validDays.map(d => calculatePersonalGoalAverage(d, d.date))); avgGoalRate = Math.round(goalRates.reduce((sum, rate) => sum + rate, 0) / validDays.length); }
                    const totalWriting = dayDatas.reduce((sum, data) => sum + (data?.writing || 0), 0);
                    const exerciseCount = dayDatas.reduce((sum, data) => sum + (data?.exercise.done ? 1 : 0), 0);

                    container.innerHTML += `<div class="week-card"><div class="week-header"><span>${formatDateForLabel(weekDates[0])} ~ ${formatDateForLabel(weekDates[6])}</span></div><div class="week-stats"><span>â­ ${avgScore}</span><span>${getEmojiForAchievement(avgGoalRate)} ${avgGoalRate}%</span><span>ğŸ“– ${(totalWriting / 100000).toFixed(2)}</span><span>ğŸ’ª ${exerciseCount}/7</span></div></div>`;
                }
            }
            if (!hasAnyData) { container.innerHTML += '<p style="text-align:center; color:#666; padding: 20px 0;">ì•„ì§ ê¸°ë¡ëœ ì£¼ê°„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; }
        }
        
        async function checkAndDisplayGameWarning() { const warningDiv = document.getElementById('gameWarning'); const weekDates = getWeekDates(new Date()); const dataPromises = weekDates.map(dateStr => dbGet(`day_${dateStr}`)); const weekData = await Promise.all(dataPromises); const totalGameTime = weekData.reduce((sum, dayData) => sum + (dayData?.gameTime || 0), 0); if (totalGameTime > 1200) { warningDiv.textContent = `âš ï¸ì´ë²ˆ ì£¼ ê²Œì„ ì‹œê°„ì´ ${(totalGameTime / 60).toFixed(1)}ì‹œê°„ì„ ë„˜ì—ˆìŠµë‹ˆë‹¤. ìê¸° ì ˆì œê°€ í•„ìš”í•©ë‹ˆë‹¤.`; warningDiv.style.display = 'block'; }  else { warningDiv.style.display = 'none'; } }
        async function checkForMonthlyBonus() { 
            const today = new Date(); 
            const currentMonthKey = `bonusAwarded_${today.getFullYear()}-${today.getMonth()}`; 
            if (await dbGet(currentMonthKey)) return; 

            const prevMonthDate = new Date(today.getFullYear(), today.getMonth() - 1, 1); 
            const prevMonthDates = getMonthDates(prevMonthDate); 
            const dataPromises = prevMonthDates.map(dateStr => dbGet(`day_${dateStr}`)); 
            const monthlyData = await Promise.all(dataPromises); 
            
            let totalScore = 0, validDays = 0; 
            for (const dayData of monthlyData) { 
                if (dayData && !dayData.isOffDay && dayData.wakeTime) { 
                    totalScore += dayData.score || 0; 
                    validDays++; 
                } 
            } 
            
            if (validDays > 0 && (totalScore / validDays) >= 80) { 
                const firstDayData = await getDayData(new Date(today.getFullYear(), today.getMonth(), 1)); 
                firstDayData.bonusPoints = (firstDayData.bonusPoints || 0) + 30; 
                await saveDayData(new Date(today.getFullYear(), today.getMonth(), 1), firstDayData); 
                setTimeout(async () => { 
                    showFeedbackPopup(100, { class: 'feedback-celebration', emoji: 'ğŸ†', title: 'ì›”ê°„ ë³´ë„ˆìŠ¤ íšë“!', message: `ì§€ë‚œë‹¬ í‰ê·  ${Math.round(totalScore/validDays)}ì ì„ ë‹¬ì„±! ì´ë²ˆ ë‹¬ì˜ ì‹œì‘ì— ë³´ë„ˆìŠ¤ +30ì ì´ ë¶€ì—¬ë©ë‹ˆë‹¤!` }); 
                    await renderCalendar(); 
                }, 1000); 
            }
            
            await checkMonthlyPerformanceAndNotify();
            await checkExerciseAndDietBalance();
            await checkMonthEndAchievements(prevMonthDate);
}

        async function checkExerciseAchievements(date) {
            const today = new Date(date);
            const weekDates = getWeekDates(today);
            const monthDates = getMonthDates(today);

            const weekKey = `weeklyExercisePopup_${weekDates[0]}`;
            if (!(await dbGet(weekKey))) {
                const weekDataPromises = weekDates.map(d => dbGet(`day_${d}`));
                const weekData = await Promise.all(weekDataPromises);
                if (weekData.reduce((c, data) => c + (data?.exercise.done ? 1 : 0), 0) >= 5) {
                    showFeedbackPopup(100, { class: 'feedback-celebration', emoji: 'ğŸ”¥', title: 'ì£¼ 5ì¼ ìš´ë™ ë‹¬ì„±!', message: 'ì²´ì§€ë°©ë¥  20%... ì–´ì©Œë©´ ê¸ˆë°© ë„ë‹¬í• ì§€ë„?' });
                    await dbSet(weekKey, true);
                }
            }
    
            const monthKey = `monthlyExercisePopup_${today.getFullYear()}-${today.getMonth()}`;
            if (!(await dbGet(monthKey))) {
                const monthDataPromises = monthDates.map(d => dbGet(`day_${d}`));
                const monthData = await Promise.all(monthDataPromises);
                if (monthData.reduce((c, data) => c + (data?.exercise.done ? 1 : 0), 0) > 20) {
                    showFeedbackPopup(100, { class: 'feedback-celebration', emoji: 'ğŸ¥³', title: 'ì´ë‹¬ì˜ ìš´ë™ 20íšŒ ëŒíŒŒ!', message: 'ê¸°ë¶„ì´ë‹¤! ì˜¤ëŠ˜ì€ ì¹˜íŒ…ë°ì´ë¥¼ ê°€ì ¸ë„ ì¢‹ìŠµë‹ˆë‹¤! ìˆ˜ê³ í–ˆì–´ìš”!' });
                    await dbSet(monthKey, true);
                }
            }
        }
async function showFeedbackPopup(score, customOptions = {}) { 
   const popup = document.getElementById('feedbackPopup'); 
   const content = popup.querySelector('.feedback-content'); 
   const emoji = document.getElementById('feedbackEmoji'); 
   const title = document.getElementById('feedbackTitle'); 
   const message = document.getElementById('feedbackMessage'); 
   
   content.className = 'feedback-content'; 
   let options = {};
   
   // âœ¨ íŠ¹ë³„í•œ ë‚  ì²´í¬ (ìƒˆë¡œ ì¶”ê°€)
   const today = formatDate(new Date());
   const isRoutineKingDay = await dbGet(`routineKingDay_${today}`);
   
   // ë£¨í‹´ì˜ ì™• ë°ì´ë©´ ë¬´ì¡°ê±´ ê¸ì •ì ì¸ ë©”ì‹œì§€ë¡œ ì˜¤ë²„ë¼ì´ë“œ
   if (isRoutineKingDay && Object.keys(customOptions).length === 0) {
       const kingMessages = [
           { class: 'feedback-celebration', emoji: 'ğŸ‘‘', title: 'ì™•ë‹¤ìš´ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤!', message: 'ì—­ì‹œ ë£¨í‹´ì˜ ì™•ë‹¤ìš´ ëª¨ìŠµì´êµ°ìš”! ì˜¤ëŠ˜ë„ í›Œë¥­í–ˆìŠµë‹ˆë‹¤!' },
           { class: 'feedback-celebration', emoji: 'ğŸ†', title: 'ì™•ì˜ ìœ„ì—„!', message: 'ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ìŠµë‹ˆë‹¤. ì™•ì—ê²ŒëŠ” ëª¨ë“  ìˆœê°„ì´ ì†Œì¤‘í•˜ë‹ˆê¹Œìš”!' },
           { class: 'feedback-celebration', emoji: 'â­', title: 'ë¹›ë‚˜ëŠ” ì™•ê´€!', message: 'ì˜¤ëŠ˜ í•˜ë£¨ë„ ë‹¹ì‹ ë‹¤ì› ì–´ìš”. ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ í›Œë¥­í•©ë‹ˆë‹¤!' }
       ];
       options = kingMessages[Math.floor(Math.random() * kingMessages.length)];
   }
   // ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ
   else if (Object.keys(customOptions).length > 0) { 
       options = customOptions; 
   } else if (score >= 80) { 
       options = { class: 'feedback-celebration', emoji: 'ğŸ‰', title: 'Perfect! ì™„ë²½í•´ìš”!', message: 'ì˜¤ëŠ˜ ì •ë§ ì˜í–ˆì–´ìš”!' }; 
   } else if (score >= 40) { 
       options = { class: 'feedback-reflection', emoji: 'âœ¨', title: 'ê½¤ ê´œì°®ì•„ìš”!', message: 'ì–´ë–¤ ë¶€ë¶„ì„ ê°œì„ í•  ìˆ˜ ìˆì„ê¹Œìš”?' }; 
   } else if (score >= 1) { 
       options = { class: 'feedback-encouragement', emoji: 'ğŸŒ±', title: 'ê´œì°®ì•„ìš”!', message: 'ë‚´ì¼ì€ ìƒˆë¡œìš´ ê¸°íšŒì˜ˆìš”!' }; 
   } else { 
       options = { class: 'feedback-disaster', emoji: 'ğŸ’€', title: 'ì˜¤ëŠ˜ì€ ì¬ì•™ì´ì—ˆë„¤ìš”...', message: 'ì´ì œ ì˜¬ë¼ê°ˆ ì¼ë§Œ ë‚¨ì•˜ì–´ìš”!' }; 
   } 
   
   content.classList.add(options.class); 
   emoji.textContent = options.emoji; 
   title.textContent = options.title; 
   message.textContent = options.message; 
   popup.style.display = 'flex'; 
   
   setTimeout(() => { 
       if (popup.style.display === 'flex') closeFeedbackPopup(); 
   }, 6000); 
}
        function closeFeedbackPopup() { const popup = document.getElementById('feedbackPopup'); if(popup) popup.style.display = 'none'; }
        
        async function checkBudgetAndShowPopup() {
            const budget = await dbGet('monthlyBudget');
            if (!budget) return false;
            
            const { start, end } = getMonthDateRange(new Date());
            const allData = await dbGetAll();
            const expenses = allData.filter(item => 
                item.key.startsWith('expense_') && 
                item.value.date >= start && 
                item.value.date <= end
            );
            
            const totalSpent = expenses.reduce((sum, item) => sum + item.value.amount, 0);
            const percentage = (totalSpent / budget) * 100;
            
            const checkKey = `budgetWarning_${new Date().getFullYear()}-${new Date().getMonth()}`;
            const warningStatus = await dbGet(checkKey);

            let popupShown = false;
            
            if (percentage > 100 && warningStatus !== 'black') {
                showFeedbackPopup(0, {
                    class: 'feedback-budget-black', emoji: 'ğŸ’€', title: 'ì˜ˆì‚° ì´ˆê³¼',
                    message: "ê³„íš ì—†ëŠ” ì†Œë¹„ëŠ” ë¯¸ë˜ì˜ ë‚˜ì—ê²Œ ë¹šì„ ì§€ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. ì¬ì • ìŠµê´€ì„ ì ê²€í•˜ê³ , ë‹¤ìŒ ë‹¬ì—ëŠ” ë°˜ë“œì‹œ ì˜ˆì‚° ì•ˆì—ì„œ ìƒí™œí•˜ëŠ” í›ˆë ¨ì„ í•´ì•¼ í•©ë‹ˆë‹¤."
                });
                await dbSet(checkKey, 'black');
                popupShown = true;
            } else if (percentage > 90 && warningStatus !== 'red' && warningStatus !== 'black') {
                showFeedbackPopup(0, {
                    class: 'feedback-budget-red', emoji: 'ğŸš¨', title: 'ì§€ê°‘ ê²½ë³´!',
                    message: "ëˆì€ ë²„ëŠ” ê²ƒë³´ë‹¤ ì“°ëŠ” ê²Œ í›¨ì”¬ ì‰½ë‹¤ëŠ” ì‚¬ì‹¤, ìŠì§€ ë§ˆì„¸ìš”. ì§€ê¸ˆë¶€í„°ì˜ ì§€ì¶œì€ ì‹ ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤."
                });
                await dbSet(checkKey, 'red');
                popupShown = true;
            } else if (percentage > 70 && !warningStatus) {
                showFeedbackPopup(0, {
                    class: 'feedback-reflection', emoji: 'ğŸ¤”', title: 'ì˜ˆì‚° 70% ë„ë‹¬',
                    message: "ì˜ˆì‚°ì˜ 70%ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ë‚¨ì€ ê¸°ê°„ ë™ì•ˆ í˜„ëª…í•œ ì†Œë¹„ ê³„íšì´ í•„ìš”í•©ë‹ˆë‹¤."
                });
                await dbSet(checkKey, 'yellow');
                popupShown = true;
            }

            return popupShown;
        }

        async function openDayModal(date) {
            const saveStatus = document.getElementById('saveStatus');
            if (saveStatus) saveStatus.textContent = '';
            selectedDate = date;
            const data = await getDayData(date);
            currentModalData = { ...data };
            
            document.getElementById('modalTitle').textContent = new Date(date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            document.getElementById('modalWakeTime').value = data.wakeTime || '';
            document.getElementById('modalSeatTime').value = data.seatTime || '';
            document.getElementById('modalSleepTime').value = data.sleepTime || '';
            document.getElementById('modalMorningPomodoro').value = data.pomodoro?.morning || 0;
            document.getElementById('modalAfternoonPomodoro').value = data.pomodoro?.afternoon || 0;
            document.getElementById('modalEveningPomodoro').value = data.pomodoro?.evening || 0;
            document.getElementById('modalWriting').value = (data.writing || 0).toLocaleString('ko-KR');
            document.getElementById('modalGameTime').value = data.gameTime || 0;
            document.getElementById('modalOffDay').checked = data.isOffDay;
            document.getElementById('modalComment').value = data.comment || '';
            const commentDetails = document.getElementById('commentDetails');
            if (data.comment) {
                commentDetails.open = true;
            } else {
                commentDetails.open = false;
            }
            updateCommentCounter();
            
            toggleExercise(data.exercise.done, false);
            document.getElementById('modalExerciseMinutes').value = data.exercise.minutes || 0;
            
            await renderModalPersonalGoals(data);
            await renderModalExpenses(formatDate(selectedDate));
            await updateModalScore();

            document.getElementById('dayModal').style.display = 'flex';
        }

function toggleExercise(isDone, shouldAutoSave = true) {
    const btnYes = document.getElementById('exerciseBtnYes');
    const btnNo = document.getElementById('exerciseBtnNo');
    const timeGroup = document.getElementById('modalExerciseTimeGroup');
    
    if (isDone) {
        btnYes.classList.add('active');
        btnNo.classList.remove('active');
        timeGroup.style.display = 'block';
    } else {
        btnNo.classList.add('active');
        btnYes.classList.remove('active');
        timeGroup.style.display = 'none';
        document.getElementById('modalExerciseMinutes').value = 0; // ìš´ë™ ì•ˆí•¨ ì„ íƒ ì‹œ ì‹œê°„ ì´ˆê¸°í™”
    }
    
    // currentModalDataì˜ exercise ìƒíƒœë¥¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    currentModalData.exercise = { 
        ...currentModalData.exercise, 
        done: isDone,
        minutes: isDone ? parseInt(document.getElementById('modalExerciseMinutes').value) || 0 : 0
    };
    
    // í™”ë©´ì˜ ì ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    updateModalScore();
    
    // ì‚¬ìš©ìê°€ ì§ì ‘ í´ë¦­í–ˆì„ ë•Œë§Œ (ëª¨ë‹¬ì´ ì²˜ìŒ ì—´ë¦´ ë•Œê°€ ì•„ë‹ ë•Œ) ìë™ ì €ì¥ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
    if (shouldAutoSave) {
        autoSaveModalData();
    }
}

        async function updateModalScore() {
            const scoreEl = document.getElementById('modalScore');
            const isOffDay = document.getElementById('modalOffDay').checked;
            if (isOffDay) { scoreEl.textContent = 'íœ´ì‹'; scoreEl.classList.add('is-off'); return; }
            scoreEl.classList.remove('is-off');
            const data = { 
                wakeTime: document.getElementById('modalWakeTime').value || null, 
                seatTime: document.getElementById('modalSeatTime').value || null, 
                pomodoro: { morning: parseInt(document.getElementById('modalMorningPomodoro').value) || 0, afternoon: parseInt(document.getElementById('modalAfternoonPomodoro').value) || 0, evening: parseInt(document.getElementById('modalEveningPomodoro').value) || 0 }, 
                exercise: { done: document.getElementById('exerciseBtnYes').classList.contains('active'), minutes: parseInt(document.getElementById('modalExerciseMinutes').value) || 0 }, 
                gameTime: parseInt(document.getElementById('modalGameTime').value) || 0, 
                writing: unformatNumber(document.getElementById('modalWriting').value), 
                sleepTime: document.getElementById('modalSleepTime').value || null, 
                bonusPoints: currentModalData.bonusPoints 
            }; 
            scoreEl.textContent = await calculateScoreEnhanced(data); 
        }

function getModalDataForSave() {
    const isOffDay = document.getElementById('modalOffDay').checked;
    
    const mission = currentModalData.mission ? { ...currentModalData.mission } : null;
    if (mission) {
        const missionCompleteCheckbox = document.getElementById('modalMissionComplete');
        if (missionCompleteCheckbox) {
            mission.completed = missionCompleteCheckbox.checked;
        }
    }

    const data = {
        ...currentModalData, 
        wakeTime: document.getElementById('modalWakeTime').value || null, 
        seatTime: document.getElementById('modalSeatTime').value || null, 
        pomodoro: { morning: parseInt(document.getElementById('modalMorningPomodoro').value) || 0, afternoon: parseInt(document.getElementById('modalAfternoonPomodoro').value) || 0, evening: parseInt(document.getElementById('modalEveningPomodoro').value) || 0 }, 
        exercise: { done: document.getElementById('exerciseBtnYes').classList.contains('active'), minutes: parseInt(document.getElementById('modalExerciseMinutes').value) || 0 }, 
        gameTime: parseInt(document.getElementById('modalGameTime').value) || 0, 
        writing: unformatNumber(document.getElementById('modalWriting').value), 
        sleepTime: document.getElementById('modalSleepTime').value || null, 
        isOffDay, 
        mission: mission,
        comment: document.getElementById('modalComment').value.trim() || ""
    };
    return data;
}

// ìë™ ì €ì¥ì„ ìœ„í•œ ë””ë°”ìš´ì‹± í•¨ìˆ˜ (ë”œë ˆì´ 0.5ì´ˆë¡œ ë‹¨ì¶• ë° í”¼ë“œë°± ì¶”ê°€)
const autoSaveModalData = debounce(async () => {
    if (!selectedDate) return;

    const saveStatus = document.getElementById('saveStatus');
    if (saveStatus) saveStatus.textContent = 'ì €ì¥ ì¤‘...';

    const data = getModalDataForSave();
    
    // 1. ì ìˆ˜ ê³„ì‚° ë° ë°ì´í„° ì €ì¥
    data.score = await calculateScoreEnhanced(data);
    await dbSet(`day_${formatDate(selectedDate)}`, data);
    
    // 2. í€˜ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ë¡œì§ì„ ì´ê³³ìœ¼ë¡œ í†µí•©í•©ë‹ˆë‹¤.
    await checkAndUpdateAllQuests(data, selectedDate);
    
    // 3. í˜„ì¬ ëª¨ë‹¬ ë°ì´í„° ì—…ë°ì´íŠ¸
    currentModalData = { ...data };

    if (saveStatus) {
        setTimeout(() => {
            saveStatus.textContent = 'ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
        }, 300);
    }
}, 500);

// ê¸°ì¡´ saveModalDataë¥¼ ëŒ€ì²´í•˜ëŠ” finalizeDay í•¨ìˆ˜
async function finalizeDay() {
    const previousData = await getDayData(selectedDate);
    const data = getModalDataForSave();

    // ìµœì¢… ì ìˆ˜ ê³„ì‚° ë° ì €ì¥
    data.score = await calculateScoreEnhanced(data);
    await dbSet(`day_${formatDate(selectedDate)}`, data);

    // === ì¢…ë£Œ ì‹œì  í€˜ìŠ¤íŠ¸ ì²´í¬ ì¶”ê°€ ===
    await checkEndOfDayQuests(data, selectedDate);
    
    // ì£¼ê°„ ì¢…ë£Œ ì²´í¬ (ì¼ìš”ì¼ì¸ ê²½ìš°)
    const dayOfWeek = selectedDate.getDay();
    if (dayOfWeek === 0) { // ì¼ìš”ì¼
        await checkEndOfWeekQuests(selectedDate);
        await checkWeekEndAchievements(selectedDate);
    }
    
    // ì›”ê°„ ì¢…ë£Œ ì²´í¬ (ì›” ë§ˆì§€ë§‰ ë‚ ì¸ ê²½ìš°)
    const nextDay = new Date(selectedDate);
    nextDay.setDate(nextDay.getDate() + 1);
    if (nextDay.getDate() === 1) { // ë‹¤ìŒë‚ ì´ 1ì¼ì´ë©´ ì˜¤ëŠ˜ì´ ì›”ë§
        await checkEndOfMonthQuests(selectedDate);
    }

    // ì—…ì  ë° ìŠ¤íŠ¸ë¦­ ì²´í¬
    const allDbData = await dbGetAll();
    await checkAllAchievements(selectedDate, data, previousData, allDbData);
    await checkStreaks(selectedDate, data, allDbData);
    await checkExerciseAchievements(selectedDate);

    // ê°ì„± ë¶„ì„ ë° ëª…ì–¸ íŒì—…
    const quoteShown = await analyzeSentimentAndShowQuote(selectedDate, data.comment);

    closeDayModal();

    // ì˜ˆì‚° ê´€ë ¨ íŒì—… ì²´í¬
    const budgetPopupShown = await checkBudgetAndShowPopup();

    // ì ìˆ˜ í”¼ë“œë°± íŒì—… (ë‹¤ë¥¸ íŒì—…ì´ ë–´ìœ¼ë©´ ì•½ê°„ ì§€ì—°)
    if (!data.isOffDay) {
        const finalScore = data.score;
        const delay = (quoteShown || budgetPopupShown) ? 1000 : 0;
        setTimeout(() => showFeedbackPopup(finalScore), delay);
    }
}

// ê°ì„± ë¶„ì„ ë° ëª…ì–¸ íŒì—… í•¨ìˆ˜
async function analyzeSentimentAndShowQuote(date, currentComment) {
    if (!currentComment) return false;

    const analyze = (comment, type) => SENTIMENT_DATA[type].keywords.some(k => comment.includes(k));
    
    const today = new Date(date);
    const yesterday = new Date(today); yesterday.setDate(yesterday.getDate() - 1);
    const dayBeforeYesterday = new Date(today); dayBeforeYesterday.setDate(dayBeforeYesterday.getDate() - 2);

    const dataYesterday = await getDayData(yesterday);
    const dataDayBefore = await getDayData(dayBeforeYesterday);

    for (const type of ['positive', 'negative']) {
        if (analyze(currentComment, type) && 
            analyze(dataYesterday.comment, type) && 
            analyze(dataDayBefore.comment, type)) {
            
            const quotes = SENTIMENT_DATA[type].quotes;
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            
            const options = {
                class: type === 'positive' ? 'feedback-celebration' : 'feedback-encouragement',
                emoji: type === 'positive' ? 'â˜€ï¸' : 'ğŸŒ§ï¸',
                title: randomQuote.title,
                message: randomQuote.msg
            };
            showFeedbackPopup(0, options);
            return true; // íŒì—… í‘œì‹œë¨
        }
    }
    return false; // íŒì—… í‘œì‹œ ì•ˆë¨
}

        async function checkForWeeklyReflection(date) {
            const today = new Date(date);
            if (today.getDay() !== 0) return;

            const weekDates = getWeekDates(today);
            const checkKey = `weeklyReflectionChecked_${weekDates[0]}`;
            if (await dbGet(checkKey)) return;

            const dataPromises = weekDates.map(d => getDayData(parseDate(d)));
            const weekData = await Promise.all(dataPromises);
            const validDays = weekData.filter(d => d && !d.isOffDay && d.wakeTime);
            if (validDays.length === 0) return;

            const avgScore = Math.round(validDays.reduce((sum, d) => sum + (d.score || 0), 0) / validDays.length);
            if (avgScore < 25) {
                document.getElementById('reasonModal').style.display = 'flex';
            }
            await dbSet(checkKey, true);
        }
        function closeReasonModal() { document.getElementById('reasonModal').style.display = 'none'; }
        function submitReason() { 
            const reason = document.getElementById('reasonText').value; 
            closeReasonModal(); 
            analyzeReason(reason); 
            document.getElementById('reasonText').value = ''; 
            unlockAchievement('ACH_META_AWARENESS');
        }
        function analyzeReason(reason) {
            const negative = ['ê²Œì„', 'ë¹ˆë‘¥', 'í•˜ê¸° ì‹«ì–´ì„œ', 'ë…¸ëŠë¼', 'ìœ íŠœë¸Œ', 'ë„·í”Œë¦­ìŠ¤', 'ë’¹êµ´']; 
            const acceptable = ['ìƒë¦¬', 'íšŒì‚¬', 'ì—…ë¬´', 'ì¶œê°„', 'í”„ë¡œì íŠ¸', 'ë§ˆê°', 'ëª¸ì‚´', 'ë³‘ì›', 'ì•„íŒŒì„œ'];
            let type = 'neutral';
            if (negative.some(k => reason.includes(k))) type = 'negative'; 
            else if (acceptable.some(k => reason.includes(k))) type = 'acceptable';
            let options = {};
            switch (type) {
                case 'negative': options = { class: 'feedback-disaster', emoji: 'ğŸ˜¡', title: 'ì½”ì¹˜ì˜ ë”°ë”í•œ í•œë§ˆë””', message: `"${reason.substring(0, 15)}..." ê·¸ê±´ ë³€ëª…ì…ë‹ˆë‹¤. ì‹œê°„ì„ ì§€ë°°í•˜ì§€ ëª»í•˜ëŠ” ìëŠ” ê²°êµ­ ì‹œê°„ì˜ ë…¸ì˜ˆê°€ ë  ë¿ì…ë‹ˆë‹¤.` }; break;
                case 'acceptable': options = { class: 'feedback-encouragement', emoji: 'ğŸ‘', title: 'ì´í•´í•©ë‹ˆë‹¤. ìˆ˜ê³ í–ˆì–´ìš”.', message: 'í˜ë“  ìƒí™©ì—ì„œë„ ê¸°ë¡ì„ ë†“ì§€ ì•Šì€ ê²ƒë§Œìœ¼ë¡œë„ ëŒ€ë‹¨í•©ë‹ˆë‹¤. ì˜ ì¶”ìŠ¤ë¥´ê³  ë‹¤ìŒ ì£¼ì— ë‹¤ì‹œ ì‹œì‘í•´ë´…ì‹œë‹¤.' }; break;
                default: options = { class: 'feedback-reflection', emoji: 'ğŸ¤”', title: 'ì„±ì°°ì˜ ì‹œê°„', message: 'ì†”ì§í•œ ë‹µë³€ ê³ ë§™ìŠµë‹ˆë‹¤. ì›ì¸ì„ íŒŒì•…í•˜ê³  ë‹¤ìŒ ì£¼ì— ì–´ë–»ê²Œ ê°œì„ í• ì§€ ê³„íší•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.' }; break;
            }
            showFeedbackPopup(0, options);
        }

        async function deleteModalData() { if (!confirm("ì •ë§ë¡œ ì´ ë‚ ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return; await dbDelete(`day_${formatDate(selectedDate)}`); closeDayModal(); await renderCalendar(); }
    async function renderModalPersonalGoals(data) {
    const allGoals = await getPersonalGoals();
    const goals = allGoals.filter(goal => {
        if (goal.isCompleted) return false;
        const goalCreatedDate = new Date(goal.createdAt);
        goalCreatedDate.setHours(0, 0, 0, 0); 
        return goalCreatedDate <= selectedDate;
    });
    const container = document.getElementById('modalPersonalGoalsList');
    
    if (goals.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center; font-size:13px;">ì§„í–‰ ì¤‘ì¸ ê°œì¸ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
    }
    
    const personalGoalsData = data.personalGoals || {};
    container.innerHTML = goals.map(goal => {
        const achieved = personalGoalsData[goal.id] || 0;
        let percentage = 0;
        if (goal.type === 'negative') {
            const usageRatio = achieved / goal.dailyTarget;
            percentage = Math.max(0, (1 - usageRatio) * 100);
        } else {
            percentage = Math.min(100, (achieved / goal.dailyTarget) * 100);
        }
        const emoji = getEmojiForAchievement(percentage);
        
        return `<div class="personal-goal-checkbox">
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size:13px; margin-bottom: 5px;">
                    ${goal.name} ${goal.type === 'negative' ? '(ì¤„ì´ê¸°)' : '(ëŠ˜ë¦¬ê¸°)'}
                </div>
                <div style="font-size: 11px; color: #666; margin-bottom: 8px;">
                    ${goal.type === 'negative' ? 'ëª©í‘œ: ' + goal.dailyTarget + goal.unit + ' ì´í•˜' : 'ëª©í‘œ: ' + goal.dailyTarget + goal.unit}
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <button type="button" class="goal-adjust-btn" onclick="adjustPersonalGoal('${goal.id}', -1)" style="width: 28px; height: 28px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; font-weight: bold; color: #666;">âˆ’</button>
                    <input type="number" 
                           id="personalGoal_${goal.id}" 
                           value="${achieved}" 
                           min="0" 
                           style="width: 60px; height: 28px; text-align: center; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;" 
                           onchange="updatePersonalGoalValue('${goal.id}', this.value)">
                    <button type="button" class="goal-adjust-btn" onclick="adjustPersonalGoal('${goal.id}', 1)" style="width: 28px; height: 28px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; font-weight: bold; color: #666;">+</button>
                    <span style="font-size: 11px; color: #666;">${goal.unit}</span>
                </div>
            </div>
            <div style="font-size: 16px; margin-left: 8px;">${emoji}</div>
        </div>`;
    }).join('');
}

// ê°œì¸ ëª©í‘œ +/- ë²„íŠ¼ ì¡°ì • í•¨ìˆ˜
function adjustPersonalGoal(goalId, change) {
    const input = document.getElementById(`personalGoal_${goalId}`);
    if (!input) return;
    
    const currentValue = parseInt(input.value) || 0;
    const newValue = Math.max(0, currentValue + change);
    input.value = newValue;
    
    // ê°’ ì—…ë°ì´íŠ¸ ë° ìë™ ì €ì¥
    updatePersonalGoalValue(goalId, newValue);
}

// ê°œì¸ ëª©í‘œ ê°’ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updatePersonalGoalValue(goalId, value) {
    if (!currentModalData.personalGoals) {
        currentModalData.personalGoals = {};
    }
    currentModalData.personalGoals[goalId] = parseInt(value) || 0;
    
    // ì ìˆ˜ ì—…ë°ì´íŠ¸ ë° ìë™ ì €ì¥
    updateModalScore();
    autoSaveModalData();
}

async function updatePersonalGoalProgress(goalId, value) { 
    const achieved = Math.max(0, parseInt(value) || 0); 
    currentModalData.personalGoals = currentModalData.personalGoals || {}; 
    currentModalData.personalGoals[goalId] = achieved; 
    const goals = await getPersonalGoals(); 
    const goal = goals.find(g => g.id === goalId); 
    if (!goal) return;
    
    let percentage = 0;
    if (goal.type === 'negative') {
        const usageRatio = achieved / goal.dailyTarget;
        percentage = Math.max(0, (1 - usageRatio) * 100);
    } else {
        percentage = Math.min(100, (achieved / goal.dailyTarget) * 100);
    }
    
    const emoji = getEmojiForAchievement(percentage); 
    const container = document.querySelector(`#goal_${goal.id}`).closest('.personal-goal-checkbox'); 
    container.querySelector('.goal-emoji').textContent = emoji; 
    container.querySelector('span:last-of-type').textContent = `(${Math.round(percentage)}%)`;
    
    autoSaveModalData();
}
        
// ê¸€ì“°ê¸° ë§ˆì¼ìŠ¤í†¤ ì²´í¬ í•¨ìˆ˜
async function checkWritingMilestone(newlyAddedChars) {
    if (!newlyAddedChars || newlyAddedChars <= 0) return;
    let currentProgress = await dbGet('writingMilestoneProgress') || 0;
    currentProgress += newlyAddedChars;
    const MILESTONE_GOAL = 120000;
    if (currentProgress >= MILESTONE_GOAL) {
        showFeedbackPopup(100, {
            class: 'feedback-celebration',
            emoji: 'âœï¸',
            title: 'ì›ê³  ì™„ì„±!',
            message: 'ì¶•í•˜í•©ë‹ˆë‹¤! ì±… í•œ ê¶Œ ë¶„ëŸ‰ì˜ ê¸€ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì§„ì •í•œ ì‘ê°€ì…ë‹ˆë‹¤!'
        });
        await dbSet('writingMilestoneProgress', 0);
    } else {
        await dbSet('writingMilestoneProgress', currentProgress);
    }
}

function addWeeklyWritingSummary(cellDate, container, dataMap) {
    const weekDates = getWeekDates(cellDate);
    let weeklyWritingTotal = 0;
    
    for (const dateStr of weekDates) {
        const weeklyDayData = dataMap.get(`day_${dateStr}`);
        if (weeklyDayData) {
            weeklyWritingTotal += weeklyDayData.writing || 0;
        }
    }
    
    if (weeklyWritingTotal > 0) {
        const bookCount = (weeklyWritingTotal / 100000).toFixed(2);
        container.innerHTML += `<span>ğŸ“–${bookCount}</span>`;
    }
}
        
async function addPersonalGoal() { 
    const name = document.getElementById('newGoalName').value.trim();
    const totalAmount = parseInt(document.getElementById('newGoalTarget').value); 
    const days = parseInt(document.getElementById('newGoalUnit').value);
    const customUnit = document.getElementById('newGoalCustomUnit').value.trim(); // ìƒˆë¡œ ì¶”ê°€
    
    if (!name || !totalAmount || !days || days <= 0 || !customUnit) {
        return alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    }
    
    // í•˜ë£¨ ëª©í‘œëŸ‰ ê³„ì‚°
    const dailyTarget = Math.ceil(totalAmount / days);
    
    const goals = await getPersonalGoals(); 
    const newGoal = {
        id: Date.now().toString(), 
        name, 
        totalAmount: totalAmount,
        days: days,
        dailyTarget: dailyTarget,
        unit: customUnit, // í•˜ë“œì½”ë”© ëŒ€ì‹  ì‚¬ìš©ì ì…ë ¥ ì‚¬ìš©
        createdAt: new Date().toISOString(), 
        isCompleted: false, 
        type: newGoalType,
        deadline: new Date(Date.now() + days * 24 * 60 * 60 * 1000).toISOString()
    };
    
    goals.push(newGoal);
    await dbSet('personalGoals', goals); 
    
    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    document.getElementById('newGoalName').value = ''; 
    document.getElementById('newGoalTarget').value = ''; 
    document.getElementById('newGoalUnit').value = ''; 
    document.getElementById('newGoalCustomUnit').value = ''; // ìƒˆ í•„ë“œ ì´ˆê¸°í™”
    
    await renderPersonalGoalsList(); 
}

function toggleGoalType(type) {
    newGoalType = type;
    const positiveBtn = document.getElementById('goalTypePositive');
    const negativeBtn = document.getElementById('goalTypeNegative');
    const targetLabel = document.querySelector('label[for="newGoalTarget"]');
    const unitLabel = document.querySelector('label[for="newGoalUnit"]');

    if (type === 'positive') {
        positiveBtn.classList.add('active');
        negativeBtn.classList.remove('active');
        targetLabel.textContent = 'ì´ ëª©í‘œëŸ‰';
        unitLabel.textContent = 'ê¸°ê°„ (ì¼)';
        document.getElementById('newGoalUnit').placeholder = 'ì˜ˆ: 20';
    } else {
        negativeBtn.classList.add('active');
        positiveBtn.classList.remove('active');
        targetLabel.textContent = 'ìµœëŒ€ í—ˆìš©ëŸ‰ (ì´)';
        unitLabel.textContent = 'ê¸°ê°„ (ì¼)';
        document.getElementById('newGoalUnit').placeholder = 'ì˜ˆ: 30';
    }
}

        async function deletePersonalGoal(goalId) { if (!confirm('ì´ ëª©í‘œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const goals = (await getPersonalGoals()).filter(goal => goal.id !== goalId); await dbSet('personalGoals', goals); await renderPersonalGoalsList(); }
        function switchGoalTab(tabName) { currentGoalTab = tabName; document.querySelectorAll('.goal-tab').forEach(tab => tab.classList.remove('active')); document.querySelector(`.goal-tab[onclick="switchGoalTab('${tabName}')"]`).classList.add('active'); renderPersonalGoalsList(); }
    async function renderPersonalGoalsList() { 
    const allGoals = await getPersonalGoals(); 
    
    // ë§ˆê°ì¼ ì²´í¬ ë° ìë™ ì™„ë£Œ ì²˜ë¦¬
    const today = new Date();
    let goalsUpdated = false;
    
    for (const goal of allGoals) {
        if (!goal.isCompleted && goal.deadline) {
            const deadlineDate = new Date(goal.deadline);
            if (today >= deadlineDate) {
                goal.isCompleted = true;
                goal.completedAt = deadlineDate.toISOString();
                
                // ì„±ê³µ/ì‹¤íŒ¨ íŒì •
                const totalAchieved = await calculateTotalAchieved(goal);
                if (goal.type === 'positive') {
                    goal.success = totalAchieved >= goal.totalAmount;
                } else {
                    goal.success = totalAchieved <= goal.totalAmount;
                }
                goalsUpdated = true;
            }
        }
    }
    
    if (goalsUpdated) {
        await dbSet('personalGoals', allGoals);
    }
    
    const goals = allGoals.filter(goal => currentGoalTab === 'active' ? !goal.isCompleted : goal.isCompleted); 
    const container = document.getElementById('personalGoalsList'); 
    
    if (goals.length === 0) { 
        const emptyMessage = currentGoalTab === 'active' ? '<p>ì•„ì§ ì§„í–‰ ì¤‘ì¸ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p><p>ì•„ë˜ì—ì„œ ìƒˆ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>' : '<p>ì™„ë£Œëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p><p>ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê³  ì™„ë£Œ í‘œì‹œë¥¼ í•´ë³´ì„¸ìš”!</p>'; 
        container.innerHTML = `<div class="empty-goals"><div style="font-size: 48px; margin-bottom: 15px;">ğŸ¯</div>${emptyMessage}</div>`; 
        const addGoalSection = document.querySelector('#personalGoalsPage .modal-input-group');
        if (addGoalSection) { addGoalSection.style.display = currentGoalTab === 'completed' ? 'none' : 'block'; }
        return; 
    } 
    
    container.innerHTML = await Promise.all(goals.map(async goal => {
        const totalAchieved = await calculateTotalAchieved(goal);
        const progressPercentage = goal.type === 'positive' 
            ? Math.min(100, (totalAchieved / goal.totalAmount) * 100)
            : Math.max(0, (1 - totalAchieved / goal.totalAmount) * 100);
        
        const daysLeft = goal.deadline ? Math.max(0, Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24))) : 0;
        
        let statusText = '';
        if (goal.isCompleted) {
            const successEmoji = goal.success ? 'âœ…' : 'âŒ';
            const successText = goal.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
            statusText = `ì™„ë£Œ (${successText} ${successEmoji}) - ${new Date(goal.completedAt).toLocaleDateString('ko-KR')}`;
        } else {
            statusText = `D-${daysLeft} (í•˜ë£¨ ${goal.dailyTarget}${goal.unit})`;
        }
        
        const actionButton = currentGoalTab === 'active' ? 
            `<button class="complete-btn" onclick="completePersonalGoal('${goal.id}')">ì™„ë£Œ</button>` : 
            `<button class="reopen-btn" onclick="reopenPersonalGoal('${goal.id}')">ì¬ê°œ</button>`; 
        
        return `<div class="personal-goal-item">
            <div class="personal-goal-header">
                <div class="personal-goal-name">
                    ${goal.name} ${goal.type === 'negative' ? 'ğŸ‘' : 'ğŸ‘'} 
                    (${totalAchieved}/${goal.totalAmount}${goal.unit} - ${Math.round(progressPercentage)}%)
                </div>
                <div class="personal-goal-actions" style="display:flex; gap:5px;">
                    ${currentGoalTab === 'active' ? `<button class="edit-btn" onclick="editPersonalGoal('${goal.id}')">ìˆ˜ì •</button>` : ''}
                    ${actionButton}
                    <button class="delete-btn" onclick="deletePersonalGoal('${goal.id}')">ì‚­ì œ</button>
                </div>
            </div>
            <small style="color: #666;">${statusText}</small>
        </div>`;
    })).then(results => results.join('')); 
    
    const addGoalSection = document.querySelector('#personalGoalsPage .modal-input-group');
    if (addGoalSection) { addGoalSection.style.display = currentGoalTab === 'completed' ? 'none' : 'block'; }
}

        async function reopenPersonalGoal(goalId) { if (!confirm('ì´ ëª©í‘œë¥¼ ë‹¤ì‹œ ì§„í–‰ ì¤‘ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return; const goals = await getPersonalGoals(); const goal = goals.find(g => g.id === goalId); if (goal) { goal.isCompleted = false; delete goal.completedAt; await dbSet('personalGoals', goals); await renderPersonalGoalsList(); } }
        async function editPersonalGoal(goalId) { const goals = await getPersonalGoals(); const goal = goals.find(g => g.id === goalId); if (!goal) return; const newName = prompt('ëª©í‘œ ì´ë¦„ì„ ìˆ˜ì •í•˜ì„¸ìš”:', goal.name); if (!newName || !newName.trim()) return; const newTarget = prompt('ëª©í‘œëŸ‰ì„ ìˆ˜ì •í•˜ì„¸ìš”:', goal.target); if (!newTarget || isNaN(newTarget) || newTarget <= 0) return; const newUnit = prompt('ë‹¨ìœ„ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”:', goal.unit); if (!newUnit || !newUnit.trim()) return; goal.name = newName.trim(); goal.target = parseInt(newTarget); goal.unit = newUnit.trim(); await dbSet('personalGoals', goals); await renderPersonalGoalsList(); }

        // ëª©í‘œì˜ ì´ ë‹¬ì„±ëŸ‰ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
async function calculateTotalAchieved(goal) {
    const allData = await dbGetAll();
    const startDate = new Date(goal.createdAt);
    const endDate = goal.deadline ? new Date(goal.deadline) : new Date();
    
    let totalAchieved = 0;
    
    for (const item of allData) {
        if (item.key.startsWith('day_')) {
            const dayDate = new Date(item.value.date);
            if (dayDate >= startDate && dayDate <= endDate) {
                const dailyAchieved = item.value.personalGoals?.[goal.id] || 0;
                totalAchieved += dailyAchieved;
            }
        }
    }
    
    return totalAchieved;
}

        // ì˜ˆì‚° ê³„ì‚° í•¨ìˆ˜ ìˆ˜ì • (ë³´ë„ˆìŠ¤ ì˜ˆì‚° í¬í•¨)
async function renderSmallBudgetBarEnhanced() { 
    const budget = await dbGet('monthlyBudget'); 
    const bonusBudget = await dbGet('currentMonthBonusBudget') || 0;
    const totalBudget = (budget || 0) + bonusBudget;
    
    const budgetContainer = document.getElementById('budgetBarSmall'); 
    const budgetFill = document.getElementById('budgetBarFillSmall'); 
    
    if (!totalBudget) { 
        budgetContainer.style.display = 'none'; 
        return; 
    } 
    
    const { start, end } = getMonthDateRange(currentDate); 
    const allData = await dbGetAll(); 
    const expenses = allData.filter(item => item.key.startsWith('expense_') && item.value.date >= start && item.value.date <= end); 
    const totalSpent = expenses.reduce((sum, item) => sum + item.value.amount, 0); 
    const percentage = totalBudget > 0 ? (totalSpent / totalBudget) * 100 : 0; 
    
    let colorClass = 'green'; 
    if (percentage > 100) colorClass = 'black'; 
    else if (percentage > 85) colorClass = 'red'; 
    else if (percentage > 70) colorClass = 'yellow'; 
    
    budgetFill.className = `battery-level ${colorClass}`; 
    budgetFill.style.width = `${Math.min(percentage, 100)}%`; 
    budgetContainer.style.display = 'flex'; 
    
    // íˆ´íŒì— ë³´ë„ˆìŠ¤ ì˜ˆì‚° ì •ë³´ í¬í•¨
    let tooltipText = `ì˜ˆì‚°: ${formatCurrency(budget || 0)}`;
    if (bonusBudget > 0) {
        tooltipText += ` + ë³´ë„ˆìŠ¤: ${formatCurrency(bonusBudget)}`;
    }
    tooltipText += ` / ì§€ì¶œ: ${formatCurrency(totalSpent)}`;
    budgetContainer.title = tooltipText;
}
        async function renderBudgetBar(containerId = 'budgetDetailBar') { const container = document.getElementById(containerId); if (!container) return; container.innerHTML = ''; const budget = await dbGet('monthlyBudget'); if (!budget) return; const { start, end } = getMonthDateRange(currentDate); const allData = await dbGetAll(); const expenses = allData.filter(item => item.key.startsWith('expense_') && item.value.date >= start && item.value.date <= end); const totalSpent = expenses.reduce((sum, item) => sum + item.value.amount, 0); const percentage = budget > 0 ? (totalSpent / budget) * 100 : 0; let colorClass = 'green'; if (percentage > 100) colorClass = 'black'; else if (percentage > 85) colorClass = 'red'; else if (percentage > 70) colorClass = 'yellow'; container.innerHTML = `<div style="width:100%; height:8px; background:#eee; border-radius:4px; overflow:hidden;"><div style="width:${Math.min(percentage, 100)}%; height:100%; background:var(--${colorClass}-color)"></div></div>`; }
        async function renderBudgetPage() { await renderExpenseList(); }
async function renderExpenseList() {
    const container = document.getElementById('expenseList');
    const { start, end } = getMonthDateRange(currentDate);
    const allData = await dbGetAll();
    const budget = await dbGet('monthlyBudget') || 0;
    const expenses = allData
        .filter(item => item.key.startsWith('expense_') && item.value.date >= start && item.value.date <= end)
        .map(item => ({ ...item.value, id: item.key }))
        .sort((a, b) => a.date.localeCompare(b.date));

    if (expenses.length === 0) {
        container.innerHTML = `<div class="empty-expenses"><p>ì´ë²ˆ ë‹¬ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
        return;
    }

    const totalAmount = expenses.reduce((sum, ex) => sum + ex.amount, 0);
    
    // ì˜ìˆ˜ì¦ ìŠ¤íƒ€ì¼ HTML ìƒì„±
    let receiptHTML = `
    <div class="receipt-container">
        <div class="receipt-header">
            <div class="receipt-title">
                <h3>ğŸ§¾ ì˜ìˆ˜ì¦</h3>
                <div class="budget-info">
                    <span>ì˜ˆì‚°: ${formatCurrency(budget || 0)}</span>
                    <span>ì”ì•¡: ${formatCurrency((budget || 0) - totalAmount)}</span>
                </div>
            </div>
            <p>${currentDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' })}</p>
        </div>
`;

    expenses.forEach(ex => {
        const dateObj = new Date(ex.date);
        const formattedDate = `${String(dateObj.getFullYear()).slice(-2)}.${String(dateObj.getMonth() + 1).padStart(2, '0')}.${String(dateObj.getDate()).padStart(2, '0')}`;
        
        receiptHTML += `
            <div class="receipt-item">
                <span class="receipt-date">${formattedDate}</span>
                <span class="receipt-desc">${ex.description}</span>
                <span class="receipt-amount">${formatCurrency(ex.amount)}</span>
            </div>
        `;
    });
    
    receiptHTML += `
            </div>
            <div class="receipt-divider"></div>
            <div class="receipt-total">
                <span>ì´ ì§€ì¶œ</span>
                <span>â‚©${nf.format(totalAmount)}</span>
            </div>
        </div>
    `;

    container.innerHTML = receiptHTML;
}
        async function renderModalExpenses(dateString) { const container = document.getElementById('modalExpenseList'); const allData = await dbGetAll(); const expenses = allData.filter(item => item.key.startsWith('expense_') && item.value.date === dateString).map(item => ({ ...item.value, id: item.key })); if (expenses.length === 0) { container.innerHTML = `<p style="text-align:center; color:#999; font-size:12px; padding:10px 0;">ì˜¤ëŠ˜ ì§€ì¶œ ë‚´ì—­ ì—†ìŒ</p>`; } else { container.innerHTML = expenses.map(ex => `<div class="expense-item"><span>${ex.description}</span><div><span style="margin-right:10px;">${formatCurrency(ex.amount)}</span><button class="expense-delete-btn" style="background:var(--danger-color); border:none; color:white; border-radius:50%; width:18px; height:18px; cursor:pointer;" onclick="deleteExpense('${ex.id}', '${dateString}')">Ã—</button></div></div>`).join(''); } const total = expenses.reduce((sum, ex) => sum + ex.amount, 0); document.getElementById('modalTotalExpense').textContent = `ì˜¤ëŠ˜ ì´ ì§€ì¶œ: ${formatCurrency(total)}`; }
        async function addExpense() { 
            const desc = document.getElementById('expenseDesc').value.trim(); 
            const amount = unformatNumber(document.getElementById('expenseAmount').value); 
            if (!desc || !amount || amount <= 0) return alert('ë‚´ì—­ê³¼ ê¸ˆì•¡ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.'); 
    
            const expenseId = `expense_${Date.now()}`; 
            const expenseData = { date: formatDate(selectedDate), description: desc, amount: amount }; 
            await dbSet(expenseId, expenseData); 
    
            document.getElementById('expenseDesc').value = ''; 
            document.getElementById('expenseAmount').value = ''; 
            await renderModalExpenses(formatDate(selectedDate)); 
            await renderSmallBudgetBarEnhanced(); 
            
            const isFood = foodKeywords.some(keyword => desc.toLowerCase().includes(keyword.toLowerCase()));
            if (isFood) {
                currentFoodExpenseData = { expenseId, expenseData };
                showFoodSuggestion(desc);
            } else {
                await checkBudgetAndShowPopup();
            }
        }
        async function deleteExpense(id, dateString) { 
            if (!confirm('ì´ ì§€ì¶œ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì—°ê´€ëœ ì‹ë‹¨ ê¸°ë¡ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            const allData = await dbGetAll();
            const relatedFoodRecords = allData.filter(item => item.key.startsWith('food_') && item.value.expenseId === id);
            for (const foodRecord of relatedFoodRecords) { await dbDelete(foodRecord.key); }
            await dbDelete(id); 
            await renderModalExpenses(dateString); 
            await renderSmallBudgetBarEnhanced(); 
            if (relatedFoodRecords.length > 0 && document.getElementById('foodPage').classList.contains('active')) {
                await renderFoodRecords();
            }
        }
        
        async function renderDdayDisplay() {
            const ddays = await dbGet('ddayGoals') || [];
            const ddayContainer = document.getElementById('ddayContainer');
            ddayContainer.innerHTML = '';
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            ddays.slice(0, 3).forEach(dday => {
                const targetDate = parseDate(dday.date);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                let displayString = diffDays === 0 ? `${dday.name} D-Day` : diffDays > 0 ? `${dday.name} D-${diffDays}` : `${dday.name} D+${-diffDays}`;
                const chip = document.createElement('div');
                chip.className = 'dday-chip';
                chip.textContent = displayString;
                chip.style.display = 'block';
                ddayContainer.appendChild(chip);
            });
        }
        async function renderDdaySettings() {
            const ddays = await dbGet('ddayGoals') || [];
            const container = document.getElementById('ddaySettingsList');
            container.innerHTML = '';
            ddays.forEach(dday => {
                container.innerHTML += `<div class="dday-item"><span><strong>${dday.name}</strong> (${dday.date})</span><div class="dday-actions"><button onclick="editDday('${dday.id}')" title="ìˆ˜ì •">âœï¸</button><button onclick="deleteDday('${dday.id}')" title="ì‚­ì œ">ğŸ—‘ï¸</button></div></div>`;
            });
            document.getElementById('addDdayBtn').style.display = ddays.length < 3 ? 'block' : 'none';
        }
        async function addDday() { const ddays = await dbGet('ddayGoals') || []; if (ddays.length >= 3) { alert("D-DayëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return; } const name = prompt("D-Dayì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:"); if (!name) return; const date = prompt("ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD í˜•ì‹):"); if (!date || !/^\d{4}-\d{2}-\d{2}$/.test(date)) { alert("ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤."); return; } ddays.push({ id: Date.now().toString(), name: name, date: date }); await dbSet('ddayGoals', ddays); const unlocked = await dbGet('unlockedAchievements') || []; if (!unlocked.includes('ACH_DDAY_SETTER') && ddays.length === 1) { await unlockAchievement('ACH_DDAY_SETTER'); } await renderDdaySettings(); await renderDdayDisplay(); }
        async function editDday(id) { const ddays = await dbGet('ddayGoals') || []; const dday = ddays.find(d => d.id === id); if (!dday) return; const newName = prompt("ìƒˆ D-Day ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", dday.name); if (!newName) return; const newDate = prompt("ìƒˆ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD í˜•ì‹):", dday.date); if (!newDate || !/^\d{4}-\d{2}-\d{2}$/.test(newDate)) { alert("ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤."); return; } dday.name = newName; dday.date = newDate; await dbSet('ddayGoals', ddays); await renderDdaySettings(); await renderDdayDisplay(); }
        async function deleteDday(id) { if (!confirm("ì •ë§ë¡œ ì´ D-Dayë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return; let ddays = await dbGet('ddayGoals') || []; ddays = ddays.filter(d => d.id !== id); await dbSet('ddayGoals', ddays); await renderDdaySettings(); await renderDdayDisplay(); }
        
        async function exportData() { const allData = await dbGetAll(); const exportObject = {}; allData.forEach(item => { exportObject[item.key] = item.value; }); const dataStr = JSON.stringify(exportObject, null, 2); const dataBlob = new Blob([dataStr], {type: 'application/json'}); const url = URL.createObjectURL(dataBlob); const link = document.createElement('a'); link.href = url; link.download = `routine_data_${new Date().toISOString().split('T')[0]}.json`; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); }
        function importData(event) { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = async function(e) { try { const data = JSON.parse(e.target.result); if (!confirm("ì •ë§ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ê¸°ë¡ì´ ë°±ì—… íŒŒì¼ë¡œ ë®ì–´ì“°ì—¬ì§‘ë‹ˆë‹¤.")) { event.target.value = ''; return; } await dbClear(); for (const key in data) { if (Object.hasOwnProperty.call(data, key)) { await dbSet(key, data[key]); } } alert("ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! ì•±ì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤."); location.reload(); } catch (error) { alert("íŒŒì¼ì„ ì½ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."); event.target.value = ''; } }; reader.readAsText(file); }

        function openExcelModal() { document.getElementById('excelExportModal').style.display = 'flex'; }
        function closeExcelModal() { document.getElementById('excelExportModal').style.display = 'none'; }
        function toggleDateInputs(show) { document.getElementById('customDateRange').style.display = show ? 'flex' : 'none'; }
        
        // ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ê¸°ë¡ ë³´ê¸° í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
        async function showCommentHistory() { showPage('commentHistoryPage'); await renderCommentHistory(); }

// ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ê¸€ì ìˆ˜ ì¹´ìš´í„° ë° ìƒ‰ìƒ ë³€ê²½ í•¨ìˆ˜
function updateCommentCounter() {
    const commentInput = document.getElementById('modalComment');
    const counter = document.getElementById('commentCharCounter');
    
    const currentLength = commentInput.value.length;
    const maxLength = commentInput.maxLength;
    counter.textContent = `${currentLength}/${maxLength}`;

    if (currentLength >= maxLength) {
        commentInput.style.borderColor = 'var(--danger-color)';
        counter.style.color = 'var(--danger-color)';
    } else if (currentLength >= 400) {
        commentInput.style.borderColor = 'var(--warning-color)';
        counter.style.color = 'var(--warning-color)';
    } else {
        commentInput.style.borderColor = 'var(--border-color)';
        counter.style.color = 'var(--text-color-light)';
    }
}

// ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ê¸°ë¡ì„ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
async function renderCommentHistory() {
    const container = document.getElementById('commentHistoryList');
    const allData = await dbGetAll();
    const comments = allData
        .filter(item => item.key.startsWith('day_') && item.value.comment)
        .map(item => item.value)
        .sort((a, b) => b.date.localeCompare(a.date));

    if (comments.length === 0) {
        container.innerHTML = `<div class="empty-comments"><p>ì•„ì§ ê¸°ë¡ëœ í•œë§ˆë””ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
        return;
    }

    container.innerHTML = comments.map(day => {
        const dateObj = parseDate(day.date);
        const formattedDate = dateObj.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        // HTML Injectionì„ ë§‰ê¸° ìœ„í•´ í…ìŠ¤íŠ¸ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
        const safeComment = document.createElement('div');
        safeComment.innerText = day.comment;

        return `
            <div class="comment-item">
                <div class="comment-item-header">${formattedDate}</div>
                <div class="comment-item-body">${safeComment.innerHTML.replace(/\n/g, '<br>')}</div>
            </div>
        `;
    }).join('');
}
        
async function exportToExcel() {
    alert('ì—‘ì…€ íŒŒì¼ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ë°ì´í„° ì–‘ì— ë”°ë¼ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    const period = document.querySelector('input[name="period"]:checked').value;
    let startDate, endDate;
    const today = new Date();
    
    switch (period) {
        case 'thisMonth': startDate = new Date(today.getFullYear(), today.getMonth(), 1); endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0); break;
        case 'lastMonth': startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1); endDate = new Date(today.getFullYear(), today.getMonth(), 0); break;
        case 'custom': startDate = document.getElementById('startDate').value ? new Date(document.getElementById('startDate').value) : null; endDate = document.getElementById('endDate').value ? new Date(document.getElementById('endDate').value) : null; if (!startDate || !endDate) { alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; } endDate.setHours(23, 59, 59, 999); break;
        default: startDate = new Date('1970-01-01'); endDate = new Date('2999-12-31'); break;
    }
    
    const startDateStr = formatDate(startDate);
    const endDateStr = formatDate(endDate);

    const allData = await dbGetAll();
    const routineData = allData.filter(item => item.key.startsWith('day_') && item.value.date >= startDateStr && item.value.date <= endDateStr).map(item => item.value);
    const expenseData = allData.filter(item => item.key.startsWith('expense_') && item.value.date >= startDateStr && item.value.date <= endDateStr).map(item => item.value);

    // 'ì˜¤ëŠ˜ì˜ í•œë§ˆë””' í—¤ë” ì¶”ê°€
    const sheet1Headers = ['ë‚ ì§œ (ìš”ì¼)', 'ì ìˆ˜', 'ê°œì¸ëª©í‘œ(%)', 'ê¸°ìƒ ì‹œê°„', 'ì°©ì„ ì‹œê°„', 'ì·¨ì¹¨ ì‹œê°„', 'ì´ ë½€ëª¨ë„ë¡œ', 'ìš´ë™ ì—¬ë¶€', 'ìš´ë™ ì‹œê°„(ë¶„)', 'ê¸€ì“°ê¸°(ì)', 'ê²Œì„ ì‹œê°„(ë¶„)', 'íœ´ì‹ì¼', 'ì˜¤ëŠ˜ì˜ í•œë§ˆë””', 'ê²½ê³ '];
    const sheet1Rows = [sheet1Headers];
    for (const day of routineData.sort((a,b) => a.date.localeCompare(b.date))) {
        const dateObj = parseDate(day.date);
        const dayOfWeek = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][dateObj.getDay()];
        let warnings = [];
        if (!day.isOffDay && day.score < 40) warnings.push('ì ìˆ˜ ë¯¸í¡');
        if (day.gameTime > 120) warnings.push('ê²Œì„ ì´ˆê³¼');

        // 'ì˜¤ëŠ˜ì˜ í•œë§ˆë””' ë°ì´í„° í–‰ ì¶”ê°€
        sheet1Rows.push([ 
            `${day.date} (${dayOfWeek})`, 
            day.score, 
            await calculatePersonalGoalAverage(day, day.date) + '%', 
            day.wakeTime || '', 
            day.seatTime || '', 
            day.sleepTime || '', 
            (day.pomodoro?.morning || 0) + (day.pomodoro?.afternoon || 0) + (day.pomodoro?.evening || 0), 
            day.exercise?.done ? 'O' : 'X', 
            day.exercise?.minutes || 0, 
            day.writing || 0, 
            day.gameTime || 0, 
            day.isOffDay ? 'O' : '',
            day.comment || '',
            warnings.join(', ') 
        ]);
    }

    const monthlyBudget = await dbGet('monthlyBudget') || 0;
    const totalSpent = expenseData.reduce((sum, ex) => sum + ex.amount, 0);
    const budgetRate = monthlyBudget > 0 ? ((totalSpent / monthlyBudget) * 100).toFixed(1) + '%' : 'N/A';
    const sheet2Summary = [ ['ì¡°íšŒ ê¸°ê°„', `${startDateStr} ~ ${endDateStr}`], ['ì›” ì„¤ì • ì˜ˆì‚°', `â‚©${nf.format(monthlyBudget)}`], ['ì´ ì§€ì¶œ', `â‚©${nf.format(totalSpent)}`], ['ì˜ˆì‚° ë‹¬ì„±ë¥ ', budgetRate], [] ];
    const sheet2Headers = ['ë‚ ì§œ', 'ì§€ì¶œ ë‚´ì—­', 'ê¸ˆì•¡'];
    const sheet2Rows = expenseData.sort((a,b) => a.date.localeCompare(b.date)).map(ex => [ex.date, ex.description, ex.amount]);
    
    const wb = XLSX.utils.book_new();
    const ws1 = XLSX.utils.aoa_to_sheet(sheet1Rows);
    const ws2 = XLSX.utils.aoa_to_sheet(sheet2Summary);
    XLSX.utils.sheet_add_aoa(ws2, [sheet2Headers, ...sheet2Rows], { origin: 'A6' });
    
    ws1['!cols'] = sheet1Headers.map(h => ({ wch: h.length > 10 ? 20 : 12 }));
    // ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ì»¬ëŸ¼ ë„“ê²Œ ì„¤ì • (12ë²ˆ ì»¬ëŸ¼)
    if (ws1['!cols'][12]) ws1['!cols'][12].wch = 50; 

    ws2['!cols'] = [{wch: 15}, {wch: 30}, {wch: 15}];

    XLSX.utils.book_append_sheet(wb, ws1, 'ì¢…í•© ë£¨í‹´ ê¸°ë¡');
    XLSX.utils.book_append_sheet(wb, ws2, 'ê°€ê³„ë¶€');

    XLSX.writeFile(wb, `ë£¨í‹´íŠ¸ë˜ì»¤_ê¸°ë¡_${formatDate(new Date())}.xlsx`);
    closeExcelModal();
    unlockAchievement('ACH_EXCEL_GURU');
}

        let editingFoodRecordId = null; 

        function showFoodSuggestion(expenseDesc) {
            document.getElementById('foodNameInput').value = expenseDesc;
            document.getElementById('foodQuantityInput').value = '1';
            document.getElementById('foodSuggestionModal').style.display = 'flex';
        }
        function closeFoodSuggestion() { document.getElementById('foodSuggestionModal').style.display = 'none'; }
        async function saveFoodRecord() {
            const foodName = document.getElementById('foodNameInput').value.trim();
            const quantity = document.getElementById('foodQuantityInput').value.trim();
            const unit = document.getElementById('foodUnitSelect').value;
            if (!foodName || !quantity) return alert('ìŒì‹ ì´ë¦„ê³¼ ì–‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            const recordDate = currentFoodExpenseData?.expenseData?.date;
            if (!recordDate) return alert('ì˜¤ë¥˜: ì‹ë‹¨ì„ ê¸°ë¡í•  ë‚ ì§œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            
            const foodRecord = {
                id: `food_${Date.now()}`, date: recordDate, time: new Date().toTimeString().slice(0, 5),
                foodName, quantity, unit, expenseId: currentFoodExpenseData?.expenseId || null
            };
            await dbSet(foodRecord.id, foodRecord);
            await checkFoodRecordAchievements();
            const todayData = await getDayData(new Date());
            await checkAndUpdateAllQuests(todayData, new Date());
            closeFoodSuggestion();
            alert('ì‹ë‹¨ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ½ï¸');
            if (document.getElementById('foodPage').classList.contains('active')) await renderFoodRecords();
        
            const today = new Date();
            if (today.getDay() === 0) { // ì¼ìš”ì¼
            await checkWeekEndAchievements(today);
            }
        }

        function getFoodEmoji(foodName) {
            const lowerFoodName = foodName.toLowerCase();
            const emojiKeywordMap = {
                'â˜•': ['ì»¤í”¼', 'ì•„ë©”ë¦¬ì¹´ë…¸', 'ë¼ë–¼', 'ì¹´í‘¸ì¹˜ë…¸', 'ì—ìŠ¤í”„ë ˆì†Œ'], 'ğŸ¥¤': ['ìŠ¤ë¬´ë””', 'ìë°”ì¹©', 'í”„ë¼í‘¸ì¹˜ë…¸', 'í”„ë¼í˜', 'ì£¼ìŠ¤', 'ì—ì´ë“œ', 'ì½œë¼', 'ì‚¬ì´ë‹¤', 'íƒ„ì‚°'], 'ğŸ§‹': ['ë²„ë¸”í‹°', 'ë°€í¬í‹°'], 'ğŸ': ['ë¹µ', 'ë² ì´ê¸€', 'í† ìŠ¤íŠ¸'], 'ğŸ¥': ['í¬ë¡œì™€ìƒ', 'ë² ì´ì»¤ë¦¬', 'íŒŒì´'], 'ğŸ©': ['ë„ë„›', 'ë˜í‚¨'], 'ğŸ•': ['í”¼ì'], 'ğŸ”': ['í–„ë²„ê±°', 'ë²„ê±°'], 'ğŸ—': ['ì¹˜í‚¨', 'ë‹­ê°•ì •', 'ìœ™'], 'ğŸ¥—': ['ìƒëŸ¬ë“œ'], 'ğŸ¦': ['ì•„ì´ìŠ¤í¬ë¦¼', 'ì ¤ë¼ë˜', 'ë¹™ìˆ˜'], 'ğŸ°': ['ì¼€ì´í¬', 'ì¡°ê°ì¼€ìµ', 'íƒ€ë¥´íŠ¸'], 'ğŸ™': ['ê¹€ë°¥', 'ì£¼ë¨¹ë°¥'], 'ğŸœ': ['ë¼ë©´', 'êµ­ìˆ˜', 'ìš°ë™'], 'ğŸ¥˜': ['ë§ˆë¼íƒ•'], 'ğŸ': ['íŒŒìŠ¤íƒ€', 'ìŠ¤íŒŒê²Œí‹°'], 'ğŸ¢': ['ë–¡ë³¶ì´', 'ì˜¤ë…', 'ì–´ë¬µ'], 'ğŸ£': ['ìŠ¤ì‹œ', 'ì´ˆë°¥', 'íšŒ'], 'ğŸ¿': ['ìŠ¤ë‚µ', 'ê³¼ì', 'íŒì½˜', 'ê°ìì¹©', 'ë²„í„°ì¹©'], 'ğŸ¹': ['ì¹µí…Œì¼'], 'ğŸº': ['ë§¥ì£¼', 'ìˆ '], 'ğŸ¤': ['íŠ€ê¹€', 'ëˆê¹ŒìŠ¤', 'ëˆê°€ìŠ¤', 'ì¹´ì¸ ', 'íƒ•ìˆ˜ìœ¡'], 'ğŸš': ['í•œì‹', 'ì§‘ë°¥'], 'ğŸ›': ['ë®ë°¥', 'ì¹´ë ˆ'], 'ğŸ«': ['ì´ˆì½œë¦¿'], 'ğŸ¬': ['ìº”ë””'], 'ğŸ ': ['ê°„ì‹'], 'ğŸª': ['ì¿ í‚¤']
            };
            let lastMatch = { emoji: 'ğŸ½ï¸', position: -1 };
            for (const [emoji, keywords] of Object.entries(emojiKeywordMap)) {
                for (const keyword of keywords) {
                    const currentPosition = lowerFoodName.lastIndexOf(keyword);
                    if (currentPosition > -1 && currentPosition > lastMatch.position) {
                        lastMatch = { emoji: emoji, position: currentPosition };
                    }
                }
            }
            return lastMatch.emoji;
        }

        async function showFoodPage() {
            showPage('foodPage');
            foodManageMode = false;
            const btn = document.getElementById('foodManageBtn');
            btn.textContent = 'ğŸ”§ ê´€ë¦¬';
            btn.classList.remove('danger');
            document.getElementById('foodRecordsList').classList.remove('admin-mode');
            await renderFoodRecords();
        }

        async function renderFoodRecords() {
            const container = document.getElementById('foodRecordsList');
            container.innerHTML = '';
            const allData = await dbGetAll();
            const foodRecords = allData.filter(item => item.key.startsWith('food_')).map(item => item.value).sort((a, b) => new Date(`${b.date}T${b.time || '00:00'}`) - new Date(`${a.date}T${a.time || '00:00'}`));

            if (foodRecords.length === 0) {
                container.innerHTML = `<div class="empty-goals" style="margin-top: 20px;"><div style="font-size: 48px; margin-bottom: 15px;">ğŸ¥—</div><p>ì•„ì§ ê¸°ë¡ëœ ì‹ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤.</p><p>ìœ„ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•´ë³´ì„¸ìš”!</p></div>`;
                return;
            }

            const groupedRecords = foodRecords.reduce((acc, record) => { (acc[record.date] = acc[record.date] || []).push(record); return acc; }, {});
            let finalHtml = '';
            Object.keys(groupedRecords).sort().reverse().forEach(date => {
                const dateObj = parseDate(date);
                const dayOfWeek = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][dateObj.getDay()];
                finalHtml += `<div class="food-date-header"><span>${date} (${dayOfWeek})</span></div>`;
                groupedRecords[date].forEach(record => {
                    finalHtml += `
                        <div class="food-record-item">
                            <div class="food-time">${record.time}</div>
                            <div class="food-emoji">${getFoodEmoji(record.foodName)}</div>
                            <div class="food-name">${record.foodName}</div>
                            <div class="food-quantity">${record.quantity}${record.unit}</div>
                            <div class="food-admin-actions">
                                <button class="edit" onclick="editFoodRecord('${record.id}')">âœï¸</button>
                                <button class="delete" onclick="deleteFoodRecord('${record.id}')">ğŸ—‘ï¸</button>
                            </div>
                        </div>`;
                });
            });
            container.innerHTML = finalHtml;
        }

        function showAddFoodModal() {
            editingFoodRecordId = null;
            document.getElementById('manualFoodModalTitle').textContent = 'ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡ ì¶”ê°€';
            const today = new Date();
            document.getElementById('manualFoodDate').value = formatDate(today);
            document.getElementById('manualFoodTime').value = today.toTimeString().slice(0, 5);
            document.getElementById('manualFoodName').value = '';
            document.getElementById('manualFoodQuantity').value = '1';
            document.getElementById('manualFoodUnit').selectedIndex = 0;
            document.getElementById('manualFoodModal').style.display = 'flex';
        }

        async function editFoodRecord(recordId) {
            editingFoodRecordId = recordId;
            const record = await dbGet(recordId);
            if (!record) return alert('ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            document.getElementById('manualFoodModalTitle').textContent = 'ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡ ìˆ˜ì •';
            document.getElementById('manualFoodDate').value = record.date;
            document.getElementById('manualFoodTime').value = record.time;
            document.getElementById('manualFoodName').value = record.foodName;
            document.getElementById('manualFoodQuantity').value = record.quantity;
            document.getElementById('manualFoodUnit').value = record.unit;
            document.getElementById('manualFoodModal').style.display = 'flex';
        }

        function closeManualFoodModal() { document.getElementById('manualFoodModal').style.display = 'none'; editingFoodRecordId = null; }
        async function saveManualFoodRecord() {
            const date = document.getElementById('manualFoodDate').value;
            const time = document.getElementById('manualFoodTime').value;
            const foodName = document.getElementById('manualFoodName').value.trim();
            const quantity = document.getElementById('manualFoodQuantity').value.trim();
            const unit = document.getElementById('manualFoodUnit').value;
            if (!date || !time || !foodName || !quantity) return alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            
            const dateObject = new Date(date);
            if (dateObject.getDay() === 0) { 
            await checkWeekEndAchievements(dateObject); }

            const recordId = editingFoodRecordId || `food_${Date.now()}`;
            const foodRecord = { id: recordId, date, time, foodName, quantity, unit, expenseId: null };
            
            await dbSet(recordId, foodRecord);
            await checkFoodRecordAchievements();
            const dayDataForQuest = await getDayData(dateObject);
            await checkAndUpdateAllQuests(dayDataForQuest, dateObject);
            closeManualFoodModal();
            alert(`ì‹ë‹¨ì´ ${editingFoodRecordId ? 'ìˆ˜ì •' : 'ê¸°ë¡'}ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ½ï¸`);
            await renderFoodRecords();
        }

        function toggleFoodManageMode() {
    foodManageMode = !foodManageMode;
    const btn = document.getElementById('foodManageBtn');
    const listContainer = document.getElementById('foodRecordsList');
    const lang = LANGUAGE_DATA[currentLanguage];
    
    if (foodManageMode) {
        btn.textContent = lang.manageModeEnd;
        btn.classList.add('danger');
        listContainer.classList.add('admin-mode');
    } else {
        btn.textContent = lang.manageMode;
        btn.classList.remove('danger');
        listContainer.classList.remove('admin-mode');
    }
}

        async function deleteFoodRecord(recordId) {
            if (!confirm('ì´ ì‹ë‹¨ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            await dbDelete(recordId);
            await renderFoodRecords();
        }

        function closeFoodExportModal() { document.getElementById('foodExportModal').style.display = 'none'; }
        async function exportFoodAsImage() {
            const startDateStr = prompt("ë‚´ë³´ë‚´ê¸° ì‹œì‘ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD)", formatDate(new Date(currentDate.getFullYear(), currentDate.getMonth(), 1)));
            if (!startDateStr) return;
            const endDateStr = prompt("ë‚´ë³´ë‚´ê¸° ì¢…ë£Œ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD)", formatDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0)));
            if (!endDateStr) return;
            
            const allData = await dbGetAll();
            const foodRecords = allData
                .filter(item => item.key.startsWith('food_') && item.value.date >= startDateStr && item.value.date <= endDateStr)
                .map(item => item.value)
                .sort((a, b) => new Date(`${a.date}T${a.time || '00:00'}`) - new Date(`${b.date}T${b.time || '00:00'}`));

            if (foodRecords.length === 0) {
                alert("í•´ë‹¹ ê¸°ê°„ì— ê¸°ë¡ëœ ì‹ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            const previewContainer = document.getElementById('foodExportPreview');
            const groupedRecords = foodRecords.reduce((acc, record) => {
                (acc[record.date] = acc[record.date] || []).push(record);
                return acc;
            }, {});

            // ê¸°ì¡´ html ìƒì„± ë¶€ë¶„ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  ì•„ë˜ë¡œ êµì²´
        let html = `
        <div class="food-receipt-header">
            <div class="food-receipt-title">
                <h3>ğŸ½ï¸ ë‚˜ì˜ ì‹ë‹¨ ê¸°ë¡</h3>
            </div>
            <p>${startDateStr} ~ ${endDateStr}</p>
        </div>
        <div class="food-receipt-divider"></div>
        <div class="food-receipt-items">`;

        Object.keys(groupedRecords).sort().forEach(date => {
            const dateObj = parseDate(date);
            const dayOfWeek = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][dateObj.getDay()];
            html += `<div class="food-receipt-date-header">${date} (${dayOfWeek})</div>`;
            groupedRecords[date].forEach(record => {
                html += `
                    <div class="food-receipt-item">
                        <span class="food-receipt-time">${record.time}</span>
                        <span class="food-receipt-desc">${getFoodEmoji(record.foodName)} ${record.foodName}</span>
                        <span class="food-receipt-quantity">${record.quantity}${record.unit}</span>
                    </div>`;
            });
        });

        html += `</div>`;
        previewContainer.innerHTML = html;
        document.getElementById('foodExportModal').style.display = 'flex';
        }

        // =======================================================================
        // í€˜ìŠ¤íŠ¸ & ë ˆë²¨ ì‹œìŠ¤í…œ
        // =======================================================================

        let currentQuestTab = 'daily';

        // í€˜ìŠ¤íŠ¸ í˜ì´ì§€ í‘œì‹œ
        function showQuestPage() { document.getElementById('profileMenu').style.display = 'none'; showPage('questPage'); renderQuestPage(); }

        // í€˜ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™ (ëª¨ë‹¬ì—ì„œ)
        function openQuestPage() { closeDailyQuestModal(); showQuestPage(); }

        // í€˜ìŠ¤íŠ¸ íƒ­ ì „í™˜
        function switchQuestTab(tabName) {
            currentQuestTab = tabName;
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.quest-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.quest-tab[onclick="switchQuestTab('${tabName}')"]`).classList.add('active');
            
            // íƒ­ ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
            document.querySelectorAll('.quest-tab-content').forEach(content => content.style.display = 'none');
            document.getElementById(`${tabName}QuestTab`).style.display = 'block';
            
            // í•´ë‹¹ íƒ­ í€˜ìŠ¤íŠ¸ ë Œë”ë§
            renderQuestTab(tabName);
        }

        // í€˜ìŠ¤íŠ¸ í˜ì´ì§€ ë Œë”ë§
        async function renderQuestPage() { await updateProfileWidget(); switchQuestTab(currentQuestTab); }

        // ê° íƒ­ì˜ í€˜ìŠ¤íŠ¸ ë Œë”ë§
        async function renderQuestTab(tabName) {
            const container = document.getElementById(`${tabName}QuestList`);
            
            switch(tabName) {
                case 'daily':
                    await renderDailyQuests(container);
                    break;
                case 'weekly':
                    await renderWeeklyQuests(container);
                    break;
                case 'monthly':
                    await renderMonthlyQuests(container);
                    break;
            }
        }

// ì¼ê°„ í€˜ìŠ¤íŠ¸ ë Œë”ë§ (ì‹¤ì œ ë°ì´í„°)
async function renderDailyQuests(container) {
    const today = new Date();
    const questData = await getDailyQuests(today);
    
    let html = '';
    
    for (const quest of questData.quests) {
        const progressPercentage = quest.maxProgress > 0 ? (quest.progress / quest.maxProgress) * 100 : 0;
        const completedClass = quest.completed ? 'completed' : '';
        
        html += `
            <div class="quest-item ${completedClass}">
                <div class="quest-header">
                    <div class="quest-title">${quest.title}</div>
                    <div class="quest-reward">+${quest.reward} EXP</div>
                </div>
                <div class="quest-desc">${quest.desc}</div>
                <div class="quest-progress">
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" style="width: ${Math.min(progressPercentage, 100)}%"></div>
                    </div>
                    <div class="quest-progress-text">${quest.progress}/${quest.maxProgress}</div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

        // ì£¼ê°„ í€˜ìŠ¤íŠ¸ ë Œë”ë§ (ì‹¤ì œ ë°ì´í„°)
async function renderWeeklyQuests(container) {
    const today = new Date();
    const questData = await getWeeklyQuests(today);
    
    let html = '';
    
    for (const quest of questData.quests) {
        const progressPercentage = quest.maxProgress > 0 ? (quest.progress / quest.maxProgress) * 100 : 0;
        const completedClass = quest.completed ? 'completed' : '';
        
        // ì§„í–‰ë„ í…ìŠ¤íŠ¸ í¬ë§·íŒ…
        let progressText = `${quest.progress}/${quest.maxProgress}`;
        if (quest.id === 'weekly_writing_8000') {
            progressText = `${quest.progress.toLocaleString()}/${quest.maxProgress.toLocaleString()}ì`;
        } else if (quest.id === 'weekly_pomodoro_25') {
            progressText = `${quest.progress}/${quest.maxProgress}ê°œ`;
        } else if (quest.id === 'weekly_exercise_4times') {
            progressText = `${quest.progress}/${quest.maxProgress}íšŒ`;
        } else if (quest.id === 'weekly_expense_under_100k') {
            progressText = quest.completed ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘';
        } else if (quest.id === 'weekly_personal_goal_avg_70') {
            progressText = quest.completed ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';
        }
        
        html += `
            <div class="quest-item ${completedClass}">
                <div class="quest-header">
                    <div class="quest-title">${quest.title}</div>
                    <div class="quest-reward">+${quest.reward} EXP</div>
                </div>
                <div class="quest-desc">${quest.desc}</div>
                <div class="quest-progress">
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" style="width: ${Math.min(progressPercentage, 100)}%"></div>
                    </div>
                    <div class="quest-progress-text">${progressText}</div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

        // ì›”ê°„ í€˜ìŠ¤íŠ¸ ë Œë”ë§ (ì‹¤ì œ ë°ì´í„°)
async function renderMonthlyQuests(container) {
    const today = new Date();
    const questData = await getMonthlyQuests(today);
    
    let html = '';
    
    for (const quest of questData.quests) {
        const progressPercentage = quest.maxProgress > 0 ? (quest.progress / quest.maxProgress) * 100 : 0;
        const completedClass = quest.completed ? 'completed' : '';
        
        // ì§„í–‰ë„ í…ìŠ¤íŠ¸ í¬ë§·íŒ…
        let progressText = `${quest.progress}/${quest.maxProgress}`;
        if (quest.id === 'monthly_writing_80k') {
            progressText = `${quest.progress.toLocaleString()}/${quest.maxProgress.toLocaleString()}ì`;
        } else if (quest.id === 'monthly_exercise_15times') {
            progressText = `${quest.progress}/${quest.maxProgress}íšŒ`;
        } else if (quest.id === 'monthly_perfect_attendance') {
            progressText = `${quest.progress}/${quest.maxProgress}ì¼`;
        } else if (quest.id === 'monthly_consistent_seat_time_input') {
            progressText = `${quest.progress}/${quest.maxProgress}ì¼`;
        } else if (quest.id === 'monthly_consistent_sleep_input') {
            progressText = `${quest.progress}/${quest.maxProgress}ì¼`;
        } else if (quest.id === 'monthly_early_bird_15times') {
            progressText = `${quest.progress}/${quest.maxProgress}ì¼`;
        } else if (quest.id === 'monthly_high_score_15days') {
            progressText = `${quest.progress}/${quest.maxProgress}ì¼`;
        } else if (quest.id === 'monthly_budget_50percent' || quest.id === 'monthly_no_game_entire_month' || quest.id === 'monthly_personal_goal_avg_70') {
            progressText = quest.completed ? 'ë‹¬ì„±' : 'ë¯¸ë‹¬ì„±';
        }
        
        html += `
            <div class="quest-item ${completedClass}">
                <div class="quest-header">
                    <div class="quest-title">${quest.title}</div>
                    <div class="quest-reward">+${quest.reward} EXP</div>
                </div>
                <div class="quest-desc">${quest.desc}</div>
                <div class="quest-progress">
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" style="width: ${Math.min(progressPercentage, 100)}%"></div>
                    </div>
                    <div class="quest-progress-text">${progressText}</div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// í”„ë¡œí•„ ìœ„ì ¯ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°ì´í„°)
async function updateProfileWidget() {
    const userData = await getUserLevelData();
    const profileInfo = getProfileInfo(userData.level);
    
    const expPercentage = userData.maxExp > 0 ? (userData.currentExp / userData.maxExp) * 100 : 0;
    
    document.getElementById('profileLevel').textContent = `Lv.${userData.level}`;
    document.getElementById('profileTitle').textContent = profileInfo.title;
    document.getElementById('profileEmoji').textContent = profileInfo.emoji;
    document.getElementById('expBar').style.width = `${expPercentage}%`;
    document.getElementById('expText').textContent = `${userData.currentExp}/${userData.maxExp}`;
    
    // ì„œë¸Œíƒ€ì´í‹€ì´ ìˆìœ¼ë©´ íˆ´íŒìœ¼ë¡œ í‘œì‹œ
    if (profileInfo.subtitle) {
        const titleElement = document.getElementById('profileTitle');
        titleElement.title = profileInfo.subtitle;
        titleElement.style.cursor = 'help';
    }
}

        // ì¼ê°„ í€˜ìŠ¤íŠ¸ ëª¨ë‹¬ í‘œì‹œ
        function showDailyQuestModal() {
            document.getElementById('dailyQuestModal').style.display = 'flex';
            renderDailyQuests(document.getElementById('dailyQuestModalList'));
        }

        // ì¼ê°„ í€˜ìŠ¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
        async function closeDailyQuestModal(declined = false) {
            if (declined) {
            const todayStr = formatDate(new Date());
            await dbSet(`questDeclined_${todayStr}`, true);
        }
        document.getElementById('dailyQuestModal').style.display = 'none';
        }

        // ê¸°ì¡´ ë¯¸ì…˜ ê´€ë ¨ í•¨ìˆ˜ë“¤ì„ í€˜ìŠ¤íŠ¸ë¡œ ëŒ€ì²´
        async function triggerDailyQuests() {
            const todayStr = formatDate(new Date());
            const questDeclinedToday = await dbGet(`questDeclined_${todayStr}`);
            
            if (questDeclinedToday) return;

            // 30% í™•ë¥ ë¡œ ì¼ê°„ í€˜ìŠ¤íŠ¸ ëª¨ë‹¬ í‘œì‹œ
            if (Math.random() < 0.3) {
                setTimeout(() => {
                    showDailyQuestModal();
                }, 2000); // 2ì´ˆ í›„ì— í‘œì‹œ
            }
        }

        // ì›”ë§ ë³´ë„ˆìŠ¤ ì˜ˆì‚° ì´ˆê¸°í™”
async function resetMonthlyBonusBudget() {
    const today = new Date();
    if (today.getDate() === 1) {
        await dbDelete('currentMonthBonusBudget');
    }
}

// ì•± ì´ˆê¸°í™” ì‹œ íŠ¹ë³„í•œ ë‚  ì²´í¬
async function initEnhancedApp() { await loadUserSettings(); 
    await checkRoutineKingDay();
    await checkCompleteFreedomDay();
    await resetMonthlyBonusBudget();
    
    // ê¸°ì¡´ initApp ë¡œì§ ì‹¤í–‰
    await initApp();
}

        // =======================================================================
        // ê²Œì„ ì‹œìŠ¤í…œ ë¡œì§
        // =======================================================================

        const ACHIEVEMENTS_LIST = {
            'ACH_FIRST_STEP': { name: "ì²«ê±¸ìŒ", desc: "ì²« ë£¨í‹´ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤." },
            'ACH_CONSISTENCY_7': { name: "ì„±ì‹¤ì˜ ì¦í‘œ (ë¸Œë¡ ì¦ˆ)", desc: "7ì¼ ì—°ì†ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_CONSISTENCY_30': { name: "ì„±ì‹¤ì˜ ì¦í‘œ (ì‹¤ë²„)", desc: "30ì¼ ì—°ì†ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_CONSISTENCY_100': { name: "ì„±ì‹¤ì˜ ì¦í‘œ (ê³¨ë“œ)", desc: "100ì¼ ì—°ì†ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERFECT_MONTH': { name: "ì›”ê°„ ê°œê·¼ìƒ", desc: "í•œ ë‹¬ì˜ ëª¨ë“  ë‚ ì— ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_100TH_RECORD': { name: "100ë²ˆì§¸ ê¸°ë¡", desc: "í†µì‚° 100ë²ˆì§¸ ë‚ ì˜ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_FIRST_SEAT': { name: "ì²« ì°©ì„ ê¸°ë¡", desc: "ì²« ì°©ì„ ì‹œê°„ì„ ì„±ê³µì ìœ¼ë¡œ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PUNCTUAL_SEATER_5': { name: "ì•„ì¹¨ ì°©ì„ ìŠµê´€ (ë¸Œë¡ ì¦ˆ)", desc: "5ì¼ ì—°ì†ìœ¼ë¡œ ì˜¤ì „ 9ì‹œê¹Œì§€ ì°©ì„ ì‹œê°„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PUNCTUAL_SEATER_30': { name: "ì•„ì¹¨ ì°©ì„ ìŠµê´€ (ì‹¤ë²„)", desc: "30ì¼ ì—°ì†ìœ¼ë¡œ ì˜¤ì „ 9ì‹œê¹Œì§€ ì°©ì„ ì‹œê°„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_PUNCTUAL_SEATER_100': { name: "ì°©ì„ ìŠµê´€ì˜ ì™•", desc: "ëˆ„ì  100ì¼ ë™ì•ˆ ì˜¤ì „ 9ì‹œê¹Œì§€ ì°©ì„ ì‹œê°„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_PUNCTUAL_SEATER_365': { name: "ì°©ì„ì˜ ì‹ ", desc: "ëˆ„ì  365ì¼ ë™ì•ˆ ì˜¤ì „ 9ì‹œê¹Œì§€ ì°©ì„ ì‹œê°„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_10': { name: "ë½€ëª¨ë„ë¡œ ì…ë¬¸ì", desc: "í†µì‚° ë½€ëª¨ë„ë¡œ 10ê°œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_50': { name: "ë½€ëª¨ë„ë¡œ ì´ˆê¸‰ì", desc: "í†µì‚° ë½€ëª¨ë„ë¡œ 50ê°œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_120': { name: "ë½€ëª¨ë„ë¡œ ì¤‘ê¸‰ì", desc: "í†µì‚° ë½€ëª¨ë„ë¡œ 120ê°œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_200': { name: "ë½€ëª¨ë„ë¡œ ìˆ™ë ¨ì", desc: "í†µì‚° ë½€ëª¨ë„ë¡œ 200ê°œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_320': { name: "ë½€ëª¨ë„ë¡œ ìƒê¸‰ì", desc: "í†µì‚° ë½€ëª¨ë„ë¡œ 320ê°œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_500': { name: "ë½€ëª¨ë„ë¡œ ì „ë¬¸ê°€", desc: "í†µì‚° ë½€ëª¨ë„ë¡œ 500ê°œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_POMO_GOD': { name: "ì§‘ì¤‘ì˜ í™”ì‹ ", desc: "í•˜ë£¨ì— ë½€ëª¨ë„ë¡œ 15ê°œ ì´ìƒì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_WRITER_1': { name: "ì‹ ì¸ ì‘ê°€", desc: "ê¸€ì“°ê¸° ëˆ„ì  12ë§Œ ìë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_WRITER_5': { name: "ë– ì˜¤ë¥´ëŠ” ì‹ ì¸ ì‘ê°€", desc: "ê¸€ì“°ê¸° ëˆ„ì  60ë§Œ ìë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_WRITER_10': { name: "ìœ„ëŒ€í•œ ì‘ê°€", desc: "ê¸€ì“°ê¸° ëˆ„ì  120ë§Œ ìë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_WRITER_20': { name: "ìœ ëª… ì‘ê°€", desc: "ê¸€ì“°ê¸° ëˆ„ì  240ë§Œ ìë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_WRITER_50': { name: "ë² ìŠ¤íŠ¸ì…€ëŸ¬ ì‘ê°€", desc: "ê¸€ì“°ê¸° ëˆ„ì  600ë§Œ ìë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_WRITING_GOD': { name: "ì¼í•„íœ˜ì§€", desc: "í•˜ë£¨ì— ê¸€ì“°ê¸° 10,000ì ì´ìƒì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_DIGITAL_DETOX': { name: "ë””ì§€í„¸ ë””í†¡ìŠ¤", desc: "ì£¼ë§(í† , ì¼) ì´í‹€ ë™ì•ˆ ê²Œì„ ì‹œê°„ ì´ 0ë¶„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_SAGE_MODE': { name: "í˜„ìíƒ€ì„", desc: "7ì¼ ì—°ì†ìœ¼ë¡œ ê²Œì„ ì‹œê°„ ì´ 0ë¶„ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_FIRST': { name: "ì²« ë²ˆì§¸ ì™„ë²½í•œ í•˜ë£¨", desc: "í•˜ë£¨ ë™ì•ˆ ëª¨ë“  ê°œì¸ ëª©í‘œë¥¼ 100% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_5': { name: "ëª©í‘œ ë‹¬ì„±ì˜ ê¸°ì¨", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 5ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_10': { name: "ì˜ì§€ì˜ í˜", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 10ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_20': { name: "ìê¸°ê´€ë¦¬ì˜ ë‹¬ì¸", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 20ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_50': { name: "ëª©í‘œ ì§€í–¥ì  ì¸ê°„", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 50ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_100': { name: "ë°±ì „ë°±ìŠ¹", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 100ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_150': { name: "ëª©í‘œ ë‹¬ì„± ë§ˆìŠ¤í„°", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 150ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_200': { name: "ì™„ë²½ì£¼ì˜ì", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 200ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_PERFECT_365': { name: "ëª©í‘œ ë‹¬ì„±ì˜ ì‹ ", desc: "ê°œì¸ ëª©í‘œ 100% ë‹¬ì„±ì„ 365ì¼ ì„±ê³µí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_STREAK_3': { name: "ì‘ì‹¬ì‚¼ì¼ë„ ì„¸ ë²ˆì´ë©´ ìŠµê´€ì´ë‹¤", desc: "3ì¼ ì—°ì†ìœ¼ë¡œ ëª¨ë“  ê°œì¸ ëª©í‘œë¥¼ 100% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_STREAK_7': { name: "ì™„ë²½í•œ ì¼ì£¼ì¼", desc: "7ì¼ ì—°ì†ìœ¼ë¡œ ëª¨ë“  ê°œì¸ ëª©í‘œë¥¼ 100% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERSONAL_GOAL_STREAK_10': { name: "ì—´ì •ì˜ 10ì¼", desc: "10ì¼ ì—°ì†ìœ¼ë¡œ ëª¨ë“  ê°œì¸ ëª©í‘œë¥¼ 100% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_GOAL_COMPLETER_5': { name: "ëª©í‘œ ë‹¬ì„±ì˜ ê¸°ì¨", desc: "ê°œì¸ ëª©í‘œ 5ê°œ ì´ìƒì„ 'ì™„ë£Œ'ë¡œ í‘œì‹œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_BAD_HABIT_SLAYER_3': { name: "ë‚˜ìœ ìŠµê´€ íŒŒê´´ì", desc: "ë¶€ì •ì  ìŠµê´€ ëª©í‘œ 3ê°œ ì´ìƒì„ 'ì™„ë£Œ'ë¡œ í‘œì‹œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PERFECT_CONTROL': { name: "ì™„ë²½í•œ í†µì œ", desc: "'ë¶€ì •ì  ìŠµê´€' ëª©í‘œë¥¼ 7ì¼ ì—°ì†ìœ¼ë¡œ 100% ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EARLY_BIRD': { name: "ì˜¬ë¹¼ë¯¸, ì•„ë‹ˆ ë…ìˆ˜ë¦¬", desc: "ìƒˆë²½ 5ì‹œ ì´ì „ì— 3ì¼ ì—°ì† ê¸°ìƒí–ˆìŠµë‹ˆë‹¤." },
            'ACH_PUNCTUAL_WAKER': { name: "ì¹¼ ê¸°ìƒ ë§ˆìŠ¤í„°", desc: "7ì¼ ì—°ì†ìœ¼ë¡œ ëª©í‘œ ê¸°ìƒ ì‹œê°„ Â±15ë¶„ ë‚´ì— ê¸°ìƒí–ˆìŠµë‹ˆë‹¤." },
            'ACH_REGULAR_SLEEP': { name: "ê·œì¹™ì ì¸ ì·¨ì¹¨", desc: "ì¼ì£¼ì¼ ë‚´ë‚´ ëª©í‘œ ì·¨ì¹¨ ì‹œê°„(Â±15ë¶„) ë‚´ë¡œ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EARLY_WAKER_COUNT_50': { name: "ì•„ì¹¨í˜• ì¸ê°„", desc: "ëª©í‘œ ê¸°ìƒ ì‹œê°„ 30ë¶„ ì´ë‚´ ê¸°ìƒ ëˆ„ì  50íšŒ" },
            'ACH_EARLY_WAKER_COUNT_100': { name: "ìƒˆë²½ ì´ìŠ¬ì˜ ì¹œêµ¬", desc: "ëª©í‘œ ê¸°ìƒ ì‹œê°„ 30ë¶„ ì´ë‚´ ê¸°ìƒ ëˆ„ì  100íšŒ" },
            'ACH_NIGHT_GUARDIAN_STREAK': { name: "ë°¤ì˜ ìˆ˜í˜¸ì", desc: "7ì¼ ì—°ì†ìœ¼ë¡œ ë°¤ 1ì‹œ ì´ì „ì— ì·¨ì¹¨í–ˆìŠµë‹ˆë‹¤." },
            'ACH_SAVING_KING': { name: "ì €ì¶•ì˜ ì™•", desc: "í•œ ë‹¬ ë™ì•ˆ ì„¤ì •í•œ ì˜ˆì‚°ì˜ 50% ë¯¸ë§Œìœ¼ë¡œ ì§€ì¶œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_ZERO_SPEND_MONTH': { name: "ë¬´ì§€ì¶œì˜ ë‹¬", desc: "í•œ ë‹¬ ë™ì•ˆ ì´ ì§€ì¶œ 0ì›ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_BUDGET_MASTER_3MONTH': { name: "ì˜ˆì‚° ì§€ë°°ì", desc: "3ê°œì›” ì—°ì†ìœ¼ë¡œ ì›” ì˜ˆì‚°ì˜ 80% ë¯¸ë§Œìœ¼ë¡œ ì§€ì¶œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_FINANCIAL_FREEDOM': { name: "ì¬ì •ì  ììœ ", desc: "6ê°œì›” ì—°ì†ìœ¼ë¡œ ì›” ì˜ˆì‚°ì˜ 80% ë¯¸ë§Œìœ¼ë¡œ ì§€ì¶œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_FIRST_WORKOUT': { name: "ìš´ë™ì˜ ì‹œì‘", desc: "ì²« ìš´ë™ ê¸°ë¡ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_IRON_BODY': { name: "ê°•ì²  ì²´ë ¥", desc: "í•œ ë‹¬ ë™ì•ˆ ìš´ë™ 20íšŒ ì´ìƒì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EXERCISE_JOURNEY_1': { name: "ìš´ë™ ì—¬ì •ì˜ ì‹œì‘", desc: "ëˆ„ì  ìš´ë™ ì‹œê°„ 500ë¶„ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EXERCISE_JOURNEY_2': { name: "ê±´ê°•í•œ ìƒí™œ", desc: "ëˆ„ì  ìš´ë™ ì‹œê°„ 1,500ë¶„ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EXERCISE_JOURNEY_3': { name: "ì² ì¸ 3ì¢… ì¤€ë¹„", desc: "ëˆ„ì  ìš´ë™ ì‹œê°„ 5,000ë¶„ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EXERCISE_JOURNEY_4': { name: "ìŠ¤í¬ì¸ ë§¨ì˜ í˜¼", desc: "ëˆ„ì  ìš´ë™ ì‹œê°„ 10,000ë¶„ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_DDAY_SETTER': { name: "ë¯¸ë˜ ê³„íšê°€", desc: "D-Day ëª©í‘œë¥¼ ì²˜ìŒìœ¼ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤." },
            'ACH_NO_RAMEN': { name: "ì² ì˜ ìœ„ì¥", desc: "í•œ ë‹¬ ë™ì•ˆ ì‹ë‹¨ì— 'ë¼ë©´' í‚¤ì›Œë“œê°€ ê¸°ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." },
            'ACH_NO_LATTE': { name: "ì•¡ìƒê³¼ë‹¹ ì•ˆë…•", desc: "í•œ ë‹¬ ë™ì•ˆ ì‹ë‹¨ì— 'ë¼ë–¼' í‚¤ì›Œë“œê°€ ê¸°ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤." },
            'ACH_FOOD_DIARIST_7DAYS': { name: "ê¼¼ê¼¼í•œ ì‹ë‹¨ ê¸°ë¡ê°€", desc: "7ì¼ ì—°ì†ìœ¼ë¡œ ì‹ë‹¨ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_HEALTHY_EATER_MONTH': { name: "ê±´ê°• ì‹ë‹¨ì˜ ë‹¬ì¸", desc: "í•œ ë‹¬ ë™ì•ˆ ê°„ì‹/ì™¸ì‹ ê¸°ë¡ì„ 5íšŒ ë¯¸ë§Œìœ¼ë¡œ ìœ ì§€í–ˆìŠµë‹ˆë‹¤." },
            'ACH_DAILY_QUEST_ALL_CLEAR_FIRST': { name: "ì¼ì¼ í€˜ìŠ¤íŠ¸ ì™„ìˆ˜", desc: "ì²« ì¼ì¼ í€˜ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_DAILY_QUEST_ALL_CLEAR_10': { name: "ì¼ì¼ í€˜ìŠ¤íŠ¸ ë§ˆìŠ¤í„°", desc: "ì¼ì¼ í€˜ìŠ¤íŠ¸ë¥¼ 10íšŒ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_DAILY_QUEST_ALL_CLEAR_50': { name: "ì¼ì¼ í€˜ìŠ¤íŠ¸ ê·¸ëœë“œ ë§ˆìŠ¤í„°", desc: "ì¼ì¼ í€˜ìŠ¤íŠ¸ë¥¼ 50íšŒ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_WEEKLY_QUEST_ALL_CLEAR_FIRST': { name: "ì£¼ê°„ í€˜ìŠ¤íŠ¸ ì™„ìˆ˜", desc: "ì²« ì£¼ê°„ í€˜ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_WEEKLY_QUEST_ALL_CLEAR_5': { name: "ì£¼ê°„ í€˜ìŠ¤íŠ¸ ë§ˆìŠ¤í„°", desc: "ì£¼ê°„ í€˜ìŠ¤íŠ¸ë¥¼ 5íšŒ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_MONTHLY_QUEST_ALL_CLEAR_FIRST': { name: "ì›”ê°„ í€˜ìŠ¤íŠ¸ ì™„ìˆ˜", desc: "ì²« ì›”ê°„ í€˜ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_MONTHLY_QUEST_ALL_CLEAR_3': { name: "ì›”ê°„ í€˜ìŠ¤íŠ¸ ë§ˆìŠ¤í„°", desc: "ì›”ê°„ í€˜ìŠ¤íŠ¸ë¥¼ 3íšŒ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤." },
            'ACH_CLEAN_EATER': { name: "í´ë¦° ì´í„°", desc: "ì¼ì£¼ì¼ ë™ì•ˆ ê°„ì‹/ì™¸ì‹ ê¸°ë¡ì´ 3íšŒ ë¯¸ë§Œì…ë‹ˆë‹¤." },
            'ACH_TOTAL_SCORE_1000': { name: "ë£¨í‹´ ë§ˆë‹ˆì•„", desc: "ëˆ„ì  ë£¨í‹´ ì ìˆ˜ 1,000ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_SCORE_5000': { name: "ë£¨í‹´ ì „ë¬¸ê°€", desc: "ëˆ„ì  ë£¨í‹´ ì ìˆ˜ 5,000ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_SCORE_10000': { name: "ë£¨í‹´ì˜ ë‹¬ì¸", desc: "ëˆ„ì  ë£¨í‹´ ì ìˆ˜ 10,000ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_SCORE_50000': { name: "ë£¨í‹´ì˜ ì‹ ", desc: "ëˆ„ì  ë£¨í‹´ ì ìˆ˜ 50,000ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_SCORE_100000': { name: "ë£¨í‹´ ì„¸ê³„ê´€ ì°½ì¡°ì", desc: "ëˆ„ì  ë£¨í‹´ ì ìˆ˜ 100,000ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_STREAK_3': { name: "ë¶ˆíƒ€ëŠ” 3ì¼", desc: "3ì¼ ì—°ì†ìœ¼ë¡œ 80ì  ì´ìƒì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! ì´ ê¸°ì„¸ ê·¸ëŒ€ë¡œ!" },
            'ACH_STREAK_7': { name: "ì¸ê°„ ìŠ¹ë¦¬ì˜ 7ì¼", desc: "ì¼ì£¼ì¼ ë‚´ë‚´ 80ì  ì´ìƒì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ë¯¸ ìŠ¹ë¦¬ìì…ë‹ˆë‹¤." },
            'ACH_STREAK_14': { name: "ìŠµê´€ í˜•ì„±ê¸°", desc: "2ì£¼ ì—°ì† 80ì  ì´ìƒ ë‹¬ì„±! ì´ì œ ì™„ë²½í•œ ë‹¹ì‹ ì˜ ë£¨í‹´ì…ë‹ˆë‹¤." },
            'ACH_TOTAL_RECORD_200': { name: "ê¸°ë¡ì˜ ì—°ëŒ€ê¸°", desc: "ì´ 200ì¼ì˜ ë£¨í‹´ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_RECORD_365': { name: "1ë…„ì˜ ë£¨í‹´", desc: "ì´ 365ì¼ì˜ ë£¨í‹´ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_TOTAL_RECORD_500': { name: "ë£¨í‹´ íƒí—˜ê°€", desc: "ì´ 500ì¼ì˜ ë£¨í‹´ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_CONSISTENCY_180': { name: "ë¶ˆíƒ€ëŠ” ë£¨í‹´", desc: "180ì¼ ì—°ì†ìœ¼ë¡œ ë£¨í‹´ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_CONSISTENCY_365': { name: "ë£¨í‹´ê³¼ í•¨ê»˜í•œ 1ë…„", desc: "365ì¼ ì—°ì†ìœ¼ë¡œ ë£¨í‹´ ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_NEW_YEAR': { name: "ìƒˆí•´ ë‹¤ì§", desc: "1ì›” 1ì¼ì— ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_XMAS': { name: "ë‚˜ í™€ë¡œ ì„±ì‹¤í•˜ê²Œ", desc: "12ì›” 25ì¼ì— ë°ì´í„°ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤." },
            'ACH_MIDNIGHT_CODER': { name: "ìì •ì˜ ê¸°ë¡ì", desc: "ë°¤ 12ì‹œ 00ë¶„ì— ì •í™•íˆ ë°ì´í„°ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤." },
            'ACH_INDOMITABLE_WILL': { name: "ë¶ˆêµ´ì˜ ì˜ì§€", desc: "ë§ˆì´ë„ˆìŠ¤ì˜€ë˜ ì ìˆ˜ë¥¼ ê·¸ë‚  ë‹¤ì‹œ ìˆ˜ì •í•˜ì—¬ í”ŒëŸ¬ìŠ¤ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤." },
            'ACH_META_AWARENESS': { name: "ë©”íƒ€ì¸ì§€", desc: "'ì£¼ê°„ ì„±ì°°' ê¸°ëŠ¥ì„ ì²˜ìŒìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤." },
            'ACH_ACCOUNTABILITY': { name: "ì•½ì†ì€ ì§€í‚¨ë‹¤", desc: "'ì±…ì„ ê³µìœ ' ê¸°ëŠ¥ì„ ì²˜ìŒìœ¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤." },
            'ACH_EXCEL_GURU': { name: "ì—‘ì…€ ì¢€ ë§Œì ¸ë³¸ ë†ˆ", desc: "'ì—‘ì…€ ë‚´ë³´ë‚´ê¸°' ê¸°ëŠ¥ì„ ì²˜ìŒ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤." },
            //íˆë“ ì—…ì ë“¤
            'ACH_HIDDEN_LEGEND_GACHA': { name: "ë ˆì „ë“œ ë³´ë¬¼ ì‚¬ëƒ¥ê¾¼", desc: "ê°€ì± ì—ì„œ ë ˆì „ë“œ ë“±ê¸‰ ë³´ìƒì„ ì²˜ìŒìœ¼ë¡œ íšë“í–ˆìŠµë‹ˆë‹¤." },
            'ACH_HIDDEN_LUCKY_DRAW': { name: "í–‰ìš´ì˜ ìˆ«ì", desc: "í•˜ë£¨ ì§€ì¶œ ë‚´ì—­ ê¸ˆì•¡ì´ ì •í™•íˆ â‚©777ì›ì¸ ê²½ìš° ë‹¬ì„±ë©ë‹ˆë‹¤. (ì²œ ì›, ë§Œ ì› ë‹¨ìœ„ëŠ” ë¬´ê´€)" },
            'ACH_HIDDEN_PERFECT_DAY': { name: "ì™„ì „ë¬´ê²°ì˜ ë‚ ", desc: "í•˜ë£¨ ë£¨í‹´ ì ìˆ˜ 120ì (ìµœëŒ€ ì ìˆ˜)ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤." },
            'ACH_HIDDEN_SECRET_HOUR': { name: "ë¹„ë°€ì˜ ìƒˆë²½", desc: "ì •í™•íˆ ìƒˆë²½ 3ì‹œ 33ë¶„(AM 03:33)ì— ì·¨ì¹¨ ì‹œê°„ì„ ê¸°ë¡í•œ ê²½ìš° ë‹¬ì„±ë©ë‹ˆë‹¤." },
            'ACH_HIDDEN_EASTER_EGG': { name: "ì´ìŠ¤í„° ì—ê·¸", desc: "í•˜ë£¨ ë™ì•ˆ ì´ ë½€ëª¨ë„ë¡œ ê°œìˆ˜ë¥¼ ì •í™•íˆ 16ê°œë¡œ ê¸°ë¡í•˜ë©´ ë‹¬ì„±ë©ë‹ˆë‹¤." },
        };

        async function unlockAchievement(id) {
            const unlocked = await dbGet('unlockedAchievements') || [];
            if (unlocked.includes(id)) return;

            const achievement = ACHIEVEMENTS_LIST[id];
            if (!achievement) return;

            showFeedbackPopup(100, {
                class: 'feedback-celebration',
                emoji: 'ğŸ…',
                title: `ì—…ì  ë‹¬ì„±! [${achievement.name}]`,
                message: achievement.desc
            });

            unlocked.push(id);
            await dbSet('unlockedAchievements', unlocked);
        }

        async function checkAllAchievements(currentDate, todayData, previousData, allDbData) {
            const unlocked = await dbGet('unlockedAchievements') || [];
            
            const totalDayRecords = allDbData.filter(item => item.key.startsWith('day_')).length;
            if (!unlocked.includes('ACH_FIRST_STEP') && totalDayRecords === 1) await unlockAchievement('ACH_FIRST_STEP');
            if (!unlocked.includes('ACH_100TH_RECORD') && totalDayRecords >= 100) await unlockAchievement('ACH_100TH_RECORD');
            
            if (todayData.pomodoro.morning + todayData.pomodoro.afternoon + todayData.pomodoro.evening >= 15) await unlockAchievement('ACH_POMO_GOD');
            if (todayData.writing >= 10000) await unlockAchievement('ACH_WRITING_GOD');
            
            const today = new Date(currentDate);
            if (today.getMonth() === 0 && today.getDate() === 1) await unlockAchievement('ACH_NEW_YEAR');
            if (today.getMonth() === 11 && today.getDate() === 25) await unlockAchievement('ACH_XMAS');

            let consecutiveDays = 0;
            for (let i = 0; i < 101; i++) {
                const d = new Date(currentDate);
                d.setDate(d.getDate() - i);
                if (allDbData.some(item => item.key === `day_${formatDate(d)}`)) consecutiveDays++;
                else break;
            }
            if (consecutiveDays >= 100) await unlockAchievement('ACH_CONSISTENCY_100');
            else if (consecutiveDays >= 30) await unlockAchievement('ACH_CONSISTENCY_30');
            else if (consecutiveDays >= 7) await unlockAchievement('ACH_CONSISTENCY_7');

            const allDayData = allDbData.filter(i => i.key.startsWith('day_')).map(i=>i.value);
            const totalPomos = allDayData.reduce((sum, day) => sum + (day.pomodoro?.morning || 0) + (day.pomodoro?.afternoon || 0) + (day.pomodoro?.evening || 0), 0);
            if (totalPomos >= 500) await unlockAchievement('ACH_POMO_500');
            else if (totalPomos >= 320) await unlockAchievement('ACH_POMO_320');
            else if (totalPomos >= 200) await unlockAchievement('ACH_POMO_200');
            else if (totalPomos >= 120) await unlockAchievement('ACH_POMO_120');
            else if (totalPomos >= 50) await unlockAchievement('ACH_POMO_50');
            else if (totalPomos >= 10) await unlockAchievement('ACH_POMO_10');
            
            const totalWriting = allDayData.reduce((sum, day) => sum + (day.writing || 0), 0);
            if (totalWriting >= 6000000) await unlockAchievement('ACH_WRITER_50');
            else if (totalWriting >= 2400000) await unlockAchievement('ACH_WRITER_20');
            else if (totalWriting >= 1200000) await unlockAchievement('ACH_WRITER_10');
            else if (totalWriting >= 600000) await unlockAchievement('ACH_WRITER_5');
            else if (totalWriting >= 120000) await unlockAchievement('ACH_WRITER_1');

            if (previousData && previousData.score < 0 && todayData.score >= 0) await unlockAchievement('ACH_INDOMITABLE_WILL');
            if (todayData.exercise.done && !allDayData.some(d => d.date < todayData.date && d.exercise.done)) await unlockAchievement('ACH_FIRST_WORKOUT');

            // === ìƒˆë¡œ ì¶”ê°€ë˜ëŠ” ì—…ì  ì²´í¬ ===
    
    // ì²« ì°©ì„ ê¸°ë¡
    if (!unlocked.includes('ACH_FIRST_SEAT') && todayData.seatTime && !allDbData.some(item => 
        item.key.startsWith('day_') && item.value.date < todayData.date && item.value.seatTime
    )) {
        await unlockAchievement('ACH_FIRST_SEAT');
    }
    
    // íˆë“  ì—…ì : í–‰ìš´ì˜ ìˆ«ì (777ì›)
    if (!unlocked.includes('ACH_HIDDEN_LUCKY_DRAW')) {
        const todayExpenses = allDbData.filter(item => 
            item.key.startsWith('expense_') && item.value.date === formatDate(currentDate)
        );
        if (todayExpenses.some(item => String(item.value.amount).includes('777'))) {
            await unlockAchievement('ACH_HIDDEN_LUCKY_DRAW');
        }
    }
    
    // íˆë“  ì—…ì : ì™„ì „ë¬´ê²°ì˜ ë‚  (120ì )
    if (!unlocked.includes('ACH_HIDDEN_PERFECT_DAY') && todayData.score >= 120) {
        await unlockAchievement('ACH_HIDDEN_PERFECT_DAY');
    }
    
    // íˆë“  ì—…ì : ë¹„ë°€ì˜ ìƒˆë²½ (3:33)
    if (!unlocked.includes('ACH_HIDDEN_SECRET_HOUR') && todayData.sleepTime === '03:33') {
        await unlockAchievement('ACH_HIDDEN_SECRET_HOUR');
    }
    
    // íˆë“  ì—…ì : ì´ìŠ¤í„° ì—ê·¸ (ë½€ëª¨ë„ë¡œ 16ê°œ)
    if (!unlocked.includes('ACH_HIDDEN_EASTER_EGG')) {
    const todayTotalPomos = (todayData.pomodoro?.morning || 0) + (todayData.pomodoro?.afternoon || 0) + (todayData.pomodoro?.evening || 0);
    if (todayTotalPomos === 16) {
        await unlockAchievement('ACH_HIDDEN_EASTER_EGG');
    }

    await checkPersonalGoalAchievements(currentDate, todayData, allDbData);
}
    
    // ëˆ„ì  ë£¨í‹´ ì ìˆ˜ ì²´í¬
    const totalScore = allDbData.filter(item => item.key.startsWith('day_')).reduce((sum, item) => sum + (item.value.score || 0), 0);
    if (!unlocked.includes('ACH_TOTAL_SCORE_100000') && totalScore >= 100000) await unlockAchievement('ACH_TOTAL_SCORE_100000');
    else if (!unlocked.includes('ACH_TOTAL_SCORE_50000') && totalScore >= 50000) await unlockAchievement('ACH_TOTAL_SCORE_50000');
    else if (!unlocked.includes('ACH_TOTAL_SCORE_10000') && totalScore >= 10000) await unlockAchievement('ACH_TOTAL_SCORE_10000');
    else if (!unlocked.includes('ACH_TOTAL_SCORE_5000') && totalScore >= 5000) await unlockAchievement('ACH_TOTAL_SCORE_5000');
    else if (!unlocked.includes('ACH_TOTAL_SCORE_1000') && totalScore >= 1000) await unlockAchievement('ACH_TOTAL_SCORE_1000');
    
    // ì´ ê¸°ë¡ ì¼ìˆ˜ í™•ì¥
    if (!unlocked.includes('ACH_TOTAL_RECORD_500') && totalDayRecords >= 500) await unlockAchievement('ACH_TOTAL_RECORD_500');
    else if (!unlocked.includes('ACH_TOTAL_RECORD_365') && totalDayRecords >= 365) await unlockAchievement('ACH_TOTAL_RECORD_365');
    else if (!unlocked.includes('ACH_TOTAL_RECORD_200') && totalDayRecords >= 200) await unlockAchievement('ACH_TOTAL_RECORD_200');
    
    // ì—°ì† ê¸°ë¡ ì¼ìˆ˜ í™•ì¥ (ê¸°ì¡´ consecutiveDays ì‚¬ìš©)
    if (!unlocked.includes('ACH_CONSISTENCY_365') && consecutiveDays >= 365) await unlockAchievement('ACH_CONSISTENCY_365');
    else if (!unlocked.includes('ACH_CONSISTENCY_180') && consecutiveDays >= 180) await unlockAchievement('ACH_CONSISTENCY_180');

// ì¹¼ ê¸°ìƒ ë§ˆìŠ¤í„° (7ì¼ ì—°ì† Â±15ë¶„)
if (!unlocked.includes('ACH_PUNCTUAL_WAKER')) {
    const targetWakeTime = await dbGet('targetWakeTime');
    if (targetWakeTime) {
        let consecutivePunctualDays = 0;
        const targetMinutes = timeToMinutes(targetWakeTime);
        
        for (let i = 0; i < 7; i++) {
            const checkDate = new Date(currentDate);
            checkDate.setDate(checkDate.getDate() - i);
            const dayData = await dbGet(`day_${formatDate(checkDate)}`);
            
            if (dayData?.wakeTime) {
                const actualMinutes = timeToMinutes(dayData.wakeTime);
                const diff = Math.abs(actualMinutes - targetMinutes);
                if (diff <= 15) {
                    consecutivePunctualDays++;
                } else {
                    break;
                }
            } else {
                break;
            }
        }
        
        if (consecutivePunctualDays >= 7) {
            await unlockAchievement('ACH_PUNCTUAL_WAKER');
        }
    }
}

// ë°¤ì˜ ìˆ˜í˜¸ì (7ì¼ ì—°ì† 1ì‹œ ì´ì „ ì·¨ì¹¨)
if (!unlocked.includes('ACH_NIGHT_GUARDIAN_STREAK')) {
    let consecutiveEarlySleep = 0;
    
    for (let i = 0; i < 7; i++) {
        const checkDate = new Date(currentDate);
        checkDate.setDate(checkDate.getDate() - i);
        const dayData = await dbGet(`day_${formatDate(checkDate)}`);
        
        if (dayData?.sleepTime) {
            const sleepMinutes = timeToMinutes(dayData.sleepTime);
            if (sleepMinutes <= 60 || sleepMinutes >= 1440) { // 1ì‹œ ì´ì „
                consecutiveEarlySleep++;
            } else {
                break;
            }
        } else {
            break;
        }
    }
    
    if (consecutiveEarlySleep >= 7) {
        await unlockAchievement('ACH_NIGHT_GUARDIAN_STREAK');
    }
}

// ëª©í‘œ ê¸°ìƒì‹œê°„ ëˆ„ì  íšŸìˆ˜ ì²´í¬
const targetWakeTime = await dbGet('targetWakeTime');
if (targetWakeTime) {
    const targetMinutes = timeToMinutes(targetWakeTime);
    const punctualWakeCount = allDbData.filter(item => {
        if (!item.key.startsWith('day_') || !item.value.wakeTime) return false;
        const actualMinutes = timeToMinutes(item.value.wakeTime);
        const diff = Math.abs(actualMinutes - targetMinutes);
        return diff <= 30; // Â±30ë¶„
    }).length;
    
    if (!unlocked.includes('ACH_EARLY_WAKER_COUNT_100') && punctualWakeCount >= 100) {
        await unlockAchievement('ACH_EARLY_WAKER_COUNT_100');
    } else if (!unlocked.includes('ACH_EARLY_WAKER_COUNT_50') && punctualWakeCount >= 50) {
        await unlockAchievement('ACH_EARLY_WAKER_COUNT_50');
    }
}

// ì˜¤ì „ 9ì‹œ ì°©ì„ ìŠµê´€ ì²´í¬
const morningSeats = allDbData.filter(item => {
    if (!item.key.startsWith('day_') || !item.value.seatTime) return false;
    const seatMinutes = timeToMinutes(item.value.seatTime);
    return seatMinutes <= 540; // 9ì‹œ = 540ë¶„
});

if (!unlocked.includes('ACH_TOTAL_PUNCTUAL_SEATER_365') && morningSeats.length >= 365) {
    await unlockAchievement('ACH_TOTAL_PUNCTUAL_SEATER_365');
} else if (!unlocked.includes('ACH_TOTAL_PUNCTUAL_SEATER_100') && morningSeats.length >= 100) {
    await unlockAchievement('ACH_TOTAL_PUNCTUAL_SEATER_100');
}

// ì—°ì† ì˜¤ì „ 9ì‹œ ì°©ì„ ì²´í¬
if (!unlocked.includes('ACH_PUNCTUAL_SEATER_30')) {
    let consecutiveMorningSeats = 0;
    
    for (let i = 0; i < 30; i++) {
        const checkDate = new Date(currentDate);
        checkDate.setDate(checkDate.getDate() - i);
        const dayData = await dbGet(`day_${formatDate(checkDate)}`);
        
        if (dayData?.seatTime) {
            const seatMinutes = timeToMinutes(dayData.seatTime);
            if (seatMinutes <= 540) { // 9ì‹œ ì´ì „
                consecutiveMorningSeats++;
            } else {
                break;
            }
        } else {
            break;
        }
    }
    
    if (consecutiveMorningSeats >= 30) {
        await unlockAchievement('ACH_PUNCTUAL_SEATER_30');
    } else if (!unlocked.includes('ACH_PUNCTUAL_SEATER_5') && consecutiveMorningSeats >= 5) {
        await unlockAchievement('ACH_PUNCTUAL_SEATER_5');
    }
}

// === ìš´ë™ ê´€ë ¨ ëˆ„ì  ì—…ì  ===

// ëˆ„ì  ìš´ë™ ì‹œê°„ ì²´í¬
const totalExerciseMinutes = allDbData.filter(item => item.key.startsWith('day_')).reduce((sum, item) => {
    return sum + (item.value.exercise?.minutes || 0);
}, 0);

if (!unlocked.includes('ACH_EXERCISE_JOURNEY_4') && totalExerciseMinutes >= 10000) {
    await unlockAchievement('ACH_EXERCISE_JOURNEY_4');
} else if (!unlocked.includes('ACH_EXERCISE_JOURNEY_3') && totalExerciseMinutes >= 5000) {
    await unlockAchievement('ACH_EXERCISE_JOURNEY_3');
} else if (!unlocked.includes('ACH_EXERCISE_JOURNEY_2') && totalExerciseMinutes >= 1500) {
    await unlockAchievement('ACH_EXERCISE_JOURNEY_2');
} else if (!unlocked.includes('ACH_EXERCISE_JOURNEY_1') && totalExerciseMinutes >= 500) {
    await unlockAchievement('ACH_EXERCISE_JOURNEY_1');
}

}
        
        async function checkStreaks(currentDate, todayData, allDbData) {
            const allDayData = allDbData.filter(i => i.key.startsWith('day_')).map(i => i.value).sort((a,b) => b.date.localeCompare(a.date));

            if (todayData.score >= 80) {
                let scoreStreakCount = 0;
                for (const day of allDayData) {
                    if (new Date(day.date) > new Date(currentDate)) continue;
                    if (day.score >= 80) scoreStreakCount++;
                    else break;
                }

                let bonusPoints = 0;
                let streakPopup = null;
                if (scoreStreakCount === 14) { bonusPoints = 15; await unlockAchievement('ACH_STREAK_14'); } 
                else if (scoreStreakCount === 7) { bonusPoints = 10; await unlockAchievement('ACH_STREAK_7'); } 
                else if (scoreStreakCount === 3) { bonusPoints = 5; await unlockAchievement('ACH_STREAK_3'); } 
                else if (scoreStreakCount > 1 && scoreStreakCount % 5 === 0) {
                     streakPopup = { class: 'feedback-celebration', emoji: 'ğŸ”¥', title: `${scoreStreakCount}ì¼ ì—°ì† ë‹¬ì„±!`, message: 'ë©ˆì¶”ì§€ ë§ˆì„¸ìš”! ì´ ë¶ˆê½ƒì„ ê³„ì† ì´ì–´ë‚˜ê°€ì„¸ìš”!' };
                }

                if (bonusPoints > 0) {
                    todayData.bonusPoints = (todayData.bonusPoints || 0) + bonusPoints;
                    streakPopup = { class: 'feedback-celebration', emoji: 'ğŸ’°', title: 'ìŠ¤íŠ¸ë¦­ ë³´ë„ˆìŠ¤!', message: `${scoreStreakCount}ì¼ ì—°ì† ë‹¬ì„±ì„ ì¶•í•˜í•©ë‹ˆë‹¤! ë³´ë„ˆìŠ¤ ${bonusPoints}ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤!` };
                }
                
                if (streakPopup) setTimeout(() => showFeedbackPopup(100, streakPopup), 500);

            } else {
                let yesterdayStreakCount = 0;
                const yesterday = new Date(currentDate);
                yesterday.setDate(yesterday.getDate() - 1);

                for (const day of allDayData) {
                    if (new Date(day.date) > yesterday) continue;
                    if (day.score >= 80) yesterdayStreakCount++;
                    else break;
                }
                
                if (yesterdayStreakCount >= 3) {
                    setTimeout(() => {
                        showFeedbackPopup(0, { class: 'feedback-disaster', emoji: 'ğŸ’€', title: 'ì—°ì† ê¸°ë¡ì´ ê¹¨ì¡ŒìŠµë‹ˆë‹¤', message: `${yesterdayStreakCount}ì¼ê°„ì˜ ë…¸ë ¥ì´ ë¬¼ê±°í’ˆì´ ë˜ì—ˆìŠµë‹ˆë‹¤. 100-1=0ì´ë¼ëŠ” ê²ƒì„ ê¸°ì–µí•˜ì„¸ìš”.` });
                    }, 1000);
                }
            }
        }

        async function checkMonthlyPerformanceAndNotify() {
            const today = new Date();
            const prevMonthDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            const prevMonthDates = getMonthDates(prevMonthDate);
            const dataPromises = prevMonthDates.map(dateStr => dbGet(`day_${dateStr}`));
            const monthlyData = (await Promise.all(dataPromises)).filter(d => d);

            let totalScore = 0, validDays = 0;
            for (const dayData of monthlyData) {
                if (dayData && !dayData.isOffDay && dayData.wakeTime) {
                    totalScore += dayData.score || 0;
                    validDays++;
                }
            }
            if (validDays === 0) return;
            const avgScore = Math.round(totalScore / validDays);

            if (avgScore < 0) {
                const monthString = `${prevMonthDate.getFullYear()}ë…„ ${prevMonthDate.getMonth() + 1}ì›”`;
                const messageText = `[ë£¨í‹´ íŠ¸ë˜ì»¤ ë³´ê³ ] ì•ˆë…•í•˜ì„¸ìš”. ì œê°€ ${monthString} ë™ì•ˆ ê¸°ë¡í•œ ë£¨í‹´ í‰ê·  ì ìˆ˜ê°€ ${avgScore}ì (ë§Œì  120ì  ê¸°ì¤€)ìœ¼ë¡œ, ëª©í‘œì— ë¯¸ì¹˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¬ì—ëŠ” ë” ë…¸ë ¥í•  ìˆ˜ ìˆë„ë¡ ì˜†ì—ì„œ ì§€ì¼œë´ ì£¼ì„¸ìš”!`;
                if (navigator.share) {
                    try {
                        await navigator.share({ title: 'ì›”ê°„ ë£¨í‹´ ë³´ê³ ', text: messageText });
                        showFeedbackPopup(0, { class: 'feedback-encouragement', emoji: 'ğŸ¤', title: 'ê³µìœ  ì™„ë£Œ!', message: 'ì±…ì„ê° ìˆëŠ” ëª¨ìŠµ, ë©‹ì§‘ë‹ˆë‹¤! ë‹¤ìŒ ë‹¬ì€ ë¶„ëª… ë” ë‚˜ì„ ê±°ì˜ˆìš”.' });
                        unlockAchievement('ACH_ACCOUNTABILITY');
                    } catch (err) {
                        if (err.name === 'AbortError') {
                            showFeedbackPopup(0, { class: 'feedback-warning', emoji: 'ğŸ˜ ', title: 'íšŒí”¼ëŠ” ë‹µì´ ì•„ë‹™ë‹ˆë‹¤', message: 'ê°€ì¥ ì–´ë ¤ìš´ ê²ƒì€ í˜„ì‹¤ì„ ë§ˆì£¼í•˜ëŠ” ìš©ê¸°ì…ë‹ˆë‹¤. íšŒí”¼í•˜ì§€ ë§ˆì„¸ìš”. ë‹¤ì‹œ ì‹œë„í•´ì„œ ì•½ì†ì„ ì§€í‚¤ì„¸ìš”.' });
                        } else {
                            alert("ë©”ì‹œì§€ ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + err.message);
                        }
                    }
                } else {
                    alert("ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ì…ë‹ˆë‹¤.");
                    const fallbackMessage = "ì•„ë˜ ë©”ì‹œì§€ë¥¼ ë³µì‚¬í•˜ì—¬ ì±…ì„ íŒŒíŠ¸ë„ˆì—ê²Œ ì§ì ‘ ì „ì†¡í•´ì£¼ì„¸ìš”.\n\n" + messageText;
                    prompt("ë©”ì‹œì§€ ë³µì‚¬í•˜ê¸° (Ctrl+C)", fallbackMessage);
                }
            }
        }

        async function checkExerciseAndDietBalance() {
            const today = new Date();
            const prevMonthDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            const { start, end } = getMonthDateRange(prevMonthDate);
            const allData = await dbGetAll();

            const exerciseCount = allData.filter(item => item.key.startsWith('day_') && item.value.date >= start && item.value.date <= end && item.value.exercise?.done).length;
            
            const foodRecords = allData.filter(item => item.key.startsWith('food_') && item.value.date >= start && item.value.date <= end);
            let keywordMatchCount = 0;
            foodRecords.forEach(record => {
                const hasKeyword = foodKeywords.some(keyword => record.value.foodName.toLowerCase().includes(keyword.toLowerCase()));
                if (hasKeyword) keywordMatchCount++;
            });

            if (exerciseCount <= 5 && keywordMatchCount >= 30) {
                const monthString = `${prevMonthDate.getFullYear()}ë…„ ${prevMonthDate.getMonth() + 1}ì›”`;
                const messageText = `[ê±´ê°• ì ì‹ í˜¸ ë³´ê³ ] ì•ˆë…•í•˜ì„¸ìš”. ì œê°€ ${monthString} ë™ì•ˆ ìš´ë™ì€ ${exerciseCount}ì¼ í–ˆì§€ë§Œ, ê°„ì‹/ì™¸ì‹ì€ ${keywordMatchCount}íšŒ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê±´ê°•í•œ ìŠµê´€ì„ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ë”°ë”í•œ ì¡°ì–¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤!`;
                if (navigator.share) {
                    try {
                        await navigator.share({ title: 'ì›”ê°„ ê±´ê°• ìŠµê´€ ë³´ê³ ', text: messageText });
                        showFeedbackPopup(0, { class: 'feedback-encouragement', emoji: 'ğŸ¤', title: 'ê³µìœ  ì™„ë£Œ!', message: 'ìì‹ ì˜ ìƒíƒœë¥¼ ì§ì‹œí•˜ëŠ” ìš©ê¸°ê°€ ë” ê±´ê°•í•œ ë‚´ì¼ì„ ë§Œë“­ë‹ˆë‹¤.' });
                    } catch (err) {
                        if (err.name === 'AbortError') {
                            showFeedbackPopup(0, { class: 'feedback-disaster', emoji: 'â˜ ï¸', title: 'íŒ©íŠ¸í­í–‰ì´ ì•„í”ˆê°€ìš”?', message: 'ëª¸ì€ ê±°ì§“ë§ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì™¸ë©´í•˜ì§€ ë§ê³ , ë” ë‚˜ì€ ì„ íƒì„ í•˜ì„¸ìš”.' });
                        }
                    }
                } else {
                    alert("ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ì…ë‹ˆë‹¤.");
                    const fallbackMessage = "ì•„ë˜ ë©”ì‹œì§€ë¥¼ ë³µì‚¬í•˜ì—¬ ì±…ì„ íŒŒíŠ¸ë„ˆì—ê²Œ ì§ì ‘ ì „ì†¡í•´ì£¼ì„¸ìš”.\n\n" + messageText;
                    prompt("ë©”ì‹œì§€ ë³µì‚¬í•˜ê¸° (Ctrl+C)", fallbackMessage);
                }
            }
        }

        // ê°œì¸ ëª©í‘œ 100% ë‹¬ì„± ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•¨ìˆ˜
async function checkPersonalGoalPerfectDay(dayData, date) {
    const allGoals = await getPersonalGoals();
    const checkDate = parseDate(date);
    checkDate.setHours(0, 0, 0, 0);
    
    // í•´ë‹¹ ë‚ ì§œì— ì ìš©ë˜ëŠ” ëª©í‘œë“¤ í•„í„°ë§
    const applicableGoals = allGoals.filter(goal => {
        if (goal.isCompleted) return false;
        const goalDate = new Date(goal.createdAt);
        goalDate.setHours(0, 0, 0, 0);
        return checkDate >= goalDate;
    });
    
    // ì ìš© ê°€ëŠ¥í•œ ëª©í‘œê°€ ì—†ìœ¼ë©´ false
    if (applicableGoals.length === 0) return false;
    
    const personalGoalsData = dayData.personalGoals || {};
    
    // ëª¨ë“  ëª©í‘œê°€ 100% ë‹¬ì„±ë˜ì—ˆëŠ”ì§€ ì²´í¬
    for (const goal of applicableGoals) {
        const achieved = personalGoalsData[goal.id] || 0;
        let percentage = 0;
        
        if (goal.type === 'negative') {
            const usageRatio = achieved / goal.target;
            percentage = Math.max(0, (1 - usageRatio) * 100);
        } else {
            percentage = Math.min(100, (achieved / goal.target) * 100);
        }
        
        if (percentage < 100) {
            return false; // í•˜ë‚˜ë¼ë„ 100% ë¯¸ë‹¬ì„±ì´ë©´ false
        }
    }
    
    return true; // ëª¨ë“  ëª©í‘œê°€ 100% ë‹¬ì„±
}

// ê°œì¸ ëª©í‘œ ê´€ë ¨ ì—…ì ë“¤ì„ ì²´í¬í•˜ëŠ” í•¨ìˆ˜
async function checkPersonalGoalAchievements(currentDate, todayData, allDbData) {
    const unlocked = await dbGet('unlockedAchievements') || [];
    
    // ì˜¤ëŠ˜ ê°œì¸ ëª©í‘œ 100% ë‹¬ì„± ì—¬ë¶€ ì²´í¬
    const todayIsPerfect = await checkPersonalGoalPerfectDay(todayData, formatDate(currentDate));
    
    if (todayIsPerfect) {
        // === ëˆ„ì  ì—…ì  ì²´í¬ ===
        
        // ëª¨ë“  100% ë‹¬ì„± ë‚ ì§œ ê³„ì‚°
        const perfectDays = [];
        for (const item of allDbData) {
            if (item.key.startsWith('day_')) {
                const isPerfect = await checkPersonalGoalPerfectDay(item.value, item.value.date);
                if (isPerfect) {
                    perfectDays.push(item.value.date);
                }
            }
        }
        
        const perfectDayCount = perfectDays.length;
        
        // ì²« ë²ˆì§¸ ì™„ë²½í•œ í•˜ë£¨
        if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_FIRST') && perfectDayCount === 1) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_FIRST');
        }
        
        // ëˆ„ì  ì—…ì ë“¤ ì²´í¬
        if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_365') && perfectDayCount >= 365) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_365');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_200') && perfectDayCount >= 200) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_200');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_150') && perfectDayCount >= 150) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_150');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_100') && perfectDayCount >= 100) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_100');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_50') && perfectDayCount >= 50) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_50');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_20') && perfectDayCount >= 20) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_20');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_10') && perfectDayCount >= 10) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_10');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_PERFECT_5') && perfectDayCount >= 5) {
            await unlockAchievement('ACH_PERSONAL_GOAL_PERFECT_5');
        }
        
        // === ì—°ì† ì—…ì  ì²´í¬ ===
        
        // í˜„ì¬ ë‚ ì§œë¶€í„° ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ë©° ì—°ì† ì¼ìˆ˜ ê³„ì‚°
        let consecutivePerfectDays = 0;
        const today = new Date(currentDate);
        
        for (let i = 0; i < 20; i++) { // ìµœëŒ€ 20ì¼ê¹Œì§€ ì²´í¬ (10ì¼ ì—°ì†ì´ ìµœëŒ€ì´ë¯€ë¡œ)
            const checkDate = new Date(today);
            checkDate.setDate(checkDate.getDate() - i);
            const dateStr = formatDate(checkDate);
            
            const dayData = await dbGet(`day_${dateStr}`);
            if (dayData) {
                const isPerfect = await checkPersonalGoalPerfectDay(dayData, dateStr);
                if (isPerfect) {
                    consecutivePerfectDays++;
                } else {
                    break; // ì—°ì†ì´ ëŠì–´ì§
                }
            } else {
                break; // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì—°ì† ëŠì–´ì§
            }
        }
        
        // ì—°ì† ì—…ì ë“¤ ì²´í¬
        if (!unlocked.includes('ACH_PERSONAL_GOAL_STREAK_10') && consecutivePerfectDays >= 10) {
            await unlockAchievement('ACH_PERSONAL_GOAL_STREAK_10');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_STREAK_7') && consecutivePerfectDays >= 7) {
            await unlockAchievement('ACH_PERSONAL_GOAL_STREAK_7');
        } else if (!unlocked.includes('ACH_PERSONAL_GOAL_STREAK_3') && consecutivePerfectDays >= 3) {
            await unlockAchievement('ACH_PERSONAL_GOAL_STREAK_3');
        }
    }
}

// ë¹„ë°€ ê°œë°œì ë„êµ¬ ê´€ë ¨ ë³€ìˆ˜
let titleClickCount = 0;
let titleClickTimer = null;
let devToolsVisible = false;

// ê°œë°œì ë„êµ¬ í† ê¸€ í•¨ìˆ˜ (ìˆ¨ê¸°ê¸°/ë³´ì´ê¸°)
function toggleDevTools() {
    const devTools = document.getElementById('devTools');
    if (devTools) {
        devToolsVisible = !devToolsVisible;
        devTools.style.display = devToolsVisible ? 'block' : 'none';
        
        if (devToolsVisible) {
            devTools.style.animation = 'fadeIn 0.5s ease';
            console.log('ğŸ”§ ì‹œí¬ë¦¿ ê°œë°œì ë„êµ¬ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
            console.log('ğŸ‘» ê°œë°œì ë„êµ¬ê°€ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤.');
        }
    }
}

// ë¹„ë°€ í´ë¦­ ê°ì§€ ì„¤ì •
function setupSecretDevTools() {
    // ëª¨ë“  í˜ì´ì§€ì˜ h1 ì œëª©ì— ì´ë²¤íŠ¸ ì¶”ê°€
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'H1' || e.target.closest('h1')) {
            titleClickCount++;
            
            // ê¸°ì¡´ íƒ€ì´ë¨¸ ì·¨ì†Œ
            if (titleClickTimer) clearTimeout(titleClickTimer);
            
            // 2ì´ˆ í›„ ì¹´ìš´íŠ¸ ë¦¬ì…‹
            titleClickTimer = setTimeout(() => {
                titleClickCount = 0;
            }, 2000);
            
            // 5ë²ˆ í´ë¦­í•˜ë©´ ê°œë°œì ë„êµ¬ í† ê¸€
            if (titleClickCount >= 5) {
                toggleDevTools();
                titleClickCount = 0;
                
                // ì„±ê³µ ì‚¬ìš´ë“œ íš¨ê³¼ (ì½˜ì†”)
                console.log('ğŸ‰ ì‹œí¬ë¦¿ ì½”ë“œ ë°œë™!');
            } else if (titleClickCount >= 3) {
                // 3ë²ˆì§¸ë¶€í„° íŒíŠ¸
                console.log(`ğŸ‘€ ${titleClickCount}/5 - ê³„ì† í´ë¦­í•´ë³´ì„¸ìš”...`);
            }
        }
    });
}

// í…Œë§ˆ CSS ë°ì´í„° (ë¼ì´íŠ¸ í…Œë§ˆëŠ” ê¸°ë³¸ HTML CSS ì‚¬ìš©)
const THEME_STYLES = {
    dark: `
        @font-face {
        font-family: 'KBIZHanmaumMyungjo';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    :root {
        --bg-color: #1a1a1a;
        --primary-color: #5ba3f5;
        --primary-dark: #4a8cd9;
        --primary-light: #2a3441;
        --text-color: #e8e8e8;
        --text-color-light: #a0a0a0;
        --border-color: #333333;
        --container-bg: #2d2d2d;
        --danger-color: #ff6b6b;
        --warning-color: #ffa726;
        --success-color: #66bb6a;
        --neutral-color: #78909c;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'KBIZHanmaumMyungjo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-color); min-height: 100vh; padding: 20px; color: var(--text-color); }
    button, input, select, textarea { font-family: inherit; }
    .container { 
        background: var(--container-bg); 
        border-radius: 20px; 
        padding: 50px 30px 100px 30px; /* ì²« ë²ˆì§¸ ê°’(50px)ì´ ìƒë‹¨ íŒ¨ë”© */
        width: 100%; 
        max-width: 500px; 
        margin: 0 auto; 
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        position: relative;
        border: 1px solid var(--border-color);
    }
    .header { text-align: center; margin-bottom: 25px; position: relative; }
    .header h1 { color: var(--text-color); font-size: 26px; font-weight: 700; margin-bottom: 8px; }
    .header p { color: var(--text-color-light); font-size: 14px; }
    #gameWarning { background: #3a3a1a; color: #e6d700; border: 1px solid #5c5c1a; border-radius: 8px; padding: 10px; font-size: 14px; font-weight: 500; margin-bottom: 20px; display: none; }
    .page { display: none; }
    .page.active { display: block; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .month-nav { background: none; border: none; font-size: 24px; color: var(--text-color-light); cursor: pointer; padding: 10px; border-radius: 50%; transition: background 0.3s ease; }
    .month-nav:hover { background: var(--bg-color); }
    .month-year { font-size: 20px; font-weight: 700; color: var(--text-color); }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 20px; }
    .calendar-header-cell { text-align: center; padding: 10px 5px; font-weight: 600; color: var(--text-color-light); font-size: 12px; }
    .calendar-cell { aspect-ratio: 1; display: grid; grid-template-rows: 1fr auto 1fr; padding: 2px; align-items: center; justify-items: center; background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); transition: all 0.2s ease; position: relative }
    .cell-top-icons { grid-row: 1; display: flex; justify-content: center; gap: 2px; font-size: 9px; width: 100%; height: 100%; align-items: center; }
    .cell-day-number { grid-row: 2; font-weight: 500; }
    .calendar-cell.today .cell-day-number { font-weight: 700; }
    .cell-bottom-info { grid-row: 3; font-size: 8px; font-weight: 600; color: var(--text-color-light); width: 100%; text-align: left; padding-right: 4px; align-self: end; padding-bottom: 2px; }

    .calendar-cell.has-data .cell-bottom-info { color: rgba(255, 255, 255, 0.8); }
    .calendar-cell.off-day { background: #3a3a3a; color: var(--neutral-color); }
    .off-day-indicator { position: absolute; top: 4px; right: 4px; font-size: 10px; }
    .calendar-cell:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
    .calendar-cell.other-month { color: #555; background: var(--bg-color); border-color: var(--border-color); pointer-events: none; }
    .calendar-cell.today { border-color: var(--primary-color); font-weight: 700; color: var(--primary-color); box-shadow: 0 0 0 2px var(--primary-light); }
    .calendar-cell.has-data { color: white; border: none; font-weight: bold; }
    .calendar-cell.score-high { background: var(--success-color); }
    .calendar-cell.score-medium { background: var(--warning-color); }
    .calendar-cell.score-low { background: var(--danger-color); }
    .calendar-cell.score-negative { background: #455a64; }
    .score-indicator { position: absolute; bottom: 4px; right: 4px; font-size: 9px; background: rgba(0,0,0,0.5); color: white; padding: 1px 4px; border-radius: 4px; font-weight: 700; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease, box-shadow 0.3s ease; font-family: 'KBIZHanmaumMyungjo', sans-serif; background: var(--container-bg); color: var(--text-color); }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-light); }
    .main-actions { display: flex; gap: 10px; margin-bottom: 10px; }
    .btn { width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    .btn:hover { background-color: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.4); }
    .btn:active { transform: translateY(0); box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .main-actions .btn { flex: 1; }
    .btn.secondary { background: var(--neutral-color); }
    .btn.secondary:hover { background: #546e7a; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px); z-index: 1000; align-items: center; justify-content: center; }
    .modal-content { background: var(--container-bg); padding: 0; border-radius: 16px; width: 90%; max-width: 800px; max-height: 95vh; overflow-y: auto; box-shadow: 0 16px 48px rgba(0,0,0,0.5); border: 1px solid var(--border-color); }
    #dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--border-color); background: var(--container-bg); border-top-left-radius: 16px; border-top-right-radius: 16px; }
    #dayModal .modal-body { padding: 25px; background: var(--container-bg); }
    .modal-layout { display: block; }
    @media (min-width: 768px) { .modal-layout { display: block; } }
    .modal-side-column { display: flex; flex-direction: column; }
    .modal-input-group { background: var(--bg-color); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); }
    .modal-input-group h4 { font-size: 16px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); color: var(--text-color); }
    .modal-input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
    
    #commentDetails summary { font-weight: 600; color: var(--text-color); cursor: pointer; padding: 10px; border-radius: 8px; background-color: var(--bg-color); border: 1px solid var(--border-color); list-style: none; position: relative; padding-left: 30px; }
    #commentDetails summary::-webkit-details-marker { display: none; }
    #commentDetails summary::before { content: 'â–¶'; position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 10px; transition: transform 0.2s; }
    #commentDetails[open] > summary::before { transform: translateY(-50%) rotate(90deg); }

    #dayModal .form-group { margin-bottom: 0; }
    #dayModal .form-group label { font-size: 13px; margin-bottom: 6px; }
    #dayModal .form-group input { padding: 10px; font-size: 16px; }
    #dayModal .modal-input-group,
    #dayModal .score-display-card { margin-bottom: 5px; }
    #dayModal .modal-layout > div:last-child { margin-bottom: 0; }
    .modal-header { display: flex; justify-content: center; align-items: center; position: relative; gap: 20px; }
    .modal-title { flex: none; text-align: center; margin: 0; color: var(--text-color); }
    .date-nav-btn { background: none; border: none; font-size: 24px; color: var(--text-color-light); cursor: pointer; padding: 10px; border-radius: 50%; transition: all 0.2s ease; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
    .date-nav-btn:hover { background: var(--bg-color); color: var(--text-color); }
    .close-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: var(--text-color-light); line-height: 1; position: absolute; right: 0; top: 50%; transform: translateY(-50%); }
    .score-display-card { background: var(--bg-color); border-radius: 12px; padding: 20px; text-align: center; border: 1px solid var(--border-color); }
    .score-display-card .score { font-size: 40px; font-weight: 700; color: var(--primary-color); line-height: 1; }
    .score-display-card .score.is-off { color: var(--neutral-color); }
    .score-display-card div:last-child { font-size: 14px; color: var(--text-color-light); margin-top: 5px; }
    .exercise-toggle-group { margin-bottom: 15px; }
    .exercise-toggle-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    .exercise-toggle-btns { display: flex; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
    .exercise-toggle-btn { flex: 1; padding: 10px; border: none; background: var(--container-bg); cursor: pointer; font-weight: 600; transition: all 0.2s ease; font-size: 14px; color: var(--text-color); }
    .exercise-toggle-btn.active { background: var(--success-color); color: #fff; }
    .legend { display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0 0; font-size: 12px; gap: 15px; }
    .legend-item { display: flex; align-items: center; gap: 5px; color: var(--text-color); }
    .legend-color { width: 12px; height: 12px; border-radius: 3px; }
    .goal-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .goal-tab { padding: 8px 16px; background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; color: var(--text-color); }
    .goal-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    .goal-type-toggle { display: flex; gap: 5px; margin-bottom: 15px; }
    .goal-type-toggle button { flex: 1; padding: 8px; font-size: 14px; border: 1px solid var(--border-color); background: var(--bg-color); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; color: var(--text-color); }
    .goal-type-toggle button.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    #personalGoalsPage .header { text-align: left; }
    .dday-header-container { height: auto; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: flex-start; position: absolute; top: 10px; left: 10px; right: 10px; z-index: 10; pointer-events: none; }
    .dday-chip { background: var(--primary-light); backdrop-filter: blur(5px); color: var(--primary-color); padding: 4px 10px; border-radius: 12px; font-weight: 700; font-size: 11px; display: none; box-shadow: 0 2px 8px rgba(0,0,0,0.3); pointer-events: all; border: 1px solid var(--border-color); }
    .battery { display: none; width: 30px; height: 14px; border: 1.5px solid var(--text-color-light); border-radius: 4px; position: relative; padding: 1.5px; }
    .battery::after { content: ''; position: absolute; top: 50%; right: -4px; transform: translateY(-50%); width: 2px; height: 6px; background: var(--text-color-light); border-radius: 0 1px 1px 0; }
    .battery-level { height: 100%; border-radius: 2px; transition: width 0.3s ease; }
    .battery-level.green { background: var(--success-color); } .battery-level.yellow { background: var(--warning-color); } .battery-level.red { background: var(--danger-color); } .battery-level.black { background: var(--text-color); }
    .budget-summary { display: flex; gap: 10px; margin-bottom: 20px; }
    .budget-card { flex: 1; background: var(--primary-light); color: var(--primary-color); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color); }
    .budget-card-title { font-size: 12px; opacity: 0.9; margin-bottom: 8px; font-weight: 600; }
    .budget-card-value { font-size: 22px; font-weight: 700; }
    #budgetPage .header p { font-size: 16px; font-weight: 600; color: var(--text-color); }
    .personal-goals-section { background: var(--bg-color); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); }
    #modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }
    .personal-goal-checkbox { display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--container-bg); border-radius: 10px; margin-bottom: 10px; border: 1px solid var(--border-color); }
    .personal-goal-item { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 10px; }
    .personal-goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .personal-goal-name { font-weight: 600; color: var(--text-color); }
    .personal-goal-actions button { padding: 5px 10px; border-radius: 6px; font-size: 12px; border: none; cursor: pointer; color: white; }
    .edit-btn { background: var(--warning-color); }
    .delete-btn { background: var(--danger-color); }
    .complete-btn { background: var(--success-color); }
    .reopen-btn { background: var(--primary-color); }
    .empty-goals { text-align: center; color: var(--text-color-light); padding: 40px 20px; background: var(--bg-color); border-radius: 12px; margin-top: 20px; border: 1px solid var(--border-color); }
    .budget-settings, .dday-settings { margin-bottom: 30px; }
    .budget-input, .dday-actions { display: flex; gap: 10px; align-items: center; }
    .dday-item { background: var(--bg-color); border-radius: 12px; padding: 12px 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color); }
    .budget-input button { padding: 12px 20px; background: var(--success-color); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
    .wakeup-prompt { background: var(--primary-light); color: var(--primary-color); padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; border: 1px solid var(--border-color); }
    .monthly-summary { display: flex; justify-content: space-around; gap: 15px; margin-bottom: 30px; }
    .summary-card { flex-basis: 30%; background: var(--primary-light); color: var(--primary-color); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid var(--border-color); }
    .summary-title { font-size: 14px; opacity: 0.9; margin-bottom: 10px; font-weight: 600; }
    .summary-value { font-size: 24px; font-weight: 700; }
    .week-card { background: var(--bg-color); border-radius: 15px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-color); }
    .week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: 600; color: var(--text-color); }
    .week-stats { display: flex; justify-content: space-around; align-items: center; text-align: center; font-size: 22px; font-weight: 600; color: var(--text-color); }
    .empty-expenses { text-align: center; color: var(--text-color-light); padding: 40px 20px; }
    .feedback-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 2000; animation: fadeIn 0.3s ease; justify-content: center; align-items: center; }
    .feedback-content { position: relative; background: var(--container-bg); padding: 40px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.6); animation: popIn 0.5s ease; border: 1px solid var(--border-color); }
    .feedback-emoji { font-size: 60px; margin-bottom: 20px; display: block; }
    .feedback-title { font-size: 24px; font-weight: 700; margin-bottom: 15px; color: var(--text-color); }
    .feedback-message { font-size: 16px; color: var(--text-color-light); line-height: 1.5; margin-bottom: 25px; }
    .feedback-celebration .feedback-title, .feedback-celebration .feedback-message, .feedback-reflection .feedback-title, .feedback-reflection .feedback-message, .feedback-disaster .feedback-title, .feedback-disaster .feedback-message, .feedback-encouragement .feedback-title, .feedback-encouragement .feedback-message, .feedback-warning .feedback-title, .feedback-warning .feedback-message { color: rgba(255,255,255,0.95); }
    .feedback-celebration { background: linear-gradient(135deg, #2ecc71, #28b463); } .feedback-reflection { background: linear-gradient(135deg, #f39c12, #e67e22); } .feedback-disaster { background: linear-gradient(135deg, #455a64, #37474f); } .feedback-encouragement { background: linear-gradient(135deg, #3498db, #2980b9); } .feedback-warning { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    .feedback-btn { background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 12px 30px; border-radius: 25px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 0 10px; }
    .feedback-btn:hover { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.5); transform: translateY(-2px); }
    .feedback-budget-red { background: linear-gradient(135deg, #e74c3c, #c0392b) !important; }
    .feedback-budget-black { background: linear-gradient(135deg, #455a64, #37474f) !important; }
    .expense-input-row { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
    .expense-input-row input { flex: 1; padding: 12px; font-size: 14px; border-radius: 8px; background: var(--container-bg); color: var(--text-color); border: 1px solid var(--border-color); }
    .expense-input-row button { flex-shrink: 0; width: 44px; height: 44px; border-radius: 12px; background: var(--primary-color); border: none; color: white; font-weight: bold; cursor: pointer; font-size: 24px; line-height: 44px; transition: background 0.2s ease; }
    .expense-input-row button:hover { background: var(--primary-dark); }
    .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; font-size: 14px; color: var(--text-color); }
    .dday-settings h4 { margin-bottom: 15px; color: var(--text-color); }
    .dday-item .dday-actions { display: flex; gap: 5px; }
    .dday-item .dday-actions button { background: none; border: 1px solid var(--border-color); width: 30px; height: 30px; border-radius: 50%; font-size: 16px; cursor: pointer; transition: all 0.2s ease; color: var(--text-color-light); }
    .dday-item .dday-actions button:hover { background: var(--bg-color); color: var(--text-color); transform: scale(1.1); }
    .excel-option-item { display: flex; align-items: center; padding: 8px 0; cursor: pointer; color: var(--text-color); }
    .excel-option-item input[type="radio"] { width: 18px; height: 18px; margin-right: 12px; accent-color: var(--primary-color); }
    .excel-option-item label { font-size: 16px; }
    #customDateRange { display: flex; gap: 10px; align-items: center; margin-top: 10px; margin-bottom: 20px; }
    #customDateRange input[type="date"] { padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); flex: 1; font-family: inherit; background: var(--container-bg); color: var(--text-color); }

    .number-input-group {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
}

.number-input-group input {
    border: none;
    text-align: center;
    flex: 1;
    padding: 10px 5px;
    background: var(--container-bg);
    color: var(--text-color);
}

.number-input-group input:focus { box-shadow: none; border: none; }

.number-btn {
    width: 32px;
    height: 42px;
    border: none;
    background: var(--bg-color);
    color: var(--text-color);
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.number-btn:hover { background: var(--primary-light); }
.number-btn:active { background: var(--primary-color); color: white; }

input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    /* --- ì‹ë‹¨ ê´€ë ¨ ìŠ¤íƒ€ì¼ (ê¸°ëŠ¥+ë””ìì¸) --- */
    .food-page-actions { display: flex; gap: 10px; margin-bottom: 10px; }
    .food-page-actions .btn.secondary.danger { background-color: var(--danger-color); color: white; }
    .food-date-header { display: flex; align-items: center; text-align: center; margin: 30px 0 10px; color: var(--text-color-light); }
    .food-date-header::before, .food-date-header::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color); }
    .food-date-header span { padding: 0 15px; font-size: 13px; font-weight: 600; }
    .food-record-item { display: grid; grid-template-columns: 50px 30px 1fr auto; gap: 15px; align-items: center; padding: 14px 5px; border-bottom: 1px solid var(--border-color); position: relative; }
    .food-record-item .food-admin-actions { position: absolute; right: 0px; top: 50%; transform: translateY(-50%); display: flex; gap: 5px; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
    .food-records.admin-mode .food-record-item .food-admin-actions { opacity: 1; pointer-events: auto; }
    .food-admin-actions button { background: none; border: 1px solid var(--border-color); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 13px; transition: background-color 0.2s; }
    .food-admin-actions button.edit { color: var(--warning-color); }
    .food-admin-actions button.delete { color: var(--danger-color); }
    .food-admin-actions button:hover { background-color: var(--bg-color); }
    
#foodExportModal .modal-content {
    max-width: 90vw;
    background: var(--container-bg);
    padding: 0;
}
#foodExportPreview {
    background: var(--container-bg);
    border-radius: 8px;
    padding: 0;
    margin: 20px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    font-family: 'Courier New', monospace;
    border: 1px solid var(--border-color);
}
.food-receipt-header {
    padding: 15px 20px 10px;
    background: var(--primary-light);
}
.food-receipt-title {
    display: block;
    text-align: center;
    margin-bottom: 5px;
}
.food-receipt-title h3 {
    margin: 0;
    font-size: 16px;
    color: var(--primary-color);
    font-weight: 700;
}
.food-receipt-header p {
    margin: 0;
    font-size: 12px;
    color: var(--text-color-light);
    text-align: center;
}
.food-receipt-divider {
    height: 1px;
    background: repeating-linear-gradient(
        to right,
        var(--border-color) 0px,
        var(--border-color) 3px,
        transparent 3px,
        transparent 6px
    );
    margin: 0 15px;
}
.food-receipt-items {
    padding: 15px 20px 10px;
}
.food-receipt-date-header {
    font-weight: 700;
    color: var(--primary-color);
    font-size: 13px;
    margin: 15px 0 8px 0;
    padding-bottom: 5px;
    border-bottom: 1px dashed var(--border-color);
}
.food-receipt-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 0;
    font-size: 13px;
    line-height: 1.3;
}
.food-receipt-time {
    color: var(--text-color-light);
    font-size: 11px;
    min-width: 45px;
    margin-right: 10px;
}
.food-receipt-desc {
    flex: 1;
    font-weight: 600;
    color: var(--text-color);
    margin-right: 10px;
}
.food-receipt-quantity {
    font-weight: 700;
    color: var(--text-color);
    font-size: 13px;
    text-align: right;
    min-width: 60px;
}
#foodExportModal .close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    font-size: 20px;
    color: var(--text-color);
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
}

#foodExportModal .close-btn:hover {
    background: rgba(0, 0, 0, 0.5);
}

@media (max-width: 767px) {
    #foodExportModal.modal-overlay {
        background: var(--bg-color);    
        backdrop-filter: none; 
    }
    
    #foodExportModal .modal-content {
        max-width: 100vw;
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        border-radius: 0;
        box-shadow: none; 
        background: var(--bg-color);
    }
    
    #foodExportPreview {
        margin: 0; 
        border-radius: 0; 
        box-shadow: none;  
        height: calc(100vh - 50px); 
        overflow-y: auto;
        background: var(--container-bg);
        border: none;
    }
    
    #foodExportModal .close-btn {
        position: fixed;   
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 22px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        z-index: 1000;
    }
    
    #foodExportModal .modal-content > div:last-child {
        position: fixed;        
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--container-bg);
        padding: 15px;
        border-top: 1px solid var(--border-color);
    }
}

    .food-modal { max-width: 420px; background-color: var(--container-bg); overflow: hidden; }
    .food-modal .modal-header { padding: 15px 20px; background-color: var(--bg-color); border-bottom: 1px solid var(--border-color); }
    .food-modal .modal-header h2 { font-size: 18px; color: var(--text-color); }
    .food-modal .modal-body { padding: 20px; background: var(--container-bg); }
    .food-modal .form-group { margin-bottom: 15px; }
    .food-modal .form-group label { font-size: 13px; margin-bottom: 6px; }
    .food-modal .form-group input, .food-modal .form-group select { padding: 10px; font-size: 15px; }
    .food-modal .quantity-input { display: flex; gap: 8px; }
    .food-modal .quantity-input select { width: 90px; }
    .food-modal .food-modal-actions { margin-top: 20px; display: flex; gap: 10px; }
    .food-modal .food-modal-actions .btn { flex: 1; padding: 12px; }

    .fame-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; }
    .fame-card { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; text-align: center; }
    .fame-card-title { font-size: 18px; margin-bottom: 8px; color: var(--text-color); }
    .fame-card-value { font-size: 20px; font-weight: 700; color: var(--primary-color); }
    .fame-card-date { font-size: 12px; color: var(--text-color-light); margin-top: 4px; }
    #wallOfShame .fame-card-value { color: var(--danger-color); }

    #modalCommentSection { margin-top: 20px; }
    #modalComment { width: 100%; margin-top: 15px; height: 80px; resize: vertical; font-size: 16px; }
    #modalPersonalGoalsList input[type="number"] { font-size: 16px; }
    .comment-history-list { max-height: 450px; overflow-y: auto; padding-right: 5px; }
    .comment-item { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px 20px; margin-bottom: 12px; }
    .comment-item-header { font-size: 13px; color: var(--text-color-light); font-weight: 600; margin-bottom: 10px; }
    .comment-item-body { font-size: 15px; line-height: 1.7; white-space: pre-wrap; word-break: break-word; color: var(--text-color); }
    .empty-comments { text-align: center; color: var(--text-color-light); padding: 50px 20px; background: var(--bg-color); border-radius: 12px; border: 1px solid var(--border-color); }
    
.receipt-container {
    background: var(--container-bg);
    border-radius: 8px;
    padding: 0;
    margin-top: 0; /* ìœ„ìª½ ë°”ê¹¥ ì—¬ë°±ì„ 0ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤. */
    margin-bottom: 20px; /* ì•„ë˜ìª½ ì—¬ë°±ì€ ìœ ì§€í•©ë‹ˆë‹¤. */
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    font-family: 'Courier New', monospace;
    max-width: 100%;
    overflow: hidden;
    border: 1px solid var(--border-color);
}
.receipt-header { padding: 15px 20px 10px; background: var(--primary-light); }
.receipt-title { display: block; text-align: center; margin-bottom: 5px; position: relative; }
.receipt-title h3 { margin: 0; font-size: 16px; color: var(--primary-color); font-weight: 700; }
.budget-info { display: flex; flex-direction: column; gap: 3px; font-size: 11px; color: var(--text-color); font-weight: 600; text-align: right; position: absolute;
    top: -5px;
    right: -8px;
}
.receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
.receipt-divider { height: 1px; background: repeating-linear-gradient(to right, var(--border-color) 0px, var(--border-color) 3px, transparent 3px, transparent 6px); margin: 0 15px; }
.receipt-items { padding: 15px 20px 10px; }
.receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 8px; font-size: 13px; line-height: 1.3; }
.receipt-date { color: var(--text-color-light); font-size: 11px; min-width: 60px; margin-right: 15px; }
.receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 15px; }
.receipt-amount { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 70px; }
.receipt-total { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--bg-color); font-weight: 700; font-size: 16px; font-family: 'Courier New', monospace; color: var(--primary-color); }

.calendar-cell.skeleton {
    background: #2a2a2a;
    border: 1px solid #404040;
    position: relative;
    overflow: hidden;
}

.calendar-cell.skeleton::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shimmer 2s infinite;
}

.calendar-cell.skeleton .cell-day-number {
    color: #505050;
    background: transparent;
}

.calendar-cell.skeleton .cell-top-icons,
.calendar-cell.skeleton .cell-bottom-info {
    background: transparent;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--text-color-light);
    font-size: 12px;
    z-index: 10;
    background: rgba(45, 45, 45, 0.9);
    padding: 5px 10px;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
}

#dailyQuestModal .modal-header {
    padding-top: 25px;
    padding-bottom: 15px;
}

    .quest-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .quest-tab { padding: 8px 16px; background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; color: var(--text-color); }
    .quest-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
    .quest-list { display: flex; flex-direction: column; gap: 10px; }
    .quest-item { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; transition: all 0.2s ease; }
    .quest-item:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
    .quest-item.completed { background: var(--success-color); color: white; border-color: var(--success-color); }
    .quest-item.completed .quest-reward { color: rgba(255,255,255,0.9); }
    .quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .quest-title { font-weight: 600; font-size: 14px; color: var(--text-color); }
    .quest-item.completed .quest-title { color: white; }
    .quest-reward { font-size: 12px; color: var(--primary-color); font-weight: 600; }
    .quest-desc { font-size: 13px; color: var(--text-color-light); margin-bottom: 10px; }
    .quest-item.completed .quest-desc { color: rgba(255,255,255,0.8); }
    .quest-progress { display: flex; justify-content: space-between; align-items: center; }
    .quest-progress-bar { flex: 1; height: 6px; background: var(--bg-color); border-radius: 3px; margin-right: 10px; overflow: hidden; }
    .quest-progress-fill { height: 100%; background: var(--primary-color); transition: width 0.3s ease; }
    .quest-progress-text { font-size: 11px; color: var(--text-color-light); min-width: 40px; text-align: right; }
    .quest-item.completed .quest-progress-bar { background: rgba(255,255,255,0.3); }
    .quest-item.completed .quest-progress-fill { background: rgba(255,255,255,0.8); }
    .quest-item.completed .quest-progress-text { color: rgba(255,255,255,0.9); }

    #rewardsModal .modal-header { padding: 30px 25px 20px 25px; border-bottom: 1px solid var(--border-color); background: var(--container-bg); border-top-left-radius: 16px; border-top-right-radius: 16px; }
    .rewards-list { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; }
    .reward-item { background: var(--bg-color); border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s ease; }
    .reward-item:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
    .reward-item.bronze { border-color: #CD7F32; background: linear-gradient(135deg, #3a2f1a, #2d251a); }
    .reward-item.silver { border-color: #C0C0C0; background: linear-gradient(135deg, #3a3a3f, #2e2e33); }
    .reward-item.gold { border-color: #FFD700; background: linear-gradient(135deg, #4a3d1a, #3d321a); }
    .reward-item.legend { border-color: #9400D3; background: linear-gradient(135deg, #3a1a4a, #2d1a3d); }
    .reward-item.used { opacity: 0.5; filter: grayscale(50%); }
    .reward-info { flex: 1; }
    .reward-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; color: var(--text-color); }
    .reward-desc { font-size: 13px; color: var(--text-color-light); }
    .reward-tier { font-size: 11px; font-weight: 600; padding: 2px 6px; border-radius: 4px; margin-bottom: 4px; display: inline-block; }
    .reward-tier.bronze { background: #CD7F32; color: white; }
    .reward-tier.silver { background: #C0C0C0; color: white; }
    .reward-tier.gold { background: #FFD700; color: #333; }
    .reward-tier.legend { background: #9400D3; color: white; }
    .reward-actions { display: flex; gap: 8px; }
    .reward-btn { padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .reward-btn.use { background: var(--success-color); color: white; }
    .reward-btn.use:hover { background: #27ae60; }
    .reward-btn.delete { background: var(--danger-color); color: white; }
    .reward-btn.delete:hover { background: #c0392b; }
    .reward-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .empty-rewards { text-align: center; padding: 40px 20px; color: var(--text-color-light); }

    .profile-menu-item:hover { background: var(--primary-light); color: var(--primary-color); }
    
    #profileWidget:hover { transform: translateY(-2px); }
    #profileWidget { transition: transform 0.2s ease; }

    .achievements-list { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; }
    .achievement-item { background: var(--bg-color); border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; transition: all 0.2s ease; }
    .achievement-item.unlocked { border-color: var(--success-color); background: linear-gradient(135deg, #1a3d1a, #1a2f1a); }
    .achievement-item.locked { opacity: 0.6; }
    .achievement-emoji { font-size: 24px; min-width: 40px; text-align: center; }
    .achievement-info { flex: 1; }
    .achievement-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; color: var(--text-color); }
    .achievement-desc { font-size: 13px; color: var(--text-color-light); }
    .achievement-status { font-size: 12px; font-weight: 600; padding: 4px 8px; border-radius: 6px; }
    .achievement-status.unlocked { background: var(--success-color); color: white; }
    .achievement-status.locked { background: var(--border-color); color: var(--text-color-light); }
    .achievement-item.hidden { background: linear-gradient(135deg, #1a1a1a, #2d2d2d); color: #a0a0a0; border-color: #404040; }
    .achievement-item.hidden .achievement-desc { color: #707070; font-style: italic; }

    @media (max-width: 767px) {
        .modal-content {
            padding: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            max-height: 100vh;
            background: var(--container-bg);
        }
        .food-modal {
            width: 90%;
            height: auto;
            border-radius: 16px;
            max-height: 90vh;
        }
        .food-modal .modal-body {
            overflow-y: auto;
            max-height: calc(90vh - 120px);
        }
        #dayModal .modal-body {
            padding: 20px 15px;
        }
        .modal-input-group {
            padding: 15px;
        }
        .modal-input-group h4 {
            font-size: 15px;
        }
        #dayModal .form-group label {
            font-size: 13px;
        }

        #dayModal .modal-input-row {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .exercise-toggle-btns {
            max-width: 180px;
        }
        .score-display-card, .personal-goals-section {
            width: 100%;
            max-width: none;
            margin: 0;
            padding: 15px;
        }
        .score-display-card .score {
            font-size: 36px;
        }

        #modalTotalExpense {
            text-align: left !important;
        }
        .expense-item {
            font-size: 13px;
            word-break: break-all;
        }
        .expense-item span:first-child {
            flex-grow: 1;
            margin-right: 10px;
        }
        .expense-item > div {
            flex-shrink: 0;
        }
        
        .modal-actions-container {
            padding: 0 15px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .modal-actions-container .btn.delete {
            order: 2;
            background-color: transparent;
            color: var(--text-color-light);
            font-size: 14px;
            font-weight: normal;
            padding: 8px;
            box-shadow: none;
            margin-top: 10px;
            max-width: 150px;
        }
        .modal-actions-container .btn.delete:hover {
            background-color: transparent;
            color: var(--danger-color);
        }
        .modal-actions-container .btn.save {
            order: 1;
        }

        #budgetPage .budget-summary {
            flex-wrap: wrap;
        }
        #budgetPage .budget-summary .budget-card:first-child {
            flex-basis: 100%;
        }
        #budgetPage .budget-card-value {
            font-size: 20px;
        }
        #dayModal .expense-input-row {
            flex-direction: column;
            gap: 10px;
        }
        #dayModal .expense-input-row input,
        #dayModal .expense-input-row button {
            width: 100%;
        }
        .dday-header-container {
            top: 8px;
            left: 3px;
            right: 3px;
        }
        .container {
            padding: 40px 20px 95px 20px;
        }
        .dday-chip {
            font-size: 10px;
            padding: 3px 8px;
        }
        .battery {
            width: 25px;
            height: 12px;
        }
        
        .receipt-item {
            font-size: 12px;
        }
    
        .receipt-date {
            min-width: 50px;
            margin-right: 10px;
            font-size: 10px;
        }
    
        .receipt-desc {
            margin-right: 10px;
        }
    
        .receipt-amount {
            min-width: 60px;
            font-size: 12px;
        }
    
        .budget-info {
            flex-direction: column;
            gap: 2px;
            font-size: 10px;
            text-align: right;
        }
    }
    `,
    
    excel: `
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap');
        @font-face { font-family: 'KBIZHanmaumMyungjo'; src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff'); font-weight: normal; font-style: normal; }
:root {
    --bg-color: #f8f9fa;
    --primary-color: #217346;
    --primary-dark: #0f5132;
    --primary-light: #e0f5e9;
    --text-color: #323130;
    --text-color-light: #605e5c;
    --border-color: #d1d1d1;
    --container-bg: #ffffff;
    --danger-color: #d13438;
    --warning-color: #ff8c00;
    --success-color: #107c10;
    --neutral-color: #8a8886;
}
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif; background: var(--bg-color); min-height: 100vh; padding: 20px; color: var(--text-color); line-height: 1.4; }
        button, input, select, textarea { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif; }
        .container { 
    background: var(--container-bg);
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 8pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 32px 24px 100px 24px; 
    width: 100%; 
    max-width: 500px; 
    margin: 0 auto; 
    box-shadow: 
        0 1.6px 3.6px 0 rgba(0, 0, 0, 0.132), 
        0 0.3px 0.9px 0 rgba(0, 0, 0, 0.108);
    position: relative;
}
        .header { text-align: center; margin-bottom: 24px; position: relative; padding: 16px; border-bottom: 1px solid var(--border-color); background: linear-gradient(180deg, var(--container-bg) 0%, #fafbfc 100%); }
        .header h1 { color: var(--text-color); font-size: 20px; font-weight: 600; margin-bottom: 4px; letter-spacing: -0.01em; }
        .header p { color: var(--text-color-light); font-size: 13px; font-weight: 400; }
        #gameWarning { background: #fff4e5; color: #8a5a08; border: 1px solid #ffb900; border-radius: 4px; padding: 8px 12px; font-size: 12px; font-weight: 400; margin-bottom: 16px; display: none; border-left: 4px solid var(--warning-color); }
        .page { display: none; }
        .page.active { display: block; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 8px 0; }
        .month-nav { 
    background: var(--container-bg); 
    border: 1px solid var(--border-color); 
    font-size: 14px; 
    color: var(--text-color); 
    cursor: pointer; 
    padding: 8px 12px; 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    transition: all 0.15s ease;
    font-family: 'Segoe UI', sans-serif;
    font-weight: 400;
}
        .month-nav:hover { background: var(--primary-light); border-color: var(--primary-color); color: var(--primary-color); }
.month-year { font-size: 16px; font-weight: 600; color: var(--text-color); }
.calendar-grid { 
    display: grid; 
    grid-template-columns: repeat(7, 1fr); 
    gap: 1px; 
    margin-bottom: 16px; 
    border: 1px solid var(--border-color);
    background: var(--border-color);
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    overflow: hidden;
}
.calendar-header-cell { 
    text-align: center; 
    padding: 12px 4px; 
    font-weight: 600; 
    color: var(--text-color); 
    font-size: 11px; 
    background: #f3f2f1;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 0; /* ëª¨ë“  ë¼ìš´ë”© ì œê±° */
}
.calendar-cell { 
    aspect-ratio: 1; 
    display: grid; 
    grid-template-rows: 1fr auto 1fr; 
    padding: 4px; 
    align-items: center; 
    justify-items: center;
    background: var(--container-bg);
    transition: all 0.15s ease;
    cursor: pointer;
    position: relative;
    border-radius: 0; /* ëª¨ë“  ë¼ìš´ë”© ì œê±° */
}
.cell-top-icons { grid-row: 1; display: flex; justify-content: center; gap: 2px; font-size: 8px; width: 100%; height: 100%; align-items: center; }
.cell-day-number { grid-row: 2; font-weight: 400; font-size: 12px; color: var(--text-color); }
.calendar-cell.today .cell-day-number { font-weight: 600; color: var(--primary-color); }
.cell-bottom-info { grid-row: 3; font-size: 7px; font-weight: 400; color: var(--text-color-light); width: 100%; text-align: left; padding-right: 2px; align-self: end; padding-bottom: 2px; }
.calendar-cell.has-data .cell-bottom-info { color: rgba(255, 255, 255, 0.9); }
.calendar-cell.off-day { background: #f3f2f1; color: var(--neutral-color); }
.off-day-indicator { position: absolute; top: 2px; right: 2px; font-size: 8px; }
.calendar-cell:hover { background: var(--primary-light); transform: none; }
.calendar-cell.other-month { color: #c8c6c4; background: #faf9f8; pointer-events: none; }
.calendar-cell.today { background: var(--primary-light); border: 2px solid var(--primary-color); }
.calendar-cell.has-data { color: white; font-weight: 500; }
.calendar-cell.score-high { background: var(--success-color); }
.calendar-cell.score-medium { background: var(--warning-color); }
.calendar-cell.score-low { background: var(--danger-color); }
.calendar-cell.score-negative { background: #605e5c; }
.score-indicator { position: absolute; bottom: 2px; right: 2px; font-size: 7px; background: rgba(0,0,0,0.6); color: white; padding: 1px 3px; border-radius: 2px; font-weight: 500; }
.form-group { margin-bottom: 16px; }
.form-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 4px; font-size: 13px; }
.form-group input, .form-group textarea, .form-group select { 
    width: 100%; 
    padding: 8px 12px; 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    font-size: 14px; 
    transition: all 0.15s ease; 
    font-family: 'Segoe UI', sans-serif;
    background: var(--container-bg);
    color: var(--text-color);
}
.form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 1px var(--primary-color); }
.main-actions { display: flex; gap: 8px; margin-bottom: 8px; }
.btn { 
    width: 100%; 
    padding: 10px 16px; 
    background: var(--primary-color);
    color: white; 
    border: 1px solid var(--primary-color);
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    font-size: 14px; 
    font-weight: 500; 
    cursor: pointer; 
    transition: all 0.15s ease; 
    font-family: 'Segoe UI', sans-serif;
}
.btn:hover { background: var(--primary-dark); border-color: var(--primary-dark); transform: none; }
.btn:active { transform: scale(0.98); }
.main-actions .btn { flex: 1; }
.btn.secondary { background: var(--container-bg); color: var(--text-color); border-color: var(--border-color); }
.btn.secondary:hover { background: var(--primary-light); border-color: var(--primary-color); color: var(--primary-color); }
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(2px); z-index: 1000; align-items: center; justify-content: center; }
.modal-content { 
    background: var(--container-bg); 
    padding: 0; 
    border-radius: 0; /* 8pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    width: 90%; 
    max-width: 800px; 
    max-height: 95vh; 
    overflow-y: auto; 
    box-shadow: 
        0 25.6px 57.6px 0 rgba(0, 0, 0, 0.22), 
        0 4.8px 14.4px 0 rgba(0, 0, 0, 0.18);
}
#dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border-color); background: #fafbfc; }
#dayModal .modal-body { padding: 20px; }
.modal-layout { display: block; }
@media (min-width: 768px) { .modal-layout { display: block; } }
.modal-side-column { display: flex; flex-direction: column; }
.modal-input-group { 
    background: var(--container-bg); 
    padding: 16px; 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    margin-bottom: 12px;
}
.modal-input-group h4 { font-size: 14px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color); color: var(--text-color); font-weight: 600; }
.modal-input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
#commentDetails summary { 
    font-weight: 500; 
    color: var(--text-color); 
    cursor: pointer; 
    padding: 8px 12px; 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    background-color: var(--primary-light); 
    border: 1px solid var(--primary-color); 
    list-style: none; 
    position: relative; 
    font-size: 13px;
}
#commentDetails summary::-webkit-details-marker { display: none; }
#commentDetails summary::before { content: 'â–¶'; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 10px; transition: transform 0.2s; }
#commentDetails[open] > summary::before { transform: translateY(-50%) rotate(90deg); }
#dayModal .form-group { margin-bottom: 12px; }
#dayModal .form-group label { font-size: 12px; margin-bottom: 4px; }
#dayModal .form-group input { padding: 6px 8px; font-size: 13px; }
#dayModal .modal-input-group,
#dayModal .score-display-card { margin-bottom: 12px; }
#dayModal .modal-layout > div:last-child { margin-bottom: 0; }
.modal-header { display: flex; justify-content: center; align-items: center; position: relative; gap: 16px; }
.modal-title { flex: none; text-align: center; margin: 0; font-size: 16px; color: var(--text-color); font-weight: 600; }
.date-nav-btn { background: var(--container-bg); border: 1px solid var(--border-color); font-size: 14px; color: var(--text-color); cursor: pointer; padding: 6px 10px; border-radius: 4px; transition: all 0.15s ease; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-family: 'Segoe UI', sans-serif; }
.date-nav-btn:hover { background: var(--primary-light); border-color: var(--primary-color); color: var(--primary-color); }
.close-btn { background: var(--container-bg); border: 1px solid var(--border-color); font-size: 16px; cursor: pointer; color: var(--text-color); line-height: 1; position: absolute; right: 0; top: 50%;  transform: translateY(-50%); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-family: 'Segoe UI', sans-serif; transition: all 0.15s ease; }
.close-btn:hover { background: #fdebee; border-color: var(--danger-color); color: var(--danger-color); }
.score-display-card { 
    background: var(--container-bg); 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 12pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 20px; 
    text-align: center; 
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.score-display-card .score { font-size: 36px; font-weight: 600; color: var(--primary-color); line-height: 1; }
.score-display-card .score.is-off { color: var(--neutral-color); }
.score-display-card div:last-child { font-size: 13px; color: var(--text-color-light); margin-top: 4px; font-weight: 500; }
.exercise-toggle-group { margin-bottom: 12px; }
.exercise-toggle-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 6px; font-size: 13px; }
.exercise-toggle-btns { 
    display: flex; 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 8pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    overflow: hidden; 
}
.exercise-toggle-btn { 
    flex: 1; 
    padding: 8px 12px; 
    border: none; 
    background: var(--container-bg); 
    cursor: pointer; 
    font-weight: 500; 
    transition: all 0.15s ease; 
    font-size: 13px;
    color: var(--text-color);
    font-family: 'Segoe UI', sans-serif;
    border-radius: 0; /* ëª¨ë“  ë¼ìš´ë”© ì œê±° */
}
.exercise-toggle-btn.active { background: var(--success-color); color: white; }
.legend { display: flex; justify-content: center; flex-wrap: wrap; margin: 16px 0 0; font-size: 11px; gap: 12px; }
.legend-item { display: flex; align-items: center; gap: 4px; }
.legend-color { width: 10px; height: 10px; border-radius: 2px; border: 1px solid rgba(0,0,0,0.1); }
.goal-tabs { display: flex; gap: 4px; margin-bottom: 16px; }
.goal-tab { padding: 6px 12px; background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.15s ease; color: var(--text-color); font-family: 'Segoe UI', sans-serif; }
.goal-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
.goal-type-toggle { display: flex; gap: 4px; margin-bottom: 12px; }
.goal-type-toggle button { flex: 1; padding: 6px 12px; font-size: 12px; border: 1px solid var(--border-color); background: var(--container-bg); border-radius: 4px; cursor: pointer; font-weight: 500; transition: all 0.15s ease; color: var(--text-color); font-family: 'Segoe UI', sans-serif; }
.goal-type-toggle button.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
#personalGoalsPage .header { text-align: left; }
.dday-header-container { height: auto; margin-bottom: 4px; display: flex; justify-content: space-between; align-items: flex-start; position: absolute; top: 8px; left: 8px; right: 8px; z-index: 10; pointer-events: none; }
.dday-chip { background: var(--primary-color); color: white; padding: 4px 8px; border-radius: 12px; font-weight: 500; font-size: 10px; display: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1); pointer-events: all; }
.battery { display: none; width: 28px; height: 12px; border: 1px solid var(--border-color); border-radius: 2px; position: relative; padding: 1px; background: var(--container-bg); }
.battery::after { content: ''; position: absolute; top: 50%; right: -3px; transform: translateY(-50%); width: 2px; height: 6px; background: var(--border-color); border-radius: 0 1px 1px 0; }
.battery-level { height: 100%; border-radius: 1px; transition: width 0.3s ease; }
.battery-level.green { background: var(--success-color); } 
.battery-level.yellow { background: var(--warning-color); } 
.battery-level.red { background: var(--danger-color); } 
.battery-level.black { background: var(--text-color); }
.budget-summary { display: flex; gap: 8px; margin-bottom: 16px; }
.budget-card { 
    flex: 1; 
    background: var(--primary-light); 
    color: var(--primary-color); 
    padding: 15px; 
    border-radius: 0; /* 12pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    text-align: center; 
    border: 1px solid var(--primary-color);
}
.budget-card-title { font-size: 11px; margin-bottom: 4px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
.budget-card-value { font-size: 18px; font-weight: 600; }
#budgetPage .header p { font-size: 14px; font-weight: 500; color: var(--text-color); }
.personal-goals-section { background: var(--container-bg); padding: 12px; border: 1px solid var(--border-color); border-radius: 4px; }
#modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }
.personal-goal-checkbox { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    padding: 8px; 
    background: var(--container-bg); 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    margin-bottom: 8px; 
}
.personal-goal-item { 
    background: var(--container-bg); 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 12px; 
    margin-bottom: 8px; 
}
.personal-goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.personal-goal-name { font-weight: 500; }
.personal-goal-actions button { 
    padding: 4px 8px; 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    font-size: 11px; 
    border: 1px solid; 
    cursor: pointer; 
    color: white;
    font-family: 'Segoe UI', sans-serif;
    font-weight: 500;
    margin-left: 4px;
}
.edit-btn { background: var(--warning-color); border-color: var(--warning-color); }
.delete-btn { background: var(--danger-color); border-color: var(--danger-color); }
.complete-btn { background: var(--success-color); border-color: var(--success-color); }
.reopen-btn { background: var(--primary-color); border-color: var(--primary-color); }
.empty-goals { 
    text-align: center; 
    color: var(--text-color-light); 
    padding: 32px 16px; 
    background: #fafbfc; 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    margin-top: 16px; 
}
.budget-settings, .dday-settings { margin-bottom: 24px; }
.budget-input, .dday-actions { display: flex; gap: 8px; align-items: center; }
.dday-item { 
    background: #fafbfc; 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 10px 12px; 
    margin-bottom: 8px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
}
.budget-input button { padding: 8px 16px; background: var(--success-color); color: white; border: 1px solid var(--success-color); border-radius: 4px; font-weight: 500; cursor: pointer; font-family: 'Segoe UI', sans-serif; font-size: 13px; }
.wakeup-prompt { background: var(--primary-light); color: var(--primary-color); padding: 16px; border: 1px solid var(--primary-color); border-radius: 4px; text-align: center; margin-bottom: 16px; }
.monthly-summary { display: flex; justify-content: space-around; gap: 12px; margin-bottom: 24px; }
.summary-card { 
    flex-basis: 30%; 
    background: var(--primary-light); 
    color: var(--primary-color); 
    padding: 16px; 
    border-radius: 0; /* 15pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    text-align: center; 
    border: 1px solid var(--primary-color);
}
.summary-title { font-size: 11px; margin-bottom: 8px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
.summary-value { font-size: 20px; font-weight: 600; }
.week-card { 
    background: var(--container-bg); 
    border-radius: 0; /* 15pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 16px; 
    margin-bottom: 12px; 
    border: 1px solid var(--border-color);
}
.week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 500; }
.week-stats { display: flex; justify-content: space-around; align-items: center; text-align: center; font-size: 18px; font-weight: 500; }
.empty-expenses { text-align: center; color: var(--text-color-light); padding: 32px 16px; }
.feedback-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; z-index: 2000; animation: fadeIn 0.3s ease; justify-content: center; align-items: center; }
.feedback-content { position: relative; background: var(--container-bg); padding: 24px; border-radius: 8px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 25.6px 57.6px 0 rgba(0, 0, 0, 0.22), 0 4.8px 14.4px 0 rgba(0, 0, 0, 0.18); animation: popIn 0.5s ease; }
.feedback-emoji { font-size: 48px; margin-bottom: 16px; display: block; }
.feedback-title { font-size: 18px; font-weight: 600; margin-bottom: 12px; color: var(--text-color); }
.feedback-message { font-size: 14px; color: var(--text-color-light); line-height: 1.5; margin-bottom: 20px; }
.feedback-celebration .feedback-title, 
.feedback-celebration .feedback-message, 
.feedback-reflection .feedback-title, 
.feedback-reflection .feedback-message, 
.feedback-disaster .feedback-title, 
.feedback-disaster .feedback-message, 
.feedback-encouragement .feedback-title, 
.feedback-encouragement .feedback-message, 
.feedback-warning .feedback-title, 
.feedback-warning .feedback-message { color: white; }
.feedback-celebration { background: linear-gradient(135deg, var(--success-color), #0e7b0e); }
.feedback-reflection { background: linear-gradient(135deg, var(--warning-color), #e67700); }
.feedback-disaster { background: linear-gradient(135deg, #605e5c, #484644); }
.feedback-encouragement { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); }
.feedback-warning { background: linear-gradient(135deg, var(--danger-color), #b92e32); }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
.feedback-btn { background: rgba(255,255,255,0.9); color: var(--text-color); border: 1px solid rgba(255,255,255,0.5); padding: 8px 20px; border-radius: 4px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.15s ease; margin: 0 4px; font-family: 'Segoe UI', sans-serif; }
.feedback-btn:hover { background: white; transform: translateY(-1px); }
.feedback-budget-red { background: linear-gradient(135deg, var(--danger-color), #b92e32) !important; }
.feedback-budget-black { background: linear-gradient(135deg, #605e5c, #484644) !important; }
.expense-input-row { display: flex; gap: 8px; align-items: center; margin-top: 8px; }
.expense-input-row input { flex: 1; padding: 6px 8px; font-size: 13px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--container-bg); color: var(--text-color); font-family: 'Segoe UI', sans-serif; }
.expense-input-row button { flex-shrink: 0; width: 32px; height: 32px; border-radius: 4px; background: var(--primary-color); border: 1px solid var(--primary-color); color: white; font-weight: 500; cursor: pointer; font-size: 16px; transition: all 0.15s ease; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; }
.expense-input-row button:hover { background: var(--primary-dark); border-color: var(--primary-dark); }
.expense-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; font-size: 13px; border-bottom: 1px solid #f3f2f1; }
.dday-settings h4 { margin-bottom: 12px; }
.dday-item .dday-actions { display: flex; gap: 4px; }
.dday-item .dday-actions button { background: var(--container-bg); border: 1px solid var(--border-color); width: 24px; height: 24px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: all 0.15s ease; color: var(--text-color-light); font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; }
.dday-item .dday-actions button:hover { background: var(--primary-light); border-color: var(--primary-color); color: var(--primary-color); }
.excel-option-item { display: flex; align-items: center; padding: 6px 0; cursor: pointer; }
.excel-option-item input[type="radio"] { width: 16px; height: 16px; margin-right: 8px; }
.excel-option-item label { font-size: 13px; font-family: 'Segoe UI', sans-serif; }
#customDateRange { display: flex; gap: 8px; align-items: center; margin-top: 8px; margin-bottom: 16px; }
#customDateRange input[type="date"] { padding: 6px 8px; border-radius: 4px; border: 1px solid var(--border-color); flex: 1; font-family: 'Segoe UI', sans-serif; background: var(--container-bg); color: var(--text-color); font-size: 13px; }
.number-input-group {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-color);
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    overflow: hidden;
    background: var(--container-bg);
}
.number-input-group input { border: none; text-align: center; flex: 1; padding: 6px 4px; background: var(--container-bg); color: var(--text-color); font-size: 13px; }
.number-input-group input:focus { box-shadow: none; border: none; }
.number-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: #f3f2f1;
    color: var(--text-color);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Segoe UI', sans-serif;
    border-radius: 0; /* ëª¨ë“  ë¼ìš´ë”© ì œê±° */
}
.number-btn:hover { background: var(--primary-light); color: var(--primary-color); }
.number-btn:active { background: var(--primary-color); color: white; }
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.food-page-actions { display: flex; gap: 8px; margin-bottom: 8px; }
.food-page-actions .btn.secondary.danger { background-color: var(--danger-color); color: white; border-color: var(--danger-color); }
.food-date-header { display: flex; align-items: center; text-align: center; margin: 24px 0 8px; color: var(--text-color-light); }
.food-date-header::before, .food-date-header::after { content: ''; flex: 1; border-bottom: 1px solid var(--border-color); }
.food-date-header span { padding: 0 12px; font-size: 12px; font-weight: 500; }
.food-record-item { display: grid; grid-template-columns: 50px 30px 1fr auto; gap: 12px; align-items: center; padding: 12px 4px; border-bottom: 1px solid #f3f2f1; position: relative; }
.food-record-item .food-admin-actions { position: absolute; right: 0px; top: 50%; transform: translateY(-50%); display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
.food-records.admin-mode .food-record-item .food-admin-actions { opacity: 1; pointer-events: auto; }
.food-admin-actions button { background: var(--container-bg); border: 1px solid var(--border-color); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 11px; transition: all 0.15s ease; font-family: 'Segoe UI', sans-serif; }
.food-admin-actions button.edit { color: var(--warning-color); }
.food-admin-actions button.delete { color: var(--danger-color); }
.food-admin-actions button:hover { background-color: var(--primary-light); border-color: var(--primary-color); color: var(--primary-color); }
#foodExportModal .modal-content { max-width: 90vw; background: var(--container-bg); padding: 0; }
#foodExportPreview { background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; padding: 0; margin: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-family: 'Segoe UI', sans-serif; }
.food-receipt-header { padding: 12px 16px 8px; background: #f3f2f1; border-bottom: 1px solid var(--border-color); }
.food-receipt-title { display: block; text-align: center; margin-bottom: 4px; }
.food-receipt-title h3 { margin: 0; font-size: 14px; color: var(--text-color); font-weight: 600; }
.food-receipt-header p { margin: 0; font-size: 11px; color: var(--text-color-light); text-align: center; }
.food-receipt-divider { height: 1px; background: var(--border-color); margin: 0 12px; }
.food-receipt-items { padding: 12px 16px 8px; }
.food-receipt-date-header { font-weight: 600; color: var(--text-color); font-size: 12px; margin: 12px 0 6px 0; padding-bottom: 4px; border-bottom: 1px solid #f3f2f1; }
.food-receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; font-size: 11px; line-height: 1.3; }
.food-receipt-time { color: var(--text-color-light); font-size: 10px; min-width: 40px; margin-right: 8px; }
.food-receipt-desc { flex: 1; font-weight: 500; color: var(--text-color); margin-right: 8px; }
.food-receipt-quantity { font-weight: 500; color: var(--text-color); font-size: 11px; text-align: right; min-width: 50px; }
#foodExportModal .close-btn { position: absolute; top: 12px; right: 12px; background: var(--container-bg); border: 1px solid var(--border-color); width: 28px; height: 28px; border-radius: 4px; font-size: 14px; color: var(--text-color); cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; font-family: 'Segoe UI', sans-serif; }
#foodExportModal .close-btn:hover { background: #fdebee; border-color: var(--danger-color); color: var(--danger-color); }
.food-modal { max-width: 420px; background-color: var(--container-bg); overflow: hidden; }
.food-modal .modal-header { padding: 12px 16px; background-color: #f3f2f1; border-bottom: 1px solid var(--border-color); }
.food-modal .modal-header h2 { font-size: 16px; font-weight: 600; }
.food-modal .modal-body { padding: 16px; }
.food-modal .form-group { margin-bottom: 12px; }
.food-modal .form-group label { font-size: 12px; margin-bottom: 4px; }
.food-modal .form-group input, .food-modal .form-group select { padding: 6px 8px; font-size: 13px; }
.food-modal .quantity-input { display: flex; gap: 6px; }
.food-modal .quantity-input select { width: 90px; }
.food-modal .food-modal-actions { margin-top: 16px; display: flex; gap: 8px; }
.food-modal .food-modal-actions .btn { flex: 1; padding: 8px 12px; }
.fame-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 8px; }
.fame-card { 
    background: var(--container-bg); 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 12px; 
    text-align: center; 
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.fame-card-title { font-size: 16px; margin-bottom: 6px; }
.fame-card-value { font-size: 16px; font-weight: 600; color: var(--primary-color); }
.fame-card-date { font-size: 10px; color: var(--text-color-light); margin-top: 3px; }
#wallOfShame .fame-card-value { color: var(--danger-color); }
#modalCommentSection { margin-top: 16px; }
#modalComment { width: 100%; margin-top: 12px; height: 70px; resize: vertical; font-size: 13px; }
#modalPersonalGoalsList input[type="number"] { font-size: 13px; }
.comment-history-list { max-height: 450px; overflow-y: auto; padding-right: 4px; }
.comment-item { 
    background: var(--container-bg); 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 12px 16px; 
    margin-bottom: 8px; 
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.comment-item-header { font-size: 11px; color: var(--text-color-light); font-weight: 500; margin-bottom: 8px; }
.comment-item-body { font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-break: break-word; }
.empty-comments { 
    text-align: center; 
    color: var(--text-color-light); 
    padding: 40px 16px; 
    background: #fafbfc; 
    border: 1px solid var(--border-color); 
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
}
.receipt-container {
    background: var(--container-bg);
    border: 1px solid var(--border-color);
    border-radius: 0; /* 4pxì—ì„œ 0ìœ¼ë¡œ ë³€ê²½ */
    padding: 0;
    margin-top: 0;
    margin-bottom: 16px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', sans-serif;
    max-width: 100%;
    overflow: hidden;
}
.receipt-header { padding: 12px 16px 8px; background: #f3f2f1; border-bottom: 1px solid var(--border-color); }
.receipt-title { display: block; text-align: center; margin-bottom: 4px; position: relative; }
.receipt-title h3 { margin: 0; font-size: 14px; color: var(--text-color); font-weight: 600; }
.budget-info { display: flex; flex-direction: column; gap: 2px; font-size: 9px; color: var(--text-color-light); font-weight: 500; text-align: right; position: absolute; top: -4px; right: -6px; }
.receipt-header p { margin: 0; font-size: 11px; color: var(--text-color-light); text-align: center; }
.receipt-divider { height: 1px; background: var(--border-color); margin: 0 12px; }
.receipt-items { padding: 12px 16px 8px; }
.receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 3px 6px; font-size: 11px; line-height: 1.3; }
.receipt-date { color: var(--text-color-light); font-size: 10px; min-width: 55px; margin-right: 12px; }
.receipt-desc { flex: 1; font-weight: 500; color: var(--text-color); margin-right: 12px; }
.receipt-amount { font-weight: 600; color: var(--text-color); font-size: 11px; text-align: right; min-width: 60px; }
.receipt-total { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: #f3f2f1; font-weight: 600; font-size: 13px; font-family: 'Segoe UI', sans-serif; color: var(--text-color); border-top: 1px solid var(--border-color); }
.calendar-cell.skeleton { background: #f8f9fa; border: 1px solid #e9ecef; position: relative; overflow: hidden; }
.calendar-cell.skeleton::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); animation: shimmer 1.5s infinite; }
.calendar-cell.skeleton .cell-day-number { color: #ced4da; background: transparent; }
.calendar-cell.skeleton .cell-top-icons,
.calendar-cell.skeleton .cell-bottom-info { background: transparent; }
@keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }
.loading-indicator { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-color-light); font-size: 11px; z-index: 10; background: rgba(255, 255, 255, 0.95); padding: 4px 8px; border: 1px solid var(--border-color); border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
#dailyQuestModal .modal-header { padding-top: 20px; padding-bottom: 12px; }
.quest-tabs { display: flex; gap: 4px; margin-bottom: 16px; }
.quest-tab { padding: 6px 12px; background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.15s ease; color: var(--text-color); font-family: 'Segoe UI', sans-serif; }
.quest-tab.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
.quest-list { display: flex; flex-direction: column; gap: 8px; }
.quest-item { background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px; transition: all 0.15s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.quest-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-color: var(--primary-color); }
.quest-item.completed { background: var(--success-color); color: white; border-color: var(--success-color); }
.quest-item.completed .quest-reward { color: rgba(255, 255, 255, 0.9); }
.quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.quest-title { font-weight: 500; font-size: 13px; }
.quest-reward { font-size: 11px; color: var(--primary-color); font-weight: 500; }
.quest-desc { font-size: 12px; color: var(--text-color-light); margin-bottom: 8px; line-height: 1.4; }
.quest-progress { display: flex; justify-content: space-between; align-items: center; }
.quest-progress-bar { flex: 1; height: 6px; background: #f3f2f1; border: 1px solid var(--border-color); border-radius: 3px; margin-right: 8px; overflow: hidden; }
.quest-progress-fill { height: 100%; background: var(--primary-color); transition: width 0.3s ease; border-radius: 2px; }
.quest-progress-text { font-size: 10px; color: var(--text-color-light); min-width: 35px; text-align: right; }
.quest-item.completed .quest-progress-bar { background: rgba(255, 255, 255, 0.3); border-color: rgba(255, 255, 255, 0.3); }
.quest-item.completed .quest-progress-fill { background: rgba(255, 255, 255, 0.8); }
.quest-item.completed .quest-progress-text { color: rgba(255, 255, 255, 0.9); }
#rewardsModal .modal-header { padding: 20px 20px 16px 20px; border-bottom: 1px solid var(--border-color); background: var(--container-bg); }
.rewards-list { display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; }
.reward-item { background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px; display: flex; justify-content: space-between; align-items: center; transition: all 0.15s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.reward-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-color: var(--primary-color); }
.reward-item.bronze { border-color: #CD7F32; background: #fef9f3; }
.reward-item.silver { border-color: #C0C0C0; background: #f8f9fa; }
.reward-item.gold { border-color: #FFD700; background: #fffdf0; }
.reward-item.legend { border-color: #9400D3; background: #faf5ff; }
.reward-item.used { opacity: 0.6; filter: grayscale(30%); }
.reward-info { flex: 1; }
.reward-name { font-weight: 500; font-size: 13px; margin-bottom: 3px; }
.reward-desc { font-size: 11px; color: var(--text-color-light); line-height: 1.4; }
.reward-tier { font-size: 9px; font-weight: 500; padding: 2px 6px; border-radius: 2px; margin-bottom: 3px; display: inline-block; border: 1px solid; text-transform: uppercase; letter-spacing: 0.5px; }
.reward-tier.bronze { background: #CD7F32; color: white; border-color: #A0522D; }
.reward-tier.silver { background: #C0C0C0; color: var(--text-color); border-color: #808080; }
.reward-tier.gold { background: #FFD700; color: var(--text-color); border-color: #FFA500; }
.reward-tier.legend { background: #9400D3; color: white; border-color: #4B0082; }
.reward-actions { display: flex; gap: 6px; }
.reward-btn { padding: 4px 10px; border: 1px solid; border-radius: 4px; font-size: 10px; font-weight: 500; cursor: pointer; transition: all 0.15s ease; font-family: 'Segoe UI', sans-serif; }
.reward-btn.use { background: var(--success-color); color: white; border-color: var(--success-color); }
.reward-btn.use:hover { background: #0e7b0e; border-color: #0e7b0e; }
.reward-btn.delete { background: var(--danger-color); color: white; border-color: var(--danger-color); }
.reward-btn.delete:hover { background: #b92e32; border-color: #b92e32; }
.reward-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.empty-rewards { text-align: center; padding: 32px 16px; color: var(--text-color-light); }
.profile-menu-item:hover { background: var(--primary-light); color: var(--primary-color); }
#profileWidget:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
#profileWidget { transition: all 0.15s ease; background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; padding: 6px 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); min-width: 120px; }
#expBar { background: linear-gradient(90deg, var(--primary-color), var(--success-color)); height: 4px; border-radius: 2px; }
.achievements-list { display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; }
.achievement-item { background: var(--container-bg); border: 1px solid var(--border-color); border-radius: 4px; padding: 12px; display: flex; align-items: center; gap: 12px; transition: all 0.15s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.achievement-item.unlocked { border-color: var(--success-color); background: #f1f8e9; }
.achievement-item.locked { opacity: 0.6; }
.achievement-emoji { font-size: 20px; min-width: 40px; text-align: center; }
.achievement-info { flex: 1; }
.achievement-name { font-weight: 500; font-size: 13px; margin-bottom: 3px; }
.achievement-desc { font-size: 11px; color: var(--text-color-light); line-height: 1.4; }
.achievement-status { font-size: 10px; font-weight: 500; padding: 3px 6px; border-radius: 2px; border: 1px solid; text-transform: uppercase; letter-spacing: 0.5px; }
.achievement-status.unlocked { background: var(--success-color); color: white; border-color: var(--success-color); }
.achievement-status.locked { background: #f3f2f1; color: var(--text-color-light); border-color: var(--border-color); }
.achievement-item.hidden { background: #f8f9fa; color: var(--text-color-light); border-color: var(--border-color); }
.achievement-item.hidden .achievement-desc { color: var(--text-color-light); font-style: italic; }

@media (max-width: 767px) {
    body { font-size: 12px; padding: 12px; }
    .container { padding: 24px 12px 80px 12px; }
    .header h1 { font-size: 18px; }
    .header p { font-size: 12px; }
    .btn { font-size: 13px; padding: 8px 12px; }
    .form-group label { font-size: 12px; }
    .form-group input, .form-group textarea, .form-group select { font-size: 13px; padding: 6px 8px; }
    .modal-content { padding: 0; width: 100%; height: 100%; border-radius: 0; max-height: 100vh; }
    .food-modal { width: 90%; height: auto; border-radius: 4px; max-height: 90vh; }
    .food-modal .modal-body { overflow-y: auto; max-height: calc(90vh - 120px); }
    #dayModal .modal-body { padding: 16px 12px; }
    .modal-input-group { padding: 12px; }
    .modal-input-group h4 { font-size: 13px; }
    #dayModal .form-group label { font-size: 11px; }
    #dayModal .modal-input-row { grid-template-columns: 1fr; gap: 12px; }
    .exercise-toggle-btns { max-width: 200px; }
    .score-display-card, .personal-goals-section { width: 100%; max-width: none; margin: 0; padding: 12px; }
    .score-display-card .score { font-size: 28px; }
    #modalTotalExpense { text-align: left !important; }
    .expense-item { font-size: 12px; word-break: break-all; }
    .expense-item span:first-child { flex-grow: 1; margin-right: 8px; }
    .expense-item > div { flex-shrink: 0; }
    .modal-actions-container { padding: 0 12px 16px; display: flex; flex-direction: column; align-items: center; }
    .modal-actions-container .btn.delete { order: 2; background-color: transparent; color: var(--text-color-light); font-size: 11px; font-weight: 500; padding: 6px; box-shadow: none; margin-top: 8px; max-width: 150px; border: none; }
    .modal-actions-container .btn.delete:hover { background-color: transparent; color: var(--danger-color); }
    .modal-actions-container .btn.save { order: 1; }
    #budgetPage .budget-summary { flex-wrap: wrap; }
    #budgetPage .budget-summary .budget-card:first-child { flex-basis: 100%; }
    #budgetPage .budget-card-value { font-size: 16px; }
    #dayModal .expense-input-row { flex-direction: column; gap: 8px; }
    #dayModal .expense-input-row input,
    #dayModal .expense-input-row button { width: 100%; }
    .dday-header-container { top: 6px; left: 2px; right: 2px; }
    .dday-chip { font-size: 9px; padding: 3px 6px; }
    .battery { width: 24px; height: 10px; }
    .receipt-item { font-size: 10px; }
    .receipt-date { min-width: 40px; margin-right: 6px; font-size: 9px; }
    .receipt-desc { margin-right: 6px; }
    .receipt-amount { min-width: 45px; font-size: 10px; }
    .budget-info { flex-direction: column; gap: 1px; font-size: 8px; text-align: right; }
    .modal-title { font-size: 14px; }
    .quest-title { font-size: 12px; }
    .quest-desc { font-size: 11px; }
    .quest-reward { font-size: 10px; }
    .quest-progress-text { font-size: 9px; }
    .reward-name { font-size: 12px; }
    .reward-desc { font-size: 10px; }
    .achievement-name { font-size: 12px; }
    .achievement-desc { font-size: 10px; }
}
    `,
    
    sakura: `
    @font-face {
        font-family: 'KBIZHanmaumMyungjo';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    :root {
        --bg-color: #fefbfc;
        --primary-color: #f4a6cd;
        --primary-dark: #e991c0;
        --primary-light: #fdf3f7;
        --text-color: #5a4250;
        --text-color-light: #a08d97;
        --border-color: #f2e6ea;
        --container-bg: #ffffff;
        --danger-color: #f0a8c1;
        --warning-color: #f5c2a3;
        --success-color: #c8e4c2;
        --neutral-color: #d4c4cc;
        --sakura-accent: #f8eef2;
        --sakura-soft: #fcf7f9;
        --sakura-deep: #e67db3;
        --sakura-petal: #ffeef5;
        --sakura-bloom: #ffe4f0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    @keyframes sakuraPetals {
        0% {
            transform: translateY(-100vh) rotate(0deg);
            opacity: 0.8;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 0.7;
        }
        100% {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }

    @keyframes sakuraPetalsFloat {
        0%, 100% { transform: translateX(0px) rotate(0deg); }
        25% { transform: translateX(10px) rotate(90deg); }
        50% { transform: translateX(-5px) rotate(180deg); }
        75% { transform: translateX(8px) rotate(270deg); }
    }

    body { 
        font-family: 'KBIZHanmaumMyungjo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        background: linear-gradient(135deg, #fefbfc 0%, #fdf3f7 50%, #fcf0f4 100%);
        min-height: 100vh; 
        padding: 20px; 
        color: var(--text-color); 
        position: relative;
        overflow-x: hidden;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            radial-gradient(circle at 15% 25%, rgba(244, 166, 205, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 85% 75%, rgba(253, 243, 247, 0.12) 0%, transparent 50%),
            radial-gradient(circle at 45% 40%, rgba(252, 240, 244, 0.06) 0%, transparent 50%),
            radial-gradient(circle at 70% 20%, rgba(255, 238, 245, 0.1) 0%, transparent 40%);
        pointer-events: none;
        z-index: -1;
    }

    /* ë–¨ì–´ì§€ëŠ” ê½ƒì íš¨ê³¼ - ë’¤ìª½ì— ë°°ì¹˜ */
    body::after {
        content: 'ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸';
        position: fixed;
        top: -50px;
        left: 0;
        width: 100%;
        font-size: 12px;
        line-height: 1;
        animation: sakuraPetals 15s infinite linear;
        pointer-events: none;
        z-index: -2;
        opacity: 0.4;
        letter-spacing: 80px;
        animation-delay: -5s;
    }

    .container::before {
        content: 'ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸ ğŸŒ¸';
        position: fixed;
        top: -30px;
        left: 20%;
        width: 60%;
        font-size: 10px;
        animation: sakuraPetals 20s infinite linear;
        pointer-events: none;
        z-index: -2;
        opacity: 0.3;
        letter-spacing: 100px;
        animation-delay: -10s;
    }
    
    button, input, select, textarea { font-family: inherit; }
    .container { 
        background: rgba(255, 255, 255, 0.95); 
        border-radius: 24px; 
        padding: 50px 30px 100px 30px;
        width: 100%; 
        max-width: 500px; 
        margin: 0 auto; 
        box-shadow: 
            0 20px 60px rgba(244, 166, 205, 0.15), 
            0 8px 25px rgba(253, 243, 247, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        position: relative;
        border: 1px solid rgba(248, 238, 242, 0.6);
        backdrop-filter: blur(10px);
    }
    .header { text-align: center; margin-bottom: 25px; position: relative; }
    .header h1 { 
        color: var(--primary-color); 
        font-size: 26px; 
        font-weight: 700; 
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .header p { color: var(--text-color-light); font-size: 14px; }
    #gameWarning { 
        background: linear-gradient(135deg, var(--sakura-petal), var(--sakura-bloom)); 
        color: var(--sakura-deep); 
        border: 1px solid rgba(246, 189, 213, 0.3); 
        border-radius: 18px; 
        padding: 15px; 
        font-size: 14px; 
        font-weight: 500; 
        margin-bottom: 20px; 
        display: none;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .page { display: none; }
    .page.active { display: block; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .month-nav { 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.8)); 
        border: 1px solid rgba(248, 238, 242, 0.4); 
        font-size: 22px; 
        color: var(--primary-color); 
        cursor: pointer; 
        padding: 12px; 
        border-radius: 16px; 
        transition: all 0.4s ease; 
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .month-nav:hover { 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--sakura-deep);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.2);
    }
    .month-year { 
        font-size: 20px; 
        font-weight: 700; 
        color: var(--primary-color);
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.1);
    }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 20px; }
    .calendar-header-cell { text-align: center; padding: 10px 5px; font-weight: 600; color: var(--text-color-light); font-size: 12px; }
    .calendar-cell { 
        aspect-ratio: 1; 
        display: grid; 
        grid-template-rows: 1fr auto 1fr; 
        padding: 3px; 
        align-items: center; 
        justify-items: center;
        border-radius: 16px;
        border: 1px solid transparent;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.7);
        position: relative;
    }
    .cell-top-icons { grid-row: 1; display: flex; justify-content: center; gap: 2px; font-size: 9px; width: 100%; height: 100%; align-items: center; }
    .cell-day-number { grid-row: 2; font-weight: 500; color: var(--text-color); }
    .calendar-cell.today .cell-day-number { font-weight: 700; }
    .cell-bottom-info { grid-row: 3; font-size: 8px; font-weight: 600; color: var(--text-color-light); width: 100%; text-align: left; padding-right: 4px; align-self: end; padding-bottom: 3px; }

    .calendar-cell.has-data .cell-bottom-info { color: rgba(255, 255, 255, 0.9); }
    .calendar-cell.off-day { 
        background: linear-gradient(135deg, #f8f0f2, #f2e6ea); 
        color: var(--neutral-color); 
        border-radius: 14px; 
    }
    .off-day-indicator { position: absolute; top: 4px; right: 4px; font-size: 10px; }
    .calendar-cell:hover { 
        transform: translateY(-3px) scale(1.02); 
        box-shadow: 0 8px 25px rgba(244, 166, 205, 0.2);
        background: rgba(253, 243, 247, 0.9);
    }
    .calendar-cell.other-month { 
        color: #e4d2d8; 
        background: rgba(252, 247, 249, 0.5); 
        border-color: transparent; 
        pointer-events: none; 
        border-radius: 12px; 
    }
    .calendar-cell.today { 
        border: 2px solid var(--primary-color); 
        font-weight: 700; 
        color: var(--primary-color); 
        box-shadow: 
            0 0 0 3px rgba(244, 166, 205, 0.2),
            0 4px 15px rgba(244, 166, 205, 0.3);
        background: linear-gradient(135deg, rgba(253, 243, 247, 0.9), rgba(255, 255, 255, 0.95));
        animation: sakuraPetalsFloat 4s ease-in-out infinite;
    }
    .calendar-cell.has-data { color: white; border: none; font-weight: bold; }
    .calendar-cell.score-high { 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2); 
        box-shadow: 0 4px 12px rgba(200, 228, 194, 0.3);
    }
    .calendar-cell.score-medium { 
        background: linear-gradient(135deg, var(--warning-color), #f0b392); 
        box-shadow: 0 4px 12px rgba(245, 194, 163, 0.3);
    }
    .calendar-cell.score-low { 
        background: linear-gradient(135deg, var(--danger-color), #eca0b5); 
        box-shadow: 0 4px 12px rgba(240, 168, 193, 0.3);
    }
    .calendar-cell.score-negative { 
        background: linear-gradient(135deg, #d4c4cc, #c4b0bc); 
        box-shadow: 0 4px 12px rgba(212, 196, 204, 0.3);
    }
    .score-indicator { 
        position: absolute; 
        bottom: 4px; 
        right: 4px; 
        font-size: 9px; 
        background: rgba(0,0,0,0.2); 
        color: white; 
        padding: 2px 5px; 
        border-radius: 8px; 
        font-weight: 700; 
    }
    .form-group { margin-bottom: 20px; }
    .form-group label { 
        display: block; 
        color: var(--text-color); 
        font-weight: 600; 
        margin-bottom: 10px; 
        font-size: 14px; 
    }
    .form-group input, .form-group textarea, .form-group select { 
        width: 100%; 
        padding: 16px; 
        border: 1px solid var(--border-color); 
        border-radius: 18px; 
        font-size: 16px; 
        transition: all 0.3s ease; 
        font-family: 'KBIZHanmaumMyungjo', sans-serif;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(253, 247, 249, 0.8));
        box-shadow: inset 0 2px 4px rgba(244, 166, 205, 0.05);
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
        outline: none; 
        border-color: var(--primary-color); 
        box-shadow: 
            0 0 0 4px rgba(244, 166, 205, 0.15), 
            0 4px 12px rgba(244, 166, 205, 0.1),
            inset 0 2px 4px rgba(244, 166, 205, 0.05);
        background: linear-gradient(135deg, #ffffff, rgba(253, 243, 247, 0.9));
    }
    .main-actions { display: flex; gap: 15px; margin-bottom: 10px; }
    .btn { 
        width: 100%; 
        padding: 18px; 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        color: white; 
        border: none; 
        border-radius: 20px; 
        font-size: 16px; 
        font-weight: 700; 
        cursor: pointer; 
        transition: all 0.4s ease; 
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.3),
            0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.6s ease;
    }
    .btn:hover::before {
        left: 100%;
    }
    .btn:hover { 
        background: linear-gradient(135deg, var(--primary-dark), var(--sakura-deep)); 
        transform: translateY(-3px); 
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.4),
            0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .btn:active { 
        transform: translateY(-1px); 
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.4),
            0 2px 4px rgba(0, 0, 0, 0.1); 
    }
    .main-actions .btn { flex: 1; }
    .btn.secondary { 
        background: linear-gradient(135deg, var(--neutral-color), #c4b0bc); 
        box-shadow: 0 6px 20px rgba(212, 196, 204, 0.3);
    }
    .btn.secondary:hover { 
        background: linear-gradient(135deg, #c4b0bc, #b8a2b0); 
        box-shadow: 0 10px 30px rgba(212, 196, 204, 0.4);
    }
    .modal-overlay { 
        display: none; 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(90, 66, 80, 0.3); 
        backdrop-filter: blur(12px); 
        z-index: 1000; 
        align-items: center; 
        justify-content: center; 
    }
    .modal-content { 
        background: rgba(255, 255, 255, 0.98); 
        padding: 0; 
        border-radius: 24px; 
        width: 90%; 
        max-width: 800px; 
        max-height: 95vh; 
        overflow-y: auto; 
        box-shadow: 
            0 25px 80px rgba(244, 166, 205, 0.25), 
            0 10px 40px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(248, 238, 242, 0.6);
        backdrop-filter: blur(20px);
    }
    #dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { 
        padding: 25px 30px; 
        border-bottom: 1px solid rgba(248, 238, 242, 0.8); 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        border-top-left-radius: 24px; 
        border-top-right-radius: 24px; 
        position: relative;
    }
    #dayModal .modal-header::before {
        content: 'ğŸŒ¸ âœ¨ ğŸŒ¸';
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 14px;
        opacity: 0.6;
        animation: sakuraPetalsFloat 3s ease-in-out infinite;
    }
    #dayModal .modal-body { padding: 30px; }
    .modal-layout { display: block; }
    @media (min-width: 768px) { .modal-layout { display: block; } }
    .modal-side-column { display: flex; flex-direction: column; }
    .modal-input-group { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-soft)); 
        padding: 22px; 
        border-radius: 18px; 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        box-shadow: 
            0 4px 15px rgba(244, 166, 205, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .modal-input-group h4 { 
        font-size: 16px; 
        margin-bottom: 18px; 
        padding-bottom: 12px; 
        border-bottom: 1px solid rgba(248, 238, 242, 0.6); 
        color: var(--primary-color); 
        font-weight: 700;
    }
    .modal-input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
    
    #commentDetails summary { 
        font-weight: 600; 
        color: var(--text-color); 
        cursor: pointer; 
        padding: 15px; 
        border-radius: 16px; 
        background: linear-gradient(135deg, var(--sakura-petal), rgba(255, 255, 255, 0.9)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        list-style: none; 
        position: relative; 
        padding-left: 45px; 
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    #commentDetails summary:hover {
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal));
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.2);
    }
    #commentDetails summary::-webkit-details-marker { display: none; }
    #commentDetails summary::before { 
        content: 'ğŸŒ¸'; 
        position: absolute; 
        left: 15px; 
        top: 50%; 
        transform: translateY(-50%); 
        font-size: 14px; 
        transition: transform 0.4s ease; 
        animation: sakuraPetalsFloat 2s ease-in-out infinite;
    }
    #commentDetails[open] > summary::before { 
        transform: translateY(-50%) rotate(180deg); 
        content: 'ğŸŒº';
    }

    #dayModal .form-group { margin-bottom: 0; }
    #dayModal .form-group label { font-size: 13px; margin-bottom: 8px; }
    #dayModal .form-group input { padding: 12px; font-size: 16px; }
    #dayModal .modal-input-group,
    #dayModal .score-display-card { margin-bottom: 8px; }
    #dayModal .modal-layout > div:last-child { margin-bottom: 0; }
    .modal-header { display: flex; justify-content: center; align-items: center; position: relative; gap: 25px; }
    .modal-title { 
        flex: none; 
        text-align: center; 
        margin: 0; 
        color: var(--primary-color);
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }

    .date-nav-btn { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft)); 
        border: 1px solid rgba(248, 238, 242, 0.6); 
        font-size: 24px; 
        color: var(--primary-color); 
        cursor: pointer; 
        padding: 12px; 
        border-radius: 14px; 
        transition: all 0.3s ease; 
        width: 44px; 
        height: 44px; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .date-nav-btn:hover { 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--sakura-deep);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.2);
    }
    .close-btn { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft)); 
        border: 1px solid rgba(248, 238, 242, 0.6); 
        font-size: 24px; 
        cursor: pointer; 
        color: var(--primary-color); 
        line-height: 1; 
        position: absolute; 
        right: 0; 
        top: 50%; 
        transform: translateY(-50%);
        transition: all 0.3s ease;
        border-radius: 12px;
        padding: 8px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .close-btn:hover {
        color: var(--sakura-deep);
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal));
        transform: translateY(-50%) scale(1.05);
    }
    .score-display-card { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border-radius: 20px; 
        padding: 25px; 
        text-align: center; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .score-display-card .score { 
        font-size: 40px; 
        font-weight: 700; 
        color: var(--primary-color); 
        line-height: 1;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .score-display-card .score.is-off { color: var(--neutral-color); }
    .score-display-card div:last-child { font-size: 14px; color: var(--text-color-light); margin-top: 8px; }
    .exercise-toggle-group { margin-bottom: 18px; }
    .exercise-toggle-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 10px; font-size: 14px; }
    .exercise-toggle-btns { 
        display: flex; 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 16px; 
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .exercise-toggle-btn { 
        flex: 1; 
        padding: 14px; 
        border: none; 
        background: rgba(255, 255, 255, 0.9); 
        cursor: pointer; 
        font-weight: 600; 
        transition: all 0.3s ease; 
        font-size: 14px; 
        color: var(--text-color);
    }
    .exercise-toggle-btn.active { 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2); 
        color: #fff;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .legend { display: flex; justify-content: center; flex-wrap: wrap; margin: 20px 0 0; font-size: 12px; gap: 18px; }
    .legend-item { display: flex; align-items: center; gap: 6px; }
    .legend-color { width: 14px; height: 14px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    .goal-tabs { display: flex; gap: 12px; margin-bottom: 20px; }
    .goal-tab { 
        padding: 12px 20px; 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 16px; 
        cursor: pointer; 
        font-size: 14px; 
        font-weight: 600; 
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .goal-tab.active { 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        color: white; 
        border-color: var(--primary-color);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.3);
    }
    .goal-type-toggle { display: flex; gap: 8px; margin-bottom: 15px; }
    .goal-type-toggle button { 
        flex: 1; 
        padding: 12px; 
        font-size: 14px; 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border-radius: 14px; 
        cursor: pointer; 
        font-weight: 600; 
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .goal-type-toggle button.active { 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        color: white; 
        border-color: var(--primary-color);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.3);
    }
    #personalGoalsPage .header { text-align: left; }
    .dday-header-container { 
        height: auto; 
        margin-bottom: 5px; 
        display: flex; 
        justify-content: space-between; 
        align-items: flex-start; 
        position: absolute; 
        top: 15px; 
        left: 15px; 
        right: 15px; 
        z-index: 10; 
        pointer-events: none; 
    }
    .dday-chip { 
        background: linear-gradient(135deg, var(--sakura-bloom), rgba(255, 238, 245, 0.95)); 
        backdrop-filter: blur(12px); 
        color: var(--primary-color); 
        padding: 8px 14px; 
        border-radius: 18px; 
        font-weight: 700; 
        font-size: 11px; 
        display: none; 
        box-shadow: 
            0 4px 15px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8); 
        pointer-events: all; 
        border: 1px solid rgba(248, 238, 242, 0.6); 
        animation: sakuraPetalsFloat 3s ease-in-out infinite;
    }
    .battery { 
        display: none; 
        width: 32px; 
        height: 16px; 
        border: 2px solid var(--text-color-light); 
        border-radius: 8px; 
        position: relative; 
        padding: 2px;
        background: rgba(255, 255, 255, 0.9);
    }
    .battery::after { 
        content: ''; 
        position: absolute; 
        top: 50%; 
        right: -5px; 
        transform: translateY(-50%); 
        width: 3px; 
        height: 8px; 
        background: var(--text-color-light); 
        border-radius: 0 3px 3px 0; 
    }
    .battery-level { height: 100%; border-radius: 4px; transition: width 0.3s ease; }
    .battery-level.green { background: linear-gradient(90deg, var(--success-color), #b8dbb2); } 
    .battery-level.yellow { background: linear-gradient(90deg, var(--warning-color), #f0b392); } 
    .battery-level.red { background: linear-gradient(90deg, var(--danger-color), #eca0b5); } 
    .battery-level.black { background: linear-gradient(90deg, var(--text-color), #6d5660); }
    .budget-summary { display: flex; gap: 15px; margin-bottom: 25px; }
    .budget-card { 
        flex: 1; 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--primary-color); 
        padding: 20px; 
        border-radius: 18px; 
        text-align: center;
        border: 1px solid rgba(248, 238, 242, 0.6);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .budget-card-title { font-size: 12px; opacity: 0.9; margin-bottom: 10px; font-weight: 600; }
    .budget-card-value { 
        font-size: 22px; 
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    #budgetPage .header p { font-size: 16px; font-weight: 600; color: var(--text-color); }
    .personal-goals-section { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        padding: 20px; 
        border-radius: 18px; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    #modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }
    .personal-goal-checkbox { 
        display: flex; 
        align-items: center; 
        gap: 14px; 
        padding: 14px; 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft)); 
        border-radius: 14px; 
        margin-bottom: 12px; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.08);
    }
    .personal-goal-checkbox:hover {
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal));
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.15);
    }
    .personal-goal-item { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 18px; 
        padding: 20px; 
        margin-bottom: 15px;
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
    }
    .personal-goal-item:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .personal-goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .personal-goal-name { font-weight: 600; color: var(--text-color); }
    .personal-goal-actions button { 
        padding: 8px 14px; 
        border-radius: 12px; 
        font-size: 12px; 
        border: none; 
        cursor: pointer; 
        color: white; 
        transition: all 0.3s ease;
        font-weight: 600;
    }
    .edit-btn { 
        background: linear-gradient(135deg, var(--warning-color), #f0b392);
        box-shadow: 0 4px 12px rgba(245, 194, 163, 0.3);
    }
    .delete-btn { 
        background: linear-gradient(135deg, var(--danger-color), #eca0b5);
        box-shadow: 0 4px 12px rgba(240, 168, 193, 0.3);
    }
    .complete-btn { 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2);
        box-shadow: 0 4px 12px rgba(200, 228, 194, 0.3);
    }
    .reopen-btn { 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.3);
    }
    .personal-goal-actions button:hover {
        transform: translateY(-1px);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.4),
            0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .empty-goals { 
        text-align: center; 
        color: var(--text-color-light); 
        padding: 50px 25px; 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border-radius: 18px; 
        margin-top: 25px; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        box-shadow: 0 4px 15px rgba(244, 166, 205, 0.1);
    }
    .budget-settings, .dday-settings { margin-bottom: 35px; }
    .budget-input, .dday-actions { display: flex; gap: 15px; align-items: center; }
    .dday-item { 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border-radius: 16px; 
        padding: 18px 20px; 
        margin-bottom: 15px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        border: 1px solid rgba(248, 238, 242, 0.8);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.08);
    }
    .dday-item:hover {
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal));
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.15);
    }
    .budget-input button { 
        padding: 16px 24px; 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2); 
        color: white; 
        border: none; 
        border-radius: 16px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(200, 228, 194, 0.3);
    }
    .budget-input button:hover {
        background: linear-gradient(135deg, #b8dbb2, #a8ccb0);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(200, 228, 194, 0.4);
    }
    .wakeup-prompt { 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--primary-color); 
        padding: 25px; 
        border-radius: 20px; 
        text-align: center; 
        margin-bottom: 25px;
        border: 1px solid rgba(248, 238, 242, 0.6);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        position: relative;
    }
    .wakeup-prompt::before {
        content: 'ğŸŒ¸';
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 20px;
        opacity: 0.6;
        animation: sakuraPetalsFloat 4s ease-in-out infinite;
    }
    .monthly-summary { display: flex; justify-content: space-around; gap: 18px; margin-bottom: 35px; }
    .summary-card { 
        flex-basis: 30%; 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--primary-color); 
        padding: 25px; 
        border-radius: 20px; 
        text-align: center;
        border: 1px solid rgba(248, 238, 242, 0.6);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .summary-title { font-size: 14px; opacity: 0.9; margin-bottom: 12px; font-weight: 600; }
    .summary-value { 
        font-size: 24px; 
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .week-card { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border-radius: 20px; 
        padding: 25px; 
        margin-bottom: 18px; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
    }
    .week-card:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .week-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 18px; 
        font-weight: 600; 
        color: var(--text-color); 
    }
    .week-stats { 
        display: flex; 
        justify-content: space-around; 
        align-items: center; 
        text-align: center; 
        font-size: 22px; 
        font-weight: 600; 
    }
    .empty-expenses { text-align: center; color: var(--text-color-light); padding: 50px 25px; }
    .feedback-popup { 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(90, 66, 80, 0.3); 
        display: none; 
        z-index: 2000; 
        animation: fadeIn 0.3s ease; 
        justify-content: center; 
        align-items: center; 
        backdrop-filter: blur(12px); 
    }
    .feedback-content { 
        position: relative; 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), var(--sakura-petal)); 
        padding: 45px; 
        border-radius: 24px; 
        width: 90%; 
        max-width: 420px; 
        text-align: center; 
        box-shadow: 
            0 25px 80px rgba(244, 166, 205, 0.3), 
            0 10px 40px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.8); 
        animation: popIn 0.5s ease;
        border: 1px solid rgba(248, 238, 242, 0.6);
        backdrop-filter: blur(20px);
    }
    .feedback-emoji { font-size: 65px; margin-bottom: 25px; display: block; }
    .feedback-title { font-size: 24px; font-weight: 700; margin-bottom: 18px; color: var(--text-color); }
    .feedback-message { font-size: 16px; color: var(--text-color-light); line-height: 1.6; margin-bottom: 30px; }
    .feedback-celebration .feedback-title, .feedback-celebration .feedback-message, 
    .feedback-reflection .feedback-title, .feedback-reflection .feedback-message, 
    .feedback-disaster .feedback-title, .feedback-disaster .feedback-message, 
    .feedback-encouragement .feedback-title, .feedback-encouragement .feedback-message, 
    .feedback-warning .feedback-title, .feedback-warning .feedback-message { 
        color: rgba(255,255,255,0.95); 
    }
    .feedback-celebration { 
        background: linear-gradient(135deg, #c8e4c2, #b8dbb2); 
    } 
    .feedback-reflection { 
        background: linear-gradient(135deg, #f5c2a3, #f0b392); 
    } 
    .feedback-disaster { 
        background: linear-gradient(135deg, #d4c4cc, #c4b0bc); 
    } 
    .feedback-encouragement { 
        background: linear-gradient(135deg, #f4a6cd, #e991c0); 
    } 
    .feedback-warning { 
        background: linear-gradient(135deg, #f0a8c1, #eca0b5); 
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { 
        from { opacity: 0; transform: scale(0.8); } 
        to { opacity: 1; transform: scale(1); } 
    }
    .feedback-btn { 
        background: rgba(255,255,255,0.25); 
        color: white; 
        border: 2px solid rgba(255,255,255,0.4); 
        padding: 14px 32px; 
        border-radius: 24px; 
        font-size: 16px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        margin: 0 12px; 
    }
    .feedback-btn:hover { 
        background: rgba(255,255,255,0.35); 
        border-color: rgba(255,255,255,0.6); 
        transform: translateY(-2px); 
    }
    .feedback-budget-red { 
        background: linear-gradient(135deg, #f0a8c1, #eca0b5) !important; 
    }
    .feedback-budget-black { 
        background: linear-gradient(135deg, #d4c4cc, #c4b0bc) !important; 
    }
    .expense-input-row { display: flex; gap: 15px; align-items: center; margin-top: 12px; }
    .expense-input-row input { 
        flex: 1; 
        padding: 14px; 
        font-size: 14px; 
        border-radius: 14px; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft));
    }
    .expense-input-row button { 
        flex-shrink: 0; 
        width: 48px; 
        height: 48px; 
        border-radius: 16px; 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        border: none; 
        color: white; 
        font-weight: bold; 
        cursor: pointer; 
        font-size: 24px; 
        line-height: 48px; 
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.3);
    }
    .expense-input-row button:hover { 
        background: linear-gradient(135deg, var(--primary-dark), var(--sakura-deep)); 
        transform: scale(1.05); 
        box-shadow: 0 8px 25px rgba(244, 166, 205, 0.4);
    }
    .expense-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 10px 0; 
        font-size: 14px; 
        border-bottom: 1px solid rgba(248, 238, 242, 0.6); 
    }
    .expense-item:last-child { border-bottom: none; }
    .dday-settings h4 { margin-bottom: 18px; color: var(--primary-color); font-weight: 700; }
    .dday-item .dday-actions { display: flex; gap: 8px; }
    .dday-item .dday-actions button { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        width: 36px; 
        height: 36px; 
        border-radius: 12px; 
        font-size: 16px; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .dday-item .dday-actions button:hover { 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--sakura-deep); 
        border-color: var(--primary-color);
        transform: scale(1.1); 
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.2);
    }
    .excel-option-item { 
        display: flex; 
        align-items: center; 
        padding: 12px 0; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        border-radius: 12px; 
    }
    .excel-option-item:hover { 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
    }
    .excel-option-item input[type="radio"] { 
        width: 20px; 
        height: 20px; 
        margin-right: 14px; 
        accent-color: var(--primary-color); 
    }
    .excel-option-item label { font-size: 16px; }
    #customDateRange { display: flex; gap: 15px; align-items: center; margin-top: 12px; margin-bottom: 25px; }
    #customDateRange input[type="date"] { 
        padding: 14px; 
        border-radius: 14px; 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        flex: 1; 
        font-family: inherit;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft));
        transition: all 0.3s ease;
    }
    #customDateRange input[type="date"]:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(244, 166, 205, 0.15);
        background: linear-gradient(135deg, #ffffff, rgba(253, 243, 247, 0.9));
    }

    .number-input-group {
        display: flex;
        align-items: center;
        border: 1px solid rgba(248, 238, 242, 0.8);
        border-radius: 16px;
        overflow: hidden;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft));
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.08);
    }
    .number-input-group:focus-within {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(244, 166, 205, 0.15);
        background: linear-gradient(135deg, #ffffff, rgba(253, 243, 247, 0.9));
    }

    .number-input-group input {
        border: none;
        text-align: center;
        flex: 1;
        padding: 14px 10px;
        background: transparent;
        font-size: 16px;
        color: var(--text-color);
    }

    .number-input-group input:focus { box-shadow: none; border: none; outline: none; }

    .number-btn {
        width: 40px;
        height: 48px;
        border: none;
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9));
        color: var(--primary-color);
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .number-btn:hover { 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--sakura-deep); 
    }
    .number-btn:active { 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        color: white; 
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    .food-page-actions { display: flex; gap: 15px; margin-bottom: 12px; }
    .food-page-actions .btn.secondary.danger { 
        background: linear-gradient(135deg, var(--danger-color), #eca0b5); 
        color: white;
        box-shadow: 0 6px 20px rgba(240, 168, 193, 0.3);
    }
    .food-date-header { 
        display: flex; 
        align-items: center; 
        text-align: center; 
        margin: 35px 0 12px; 
        color: var(--text-color-light); 
    }
    .food-date-header::before, .food-date-header::after { 
        content: ''; 
        flex: 1; 
        border-bottom: 1px solid rgba(248, 238, 242, 0.8); 
    }
    .food-date-header span { padding: 0 18px; font-size: 13px; font-weight: 600; }
    .food-record-item { 
        display: grid; 
        grid-template-columns: 50px 30px 1fr auto; 
        gap: 18px; 
        align-items: center; 
        padding: 18px 10px; 
        border-bottom: 1px solid rgba(248, 238, 242, 0.6); 
        position: relative;
        transition: all 0.3s ease;
        border-radius: 12px;
    }
    .food-record-item:hover {
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9));
        margin: 0 -10px;
        padding: 18px 20px;
        box-shadow: 0 4px 15px rgba(244, 166, 205, 0.1);
    }
    .food-record-item .food-admin-actions { 
        position: absolute; 
        right: 10px; 
        top: 50%; 
        transform: translateY(-50%); 
        display: flex; 
        gap: 8px; 
        opacity: 0; 
        transition: opacity 0.3s; 
        pointer-events: none; 
    }
    .food-records.admin-mode .food-record-item .food-admin-actions { opacity: 1; pointer-events: auto; }
    .food-admin-actions button { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-soft)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        width: 32px; 
        height: 32px; 
        border-radius: 12px; 
        cursor: pointer; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        font-size: 13px; 
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .food-admin-actions button.edit { color: var(--warning-color); }
    .food-admin-actions button.delete { color: var(--danger-color); }
    .food-admin-actions button:hover { 
        background: linear-gradient(135deg, #ffffff, var(--sakura-bloom)); 
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.2);
    }
    
    #foodExportModal .modal-content { max-width: 90vw; background: white; padding: 0; }
    #foodExportPreview {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), var(--sakura-soft));
        border-radius: 18px;
        padding: 0;
        margin: 25px;
        box-shadow: 0 8px 25px rgba(244, 166, 205, 0.2);
        font-family: 'Courier New', monospace;
        border: 1px solid rgba(248, 238, 242, 0.8);
    }
    .food-receipt-header { 
        padding: 22px 25px 15px; 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
    }
    .food-receipt-title { display: block; text-align: center; margin-bottom: 8px; }
    .food-receipt-title h3 { 
        margin: 0; 
        font-size: 16px; 
        color: var(--primary-color); 
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .food-receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
    .food-receipt-divider {
        height: 1px;
        background: repeating-linear-gradient(
            to right,
            rgba(248, 238, 242, 0.8) 0px,
            rgba(248, 238, 242, 0.8) 3px,
            transparent 3px,
            transparent 6px
        );
        margin: 0 22px;
    }
    .food-receipt-items { padding: 22px 25px 15px; }
    .food-receipt-date-header { 
        font-weight: 700; 
        color: var(--primary-color); 
        font-size: 13px; 
        margin: 18px 0 10px 0; 
        padding-bottom: 8px; 
        border-bottom: 1px dashed rgba(248, 238, 242, 0.8); 
    }
    .food-receipt-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 6px 0; 
        font-size: 13px; 
        line-height: 1.5; 
    }
    .food-receipt-time { color: var(--text-color-light); font-size: 11px; min-width: 45px; margin-right: 15px; }
    .food-receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 15px; }
    .food-receipt-quantity { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 60px; }
    #foodExportModal .close-btn {
        position: absolute;
        top: 18px;
        right: 18px;
        background: linear-gradient(135deg, rgba(244, 166, 205, 0.15), rgba(255, 238, 245, 0.9));
        border: 1px solid rgba(248, 238, 242, 0.8);
        width: 40px;
        height: 40px;
        border-radius: 14px;
        font-size: 20px;
        color: var(--primary-color);
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.15);
    }

    #foodExportModal .close-btn:hover { 
        background: linear-gradient(135deg, rgba(244, 166, 205, 0.25), var(--sakura-bloom)); 
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.25);
    }

    @media (max-width: 767px) { 
        #foodExportModal.modal-overlay { background: white; backdrop-filter: none; }
        
        #foodExportModal .modal-content { 
            max-width: 100vw; 
            width: 100vw; 
            height: 100vh; 
            margin: 0; 
            padding: 0; 
            border-radius: 0; 
            box-shadow: none; 
        }
        #foodExportPreview { 
            margin: 0; 
            border-radius: 0; 
            box-shadow: none; 
            height: calc(100vh - 50px); 
            overflow-y: auto; 
            border: none; 
        }
        
        #foodExportModal .close-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 44px;
            height: 44px;
            font-size: 22px;
            background: linear-gradient(135deg, rgba(244, 166, 205, 0.9), var(--primary-color));
            color: white;
            z-index: 1000;
        }
        
        #foodExportModal .modal-content > div:last-child {
            position: fixed; 
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), var(--sakura-soft));
            padding: 18px;
            border-top: 1px solid rgba(248, 238, 242, 0.8);
        }
    }

    .food-modal { max-width: 420px; background-color: white; overflow: hidden; }
    .food-modal .modal-header { 
        padding: 22px 25px; 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        border-bottom: 1px solid rgba(248, 238, 242, 0.8); 
    }
    .food-modal .modal-header h2 { 
        font-size: 18px; 
        color: var(--primary-color);
        font-weight: 700;
    }
    .food-modal .modal-body { padding: 25px; }
    .food-modal .form-group { margin-bottom: 18px; }
    .food-modal .form-group label { font-size: 13px; margin-bottom: 10px; }
    .food-modal .form-group input, .food-modal .form-group select { 
        padding: 14px; 
        font-size: 15px; 
        border-radius: 14px; 
    }
    .food-modal .quantity-input { display: flex; gap: 12px; }
    .food-modal .quantity-input select { width: 90px; }
    .food-modal .food-modal-actions { margin-top: 25px; display: flex; gap: 15px; }
    .food-modal .food-modal-actions .btn { flex: 1; padding: 16px; }

    .fame-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; }
    .fame-card { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 18px; 
        padding: 20px; 
        text-align: center;
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
    }
    .fame-card:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .fame-card-title { font-size: 18px; margin-bottom: 10px; color: var(--text-color); }
    .fame-card-value { 
        font-size: 20px; 
        font-weight: 700; 
        color: var(--primary-color);
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .fame-card-date { font-size: 12px; color: var(--text-color-light); margin-top: 8px; }
    #wallOfShame .fame-card-value { color: var(--danger-color); }

    #modalCommentSection { margin-top: 25px; }
    #modalComment { 
        width: 100%; 
        margin-top: 18px; 
        height: 80px; 
        resize: vertical; 
        font-size: 16px;
        border-radius: 14px;
        border: 1px solid rgba(248, 238, 242, 0.8);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), var(--sakura-soft));
        transition: all 0.3s ease;
        padding: 14px;
    }
    #modalComment:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(244, 166, 205, 0.15);
        background: linear-gradient(135deg, #ffffff, rgba(253, 243, 247, 0.9));
    }
    #modalPersonalGoalsList input[type="number"] { font-size: 16px; }

    .comment-history-list { max-height: 450px; overflow-y: auto; padding-right: 8px; }
    .comment-item { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 18px; 
        padding: 20px 25px; 
        margin-bottom: 15px;
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
    }
    .comment-item:hover {
        transform: translateY(-2px);
        box-shadow: 
            0 8px 25px rgba(244, 166, 205, 0.18),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .comment-item-header { 
        font-size: 13px; 
        color: var(--text-color-light); 
        font-weight: 600; 
        margin-bottom: 12px; 
    }
    .comment-item-body { 
        font-size: 15px; 
        line-height: 1.7; 
        white-space: pre-wrap; 
        word-break: break-word; 
        color: var(--text-color); 
    }
    .empty-comments { 
        text-align: center; 
        color: var(--text-color-light); 
        padding: 60px 25px; 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border-radius: 18px; 
        border: 1px solid rgba(248, 238, 242, 0.8);
        box-shadow: 0 4px 15px rgba(244, 166, 205, 0.1);
    }
    
    .receipt-container {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), var(--sakura-soft));
        border-radius: 18px;
        padding: 0;
        margin-top: 0; 
        margin-bottom: 25px; 
        box-shadow: 0 8px 25px rgba(244, 166, 205, 0.2);
        font-family: 'Courier New', monospace;
        max-width: 100%;
        overflow: hidden;
        border: 1px solid rgba(248, 238, 242, 0.8);
    }
    .receipt-header { 
        padding: 20px 25px 12px; 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
    }
    .receipt-title { display: block; text-align: center; margin-bottom: 8px; position: relative; }
    .receipt-title h3 { 
        margin: 0; 
        font-size: 16px; 
        color: var(--primary-color); 
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .budget-info { 
        display: flex; 
        flex-direction: column; 
        gap: 5px; 
        font-size: 11px; 
        color: var(--text-color); 
        font-weight: 600; 
        text-align: right; 
        position: absolute; 
        top: -5px; 
        right: -8px; 
    }
    .receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
    .receipt-divider { 
        height: 1px; 
        background: repeating-linear-gradient(
            to right, 
            rgba(248, 238, 242, 0.8) 0px, 
            rgba(248, 238, 242, 0.8) 3px, 
            transparent 3px, 
            transparent 6px
        ); 
        margin: 0 22px; 
    }
    .receipt-items { padding: 20px 25px 12px; }
    .receipt-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 6px 12px; 
        font-size: 13px; 
        line-height: 1.5; 
        transition: all 0.2s ease; 
        border-radius: 8px; 
    }
    .receipt-item:hover { 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
    }
    .receipt-date { color: var(--text-color-light); font-size: 11px; min-width: 60px; margin-right: 18px; }
    .receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 18px; }
    .receipt-amount { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 70px; }
    .receipt-total { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 20px 25px; 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        font-weight: 700; 
        font-size: 16px; 
        font-family: 'Courier New', monospace; 
        color: var(--primary-color); 
    }

    .calendar-cell.skeleton { 
        background: linear-gradient(135deg, #fafafa, #f5f5f5); 
        border: 1px solid #f0f0f0; 
        position: relative; 
        overflow: hidden;
        border-radius: 12px;
    }
    .calendar-cell.skeleton::before { 
        content: ''; 
        position: absolute; 
        top: 0; 
        left: -100%; 
        width: 100%; 
        height: 100%; 
        background: linear-gradient(90deg, transparent, rgba(244, 166, 205, 0.15), transparent); 
        animation: shimmer 2s infinite; 
    }
    .calendar-cell.skeleton .cell-day-number { color: #d0d0d0; background: transparent; }
    .calendar-cell.skeleton .cell-top-icons,
    .calendar-cell.skeleton .cell-bottom-info { background: transparent; }
    @keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }

    .loading-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--text-color-light);
        font-size: 12px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.98);
        padding: 10px 15px;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.2);
        border: 1px solid rgba(248, 238, 242, 0.8);
    }

    #dailyQuestModal .modal-header { padding-top: 32px; padding-bottom: 22px; }
    .quest-tabs { display: flex; gap: 15px; margin-bottom: 25px; }
    .quest-tab { 
        padding: 12px 22px; 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 16px; 
        cursor: pointer; 
        font-size: 14px; 
        font-weight: 600; 
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(244, 166, 205, 0.1);
    }
    .quest-tab.active { 
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
        color: white; 
        border-color: var(--primary-color);
        box-shadow: 0 6px 20px rgba(244, 166, 205, 0.3);
    }
    .quest-list { display: flex; flex-direction: column; gap: 15px; }
    .quest-item { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border: 1px solid rgba(248, 238, 242, 0.8); 
        border-radius: 18px; 
        padding: 20px; 
        transition: all 0.3s ease;
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .quest-item:hover { 
        transform: translateY(-3px); 
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8); 
    }
    .quest-item.completed { 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2); 
        color: white; 
        border-color: var(--success-color);
        box-shadow: 0 6px 20px rgba(200, 228, 194, 0.3);
    }
    .quest-item.completed .quest-reward { color: rgba(255,255,255,0.9); }
    .quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .quest-title { font-weight: 600; font-size: 14px; }
    .quest-reward { font-size: 12px; color: var(--primary-color); font-weight: 600; }
    .quest-desc { font-size: 13px; color: var(--text-color-light); margin-bottom: 15px; }
    .quest-progress { display: flex; justify-content: space-between; align-items: center; }
    .quest-progress-bar { 
        flex: 1; 
        height: 10px; 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9)); 
        border-radius: 6px; 
        margin-right: 15px; 
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(244, 166, 205, 0.1);
    }
    .quest-progress-fill { 
        height: 100%; 
        background: linear-gradient(90deg, var(--primary-color), var(--primary-dark)); 
        transition: width 0.3s ease; 
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(244, 166, 205, 0.2);
    }
    .quest-progress-text { font-size: 11px; color: var(--text-color-light); min-width: 40px; text-align: right; }
    .quest-item.completed .quest-progress-bar { background: rgba(255,255,255,0.3); }
    .quest-item.completed .quest-progress-fill { background: rgba(255,255,255,0.8); }
    .quest-item.completed .quest-progress-text { color: rgba(255,255,255,0.9); }

    #rewardsModal .modal-header { 
        padding: 35px 32px 25px 32px; 
        border-bottom: 1px solid rgba(248, 238, 242, 0.8); 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        border-top-left-radius: 24px; 
        border-top-right-radius: 24px; 
    }
    .rewards-list { display: flex; flex-direction: column; gap: 18px; max-height: 400px; overflow-y: auto; }
    .reward-item { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border: 2px solid rgba(248, 238, 242, 0.8); 
        border-radius: 18px; 
        padding: 20px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        transition: all 0.3s ease;
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .reward-item:hover { 
        transform: translateY(-3px); 
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8); 
    }
    .reward-item.bronze { 
        border-color: #CD7F32; 
        background: linear-gradient(135deg, #FFF8DC, #F5F5DC); 
    }
    .reward-item.silver { 
        border-color: #C0C0C0; 
        background: linear-gradient(135deg, #F8F8FF, #E6E6FA); 
    }
    .reward-item.gold { 
        border-color: #FFD700; 
        background: linear-gradient(135deg, #FFFACD, #FFEFD5); 
    }
    .reward-item.legend { 
        border-color: #9400D3; 
        background: linear-gradient(135deg, #F8F0FF, #E6E6FA); 
    }
    .reward-item.used { opacity: 0.5; filter: grayscale(50%); }
    .reward-info { flex: 1; }
    .reward-name { font-weight: 600; font-size: 16px; margin-bottom: 8px; color: var(--text-color); }
    .reward-desc { font-size: 13px; color: var(--text-color-light); }
    .reward-tier { 
        font-size: 11px; 
        font-weight: 600; 
        padding: 4px 10px; 
        border-radius: 8px; 
        margin-bottom: 8px; 
        display: inline-block; 
    }
    .reward-tier.bronze { background: #CD7F32; color: white; }
    .reward-tier.silver { background: #C0C0C0; color: white; }
    .reward-tier.gold { background: #FFD700; color: #333; }
    .reward-tier.legend { background: #9400D3; color: white; }
    .reward-actions { display: flex; gap: 12px; }
    .reward-btn { 
        padding: 12px 16px; 
        border: none; 
        border-radius: 12px; 
        font-size: 12px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: all 0.3s ease; 
    }
    .reward-btn.use { 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2); 
        color: white;
        box-shadow: 0 4px 12px rgba(200, 228, 194, 0.3);
    }
    .reward-btn.use:hover { 
        background: linear-gradient(135deg, #b8dbb2, #a8ccb0); 
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(200, 228, 194, 0.4);
    }
    .reward-btn.delete { 
        background: linear-gradient(135deg, var(--danger-color), #eca0b5); 
        color: white;
        box-shadow: 0 4px 12px rgba(240, 168, 193, 0.3);
    }
    .reward-btn.delete:hover { 
        background: linear-gradient(135deg, #eca0b5, #e395aa); 
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(240, 168, 193, 0.4);
    }
    .reward-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .empty-rewards { 
        text-align: center; 
        padding: 50px 25px; 
        color: var(--text-color-light); 
        background: linear-gradient(135deg, var(--sakura-soft), rgba(255, 255, 255, 0.9));
        border-radius: 18px;
        border: 1px solid rgba(248, 238, 242, 0.8);
        box-shadow: 0 4px 15px rgba(244, 166, 205, 0.1);
    }

    .profile-menu-item:hover { 
        background: linear-gradient(135deg, var(--sakura-bloom), var(--sakura-petal)); 
        color: var(--primary-color); 
        border-radius: 12px;
    }
    
    #profileWidget:hover { transform: translateY(-3px); }
    #profileWidget { 
        transition: all 0.3s ease; 
        border-radius: 16px;
        padding: 6px;
    }

    .achievements-list { display: flex; flex-direction: column; gap: 18px; max-height: 400px; overflow-y: auto; }
    .achievement-item { 
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), var(--sakura-petal)); 
        border: 2px solid rgba(248, 238, 242, 0.8); 
        border-radius: 18px; 
        padding: 20px; 
        display: flex; 
        align-items: center; 
        gap: 20px; 
        transition: all 0.3s ease;
        box-shadow: 
            0 6px 20px rgba(244, 166, 205, 0.12),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .achievement-item:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 10px 30px rgba(244, 166, 205, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    .achievement-item.unlocked { 
        border-color: var(--success-color); 
        background: linear-gradient(135deg, #f8fff8, #e8f5e8); 
    }
    .achievement-item.locked { opacity: 0.6; }
    .achievement-emoji { font-size: 28px; min-width: 45px; text-align: center; }
    .achievement-info { flex: 1; }
    .achievement-name { font-weight: 600; font-size: 16px; margin-bottom: 8px; color: var(--text-color); }
    .achievement-desc { font-size: 13px; color: var(--text-color-light); }
    .achievement-status { 
        font-size: 12px; 
        font-weight: 600; 
        padding: 6px 12px; 
        border-radius: 12px; 
    }
    .achievement-status.unlocked { 
        background: linear-gradient(135deg, var(--success-color), #b8dbb2); 
        color: white; 
    }
    .achievement-status.locked { 
        background: rgba(248, 238, 242, 0.8); 
        color: var(--text-color-light); 
    }
    .achievement-item.hidden { 
        background: linear-gradient(135deg, #d4c4cc, #c4b0bc); 
        color: #f8f0f2; 
        border-color: #c4b0bc; 
    }
    .achievement-item.hidden .achievement-desc { 
        color: #e4d2d8; 
        font-style: italic; 
    }

    @media (max-width: 767px) {
        body {
            padding: 15px;
        }
        .modal-content { 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            border-radius: 0; 
            max-height: 100vh; 
        }
        .food-modal { 
            width: 90%; 
            height: auto; 
            border-radius: 20px; 
            max-height: 90vh; 
        }
        .food-modal .modal-body { 
            overflow-y: auto; 
            max-height: calc(90vh - 120px); 
        }
        #dayModal .modal-body { padding: 20px 18px; }
        .modal-input-group { padding: 18px; }
        .modal-input-group h4 { font-size: 15px; }
        #dayModal .form-group label { font-size: 13px; }
        #dayModal .modal-input-row { grid-template-columns: 1fr; gap: 15px; }
        .exercise-toggle-btns { max-width: 180px; }
        .score-display-card, .personal-goals-section { 
            width: 100%; 
            max-width: none; 
            margin: 0; 
            padding: 18px; 
        }
        .score-display-card .score { font-size: 36px; }

        #modalTotalExpense { text-align: left !important; }
        .expense-item { font-size: 13px; word-break: break-all; }
        .expense-item span:first-child { flex-grow: 1; margin-right: 10px; }
        .expense-item > div { flex-shrink: 0; }
        
        .modal-actions-container { 
            padding: 0 18px 25px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .modal-actions-container .btn.delete {
            order: 2;
            background-color: transparent;
            color: var(--text-color-light);
            font-size: 14px;
            font-weight: normal;
            padding: 10px;
            box-shadow: none;
            margin-top: 12px;
            max-width: 150px;
        }
        .modal-actions-container .btn.delete:hover { 
            background-color: transparent; 
            color: var(--danger-color); 
        }
        .modal-actions-container .btn.save { order: 1; }

        #budgetPage .budget-summary { flex-wrap: wrap; }
        #budgetPage .budget-summary .budget-card:first-child { flex-basis: 100%; }
        #budgetPage .budget-card-value { font-size: 20px; }
        #dayModal .expense-input-row { flex-direction: column; gap: 12px; }
        #dayModal .expense-input-row input,
        #dayModal .expense-input-row button { width: 100%; }
        .dday-header-container { top: 10px; left: 6px; right: 6px; }
        .container { padding: 40px 22px 100px 22px; }
        .dday-chip { font-size: 10px; padding: 4px 10px; }
        .battery { width: 28px; height: 14px; }
        .receipt-item { font-size: 12px; }
        .receipt-date { min-width: 50px; margin-right: 12px; font-size: 10px; }
        .receipt-desc { margin-right: 12px; }
        .receipt-amount { min-width: 60px; font-size: 12px; }
        .budget-info { 
            flex-direction: column; 
            gap: 3px; 
            font-size: 10px; 
            text-align: right; 
        }
        .calendar-grid { gap: 6px; }
        .main-actions { gap: 12px; }
        .btn { padding: 16px; }
    }
    `,
    
    paperbook: `
       @font-face {
        font-family: 'KBIZHanmaumMyungjo';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Playfair+Display:wght@400;600;700&display=swap');

    :root {
        --bg-color: #f5f3f0;
        --primary-color: #8b4513;
        --primary-dark: #654321;
        --primary-light: #f4f1ec;
        --text-color: #2d2520;
        --text-color-light: #6b5b54;
        --border-color: #d4c4b0;
        --container-bg: #fefdfb;
        --danger-color: #b85450;
        --warning-color: #c9963d;
        --success-color: #6b8e5a;
        --neutral-color: #8d7b68;
        --paper-shadow: rgba(139, 69, 19, 0.15);
        --ink-color: #1a1a1a;
        --vintage-gold: #d4af37;
        --aged-paper: #f9f7f4;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
        font-family: 'Crimson Text', 'KBIZHanmaumMyungjo', Georgia, serif; 
        background: linear-gradient(45deg, #f5f3f0 0%, #ede8e0 50%, #f5f3f0 100%);
        background-attachment: fixed;
        min-height: 100vh; 
        padding: 20px; 
        color: var(--text-color);
        position: relative;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 80%, rgba(139, 69, 19, 0.03) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(180, 140, 70, 0.03) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(139, 69, 19, 0.02) 0%, transparent 50%);
        pointer-events: none;
        z-index: -1;
    }
    
    button, input, select, textarea { font-family: inherit; }
    
    .container { 
        background: var(--container-bg);
        border-radius: 0;
        padding: 60px 40px 120px 40px;
        width: 100%; 
        max-width: 520px; 
        margin: 0 auto; 
        box-shadow: 
            0 0 0 1px var(--border-color),
            0 5px 15px var(--paper-shadow),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
        position: relative;
        border: 3px solid var(--border-color);
        background: 
            linear-gradient(90deg, transparent 0%, transparent 48px, rgba(139, 69, 19, 0.1) 48px, rgba(139, 69, 19, 0.1) 50px, transparent 50px),
            var(--container-bg);
    }
    
    .container::before {
        content: '';
        position: absolute;
        left: 48px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: rgba(220, 53, 69, 0.3);
        z-index: 1;
    }
    
    .container::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            repeating-linear-gradient(
                transparent,
                transparent 24px,
                rgba(139, 69, 19, 0.05) 24px,
                rgba(139, 69, 19, 0.05) 25px
            );
        pointer-events: none;
        z-index: 1;
    }
    
    .header { 
        text-align: center; 
        margin-bottom: 30px; 
        position: relative;
        z-index: 2;
        padding: 20px 0;
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 40px;
    }
    
    .header h1 { 
        font-family: 'Playfair Display', serif;
        color: var(--text-color); 
        font-size: 32px; 
        font-weight: 700; 
        margin-bottom: 8px;
        text-shadow: 1px 1px 2px rgba(139, 69, 19, 0.1);
        letter-spacing: 1px;
    }
    
    .header p { 
        color: var(--text-color-light); 
        font-size: 16px;
        font-style: italic;
        letter-spacing: 0.5px;
    }
    
    #gameWarning { 
        background: var(--aged-paper);
        color: var(--warning-color); 
        border: 2px solid var(--warning-color);
        border-radius: 0;
        padding: 15px; 
        font-size: 14px; 
        font-weight: 600; 
        margin-bottom: 25px; 
        display: none;
        box-shadow: inset 0 0 10px rgba(201, 150, 61, 0.1);
        z-index: 2;
        position: relative;
    }
    
    .page { display: none; z-index: 2; position: relative; }
    .page.active { display: block; }
    
    .calendar-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 25px;
        padding: 0 10px;
    }
    
    .month-nav { 
        background: none; 
        border: 2px solid var(--border-color);
        font-size: 20px; 
        color: var(--text-color); 
        cursor: pointer; 
        padding: 8px 12px; 
        border-radius: 0;
        transition: all 0.3s ease;
        font-family: 'Playfair Display', serif;
        font-weight: 600;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .month-nav:hover { 
        background: var(--primary-light);
        transform: translateY(-1px);
        box-shadow: 3px 3px 6px var(--paper-shadow);
    }
    
    .month-year { 
        font-family: 'Playfair Display', serif;
        font-size: 24px; 
        font-weight: 700;
        color: var(--text-color);
        text-shadow: 1px 1px 2px rgba(139, 69, 19, 0.1);
    }
    
    .calendar-grid { 
        display: grid; 
        grid-template-columns: repeat(7, 1fr); 
        gap: 2px; 
        margin-bottom: 25px;
        border: 2px solid var(--border-color);
        background: var(--border-color);
    }
    
    .calendar-header-cell { 
        text-align: center; 
        padding: 12px 5px; 
        font-weight: 600; 
        color: var(--text-color); 
        font-size: 13px;
        background: var(--primary-light);
        font-family: 'Playfair Display', serif;
    }
    
    .calendar-cell { 
        aspect-ratio: 1; 
        display: grid; 
        grid-template-rows: 1fr auto 1fr; 
        padding: 4px; 
        align-items: center; 
        justify-items: center;
        background: var(--container-bg);
        color: var(--text-color);
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
        position: relative;
    }
    
    .calendar-cell::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            repeating-linear-gradient(
                45deg,
                transparent,
                transparent 1px,
                rgba(139, 69, 19, 0.02) 1px,
                rgba(139, 69, 19, 0.02) 2px
            );
        pointer-events: none;
    }
    
    .cell-top-icons { 
        grid-row: 1; 
        display: flex; 
        justify-content: center; 
        gap: 2px; 
        font-size: 10px; 
        width: 100%; 
        height: 100%; 
        align-items: center; 
    }
    
    .cell-day-number { 
        grid-row: 2; 
        font-weight: 600;
        font-family: 'Playfair Display', serif;
        font-size: 14px;
    }
    
    .calendar-cell.today .cell-day-number { font-weight: 700; }
    
    .cell-bottom-info { 
        grid-row: 3; 
        font-size: 8px; 
        font-weight: 600; 
        color: var(--text-color-light); 
        width: 100%; 
        text-align: left; 
        padding-right: 4px; 
        align-self: end; 
        padding-bottom: 2px; 
    }

    .calendar-cell.has-data .cell-bottom-info { color: rgba(254, 253, 251, 0.9); }
    
    .calendar-cell.off-day { 
        background: #ede8e0; 
        color: var(--neutral-color);
        position: relative;
    }
    
    .calendar-cell.off-day::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(45deg);
        width: 1px;
        height: 80%;
        background: var(--neutral-color);
        opacity: 0.3;
    }
    
    .off-day-indicator { position: absolute; top: 4px; right: 4px; font-size: 10px; }
    
    .calendar-cell:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 4px 8px var(--paper-shadow);
        background: var(--aged-paper);
    }
    
    .calendar-cell.other-month { 
        color: #bbb; 
        background: #f0ede8; 
        pointer-events: none; 
    }
    
    .calendar-cell.today { 
        background: var(--primary-light);
        font-weight: 700; 
        color: var(--primary-color); 
        box-shadow: inset 0 0 0 2px var(--primary-color);
    }
    
    .calendar-cell.has-data { color: white; font-weight: bold; }
    .calendar-cell.score-high { background: var(--success-color); }
    .calendar-cell.score-medium { background: var(--warning-color); }
    .calendar-cell.score-low { background: var(--danger-color); }
    .calendar-cell.score-negative { background: var(--neutral-color); }
    
    .score-indicator { 
        position: absolute; 
        bottom: 4px; 
        right: 4px; 
        font-size: 9px; 
        background: rgba(0,0,0,0.3); 
        color: white; 
        padding: 1px 4px; 
        border-radius: 0;
        font-weight: 700; 
    }
    
    .form-group { 
        margin-bottom: 25px;
        z-index: 2;
        position: relative;
    }
    
    .form-group label { 
        display: block; 
        color: var(--text-color); 
        font-weight: 600; 
        margin-bottom: 8px; 
        font-size: 15px;
        font-family: 'Playfair Display', serif;
    }
    
    .form-group input, .form-group textarea, .form-group select { 
        width: 100%; 
        padding: 12px 15px; 
        border: 2px solid var(--border-color);
        border-radius: 0;
        font-size: 16px; 
        transition: all 0.3s ease; 
        font-family: 'Crimson Text', serif;
        background: var(--container-bg);
        color: var(--text-color);
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
        outline: none; 
        border-color: var(--primary-color); 
        box-shadow: 
            inset 2px 2px 4px rgba(139, 69, 19, 0.05),
            0 0 0 3px rgba(139, 69, 19, 0.1);
        background: var(--aged-paper);
    }
    
    .main-actions { 
        display: flex; 
        gap: 15px; 
        margin-bottom: 15px;
        z-index: 2;
        position: relative;
    }
    
    .btn { 
        width: 100%; 
        padding: 15px 20px; 
        background-color: var(--primary-color); 
        color: white; 
        border: 2px solid var(--primary-dark);
        border-radius: 0;
        font-size: 16px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        box-shadow: 3px 3px 6px var(--paper-shadow);
        font-family: 'Playfair Display', serif;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .btn:hover { 
        background-color: var(--primary-dark); 
        transform: translateY(-2px); 
        box-shadow: 4px 4px 8px var(--paper-shadow);
    }
    
    .btn:active { 
        transform: translateY(0); 
        box-shadow: 2px 2px 4px var(--paper-shadow); 
    }
    
    .main-actions .btn { flex: 1; }
    
    .btn.secondary { 
        background: var(--neutral-color);
        border-color: #6b5b54;
    }
    
    .btn.secondary:hover { background: #6b5b54; }
    
    .modal-overlay { 
        display: none; 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(45, 37, 32, 0.7);
        backdrop-filter: blur(2px);
        z-index: 1000; 
        align-items: center; 
        justify-content: center; 
    }
    
    .modal-content { 
        background: var(--container-bg);
        padding: 0; 
        border-radius: 0;
        width: 90%; 
        max-width: 800px; 
        max-height: 95vh; 
        overflow-y: auto; 
        box-shadow: 
            0 0 0 3px var(--border-color),
            0 10px 30px var(--paper-shadow);
        border: 3px solid var(--border-color);
    }
    
    #dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { 
        padding: 25px 30px; 
        border-bottom: 2px solid var(--border-color); 
        background: var(--primary-light);
    }
    
    #dayModal .modal-body { 
        padding: 30px;
        background: var(--container-bg);
    }
    
    .modal-layout { display: block; }
    
    @media (min-width: 768px) { .modal-layout { display: block; } }
    
    .modal-side-column { display: flex; flex-direction: column; }
    
    .modal-input-group { 
        background: var(--aged-paper);
        padding: 20px; 
        border-radius: 0;
        border: 2px solid var(--border-color);
        margin-bottom: 20px;
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    .modal-input-group h4 { 
        font-size: 18px; 
        margin-bottom: 15px; 
        padding-bottom: 10px; 
        border-bottom: 1px solid var(--border-color);
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
        font-weight: 600;
    }
    
    .modal-input-row { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
        gap: 15px; 
    }
    
    #commentDetails summary { 
        font-weight: 600; 
        color: var(--text-color); 
        cursor: pointer; 
        padding: 12px 15px; 
        border-radius: 0;
        background-color: var(--aged-paper);
        border: 2px solid var(--border-color);
        list-style: none; 
        position: relative; 
        padding-left: 35px;
        font-family: 'Playfair Display', serif;
    }
    
    #commentDetails summary::-webkit-details-marker { display: none; }
    
    #commentDetails summary::before { 
        content: 'â–º'; 
        position: absolute; 
        left: 15px; 
        top: 50%; 
        transform: translateY(-50%); 
        font-size: 12px; 
        transition: transform 0.3s; 
        color: var(--primary-color);
    }
    
    #commentDetails[open] > summary::before { transform: translateY(-50%) rotate(90deg); }

    #dayModal .form-group { margin-bottom: 0; }
    #dayModal .form-group label { font-size: 14px; margin-bottom: 6px; }
    #dayModal .form-group input { padding: 10px; font-size: 16px; }
    #dayModal .modal-input-group,
    #dayModal .score-display-card { margin-bottom: 5px; }
    #dayModal .modal-layout > div:last-child { margin-bottom: 0; }
    
    .modal-header { 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        position: relative; 
        gap: 20px; 
    }
    
    .modal-title { 
        flex: none; 
        text-align: center; 
        margin: 0;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
        font-size: 20px;
        font-weight: 600;
    }
    
    .date-nav-btn { 
        background: none; 
        border: 2px solid var(--border-color);
        font-size: 20px; 
        color: var(--text-color); 
        cursor: pointer; 
        padding: 8px 12px; 
        border-radius: 0;
        transition: all 0.2s ease; 
        width: 40px; 
        height: 40px; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        font-family: 'Playfair Display', serif;
    }
    
    .date-nav-btn:hover { 
        background: var(--aged-paper);
        transform: translateY(-1px);
    }
    
    .close-btn { 
        background: none; 
        border: 2px solid var(--border-color);
        font-size: 24px; 
        cursor: pointer; 
        color: var(--text-color); 
        line-height: 1; 
        position: absolute; 
        right: 0; 
        top: 50%; 
        transform: translateY(-50%);
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0;
    }
    
    .close-btn:hover {
        background: var(--aged-paper);
    }
    
    .score-display-card { 
        background: var(--aged-paper);
        border-radius: 0;
        padding: 25px; 
        text-align: center; 
        border: 2px solid var(--border-color);
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    .score-display-card .score { 
        font-size: 42px; 
        font-weight: 700; 
        color: var(--primary-color); 
        line-height: 1;
        font-family: 'Playfair Display', serif;
        text-shadow: 1px 1px 2px rgba(139, 69, 19, 0.1);
    }
    
    .score-display-card .score.is-off { color: var(--neutral-color); }
    
    .score-display-card div:last-child { 
        font-size: 14px; 
        color: var(--text-color-light); 
        margin-top: 8px;
        font-style: italic;
    }
    
    .exercise-toggle-group { margin-bottom: 15px; }
    
    .exercise-toggle-group label { 
        display: block; 
        color: var(--text-color); 
        font-weight: 600; 
        margin-bottom: 8px; 
        font-size: 14px;
        font-family: 'Playfair Display', serif;
    }
    
    .exercise-toggle-btns { 
        display: flex; 
        border: 2px solid var(--border-color);
        border-radius: 0;
        overflow: hidden; 
    }
    
    .exercise-toggle-btn { 
        flex: 1; 
        padding: 10px; 
        border: none; 
        background: var(--container-bg);
        cursor: pointer; 
        font-weight: 600; 
        transition: all 0.2s ease; 
        font-size: 14px;
        color: var(--text-color);
        font-family: 'Crimson Text', serif;
    }
    
    .exercise-toggle-btn.active { 
        background: var(--success-color); 
        color: #fff; 
    }
    
    .legend { 
        display: flex; 
        justify-content: center; 
        flex-wrap: wrap; 
        margin: 25px 0 0; 
        font-size: 12px; 
        gap: 15px; 
    }
    
    .legend-item { 
        display: flex; 
        align-items: center; 
        gap: 5px;
        color: var(--text-color);
        font-family: 'Crimson Text', serif;
    }
    
    .legend-color { 
        width: 12px; 
        height: 12px; 
        border-radius: 0;
        border: 1px solid var(--border-color);
    }
    
    .goal-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    
    .goal-tab { 
        padding: 10px 18px; 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        cursor: pointer; 
        font-size: 14px; 
        font-weight: 600; 
        transition: all 0.3s ease;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .goal-tab.active { 
        background: var(--primary-color); 
        color: white; 
        border-color: var(--primary-dark); 
    }
    
    .goal-type-toggle { display: flex; gap: 5px; margin-bottom: 15px; }
    
    .goal-type-toggle button { 
        flex: 1; 
        padding: 10px; 
        font-size: 14px; 
        border: 2px solid var(--border-color);
        background: var(--aged-paper);
        border-radius: 0;
        cursor: pointer; 
        font-weight: 600; 
        transition: all 0.2s ease;
        color: var(--text-color);
        font-family: 'Crimson Text', serif;
    }
    
    .goal-type-toggle button.active { 
        background: var(--primary-color); 
        color: white; 
        border-color: var(--primary-dark); 
    }
    
    #personalGoalsPage .header { text-align: left; }
    
    .dday-header-container { 
        height: auto; 
        margin-bottom: 5px; 
        display: flex; 
        justify-content: space-between; 
        align-items: flex-start; 
        position: absolute; 
        top: 15px; 
        left: 15px; 
        right: 15px; 
        z-index: 10; 
        pointer-events: none; 
    }
    
    .dday-chip { 
        background: var(--vintage-gold);
        color: var(--text-color);
        padding: 6px 12px; 
        border-radius: 0;
        font-weight: 700; 
        font-size: 11px; 
        display: none; 
        box-shadow: 2px 2px 4px var(--paper-shadow);
        pointer-events: all; 
        border: 2px solid var(--primary-dark);
        font-family: 'Playfair Display', serif;
    }
    
    .battery { 
        display: none; 
        width: 30px; 
        height: 14px; 
        border: 2px solid var(--text-color-light);
        border-radius: 0;
        position: relative; 
        padding: 1.5px; 
    }
    
    .battery::after { 
        content: ''; 
        position: absolute; 
        top: 50%; 
        right: -4px; 
        transform: translateY(-50%); 
        width: 2px; 
        height: 6px; 
        background: var(--text-color-light);
        border-radius: 0;
    }
    
    .battery-level { height: 100%; border-radius: 0; transition: width 0.3s ease; }
    .battery-level.green { background: var(--success-color); } 
    .battery-level.yellow { background: var(--warning-color); } 
    .battery-level.red { background: var(--danger-color); } 
    .battery-level.black { background: var(--text-color); }
    
    .budget-summary { display: flex; gap: 15px; margin-bottom: 25px; }
    
    .budget-card { 
        flex: 1; 
        background: var(--aged-paper);
        color: var(--primary-color); 
        padding: 20px; 
        border-radius: 0;
        text-align: center;
        border: 2px solid var(--border-color);
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    .budget-card-title { 
        font-size: 13px; 
        opacity: 0.9; 
        margin-bottom: 10px; 
        font-weight: 600;
        font-family: 'Playfair Display', serif;
    }
    
    .budget-card-value { 
        font-size: 24px; 
        font-weight: 700;
        font-family: 'Playfair Display', serif;
    }
    
    #budgetPage .header p { 
        font-size: 16px; 
        font-weight: 600; 
        color: var(--text-color); 
    }
    
    .personal-goals-section { 
        background: var(--aged-paper);
        padding: 20px; 
        border-radius: 0;
        border: 2px solid var(--border-color);
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    #modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }
    
    .personal-goal-checkbox { 
        display: flex; 
        align-items: center; 
        gap: 10px;
        padding: 12px; 
        background: var(--container-bg);
        border-radius: 0;
        margin-bottom: 10px; 
        border: 2px solid var(--border-color);
    }
    
    .personal-goal-item { 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        padding: 18px; 
        margin-bottom: 12px;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .personal-goal-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 8px; 
    }
    
    .personal-goal-name { 
        font-weight: 600;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .personal-goal-actions button { 
        padding: 6px 12px; 
        border-radius: 0;
        font-size: 12px; 
        border: 2px solid;
        cursor: pointer; 
        color: white;
        font-weight: 600;
        margin-left: 5px;
        font-family: 'Crimson Text', serif;
    }
    
    .edit-btn { 
        background: var(--warning-color);
        border-color: #b8852d;
    }
    
    .delete-btn { 
        background: var(--danger-color);
        border-color: #9d3f3c;
    }
    
    .complete-btn { 
        background: var(--success-color);
        border-color: #5a7849;
    }
    
    .reopen-btn { 
        background: var(--primary-color);
        border-color: var(--primary-dark);
    }
    
    .empty-goals { 
        text-align: center; 
        color: var(--text-color-light); 
        padding: 50px 25px; 
        background: var(--aged-paper);
        border-radius: 0;
        margin-top: 25px; 
        border: 2px dashed var(--border-color);
        font-style: italic;
    }
    
    .budget-settings, .dday-settings { margin-bottom: 35px; }
    
    .budget-input, .dday-actions { 
        display: flex; 
        gap: 12px; 
        align-items: center; 
    }
    
    .dday-item { 
        background: var(--aged-paper);
        border-radius: 0;
        padding: 15px 18px; 
        margin-bottom: 12px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        border: 2px solid var(--border-color);
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .budget-input button { 
        padding: 12px 20px; 
        background: var(--success-color); 
        color: white; 
        border: 2px solid #5a7849;
        border-radius: 0;
        font-weight: 600; 
        cursor: pointer;
        font-family: 'Playfair Display', serif;
    }
    
    .wakeup-prompt { 
        background: var(--aged-paper);
        color: var(--primary-color); 
        padding: 25px; 
        border-radius: 0;
        text-align: center; 
        margin-bottom: 25px;
        border: 2px solid var(--border-color);
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    .monthly-summary { 
        display: flex; 
        justify-content: space-around; 
        gap: 18px; 
        margin-bottom: 35px; 
    }
    
    .summary-card { 
        flex-basis: 30%; 
        background: var(--aged-paper);
        color: var(--primary-color); 
        padding: 25px; 
        border-radius: 0;
        text-align: center;
        border: 2px solid var(--border-color);
        box-shadow: inset 2px 2px 4px rgba(139, 69, 19, 0.05);
    }
    
    .summary-title { 
        font-size: 14px; 
        opacity: 0.9; 
        margin-bottom: 12px; 
        font-weight: 600;
        font-family: 'Playfair Display', serif;
    }
    
    .summary-value { 
        font-size: 26px; 
        font-weight: 700;
        font-family: 'Playfair Display', serif;
    }
    
    .week-card { 
        background: var(--aged-paper);
        border-radius: 0;
        padding: 25px; 
        margin-bottom: 18px; 
        border: 2px solid var(--border-color);
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .week-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 18px; 
        font-weight: 600;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .week-stats { 
        display: flex; 
        justify-content: space-around; 
        align-items: center; 
        text-align: center; 
        font-size: 24px; 
        font-weight: 600;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .empty-expenses { 
        text-align: center; 
        color: var(--text-color-light); 
        padding: 50px 25px;
        font-style: italic;
    }
    
    .feedback-popup { 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(45, 37, 32, 0.8);
        display: none; 
        z-index: 2000; 
        animation: fadeIn 0.3s ease; 
        justify-content: center; 
        align-items: center; 
    }
    
    .feedback-content { 
        position: relative; 
        background: var(--container-bg);
        padding: 45px; 
        border-radius: 0;
        width: 90%; 
        max-width: 420px; 
        text-align: center; 
        box-shadow: 
            0 0 0 3px var(--border-color),
            0 15px 40px var(--paper-shadow);
        animation: popIn 0.5s ease;
        border: 3px solid var(--border-color);
    }
    
    .feedback-emoji { font-size: 70px; margin-bottom: 25px; display: block; }
    
    .feedback-title { 
        font-size: 26px; 
        font-weight: 700; 
        margin-bottom: 18px; 
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .feedback-message { 
        font-size: 16px; 
        color: var(--text-color-light); 
        line-height: 1.6; 
        margin-bottom: 30px;
        font-family: 'Crimson Text', serif;
    }
    
    .feedback-celebration .feedback-title, 
    .feedback-celebration .feedback-message, 
    .feedback-reflection .feedback-title, 
    .feedback-reflection .feedback-message, 
    .feedback-disaster .feedback-title, 
    .feedback-disaster .feedback-message, 
    .feedback-encouragement .feedback-title, 
    .feedback-encouragement .feedback-message, 
    .feedback-warning .feedback-title, 
    .feedback-warning .feedback-message { 
        color: rgba(254, 253, 251, 0.95); 
    }
    
    .feedback-celebration { background: linear-gradient(135deg, #6b8e5a, #5a7849); } 
    .feedback-reflection { background: linear-gradient(135deg, #c9963d, #b8852d); } 
    .feedback-disaster { background: linear-gradient(135deg, #8d7b68, #6b5b54); } 
    .feedback-encouragement { background: linear-gradient(135deg, #8b4513, #654321); } 
    .feedback-warning { background: linear-gradient(135deg, #b85450, #9d3f3c); }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    
    .feedback-btn { 
        background: rgba(254, 253, 251, 0.2); 
        color: white; 
        border: 2px solid rgba(254, 253, 251, 0.4);
        padding: 12px 25px; 
        border-radius: 0;
        font-size: 16px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        margin: 0 8px;
        font-family: 'Playfair Display', serif;
    }
    
    .feedback-btn:hover { 
        background: rgba(254, 253, 251, 0.3); 
        border-color: rgba(254, 253, 251, 0.6); 
        transform: translateY(-2px); 
    }
    
    .feedback-budget-red { background: linear-gradient(135deg, #b85450, #9d3f3c) !important; }
    .feedback-budget-black { background: linear-gradient(135deg, #8d7b68, #6b5b54) !important; }
    
    .expense-input-row { 
        display: flex; 
        gap: 12px; 
        align-items: center; 
        margin-top: 12px; 
    }
    
    .expense-input-row input { 
        flex: 1; 
        padding: 12px; 
        font-size: 14px; 
        border-radius: 0;
        background: var(--container-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
    }
    
    .expense-input-row button { 
        flex-shrink: 0; 
        width: 48px; 
        height: 48px; 
        border-radius: 0;
        background: var(--primary-color); 
        border: 2px solid var(--primary-dark);
        color: white; 
        font-weight: bold; 
        cursor: pointer; 
        font-size: 24px; 
        line-height: 48px; 
        transition: background 0.2s ease; 
    }
    
    .expense-input-row button:hover { background: var(--primary-dark); }
    
    .expense-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 8px 0; 
        font-size: 14px;
        color: var(--text-color);
        border-bottom: 1px dotted var(--border-color);
    }
    
    .dday-settings h4 { 
        margin-bottom: 18px;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
        font-size: 18px;
    }
    
    .dday-item .dday-actions { display: flex; gap: 8px; }
    
    .dday-item .dday-actions button { 
        background: none; 
        border: 2px solid var(--border-color);
        width: 32px; 
        height: 32px; 
        border-radius: 0;
        font-size: 16px; 
        cursor: pointer; 
        transition: all 0.2s ease; 
        color: var(--text-color-light); 
    }
    
    .dday-item .dday-actions button:hover { 
        background: var(--aged-paper);
        color: var(--text-color); 
        transform: scale(1.05); 
    }
    
    .excel-option-item { 
        display: flex; 
        align-items: center; 
        padding: 10px 0; 
        cursor: pointer;
        color: var(--text-color);
    }
    
    .excel-option-item input[type="radio"] { 
        width: 20px; 
        height: 20px; 
        margin-right: 15px;
        accent-color: var(--primary-color);
    }
    
    .excel-option-item label { 
        font-size: 16px;
        font-family: 'Crimson Text', serif;
    }
    
    #customDateRange { 
        display: flex; 
        gap: 12px; 
        align-items: center; 
        margin-top: 12px; 
        margin-bottom: 25px; 
    }
    
    #customDateRange input[type="date"] { 
        padding: 10px; 
        border-radius: 0;
        border: 2px solid var(--border-color);
        flex: 1; 
        font-family: inherit;
        background: var(--container-bg);
        color: var(--text-color);
    }

    .number-input-group {
        display: flex;
        align-items: center;
        border: 2px solid var(--border-color);
        border-radius: 0;
        overflow: hidden;
    }

    .number-input-group input {
        border: none;
        text-align: center;
        flex: 1;
        padding: 10px 5px;
        background: var(--container-bg);
        color: var(--text-color);
        font-family: 'Crimson Text', serif;
    }

    .number-input-group input:focus {
        box-shadow: none;
        border: none;
    }

    .number-btn {
        width: 36px;
        height: 42px;
        border: none;
        background: var(--aged-paper);
        color: var(--text-color);
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Playfair Display', serif;
    }

    .number-btn:hover { background: var(--primary-light); }
    .number-btn:active { background: var(--primary-color); color: white; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .food-page-actions { display: flex; gap: 12px; margin-bottom: 12px; }
    .food-page-actions .btn.secondary.danger { background-color: var(--danger-color); color: white; }
    
    .food-date-header { 
        display: flex; 
        align-items: center; 
        text-align: center; 
        margin: 35px 0 15px; 
        color: var(--text-color-light); 
    }
    
    .food-date-header::before, .food-date-header::after { 
        content: ''; 
        flex: 1; 
        border-bottom: 1px solid var(--border-color); 
    }
    
    .food-date-header span { 
        padding: 0 18px; 
        font-size: 14px; 
        font-weight: 600;
        font-family: 'Playfair Display', serif;
    }
    
    .food-record-item { 
        display: grid; 
        grid-template-columns: 50px 30px 1fr auto; 
        gap: 18px; 
        align-items: center; 
        padding: 16px 8px; 
        border-bottom: 1px dotted var(--border-color);
        position: relative; 
    }
    
    .food-record-item .food-admin-actions { 
        position: absolute; 
        right: 0px; 
        top: 50%; 
        transform: translateY(-50%); 
        display: flex; 
        gap: 6px; 
        opacity: 0; 
        transition: opacity 0.2s; 
        pointer-events: none; 
    }
    
    .food-records.admin-mode .food-record-item .food-admin-actions { 
        opacity: 1; 
        pointer-events: auto; 
    }
    
    .food-admin-actions button { 
        background: none; 
        border: 2px solid var(--border-color);
        width: 30px; 
        height: 30px; 
        border-radius: 0;
        cursor: pointer; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        font-size: 13px; 
        transition: background-color 0.2s; 
    }
    
    .food-admin-actions button.edit { color: var(--warning-color); }
    .food-admin-actions button.delete { color: var(--danger-color); }
    .food-admin-actions button:hover { background-color: var(--aged-paper); }
    
    /* ì‹ë‹¨ ë‚´ë³´ë‚´ê¸°ë¥¼ ì˜ìˆ˜ì¦ ìŠ¤íƒ€ì¼ë¡œ */
    #foodExportModal .modal-content {
        max-width: 90vw;
        background: var(--container-bg);
        padding: 0;
    }
    
    #foodExportPreview {
        background: var(--container-bg);
        border-radius: 0;
        padding: 0;
        margin: 25px;
        box-shadow: 
            0 0 0 2px var(--border-color),
            0 6px 18px var(--paper-shadow);
        font-family: 'Courier New', monospace;
        border: 2px solid var(--border-color);
    }
    
    .food-receipt-header {
        padding: 18px 25px 12px;
        background: var(--primary-light);
    }
    
    .food-receipt-title {
        display: block;
        text-align: center;
        margin-bottom: 8px;
    }
    
    .food-receipt-title h3 {
        margin: 0;
        font-size: 18px;
        color: var(--primary-color);
        font-weight: 700;
        font-family: 'Playfair Display', serif;
    }
    
    .food-receipt-header p {
        margin: 0;
        font-size: 13px;
        color: var(--text-color-light);
        text-align: center;
        font-style: italic;
    }
    
    .food-receipt-divider {
        height: 2px;
        background: repeating-linear-gradient(
            to right,
            var(--border-color) 0px,
            var(--border-color) 4px,
            transparent 4px,
            transparent 8px
        );
        margin: 0 18px;
    }
    
    .food-receipt-items {
        padding: 18px 25px 12px;
    }
    
    .food-receipt-date-header {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 14px;
        margin: 18px 0 10px 0;
        padding-bottom: 6px;
        border-bottom: 1px dashed var(--border-color);
        font-family: 'Playfair Display', serif;
    }
    
    .food-receipt-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .food-receipt-time {
        color: var(--text-color-light);
        font-size: 12px;
        min-width: 50px;
        margin-right: 12px;
    }
    
    .food-receipt-desc {
        flex: 1;
        font-weight: 600;
        color: var(--text-color);
        margin-right: 12px;
    }
    
    .food-receipt-quantity {
        font-weight: 700;
        color: var(--text-color);
        font-size: 14px;
        text-align: right;
        min-width: 65px;
    }
    
    #foodExportModal .close-btn {
        position: absolute;
        top: 18px;
        right: 18px;
        background: rgba(139, 69, 19, 0.1);
        border: 2px solid var(--border-color);
        width: 38px;
        height: 38px;
        border-radius: 0;
        font-size: 20px;
        color: var(--text-color);
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s ease;
    }

    #foodExportModal .close-btn:hover {
        background: rgba(139, 69, 19, 0.2);
    }

    @media (max-width: 767px) {
        /* ëª¨ë°”ì¼ì—ì„œ ë°°ê²½ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸° */
        #foodExportModal.modal-overlay {
            background: var(--bg-color);
            backdrop-filter: none;
        }
        
        #foodExportModal .modal-content {
            max-width: 100vw;
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
            background: var(--bg-color);
        }
        
        #foodExportPreview {
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            height: calc(100vh - 60px);
            overflow-y: auto;
            background: var(--container-bg);
            border: none;
        }
        
        /* ë‹«ê¸° ë²„íŠ¼ */
        #foodExportModal .close-btn {
            position: fixed;
            top: 12px;
            right: 12px;
            width: 42px;
            height: 42px;
            font-size: 22px;
            background: rgba(139, 69, 19, 0.8);
            color: white;
            z-index: 1000;
        }
        
        /* ì•ˆë‚´ í…ìŠ¤íŠ¸ */
        #foodExportModal .modal-content > div:last-child {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--container-bg);
            padding: 18px;
            border-top: 2px solid var(--border-color);
        }
    }

    /* [ì»´íŒ©íŠ¸ ëª¨ë‹¬] ì‹ë‹¨ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ ì „ìš© ìŠ¤íƒ€ì¼ */
    .food-modal { 
        max-width: 440px; 
        background-color: var(--container-bg);
        overflow: hidden; 
    }
    
    .food-modal .modal-header { 
        padding: 18px 25px; 
        background-color: var(--aged-paper);
        border-bottom: 2px solid var(--border-color); 
    }
    
    .food-modal .modal-header h2 { 
        font-size: 20px;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .food-modal .modal-body { 
        padding: 25px;
        background: var(--container-bg);
    }
    
    .food-modal .form-group { margin-bottom: 18px; }
    .food-modal .form-group label { font-size: 14px; margin-bottom: 8px; }
    .food-modal .form-group input, .food-modal .form-group select { padding: 12px; font-size: 15px; }
    .food-modal .quantity-input { display: flex; gap: 10px; }
    .food-modal .quantity-input select { width: 95px; }
    .food-modal .food-modal-actions { margin-top: 25px; display: flex; gap: 12px; }
    .food-modal .food-modal-actions .btn { flex: 1; padding: 14px; }

    .fame-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
        gap: 12px; 
    }
    
    .fame-card { 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        padding: 18px; 
        text-align: center;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .fame-card-title { 
        font-size: 20px; 
        margin-bottom: 10px;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .fame-card-value { 
        font-size: 22px; 
        font-weight: 700; 
        color: var(--primary-color);
        font-family: 'Playfair Display', serif;
    }
    
    .fame-card-date { 
        font-size: 12px; 
        color: var(--text-color-light); 
        margin-top: 6px;
        font-style: italic;
    }
    
    /* ë°˜ì„±ì˜ ë²½ ì¹´ë“œëŠ” ë‹¤ë¥¸ ìƒ‰ìƒìœ¼ë¡œ */
    #wallOfShame .fame-card-value { color: var(--danger-color); }

    /* ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ìŠ¤íƒ€ì¼ */
    #modalCommentSection { margin-top: 25px; }
    #modalComment { 
        width: 100%; 
        margin-top: 18px; 
        height: 90px; 
        resize: vertical; 
        font-size: 16px; 
    }
    
    #modalPersonalGoalsList input[type="number"] { font-size: 16px; }
    
    /* ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ê¸°ë¡ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .comment-history-list { 
        max-height: 480px; 
        overflow-y: auto; 
        padding-right: 8px; 
    }
    
    .comment-item { 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        padding: 18px 25px; 
        margin-bottom: 15px;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .comment-item-header { 
        font-size: 14px; 
        color: var(--text-color-light); 
        font-weight: 600; 
        margin-bottom: 12px;
        font-family: 'Playfair Display', serif;
    }
    
    .comment-item-body { 
        font-size: 16px; 
        line-height: 1.8; 
        white-space: pre-wrap; 
        word-break: break-word;
        color: var(--text-color);
        font-family: 'Crimson Text', serif;
    }
    
    .empty-comments { 
        text-align: center; 
        color: var(--text-color-light); 
        padding: 60px 25px; 
        background: var(--aged-paper);
        border-radius: 0;
        border: 2px dashed var(--border-color);
        font-style: italic;
    }
    
    /* ì˜ìˆ˜ì¦ ìŠ¤íƒ€ì¼ */
    .receipt-container {
        background: var(--container-bg);
        border-radius: 0;
        padding: 0;
        margin-top: 0;
        margin-bottom: 25px;
        box-shadow: 
            0 0 0 2px var(--border-color),
            0 6px 18px var(--paper-shadow);
        font-family: 'Courier New', monospace;
        max-width: 100%;
        overflow: hidden;
        border: 2px solid var(--border-color);
    }
    
    .receipt-header { 
        padding: 18px 25px 12px; 
        background: var(--primary-light); 
    }
    
    .receipt-title { 
        display: block; 
        text-align: center; 
        margin-bottom: 8px; 
        position: relative; 
    }
    
    .receipt-title h3 { 
        margin: 0; 
        font-size: 18px; 
        color: var(--primary-color); 
        font-weight: 700;
        font-family: 'Playfair Display', serif;
    }
    
    .budget-info { 
        display: flex; 
        flex-direction: column; 
        gap: 4px; 
        font-size: 12px; 
        color: var(--text-color); 
        font-weight: 600; 
        text-align: right; 
        position: absolute;
        top: -6px;
        right: -10px;
    }
    
    .receipt-header p { 
        margin: 0; 
        font-size: 13px; 
        color: var(--text-color-light); 
        text-align: center;
        font-style: italic;
    }
    
    .receipt-divider { 
        height: 2px; 
        background: repeating-linear-gradient(
            to right, 
            var(--border-color) 0px, 
            var(--border-color) 4px, 
            transparent 4px, 
            transparent 8px
        ); 
        margin: 0 18px; 
    }
    
    .receipt-items { padding: 18px 25px 12px; }
    
    .receipt-item { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 5px 10px; 
        font-size: 14px; 
        line-height: 1.4; 
    }
    
    .receipt-date { 
        color: var(--text-color-light); 
        font-size: 12px; 
        min-width: 65px; 
        margin-right: 18px; 
    }
    
    .receipt-desc { 
        flex: 1; 
        font-weight: 600; 
        color: var(--text-color); 
        margin-right: 18px; 
    }
    
    .receipt-amount { 
        font-weight: 700; 
        color: var(--text-color); 
        font-size: 14px; 
        text-align: right; 
        min-width: 75px; 
    }
    
    .receipt-total { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 18px 25px; 
        background: var(--aged-paper);
        font-weight: 700; 
        font-size: 18px; 
        font-family: 'Playfair Display', serif;
        color: var(--primary-color); 
        border-top: 2px solid var(--border-color);
    }

    /* ê¹”ë”í•œ ìŠ¤ì¼ˆë ˆí†¤ UI */
    .calendar-cell.skeleton {
        background: #ede8e0;
        border: 1px solid #d4c4b0;
        position: relative;
        overflow: hidden;
    }

    .calendar-cell.skeleton::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(139, 69, 19, 0.1), transparent);
        animation: shimmer 2s infinite;
    }

    .calendar-cell.skeleton .cell-day-number {
        color: #c4b4a0;
        background: transparent;
    }

    .calendar-cell.skeleton .cell-top-icons,
    .calendar-cell.skeleton .cell-bottom-info {
        background: transparent;
    }

    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* ë¡œë”© ìƒíƒœ í‘œì‹œ */
    .loading-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--text-color-light);
        font-size: 12px;
        z-index: 10;
        background: rgba(254, 253, 251, 0.95);
        padding: 8px 15px;
        border-radius: 0;
        box-shadow: 
            0 0 0 2px var(--border-color),
            0 4px 12px var(--paper-shadow);
        border: 2px solid var(--border-color);
        font-family: 'Crimson Text', serif;
        font-style: italic;
    }

    #dailyQuestModal .modal-header {
        padding-top: 30px;
        padding-bottom: 18px;
    }
    
    /* í€˜ìŠ¤íŠ¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .quest-tabs { display: flex; gap: 12px; margin-bottom: 25px; }
    
    .quest-tab { 
        padding: 12px 20px; 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        cursor: pointer; 
        font-size: 14px; 
        font-weight: 600; 
        transition: all 0.3s ease;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .quest-tab.active { 
        background: var(--primary-color); 
        color: white; 
        border-color: var(--primary-dark); 
    }
    
    .quest-list { display: flex; flex-direction: column; gap: 12px; }
    
    .quest-item { 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        padding: 18px; 
        transition: all 0.2s ease;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .quest-item:hover { 
        transform: translateY(-2px); 
        box-shadow: 4px 4px 8px var(--paper-shadow); 
    }
    
    .quest-item.completed { 
        background: var(--success-color); 
        color: white; 
        border-color: #5a7849; 
    }
    
    .quest-item.completed .quest-reward { color: rgba(255,255,255,0.9); }
    
    .quest-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 10px; 
    }
    
    .quest-title { 
        font-weight: 600; 
        font-size: 15px;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .quest-item.completed .quest-title { color: white; }
    
    .quest-reward { 
        font-size: 12px; 
        color: var(--primary-color); 
        font-weight: 600;
        font-family: 'Crimson Text', serif;
    }
    
    .quest-desc { 
        font-size: 13px; 
        color: var(--text-color-light); 
        margin-bottom: 12px;
        font-family: 'Crimson Text', serif;
        font-style: italic;
    }
    
    .quest-item.completed .quest-desc { color: rgba(255,255,255,0.8); }
    
    .quest-progress { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
    }
    
    .quest-progress-bar { 
        flex: 1; 
        height: 8px; 
        background: var(--container-bg);
        border-radius: 0;
        margin-right: 12px; 
        overflow: hidden;
        border: 1px solid var(--border-color);
    }
    
    .quest-progress-fill { 
        height: 100%; 
        background: var(--primary-color); 
        transition: width 0.3s ease; 
    }
    
    .quest-progress-text { 
        font-size: 11px; 
        color: var(--text-color-light); 
        min-width: 45px; 
        text-align: right;
        font-family: 'Crimson Text', serif;
    }
    
    .quest-item.completed .quest-progress-bar { 
        background: rgba(255,255,255,0.3);
        border-color: rgba(255,255,255,0.5);
    }
    
    .quest-item.completed .quest-progress-fill { background: rgba(255,255,255,0.8); }
    .quest-item.completed .quest-progress-text { color: rgba(255,255,255,0.9); }

    /* ë³´ìƒ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
    #rewardsModal .modal-header { 
        padding: 35px 30px 25px 30px; 
        border-bottom: 2px solid var(--border-color); 
        background: var(--container-bg);
    }
    
    .rewards-list { 
        display: flex; 
        flex-direction: column; 
        gap: 15px; 
        max-height: 420px; 
        overflow-y: auto; 
    }
    
    .reward-item { 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        padding: 18px; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        transition: all 0.2s ease;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .reward-item:hover { 
        transform: translateY(-2px); 
        box-shadow: 4px 4px 8px var(--paper-shadow); 
    }
    
    .reward-item.bronze { 
        border-color: #CD7F32; 
        background: linear-gradient(135deg, #f9f6f0, #f4f0e8); 
    }
    
    .reward-item.silver { 
        border-color: #C0C0C0; 
        background: linear-gradient(135deg, #f8f8f9, #f0f0f2); 
    }
    
    .reward-item.gold { 
        border-color: #FFD700; 
        background: linear-gradient(135deg, #fffcf0, #fdf8e8); 
    }
    
    .reward-item.legend { 
        border-color: #9400D3; 
        background: linear-gradient(135deg, #f8f4ff, #f0e8ff); 
    }
    
    .reward-item.used { 
        opacity: 0.6; 
        filter: grayscale(30%); 
    }
    
    .reward-info { flex: 1; }
    
    .reward-name { 
        font-weight: 600; 
        font-size: 16px; 
        margin-bottom: 6px;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .reward-desc { 
        font-size: 13px; 
        color: var(--text-color-light);
        font-family: 'Crimson Text', serif;
        font-style: italic;
    }
    
    .reward-tier { 
        font-size: 11px; 
        font-weight: 600; 
        padding: 3px 8px; 
        border-radius: 0;
        margin-bottom: 6px; 
        display: inline-block;
        font-family: 'Playfair Display', serif;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .reward-tier.bronze { background: #CD7F32; color: white; }
    .reward-tier.silver { background: #C0C0C0; color: white; }
    .reward-tier.gold { background: #FFD700; color: #333; }
    .reward-tier.legend { background: #9400D3; color: white; }
    
    .reward-actions { display: flex; gap: 10px; }
    
    .reward-btn { 
        padding: 10px 15px; 
        border: 2px solid;
        border-radius: 0;
        font-size: 12px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: all 0.2s ease;
        font-family: 'Playfair Display', serif;
        text-transform: uppercase;
    }
    
    .reward-btn.use { 
        background: var(--success-color); 
        color: white;
        border-color: #5a7849;
    }
    
    .reward-btn.use:hover { background: #5a7849; }
    
    .reward-btn.delete { 
        background: var(--danger-color); 
        color: white;
        border-color: #9d3f3c;
    }
    
    .reward-btn.delete:hover { background: #9d3f3c; }
    
    .reward-btn:disabled { 
        opacity: 0.5; 
        cursor: not-allowed; 
    }
    
    .empty-rewards { 
        text-align: center; 
        padding: 50px 25px; 
        color: var(--text-color-light);
        font-style: italic;
        font-family: 'Crimson Text', serif;
    }

    /* í”„ë¡œí•„ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    .profile-menu-item:hover { 
        background: var(--primary-light); 
        color: var(--primary-color); 
    }
    
    /* í”„ë¡œí•„ ìœ„ì ¯ í˜¸ë²„ íš¨ê³¼ */
    #profileWidget:hover { transform: translateY(-2px); }
    #profileWidget { transition: transform 0.2s ease; }

    .achievements-list { 
        display: flex; 
        flex-direction: column; 
        gap: 15px; 
        max-height: 420px; 
        overflow-y: auto; 
    }
    
    .achievement-item { 
        background: var(--aged-paper);
        border: 2px solid var(--border-color);
        border-radius: 0;
        padding: 18px; 
        display: flex; 
        align-items: center; 
        gap: 18px; 
        transition: all 0.2s ease;
        box-shadow: 2px 2px 4px var(--paper-shadow);
    }
    
    .achievement-item.unlocked { 
        border-color: var(--success-color); 
        background: linear-gradient(135deg, #f4f8f2, #eef5ec); 
    }
    
    .achievement-item.locked { opacity: 0.6; }
    
    .achievement-emoji { font-size: 28px; min-width: 45px; text-align: center; }
    
    .achievement-info { flex: 1; }
    
    .achievement-name { 
        font-weight: 600; 
        font-size: 16px; 
        margin-bottom: 6px;
        color: var(--text-color);
        font-family: 'Playfair Display', serif;
    }
    
    .achievement-desc { 
        font-size: 13px; 
        color: var(--text-color-light);
        font-family: 'Crimson Text', serif;
        font-style: italic;
    }
    
    .achievement-status { 
        font-size: 12px; 
        font-weight: 600; 
        padding: 5px 10px; 
        border-radius: 0;
        font-family: 'Playfair Display', serif;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .achievement-status.unlocked { 
        background: var(--success-color); 
        color: white; 
    }
    
    .achievement-status.locked { 
        background: var(--border-color); 
        color: var(--text-color-light); 
    }
    
    .achievement-item.hidden { 
        background: linear-gradient(135deg, #ede8e0, #e5ddd0); 
        color: #8d7b68; 
        border-color: #c4b4a0; 
    }
    
    .achievement-item.hidden .achievement-desc { 
        color: #a09080; 
        font-style: italic; 
    }

    @media (max-width: 767px) {
        body {
            padding: 15px;
        }
        
        .container {
            padding: 45px 25px 100px 25px;
            border-width: 2px;
        }
        
        .container::before {
            left: 35px;
        }
        
        .container {
            background: 
                linear-gradient(90deg, transparent 0%, transparent 35px, rgba(139, 69, 19, 0.1) 35px, rgba(139, 69, 19, 0.1) 37px, transparent 37px),
                var(--container-bg);
        }
        
        .header h1 {
            font-size: 28px;
        }
        
        .modal-content {
            padding: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            max-height: 100vh;
            background: var(--container-bg);
            border-width: 0;
        }
        
        .food-modal {
            width: 90%;
            height: auto;
            border-radius: 0;
            max-height: 90vh;
            border: 2px solid var(--border-color);
        }
        
        .food-modal .modal-body {
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }
        
        #dayModal .modal-body {
            padding: 25px 18px;
        }
        
        .modal-input-group {
            padding: 18px;
        }
        
        .modal-input-group h4 {
            font-size: 16px;
        }
        
        #dayModal .form-group label {
            font-size: 14px;
        }

        #dayModal .modal-input-row {
            grid-template-columns: 1fr;
            gap: 18px;
        }

        .exercise-toggle-btns {
            max-width: 200px;
        }
        
        .score-display-card, .personal-goals-section {
            width: 100%;
            max-width: none;
            margin: 0;
            padding: 18px;
        }
        
        .score-display-card .score {
            font-size: 38px;
        }

        #modalTotalExpense {
            text-align: left !important;
        }
        
        .expense-item {
            font-size: 14px;
            word-break: break-all;
        }
        
        .expense-item span:first-child {
            flex-grow: 1;
            margin-right: 12px;
        }
        
        .expense-item > div {
            flex-shrink: 0;
        }
        
        .modal-actions-container {
            padding: 0 18px 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .modal-actions-container .btn.delete {
            order: 2;
            background-color: transparent;
            color: var(--text-color-light);
            font-size: 14px;
            font-weight: normal;
            padding: 10px;
            box-shadow: none;
            margin-top: 12px;
            max-width: 160px;
            border: 1px solid var(--border-color);
        }
        
        .modal-actions-container .btn.delete:hover {
            background-color: var(--danger-color);
            color: white;
        }
        
        .modal-actions-container .btn.save {
            order: 1;
        }

        #budgetPage .budget-summary {
            flex-wrap: wrap;
        }
        
        #budgetPage .budget-summary .budget-card:first-child {
            flex-basis: 100%;
        }
        
        #budgetPage .budget-card-value {
            font-size: 22px;
        }
        
        #dayModal .expense-input-row {
            flex-direction: column;
            gap: 12px;
        }
        
        #dayModal .expense-input-row input,
        #dayModal .expense-input-row button {
            width: 100%;
        }
        
        .dday-header-container {
            top: 10px;
            left: 5px;
            right: 5px;
        }
        
        .dday-chip {
            font-size: 10px;
            padding: 4px 10px;
        }
        
        .battery {
            width: 28px;
            height: 13px;
        }
        
        .receipt-item {
            font-size: 13px;
        }
    
        .receipt-date {
            min-width: 55px;
            margin-right: 12px;
            font-size: 11px;
        }
    
        .receipt-desc {
            margin-right: 12px;
        }
    
        .receipt-amount {
            min-width: 65px;
            font-size: 13px;
        }
    
        .budget-info {
            flex-direction: column;
            gap: 3px;
            font-size: 11px;
            text-align: right;
        }
        
        .calendar-grid {
            gap: 1px;
        }
        
        .month-nav {
            font-size: 18px;
            padding: 6px 10px;
        }
        
        .month-year {
            font-size: 22px;
        }
        
        .btn {
            font-size: 15px;
            padding: 14px 18px;
        }
    }
    `,

    nature: `
    @font-face {
        font-family: 'KBIZHanmaumMyungjo';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff');
        font-weight: normal;
        font-style: normal;
    }

    :root {
        --bg-color: #7a9e7a;
        --primary-color: #5c7c5c;
        --primary-dark: #4a6b4a;
        --primary-light: #e8f0e8;
        --text-color: #2d3d2d;
        --text-color-light: #6b8a6b;
        --border-color: #8db08d;
        --container-bg: #f8fdf8;
        --danger-color: #a0644c;
        --warning-color: #b8935e;
        --success-color: #6b9b4f;
        --neutral-color: #7a8f7a;
        --wood-color: #8b7355;
        --stone-color: #8a8a7a;
        --flower-pink: #d4a5a5;
        --flower-yellow: #e8d98c;
        --leaf-green: #8fbf8f;
        --moss-green: #6f9f6f;
    }

    * { 
        margin: 0; 
        padding: 0; 
        box-sizing: border-box; 
    }

    body { 
        font-family: 'KBIZHanmaumMyungjo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        background: var(--bg-color);
        min-height: 100vh; 
        padding: 20px; 
        color: var(--text-color);
        position: relative;
        overflow-x: hidden;
    }

    /* ìì—°ìŠ¤ëŸ¬ìš´ ì”ë”” í…ìŠ¤ì²˜ íš¨ê³¼ */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 15% 20%, rgba(111, 159, 111, 0.3) 2px, transparent 2px),
            radial-gradient(circle at 80% 30%, rgba(143, 191, 143, 0.2) 1px, transparent 1px),
            radial-gradient(circle at 45% 70%, rgba(107, 142, 107, 0.3) 1.5px, transparent 1.5px),
            radial-gradient(circle at 70% 80%, rgba(139, 175, 139, 0.2) 1px, transparent 1px);
        background-size: 120px 80px, 200px 100px, 150px 120px, 180px 90px;
        animation: grassSway 15s ease-in-out infinite;
        pointer-events: none;
        z-index: 1;
    }

    @keyframes grassSway {
        0%, 100% { transform: translateX(0px); }
        50% { transform: translateX(3px); }
    }

    /* ì‘ì€ ê³¤ì¶©ê³¼ ë‚˜ë¹„ íš¨ê³¼ */
    body::after {
        content: '';
        position: fixed;
        top: -50px;
        left: -50px;
        width: calc(100% + 100px);
        height: calc(100% + 100px);
        background-image: 
            radial-gradient(1px 1px at 20px 30px, var(--flower-pink), transparent),
            radial-gradient(1px 1px at 90px 60px, var(--flower-yellow), transparent),
            radial-gradient(0.5px 0.5px at 150px 40px, var(--text-color), transparent),
            radial-gradient(0.5px 0.5px at 200px 90px, var(--text-color), transparent);
        background-repeat: repeat;
        background-size: 300px 200px;
        animation: natureDrift 25s linear infinite;
        pointer-events: none;
        z-index: 1;
        opacity: 0.7;
    }

    @keyframes natureDrift {
        0% { transform: translate(0px, 0px); }
        25% { transform: translate(15px, -10px); }
        50% { transform: translate(-8px, -20px); }
        75% { transform: translate(20px, -30px); }
        100% { transform: translate(0px, -40px); }
    }

    button, input, select, textarea { font-family: inherit; }

    .container { 
    background: var(--container-bg); 
    border-radius: 20px; 
    padding: 50px 30px 100px 30px;
    width: 100%; 
    max-width: 500px; 
    margin: 0 auto; 
    box-shadow: 0 8px 32px rgba(45, 61, 45, 0.2);
    position: relative;
    z-index: 2;
    border: 2px solid var(--moss-green);
    animation: containerBreath 8s ease-in-out infinite;
}

    @keyframes containerBreath {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-2px); }
    }

    .header { 
        text-align: center; 
        margin-bottom: 25px; 
        position: relative; 
    }

    .header h1 { 
        color: var(--text-color); 
        font-size: 26px; 
        font-weight: 700; 
        margin-bottom: 8px;
    }

    .header p { 
        color: var(--text-color-light); 
        font-size: 14px; 
    }

    #gameWarning { 
        background: var(--flower-yellow); 
        color: var(--wood-color); 
        border: 2px solid var(--wood-color); 
        border-radius: 12px; 
        padding: 12px; 
        font-size: 14px; 
        font-weight: 500; 
        margin-bottom: 20px; 
        display: none;
    }

    .page { display: none; }
    .page.active { display: block; }

    .calendar-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 20px; 
    }

    .month-nav { 
        background: var(--stone-color); 
        border: 2px solid var(--text-color); 
        font-size: 24px; 
        color: var(--container-bg); 
        cursor: pointer; 
        padding: 12px; 
        border-radius: 50%; 
        transition: all 0.3s ease;
        font-weight: bold;
    }

    .month-nav:hover { 
        background: var(--wood-color);
        transform: scale(1.1);
    }

    .month-year { 
        font-size: 20px; 
        font-weight: 700;
        color: var(--text-color);
    }

    .calendar-grid { 
    display: grid; 
    grid-template-columns: repeat(7, 1fr); 
    gap: 2px; /* 4pxì—ì„œ 2pxë¡œ ë³€ê²½ */
    margin-bottom: 20px; 
}

    .calendar-header-cell { 
        text-align: center; 
        padding: 10px 5px; 
        font-weight: 600; 
        color: var(--text-color-light); 
        font-size: 12px; 
    }

    .calendar-cell { 
    aspect-ratio: 1; 
    display: grid; 
    grid-template-rows: 1fr auto 1fr; 
    padding: 2px; 
    align-items: center; 
    justify-items: center;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
    border: 1px solid var(--moss-green); 
    background: var(--leaf-green);
}

    .cell-top-icons { 
        grid-row: 1; 
        display: flex; 
        justify-content: center; 
        gap: 2px; 
        font-size: 9px; 
        width: 100%; 
        height: 100%; 
        align-items: center; 
    }

    .cell-day-number { 
        grid-row: 2; 
        font-weight: 600;
        color: var(--text-color);
        font-size: 14px;
    }

    .calendar-cell.today .cell-day-number { 
        font-weight: 700; 
        color: var(--container-bg);
    }

    .cell-bottom-info { 
        grid-row: 3; 
        font-size: 8px; 
        font-weight: 600; 
        color: var(--text-color-light); 
        width: 100%; 
        text-align: left; 
        padding-right: 4px; 
        align-self: end; 
        padding-bottom: 2px; 
    }

    .calendar-cell.has-data .cell-bottom-info { 
        color: var(--container-bg); 
    }

    .calendar-cell.off-day { 
        background: var(--stone-color); 
        color: var(--container-bg); 
        border-color: var(--neutral-color);
    }

    .off-day-indicator { 
        position: absolute; 
        top: 4px; 
        right: 4px; 
        font-size: 10px; 
    }

    .calendar-cell:hover { 
        transform: translateY(-2px) scale(1.05); 
        box-shadow: 0 4px 16px rgba(45, 61, 45, 0.3);
        border-color: var(--primary-color);
    }

    .calendar-cell.other-month { 
        color: var(--neutral-color); 
        background: var(--bg-color); 
        border-color: var(--bg-color); 
        pointer-events: none; 
        opacity: 0.5;
    }

    .calendar-cell.today { 
        border-color: var(--wood-color); 
        font-weight: 700; 
        background: var(--wood-color);
        box-shadow: 0 0 0 3px var(--flower-yellow);
        animation: todayGlow 3s ease-in-out infinite;
    }

    @keyframes todayGlow {
        0%, 100% { box-shadow: 0 0 0 3px var(--flower-yellow); }
        50% { box-shadow: 0 0 0 5px var(--flower-pink); }
    }

    .calendar-cell.has-data { 
        color: var(--container-bg); 
        border-color: var(--text-color); 
        font-weight: bold; 
    }

    .calendar-cell.score-high { 
        background: var(--success-color);
    }

    .calendar-cell.score-medium { 
        background: var(--warning-color);
    }

    .calendar-cell.score-low { 
        background: var(--danger-color);
    }

    .calendar-cell.score-negative { 
        background: var(--stone-color);
    }

    .score-indicator { 
        position: absolute; 
        bottom: 4px; 
        right: 4px; 
        font-size: 9px; 
        background: var(--text-color); 
        color: var(--container-bg); 
        padding: 1px 4px; 
        border-radius: 4px; 
        font-weight: 700; 
    }

    .form-group { 
        margin-bottom: 20px; 
    }

    .form-group label { 
        display: block; 
        color: var(--text-color); 
        font-weight: 600; 
        margin-bottom: 8px; 
        font-size: 14px; 
    }

    .form-group input, .form-group textarea, .form-group select { 
        width: 100%; 
        padding: 14px; 
        border: 2px solid var(--moss-green); 
        border-radius: 8px; 
        font-size: 16px; 
        transition: all 0.3s ease; 
        font-family: 'KBIZHanmaumMyungjo', sans-serif;
        background: var(--container-bg);
    }

    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
        outline: none; 
        border-color: var(--primary-color); 
        box-shadow: 0 0 0 3px var(--leaf-green);
        transform: translateY(-1px);
    }

    .main-actions { 
        display: flex; 
        gap: 12px; 
        margin-bottom: 10px; 
    }

    .btn { 
        width: 100%; 
        padding: 16px; 
        background: var(--wood-color); 
        color: var(--container-bg); 
        border: 2px solid var(--text-color); 
        border-radius: 10px; 
        font-size: 16px; 
        font-weight: 700; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        box-shadow: 0 4px 0 var(--text-color);
        position: relative;
    }

    .btn:hover { 
        background: var(--stone-color); 
        transform: translateY(-2px); 
        box-shadow: 0 6px 0 var(--text-color);
    }

    .btn:active { 
        transform: translateY(2px); 
        box-shadow: 0 2px 0 var(--text-color); 
    }

    .main-actions .btn { flex: 1; }

    .btn.secondary { 
        background: var(--stone-color); 
    }

    .btn.secondary:hover { 
        background: var(--neutral-color); 
    }

    .modal-overlay { 
        display: none; 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(45, 61, 45, 0.8); 
        z-index: 1000; 
        align-items: center; 
        justify-content: center; 
    }

    .modal-content { 
        background: var(--container-bg); 
        padding: 0; 
        border-radius: 16px; 
        width: 90%; 
        max-width: 800px; 
        max-height: 95vh; 
        overflow-y: auto; 
        box-shadow: 0 16px 48px rgba(45, 61, 45, 0.4);
        border: 3px solid var(--moss-green);
        animation: modalBounce 0.5s ease-out;
    }

    @keyframes modalBounce {
        0% {
            opacity: 0;
            transform: scale(0.8) translateY(50px);
        }
        60% {
            transform: scale(1.05) translateY(-10px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    #dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { 
        padding: 20px 25px; 
        border-bottom: 2px solid var(--moss-green); 
        background: var(--leaf-green); 
        border-top-left-radius: 13px; 
        border-top-right-radius: 13px; 
    }

    #dayModal .modal-body { 
        padding: 25px; 
    }

    .modal-layout { 
        display: block; 
    }

    @media (min-width: 768px) { 
        .modal-layout { 
            display: block; 
        } 
    }

    .modal-side-column { 
        display: flex; 
        flex-direction: column; 
    }

    .modal-input-group { 
        background: var(--container-bg); 
        padding: 20px; 
        border-radius: 12px; 
        border: 2px solid var(--moss-green); 
    }

    .modal-input-group h4 { 
        font-size: 16px; 
        margin-bottom: 15px; 
        padding-bottom: 10px; 
        border-bottom: 1px solid var(--moss-green); 
        color: var(--text-color);
    }

    .modal-input-row { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
        gap: 15px; 
    }

    #commentDetails summary { 
        font-weight: 600; 
        color: var(--text-color); 
        cursor: pointer; 
        padding: 12px; 
        border-radius: 8px; 
        background: var(--leaf-green); 
        border: 2px solid var(--moss-green); 
        list-style: none; 
        position: relative; 
        padding-left: 35px;
        transition: all 0.3s ease;
    }

    #commentDetails summary:hover {
        background: var(--moss-green);
        color: var(--container-bg);
    }

    #commentDetails summary::-webkit-details-marker { 
        display: none; 
    }

    #commentDetails summary::before { 
        content: 'ğŸŒ±'; 
        position: absolute; 
        left: 12px; 
        top: 50%; 
        transform: translateY(-50%); 
        font-size: 12px; 
        transition: transform 0.3s ease; 
    }

    #commentDetails[open] > summary::before { 
        transform: translateY(-50%) rotate(90deg); 
    }

    .legend { 
        display: flex; 
        justify-content: center; 
        flex-wrap: wrap; 
        margin: 20px 0 0; 
        font-size: 12px; 
        gap: 15px; 
    }

    .legend-item { 
        display: flex; 
        align-items: center; 
        gap: 8px;
        padding: 6px 12px;
        background: var(--leaf-green);
        border-radius: 16px;
        border: 2px solid var(--moss-green);
    }

    .legend-color { 
        width: 14px; 
        height: 14px; 
        border-radius: 50%; 
        border: 2px solid var(--text-color);
    }

    .calendar-cell.skeleton { 
        background: var(--neutral-color); 
        border: 2px solid var(--moss-green); 
        position: relative; 
        overflow: hidden; 
        opacity: 0.7;
    }

    .calendar-cell.skeleton::before { 
        content: ''; 
        position: absolute; 
        top: 0; 
        left: -100%; 
        width: 100%; 
        height: 100%; 
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); 
        animation: shimmer 2s infinite ease-in-out; 
    }

    @keyframes shimmer { 
        0% { left: -100%; } 
        100% { left: 100%; } 
    }

    .loading-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--text-color);
        font-size: 12px;
        z-index: 10;
        background: var(--flower-yellow);
        padding: 8px 16px;
        border-radius: 16px;
        border: 2px solid var(--wood-color);
        font-weight: 600;
    }

    /* ë‚˜ë¨¸ì§€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ë“¤ */
    #dayModal .form-group { margin-bottom: 0; }
    #dayModal .form-group label { font-size: 13px; margin-bottom: 6px; }
    #dayModal .form-group input { padding: 10px; font-size: 16px; }
    #dayModal .modal-input-group, #dayModal .score-display-card { margin-bottom: 5px; }
    #dayModal .modal-layout > div:last-child { margin-bottom: 0; }
    
    .modal-header { display: flex; justify-content: center; align-items: center; position: relative; gap: 20px; }
    .modal-title { flex: none; text-align: center; margin: 0; color: var(--text-color); font-weight: 700; }
    
    .date-nav-btn { background: var(--stone-color); border: 2px solid var(--text-color); font-size: 24px; color: var(--container-bg); cursor: pointer; padding: 10px; border-radius: 50%; transition: all 0.3s ease; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .date-nav-btn:hover { background: var(--wood-color); transform: scale(1.1); }
    
    .close-btn { background: var(--danger-color); border: 2px solid var(--text-color); font-size: 28px; cursor: pointer; color: var(--container-bg); line-height: 1; position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .close-btn:hover { background: var(--stone-color); }
    
    .score-display-card { background: var(--container-bg); border-radius: 12px; padding: 20px; text-align: center; border: 2px solid var(--moss-green); }
    .score-display-card .score { font-size: 40px; font-weight: 700; color: var(--primary-color); line-height: 1; }
    .score-display-card .score.is-off { color: var(--neutral-color); }
    .score-display-card div:last-child { font-size: 14px; color: var(--text-color-light); margin-top: 5px; }
    
    .exercise-toggle-group { margin-bottom: 15px; }
    .exercise-toggle-group label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    .exercise-toggle-btns { display: flex; border: 2px solid var(--moss-green); border-radius: 8px; overflow: hidden; }
    .exercise-toggle-btn { flex: 1; padding: 12px; border: none; background: var(--container-bg); cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-size: 14px; color: var(--text-color); }
    .exercise-toggle-btn.active { background: var(--success-color); color: var(--container-bg); }
    
    .goal-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .goal-tab { padding: 10px 18px; background: var(--leaf-green); border: 2px solid var(--moss-green); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; color: var(--text-color); }
    .goal-tab.active { background: var(--wood-color); color: var(--container-bg); border-color: var(--text-color); }
    .goal-tab:hover:not(.active) { background: var(--moss-green); color: var(--container-bg); }
    
    .goal-type-toggle { display: flex; gap: 6px; margin-bottom: 15px; }
    .goal-type-toggle button { flex: 1; padding: 10px; font-size: 14px; border: 2px solid var(--moss-green); background: var(--leaf-green); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; color: var(--text-color); }
    .goal-type-toggle button.active { background: var(--wood-color); color: var(--container-bg); border-color: var(--text-color); }
    
    #personalGoalsPage .header { text-align: left; }
    
    .dday-header-container { height: auto; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: flex-start; position: absolute; top: 10px; left: 10px; right: 10px; z-index: 10; pointer-events: none; }
    
    .dday-chip { background: var(--flower-yellow); color: var(--wood-color); padding: 6px 12px; border-radius: 12px; font-weight: 700; font-size: 11px; display: none; pointer-events: all; border: 2px solid var(--wood-color); }
    
    .battery { display: none; width: 32px; height: 16px; border: 2px solid var(--text-color); border-radius: 4px; position: relative; padding: 2px; background: var(--container-bg); }
    .battery::after { content: ''; position: absolute; top: 50%; right: -6px; transform: translateY(-50%); width: 3px; height: 8px; background: var(--text-color); border-radius: 0 2px 2px 0; }
    .battery-level { height: 100%; border-radius: 2px; transition: width 0.4s ease; }
    .battery-level.green { background: var(--success-color); } 
    .battery-level.yellow { background: var(--warning-color); } 
    .battery-level.red { background: var(--danger-color); } 
    .battery-level.black { background: var(--text-color); }
    
    .budget-summary { display: flex; gap: 12px; margin-bottom: 20px; }
    .budget-card { flex: 1; background: var(--leaf-green); color: var(--text-color); padding: 18px; border-radius: 12px; text-align: center; border: 2px solid var(--moss-green); }
    .budget-card-title { font-size: 13px; opacity: 0.9; margin-bottom: 10px; font-weight: 600; }
    .budget-card-value { font-size: 22px; font-weight: 700; }
    
    #budgetPage .header p { font-size: 16px; font-weight: 600; color: var(--text-color); }
    
    .personal-goals-section { background: var(--container-bg); padding: 18px; border-radius: 12px; border: 2px solid var(--moss-green); }
    
    #modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }
    
    .personal-goal-checkbox { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--container-bg); border-radius: 8px; margin-bottom: 10px; border: 2px solid var(--moss-green); transition: all 0.3s ease; }
    .personal-goal-checkbox:hover { background: var(--leaf-green); }
    
    .personal-goal-item { background: var(--container-bg); border: 2px solid var(--moss-green); border-radius: 12px; padding: 18px; margin-bottom: 12px; transition: all 0.3s ease; }
    .personal-goal-item:hover { transform: translateY(-2px); background: var(--leaf-green); }
    
    .personal-goal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .personal-goal-name { font-weight: 600; color: var(--text-color); }
    .personal-goal-actions button { padding: 6px 12px; border-radius: 6px; font-size: 12px; border: 2px solid var(--text-color); cursor: pointer; color: var(--container-bg); transition: all 0.3s ease; font-weight: 600; }
    .edit-btn { background: var(--warning-color); }
    .delete-btn { background: var(--danger-color); }
    .complete-btn { background: var(--success-color); }
    .reopen-btn { background: var(--primary-color); }
    
    .empty-goals { text-align: center; color: var(--text-color-light); padding: 40px 20px; background: var(--leaf-green); border-radius: 12px; margin-top: 20px; border: 2px solid var(--moss-green); }
    
    .budget-settings, .dday-settings { margin-bottom: 30px; }
    .budget-input, .dday-actions { display: flex; gap: 12px; align-items: center; }
    
    .dday-item { background: var(--leaf-green); border-radius: 12px; padding: 15px 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 2px solid var(--moss-green); transition: all 0.3s ease; }
    .dday-item:hover { background: var(--moss-green); color: var(--container-bg); }
    
    .budget-input button { padding: 14px 24px; background: var(--success-color); color: var(--container-bg); border: 2px solid var(--text-color); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 0 var(--text-color); }
    .budget-input button:hover { background: var(--wood-color); transform: translateY(-1px); box-shadow: 0 4px 0 var(--text-color); }
    
    .wakeup-prompt { background: var(--flower-pink); color: var(--text-color); padding: 24px; border-radius: 16px; text-align: center; margin-bottom: 20px; border: 2px solid var(--wood-color); }
    
    .monthly-summary { display: flex; justify-content: space-around; gap: 15px; margin-bottom: 30px; }
    .summary-card { flex-basis: 30%; background: var(--leaf-green); color: var(--text-color); padding: 24px; border-radius: 16px; text-align: center; border: 2px solid var(--moss-green); }
    .summary-title { font-size: 14px; opacity: 0.9; margin-bottom: 12px; font-weight: 600; }
    .summary-value { font-size: 24px; font-weight: 700; }
    
    .week-card { background: var(--container-bg); border-radius: 16px; padding: 24px; margin-bottom: 18px; border: 2px solid var(--moss-green); }
    .week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; font-weight: 600; color: var(--text-color); }
    .week-stats { display: flex; justify-content: space-around; align-items: center; text-align: center; font-size: 22px; font-weight: 600; color: var(--text-color); }
    
    .empty-expenses { text-align: center; color: var(--text-color-light); padding: 40px 20px; }
    
    .feedback-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(45, 61, 45, 0.8); display: none; z-index: 2000; animation: fadeIn 0.3s ease; justify-content: center; align-items: center; }
    .feedback-content { position: relative; background: var(--container-bg); padding: 48px; border-radius: 24px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(45, 61, 45, 0.5); animation: popIn 0.5s ease; border: 3px solid var(--moss-green); }
    .feedback-emoji { font-size: 60px; margin-bottom: 24px; display: block; }
    .feedback-title { font-size: 24px; font-weight: 700; margin-bottom: 18px; color: var(--text-color); }
    .feedback-message { font-size: 16px; color: var(--text-color-light); line-height: 1.6; margin-bottom: 28px; }
    
    .feedback-celebration .feedback-content { background: var(--success-color); }
    .feedback-celebration .feedback-title, .feedback-celebration .feedback-message { color: var(--container-bg); }
    .feedback-reflection .feedback-content { background: var(--warning-color); }
    .feedback-reflection .feedback-title, .feedback-reflection .feedback-message { color: var(--container-bg); }
    .feedback-disaster .feedback-content { background: var(--stone-color); }
    .feedback-disaster .feedback-title, .feedback-disaster .feedback-message { color: var(--container-bg); }
    .feedback-encouragement .feedback-content { background: var(--primary-color); }
    .feedback-encouragement .feedback-title, .feedback-encouragement .feedback-message { color: var(--container-bg); }
    .feedback-warning .feedback-content { background: var(--danger-color); }
    .feedback-warning .feedback-title, .feedback-warning .feedback-message { color: var(--container-bg); }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    
    .feedback-btn { background: var(--wood-color); color: var(--container-bg); border: 2px solid var(--text-color); padding: 14px 32px; border-radius: 20px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 0 12px; box-shadow: 0 3px 0 var(--text-color); }
    .feedback-btn:hover { background: var(--stone-color); transform: translateY(-2px); box-shadow: 0 5px 0 var(--text-color); }
    
    .feedback-budget-red .feedback-content { background: var(--danger-color) !important; }
    .feedback-budget-black .feedback-content { background: var(--stone-color) !important; }
    
    .expense-input-row { display: flex; gap: 12px; align-items: center; margin-top: 12px; }
    .expense-input-row input { flex: 1; padding: 14px; font-size: 14px; border-radius: 8px; border: 2px solid var(--moss-green); background: var(--container-bg); }
    .expense-input-row button { flex-shrink: 0; width: 48px; height: 48px; border-radius: 10px; background: var(--wood-color); border: 2px solid var(--text-color); color: var(--container-bg); font-weight: bold; cursor: pointer; font-size: 24px; line-height: 48px; transition: all 0.3s ease; box-shadow: 0 3px 0 var(--text-color); }
    .expense-input-row button:hover { background: var(--stone-color); transform: translateY(-1px); box-shadow: 0 4px 0 var(--text-color); }
    
    .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; font-size: 14px; border-bottom: 1px solid var(--moss-green); color: var(--text-color); }
    
    .dday-settings h4 { margin-bottom: 18px; color: var(--text-color); font-weight: 600; }
    .dday-item .dday-actions { display: flex; gap: 8px; }
    .dday-item .dday-actions button { background: var(--stone-color); border: 2px solid var(--text-color); width: 34px; height: 34px; border-radius: 50%; font-size: 16px; cursor: pointer; transition: all 0.3s ease; color: var(--container-bg); font-weight: bold; }
    .dday-item .dday-actions button:hover { background: var(--wood-color); transform: scale(1.1); }
    
    .excel-option-item { display: flex; align-items: center; padding: 10px 0; cursor: pointer; transition: all 0.3s ease; border-radius: 8px; }
    .excel-option-item:hover { background: var(--leaf-green); }
    .excel-option-item input[type="radio"] { width: 20px; height: 20px; margin-right: 14px; }
    .excel-option-item label { font-size: 16px; color: var(--text-color); }
    
    #customDateRange { display: flex; gap: 12px; align-items: center; margin-top: 12px; margin-bottom: 20px; }
    #customDateRange input[type="date"] { padding: 12px; border-radius: 8px; border: 2px solid var(--moss-green); flex: 1; font-family: inherit; background: var(--container-bg); }

    .number-input-group {
        display: flex;
        align-items: center;
        border: 2px solid var(--moss-green);
        border-radius: 8px;
        overflow: hidden;
        background: var(--container-bg);
    }

    .number-input-group input {
        border: none;
        text-align: center;
        flex: 1;
        padding: 12px 8px;
        background: transparent;
        font-weight: 600;
        color: var(--text-color);
    }

    .number-input-group input:focus { box-shadow: none; border: none; }

    .number-btn {
        width: 36px;
        height: 46px;
        border: none;
        background: var(--stone-color);
        color: var(--container-bg);
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .number-btn:hover { 
        background: var(--wood-color); 
        transform: scale(1.05);
    }
    .number-btn:active { 
        background: var(--primary-color); 
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    .food-page-actions { display: flex; gap: 12px; margin-bottom: 12px; }
    .food-page-actions .btn.secondary.danger { background: var(--danger-color); color: var(--container-bg); }
    
    .food-date-header { display: flex; align-items: center; text-align: center; margin: 30px 0 12px; color: var(--text-color-light); }
    .food-date-header::before, .food-date-header::after { content: ''; flex: 1; border-bottom: 2px solid var(--moss-green); }
    .food-date-header span { padding: 0 18px; font-size: 13px; font-weight: 600; }
    
    .food-record-item { display: grid; grid-template-columns: 50px 30px 1fr auto; gap: 18px; align-items: center; padding: 16px 8px; border-bottom: 1px solid var(--moss-green); position: relative; transition: all 0.3s ease; }
    .food-record-item:hover { background: var(--leaf-green); border-radius: 8px; }
    
    .food-record-item .food-admin-actions { position: absolute; right: 0px; top: 50%; transform: translateY(-50%); display: flex; gap: 6px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
    .food-records.admin-mode .food-record-item .food-admin-actions { opacity: 1; pointer-events: auto; }
    
    .food-admin-actions button { background: var(--stone-color); border: 2px solid var(--text-color); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 14px; transition: all 0.3s ease; color: var(--container-bg); font-weight: bold; }
    .food-admin-actions button.edit { background: var(--warning-color); }
    .food-admin-actions button.delete { background: var(--danger-color); }
    .food-admin-actions button:hover { transform: scale(1.1); }
    
    #foodExportModal .modal-content { max-width: 90vw; background: var(--container-bg); padding: 0; border: 3px solid var(--moss-green); }
    #foodExportPreview {
        background: var(--container-bg);
        border-radius: 12px;
        padding: 0;
        margin: 24px;
        box-shadow: 0 8px 24px rgba(45, 61, 45, 0.3);
        font-family: 'Courier New', monospace;
        border: 2px solid var(--moss-green);
    }
    
    .food-receipt-header { padding: 18px 24px 12px; background: var(--leaf-green); }
    .food-receipt-title { display: block; text-align: center; margin-bottom: 6px; }
    .food-receipt-title h3 { margin: 0; font-size: 16px; color: var(--text-color); font-weight: 700; }
    .food-receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
    
    .food-receipt-divider {
        height: 2px;
        background: repeating-linear-gradient(
            to right,
            var(--moss-green) 0px,
            var(--moss-green) 3px,
            transparent 3px,
            transparent 6px
        );
        margin: 0 18px;
    }
    
    .food-receipt-items { padding: 18px 24px 12px; }
    .food-receipt-date-header { font-weight: 700; color: var(--primary-color); font-size: 13px; margin: 18px 0 10px 0; padding-bottom: 6px; border-bottom: 1px dashed var(--moss-green); }
    .food-receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; font-size: 13px; line-height: 1.4; color: var(--text-color); }
    .food-receipt-time { color: var(--text-color-light); font-size: 11px; min-width: 48px; margin-right: 12px; }
    .food-receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 12px; }
    .food-receipt-quantity { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 65px; }
    
    #foodExportModal .close-btn {
        position: absolute;
        top: 18px;
        right: 18px;
        background: var(--danger-color);
        border: 2px solid var(--text-color);
        width: 38px;
        height: 38px;
        border-radius: 50%;
        font-size: 20px;
        color: var(--container-bg);
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-weight: bold;
    }

    #foodExportModal .close-btn:hover { 
        background: var(--stone-color); 
        transform: scale(1.1);
    }

    .food-modal { max-width: 420px; background: var(--container-bg); overflow: hidden; border: 3px solid var(--moss-green); }
    .food-modal .modal-header { padding: 18px 24px; background: var(--leaf-green); border-bottom: 2px solid var(--moss-green); }
    .food-modal .modal-header h2 { font-size: 18px; color: var(--text-color); }
    .food-modal .modal-body { padding: 24px; }
    .food-modal .form-group { margin-bottom: 18px; }
    .food-modal .form-group label { font-size: 13px; margin-bottom: 8px; color: var(--text-color); }
    .food-modal .form-group input, .food-modal .form-group select { padding: 12px; font-size: 15px; border-radius: 8px; border: 2px solid var(--moss-green); background: var(--container-bg); }
    .food-modal .quantity-input { display: flex; gap: 10px; }
    .food-modal .quantity-input select { width: 95px; }
    .food-modal .food-modal-actions { margin-top: 24px; display: flex; gap: 12px; }
    .food-modal .food-modal-actions .btn { flex: 1; padding: 14px; border-radius: 8px; }

    .fame-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
    .fame-card { background: var(--container-bg); border: 2px solid var(--moss-green); border-radius: 12px; padding: 18px; text-align: center; transition: all 0.3s ease; }
    .fame-card:hover { transform: translateY(-2px); background: var(--leaf-green); }
    .fame-card-title { font-size: 18px; margin-bottom: 10px; color: var(--text-color); }
    .fame-card-value { font-size: 20px; font-weight: 700; color: var(--primary-color); }
    .fame-card-date { font-size: 12px; color: var(--text-color-light); margin-top: 6px; }
    #wallOfShame .fame-card-value { color: var(--danger-color); }

    #modalCommentSection { margin-top: 24px; }
    #modalComment { width: 100%; margin-top: 18px; height: 85px; resize: vertical; font-size: 16px; border-radius: 8px; border: 2px solid var(--moss-green); background: var(--container-bg); padding: 14px; color: var(--text-color); }
    #modalPersonalGoalsList input[type="number"] { font-size: 16px; }

    .comment-history-list { max-height: 450px; overflow-y: auto; padding-right: 8px; }
    .comment-item { background: var(--container-bg); border: 2px solid var(--moss-green); border-radius: 12px; padding: 18px 24px; margin-bottom: 15px; transition: all 0.3s ease; }
    .comment-item:hover { background: var(--leaf-green); }
    .comment-item-header { font-size: 13px; color: var(--text-color-light); font-weight: 600; margin-bottom: 12px; }
    .comment-item-body { font-size: 15px; line-height: 1.7; white-space: pre-wrap; word-break: break-word; color: var(--text-color); }
    .empty-comments { text-align: center; color: var(--text-color-light); padding: 50px 20px; background: var(--leaf-green); border-radius: 12px; border: 2px solid var(--moss-green); }
    
    .receipt-container {
        background: var(--container-bg);
        border-radius: 12px;
        padding: 0;
        margin-top: 0; 
        margin-bottom: 24px; 
        box-shadow: 0 8px 24px rgba(45, 61, 45, 0.3);
        font-family: 'Courier New', monospace;
        max-width: 100%;
        overflow: hidden;
        border: 2px solid var(--moss-green);
    }
    
    .receipt-header { padding: 18px 24px 12px; background: var(--leaf-green); }
    .receipt-title { display: block; text-align: center; margin-bottom: 6px; position: relative; }
    .receipt-title h3 { margin: 0; font-size: 16px; color: var(--text-color); font-weight: 700; }
    .budget-info { display: flex; flex-direction: column; gap: 4px; font-size: 11px; color: var(--text-color); font-weight: 600; text-align: right; position: absolute; top: -6px; right: -10px; }
    .receipt-header p { margin: 0; font-size: 12px; color: var(--text-color-light); text-align: center; }
    
    .receipt-divider { 
        height: 2px; 
        background: repeating-linear-gradient(
            to right, 
            var(--moss-green) 0px, 
            var(--moss-green) 3px, 
            transparent 3px, 
            transparent 6px
        ); 
        margin: 0 18px; 
    }
    
    .receipt-items { padding: 18px 24px 12px; }
    .receipt-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 10px; font-size: 13px; line-height: 1.4; transition: all 0.2s ease; color: var(--text-color); }
    .receipt-item:hover { background: var(--leaf-green); border-radius: 6px; }
    .receipt-date { color: var(--text-color-light); font-size: 11px; min-width: 65px; margin-right: 18px; }
    .receipt-desc { flex: 1; font-weight: 600; color: var(--text-color); margin-right: 18px; }
    .receipt-amount { font-weight: 700; color: var(--text-color); font-size: 13px; text-align: right; min-width: 75px; }
    .receipt-total { display: flex; justify-content: space-between; align-items: center; padding: 18px 24px; background: var(--moss-green); font-weight: 700; font-size: 16px; font-family: 'Courier New', monospace; color: var(--container-bg); }

    #dailyQuestModal .modal-header { padding-top: 30px; padding-bottom: 18px; }
    
    /* í€˜ìŠ¤íŠ¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .quest-tabs { display: flex; gap: 12px; margin-bottom: 24px; }
    .quest-tab { padding: 10px 20px; background: var(--leaf-green); border: 2px solid var(--moss-green); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; color: var(--text-color); }
    .quest-tab.active { background: var(--wood-color); color: var(--container-bg); border-color: var(--text-color); }
    .quest-tab:hover:not(.active) { background: var(--moss-green); color: var(--container-bg); }
    
    .quest-list { display: flex; flex-direction: column; gap: 12px; }
    .quest-item { background: var(--container-bg); border: 2px solid var(--moss-green); border-radius: 12px; padding: 18px; transition: all 0.3s ease; }
    .quest-item:hover { transform: translateY(-2px); background: var(--leaf-green); }
    .quest-item.completed { background: var(--success-color); color: var(--container-bg); border-color: var(--text-color); }
    .quest-item.completed .quest-reward { color: var(--container-bg); }
    
    .quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .quest-title { font-weight: 600; font-size: 14px; color: var(--text-color); }
    .quest-item.completed .quest-title { color: var(--container-bg); }
    .quest-reward { font-size: 12px; color: var(--primary-color); font-weight: 600; }
    
    .quest-desc { font-size: 13px; color: var(--text-color-light); margin-bottom: 12px; }
    .quest-item.completed .quest-desc { color: var(--container-bg); opacity: 0.9; }
    
    .quest-progress { display: flex; justify-content: space-between; align-items: center; }
    .quest-progress-bar { flex: 1; height: 8px; background: var(--leaf-green); border: 1px solid var(--moss-green); border-radius: 4px; margin-right: 12px; overflow: hidden; }
    .quest-progress-fill { height: 100%; background: var(--wood-color); transition: width 0.4s ease; border-radius: 3px; }
    .quest-progress-text { font-size: 11px; color: var(--text-color-light); min-width: 45px; text-align: right; font-weight: 600; }
    
    .quest-item.completed .quest-progress-bar { background: var(--container-bg); opacity: 0.7; }
    .quest-item.completed .quest-progress-fill { background: var(--container-bg); }
    .quest-item.completed .quest-progress-text { color: var(--container-bg); opacity: 0.9; }

    /* ë³´ìƒ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
    #rewardsModal .modal-header { padding: 36px 30px 24px 30px; border-bottom: 2px solid var(--moss-green); background: var(--leaf-green); border-top-left-radius: 13px; border-top-right-radius: 13px; }
    
    .rewards-list { display: flex; flex-direction: column; gap: 15px; max-height: 400px; overflow-y: auto; }
    .reward-item { background: var(--container-bg); border: 2px solid var(--moss-green); border-radius: 12px; padding: 18px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; }
    .reward-item:hover { transform: translateY(-2px); background: var(--leaf-green); }
    
    .reward-item.bronze { border-color: #CD7F32; background: var(--flower-yellow); }
    .reward-item.silver { border-color: #C0C0C0; background: var(--stone-color); color: var(--container-bg); }
    .reward-item.gold { border-color: #FFD700; background: var(--flower-yellow); }
    .reward-item.legend { border-color: #9400D3; background: var(--flower-pink); }
    .reward-item.used { opacity: 0.6; transform: none !important; }
    
    .reward-info { flex: 1; }
    .reward-name { font-weight: 600; font-size: 16px; margin-bottom: 6px; color: var(--text-color); }
    .reward-desc { font-size: 13px; color: var(--text-color-light); }
    .reward-tier { font-size: 11px; font-weight: 600; padding: 3px 8px; border-radius: 6px; margin-bottom: 6px; display: inline-block; }
    .reward-tier.bronze { background: #CD7F32; color: white; }
    .reward-tier.silver { background: #C0C0C0; color: white; }
    .reward-tier.gold { background: #FFD700; color: #333; }
    .reward-tier.legend { background: #9400D3; color: white; }
    
    .reward-actions { display: flex; gap: 10px; }
    .reward-btn { padding: 10px 14px; border: 2px solid var(--text-color); border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
    .reward-btn.use { background: var(--success-color); color: var(--container-bg); }
    .reward-btn.use:hover { background: var(--wood-color); }
    .reward-btn.delete { background: var(--danger-color); color: var(--container-bg); }
    .reward-btn.delete:hover { background: var(--stone-color); }
    .reward-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
    
    .empty-rewards { text-align: center; padding: 40px 20px; color: var(--text-color-light); }

    /* í”„ë¡œí•„ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    .profile-menu-item:hover { background: var(--leaf-green); color: var(--text-color); border-radius: 8px; }
    
    #profileWidget:hover { transform: translateY(-2px); }
    #profileWidget { transition: all 0.3s ease; }

    .achievements-list { display: flex; flex-direction: column; gap: 15px; max-height: 400px; overflow-y: auto; }
    .achievement-item { background: var(--container-bg); border: 2px solid var(--moss-green); border-radius: 12px; padding: 18px; display: flex; align-items: center; gap: 18px; transition: all 0.3s ease; }
    .achievement-item.unlocked { border-color: var(--success-color); background: var(--leaf-green); }
    .achievement-item.unlocked:hover { transform: translateY(-2px); background: var(--moss-green); color: var(--container-bg); }
    .achievement-item.locked { opacity: 0.6; }
    
    .achievement-emoji { font-size: 28px; min-width: 45px; text-align: center; }
    .achievement-info { flex: 1; }
    .achievement-name { font-weight: 600; font-size: 16px; margin-bottom: 6px; color: var(--text-color); }
    .achievement-desc { font-size: 13px; color: var(--text-color-light); }
    .achievement-status { font-size: 12px; font-weight: 600; padding: 5px 10px; border-radius: 6px; border: 1px solid var(--text-color); }
    .achievement-status.unlocked { background: var(--success-color); color: var(--container-bg); }
    .achievement-status.locked { background: var(--stone-color); color: var(--container-bg); }
    
    .achievement-item.hidden { background: var(--stone-color); color: var(--container-bg); border-color: var(--text-color); }
    .achievement-item.hidden .achievement-desc { color: var(--container-bg); opacity: 0.8; font-style: italic; }

    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 767px) {
        .modal-content { padding: 0; width: 100%; height: 100%; border-radius: 0; max-height: 100vh; }
        .food-modal { width: 90%; height: auto; border-radius: 16px; max-height: 90vh; }
        .food-modal .modal-body { overflow-y: auto; max-height: calc(90vh - 140px); }
        
        #dayModal .modal-body { padding: 20px 18px; }
        .modal-input-group { padding: 18px; }
        .modal-input-group h4 { font-size: 15px; }
        #dayModal .form-group label { font-size: 13px; }
        #dayModal .modal-input-row { grid-template-columns: 1fr; gap: 18px; }
        .exercise-toggle-btns { max-width: 200px; }
        .score-display-card, .personal-goals-section { width: 100%; max-width: none; margin: 0; padding: 18px; }
        .score-display-card .score { font-size: 36px; }

        #modalTotalExpense { text-align: left !important; }
        .expense-item { font-size: 13px; word-break: break-all; }
        .expense-item span:first-child { flex-grow: 1; margin-right: 12px; }
        .expense-item > div { flex-shrink: 0; }
        
        .modal-actions-container { padding: 0 18px 24px; display: flex; flex-direction: column; align-items: center; }
        .modal-actions-container .btn.delete {
            order: 2;
            background-color: transparent;
            color: var(--text-color-light);
            font-size: 14px;
            font-weight: normal;
            padding: 10px;
            box-shadow: none;
            margin-top: 12px;
            max-width: 160px;
        }
        .modal-actions-container .btn.delete:hover { background-color: transparent; color: var(--danger-color); }
        .modal-actions-container .btn.save { order: 1; }

        #budgetPage .budget-summary { flex-wrap: wrap; }
        #budgetPage .budget-summary .budget-card:first-child { flex-basis: 100%; }
        #budgetPage .budget-card-value { font-size: 20px; }
        #dayModal .expense-input-row { flex-direction: column; gap: 12px; }
        #dayModal .expense-input-row input,
        #dayModal .expense-input-row button { width: 100%; }
        
        .dday-header-container { top: 10px; left: 5px; right: 5px; }
        .container { padding: 40px 16px 100px 16px; max-width: 100%; margin: 0 10px; animation-duration: 12s; }
        .calendar-grid { gap: 1px; padding: 8px; }
        .calendar-cell { border: 1px solid var(--moss-green); padding: 1px; min-height: 40px; }
        .cell-day-number { font-size: 13px; }
        .cell-top-icons { font-size: 8px; }
        .cell-bottom-info { font-size: 7px; }
        .dday-chip { font-size: 10px; padding: 4px 10px; }
        .battery { width: 28px; height: 14px; }
        
        .receipt-item { font-size: 12px; }
        .receipt-date { min-width: 55px; margin-right: 12px; font-size: 10px; }
        .receipt-desc { margin-right: 12px; }
        .receipt-amount { min-width: 65px; font-size: 12px; }
        .budget-info { flex-direction: column; gap: 2px; font-size: 10px; text-align: right; }

        #foodExportModal.modal-overlay { background: var(--bg-color); }
        
        #foodExportModal .modal-content { max-width: 100vw; width: 100vw; height: 100vh; margin: 0; padding: 0; border-radius: 0; box-shadow: none; }
        #foodExportPreview { margin: 0; border-radius: 0; box-shadow: none; height: calc(100vh - 60px); overflow-y: auto; }
        
        #foodExportModal .close-btn {
            position: fixed;
            top: 12px;
            right: 12px;
            width: 44px;
            height: 44px;
            font-size: 22px;
            background: var(--danger-color);
            z-index: 1000;
        }
        
        #foodExportModal .modal-content > div:last-child {
            position: fixed; 
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--container-bg);
            padding: 18px;
            border-top: 2px solid var(--moss-green);
        }
        
        /* ìì—° íš¨ê³¼ëŠ” ëª¨ë°”ì¼ì—ì„œ ì„±ëŠ¥ì„ ìœ„í•´ ì¤„ì„ */
        body::before, body::after {
            animation-duration: 25s;
        }
        
        .calendar-cell:hover {
            transform: translateY(-1px) scale(1.02);
        }
    }
    `,

    military: `
    @font-face {
    font-family: 'KBIZHanmaumMyungjo';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/KBIZHanmaumMyungjo.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}

:root {
    --bg-color: #2c3e42;
    --primary-color: #4a6741;
    --primary-dark: #3a5233;
    --primary-light: #e8ede7;
    --text-color: #1a2b1f;
    --text-color-light: #556b5d;
    --border-color: #3d4f45;
    --container-bg: #f4f6f3;
    --danger-color: #8b4513;
    --warning-color: #b8860b;
    --success-color: #4a6741;
    --neutral-color: #6b7b73;
    --scope-green: #3d5c3a;
    --military-accent: #8b9d83;
    --tactical-border: #2a3d32;
}

/* ===== ê¸°ë³¸ ì„¤ì • ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }

body { 
    font-family: 'KBIZHanmaumMyungjo', 'Courier New', monospace; 
    background: linear-gradient(135deg, var(--bg-color) 0%, #243832 50%, var(--bg-color) 100%);
    background-attachment: fixed;
    min-height: 100vh; 
    padding: 20px; 
    color: var(--text-color);
    position: relative;
}

body::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-image: 
        radial-gradient(circle at 25% 25%, rgba(74, 103, 65, 0.03) 2px, transparent 2px),
        radial-gradient(circle at 75% 75%, rgba(74, 103, 65, 0.03) 2px, transparent 2px);
    background-size: 40px 40px;
    z-index: -1;
    pointer-events: none;
}

button, input, select, textarea { font-family: inherit; }

/* ===== ì»¨í…Œì´ë„ˆ ===== */
.container { 
    background: var(--container-bg); 
    border: 3px solid var(--tactical-border);
    border-radius: 15px; 
    padding: 50px 30px 100px 30px;
    width: 100%; 
    max-width: 500px; 
    margin: 0 auto; 
    box-shadow: 
        0 0 0 1px rgba(74, 103, 65, 0.2),
        0 8px 32px rgba(26, 43, 31, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
    backdrop-filter: blur(5px);
}

.container::before {
    content: '';
    position: absolute;
    top: 8px; left: 8px; right: 8px; bottom: 8px;
    border: 1px dashed rgba(74, 103, 65, 0.3);
    border-radius: 8px;
    pointer-events: none;
}

/* ===== í—¤ë” (ì´ê²© íš¨ê³¼) ===== */
.header { 
    text-align: center; 
    margin-bottom: 25px; 
    position: relative;
    padding: 20px 15px;
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.05), rgba(61, 92, 58, 0.05));
    border: 2px solid var(--tactical-border);
    clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px));
}

.header::before {
    content: '';
    position: absolute; top: 8px; right: 25px;
    width: 6px; height: 6px;
    background: var(--text-color);
    border-radius: 50%;
    box-shadow: 
        -15px 12px 0 -1px var(--text-color),
        -8px 25px 0 -2px var(--text-color),
        12px 8px 0 -1px var(--text-color);
    opacity: 0.3;
}

.header::after {
    content: '';
    position: absolute; top: 10px; right: 27px;
    width: 20px; height: 1px;
    background: linear-gradient(45deg, transparent 40%, var(--text-color) 50%, transparent 60%);
    opacity: 0.2;
    transform: rotate(15deg);
}

.header h1 { 
    color: var(--text-color); 
    font-size: 26px; font-weight: 700; 
    margin-bottom: 8px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    letter-spacing: 1px;
    font-family: 'Courier New', monospace;
    text-transform: uppercase;
}

.header p { 
    color: var(--text-color-light); 
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.5px;
}

/* ===== í˜ì´ì§€ ===== */
#gameWarning { 
    background: linear-gradient(135deg, #f4f1e8, #ede6d3); 
    color: var(--warning-color); 
    border: 2px solid var(--warning-color); 
    border-radius: 8px; 
    padding: 12px; 
    font-size: 14px; font-weight: 600; 
    margin-bottom: 20px; 
    display: none;
    box-shadow: 0 2px 8px rgba(184, 134, 11, 0.2);
}

.page { display: none; }
.page.active { display: block; }

/* ===== ìº˜ë¦°ë” í—¤ë” ===== */
.calendar-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 20px;
    padding: 10px 0;
    border-bottom: 2px solid var(--tactical-border);
}

.month-nav { 
    background: linear-gradient(135deg, var(--military-accent), var(--scope-green)); 
    border: 2px solid var(--tactical-border); 
    font-size: 20px; color: white; 
    cursor: pointer; 
    padding: 8px 12px; 
    transition: all 0.3s ease; 
    font-weight: bold;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    clip-path: polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% 100%, 6px 100%, 0 calc(100% - 6px));
}

.month-nav:hover { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark));
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.month-year { 
    font-size: 20px; font-weight: 700;
    color: var(--text-color);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    letter-spacing: 1px;
}

/* ===== ìº˜ë¦°ë” ê·¸ë¦¬ë“œ ===== */
.calendar-grid { 
    display: grid; 
    grid-template-columns: repeat(7, 1fr); 
    gap: 2px; /* 3pxì—ì„œ 2pxë¡œ ë³€ê²½ */
    margin-bottom: 20px;
    padding: 10px;
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1));
    border-radius: 10px;
    border: 1px solid var(--tactical-border);
}

.calendar-header-cell { 
    text-align: center; 
    padding: 12px 5px; 
    font-weight: 700; 
    color: var(--scope-green); 
    font-size: 12px;
    background: linear-gradient(135deg, var(--primary-light), #e0e8df);
    border: 1px solid var(--tactical-border);
    border-radius: 4px;
    text-shadow: 0 1px 1px rgba(255,255,255,0.5);
}

/* ===== ìº˜ë¦°ë” ì…€ (ê°ì§„ ë””ìì¸) ===== */
.calendar-cell { 
    aspect-ratio: 1; 
    display: grid; 
    grid-template-rows: 1fr auto 1fr; 
    padding: 3px; 
    align-items: center; 
    justify-items: center; 
    position: relative;
    background: linear-gradient(135deg, #f8faf7, #f0f4ef);
    border: 1px solid var(--border-color); /* 2pxì—ì„œ 1pxë¡œ ë³€ê²½ */
    cursor: pointer;
    transition: all 0.2s ease;
    clip-path: polygon(0 0, calc(100% - 4px) 0, 100% 4px, 100% 100%, 4px 100%, 0 calc(100% - 4px));
}

.cell-top-icons { 
    grid-row: 1; 
    display: flex; 
    justify-content: center; 
    gap: 2px; 
    font-size: 9px; 
    width: 100%; height: 100%; 
    align-items: center; 
}

.cell-day-number { 
    grid-row: 2; 
    font-weight: 600;
    color: var(--text-color);
    text-shadow: 
        0 1px 0 rgba(255,255,255,0.7),
        0 -1px 0 rgba(0,0,0,0.1);
}

.cell-bottom-info { 
    grid-row: 3; 
    font-size: 8px; font-weight: 700; 
    color: var(--text-color-light); 
    width: 100%; 
    text-align: left; 
    padding-right: 4px; 
    align-self: end; 
    padding-bottom: 2px; 
}

.calendar-cell:hover { 
    transform: translateY(-2px) scale(1.02); 
    box-shadow: 0 4px 12px rgba(74, 103, 65, 0.3);
    border-color: var(--scope-green);
    background: linear-gradient(135deg, #ffffff, #f8faf7);
}

.calendar-cell.other-month { 
    color: #bbb; 
    background: linear-gradient(135deg, #e8e8e8, #ddd); 
    border-color: #ccc; 
    pointer-events: none; 
}

.calendar-cell.off-day { 
    background: linear-gradient(135deg, #d4d8d3, #c8cdc7); 
    color: var(--neutral-color);
    border-color: var(--neutral-color);
}

.off-day-indicator { 
    position: absolute; top: 3px; right: 3px; 
    font-size: 8px;
    color: var(--scope-green);
    font-weight: bold;
}

/* ===== ì˜¤ëŠ˜ ë‚ ì§œ (ìŠ¤ì½”í”„ ì¡°ì¤€ì ) ===== */
.calendar-cell.today { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark));
    border: 3px solid var(--tactical-border);
    color: white;
    position: relative;
    overflow: visible;
    clip-path: polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% 100%, 6px 100%, 0 calc(100% - 6px));
}

.calendar-cell.today::before {
    content: '';
    position: absolute; top: 50%; left: 50%;
    width: 80%; height: 2px;
    background: rgba(255, 255, 255, 0.7);
    transform: translate(-50%, -50%);
    z-index: 1;
}

.calendar-cell.today::after {
    content: '';
    position: absolute; top: 50%; left: 50%;
    width: 2px; height: 80%;
    background: rgba(255, 255, 255, 0.7);
    transform: translate(-50%, -50%);
    z-index: 1;
}

.calendar-cell.today .cell-day-number {
    position: relative; z-index: 2;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    width: 24px; height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255, 255, 255, 0.5);
    color: white; font-weight: 800;
    text-shadow: 
        0 1px 0 rgba(0,0,0,0.5),
        0 -1px 0 rgba(255,255,255,0.2),
        inset 0 1px 2px rgba(0,0,0,0.3);
}

/* ===== ì ìˆ˜ë³„ ìƒ‰ìƒ ===== */
.calendar-cell.has-data { 
    color: white; 
    border: 2px solid var(--tactical-border); 
    font-weight: bold; 
}

.calendar-cell.has-data .cell-bottom-info { color: rgba(255, 255, 255, 0.9); }

.calendar-cell.score-high { 
    background: linear-gradient(135deg, var(--success-color), #5a7a51);
    box-shadow: 0 0 8px rgba(74, 103, 65, 0.4);
}

.calendar-cell.score-medium { 
    background: linear-gradient(135deg, var(--warning-color), #c7941c);
    box-shadow: 0 0 8px rgba(184, 134, 11, 0.4);
}

.calendar-cell.score-low { 
    background: linear-gradient(135deg, var(--danger-color), #a0541a);
    box-shadow: 0 0 8px rgba(139, 69, 19, 0.4);
}

.calendar-cell.score-negative { 
    background: linear-gradient(135deg, #34495e, #2c3e50);
    box-shadow: 0 0 8px rgba(52, 73, 94, 0.4);
}

.score-indicator { 
    position: absolute; bottom: 2px; right: 2px; 
    font-size: 8px; 
    background: rgba(0,0,0,0.6); 
    color: white; 
    padding: 1px 3px; 
    border-radius: 3px; 
    font-weight: 800;
    border: 1px solid rgba(255,255,255,0.2);
}

/* ===== í¼ ìš”ì†Œ ===== */
.form-group { margin-bottom: 20px; }

.form-group label { 
    display: block; 
    color: var(--text-color); 
    font-weight: 700; 
    margin-bottom: 8px; 
    font-size: 14px;
    text-shadow: 0 1px 1px rgba(255,255,255,0.5);
}

.form-group input, .form-group textarea, .form-group select { 
    width: 100%; 
    padding: 12px; 
    border: 2px solid var(--border-color); 
    font-size: 16px; 
    transition: all 0.3s ease; 
    font-family: 'KBIZHanmaumMyungjo', sans-serif;
    background: linear-gradient(135deg, #ffffff, #f8faf7);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    clip-path: polygon(0 0, calc(100% - 4px) 0, 100% 4px, 100% 100%, 4px 100%, 0 calc(100% - 4px));
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
    outline: none; 
    border-color: var(--scope-green); 
    box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.05),
        0 0 0 3px rgba(74, 103, 65, 0.2);
    background: white;
}

/* ===== êµ°ë²ˆì¤„ ìŠ¤íƒ€ì¼ ë²„íŠ¼ ===== */
.btn { 
    width: 100%; 
    padding: 15px 20px; 
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white; 
    border: none;
    font-size: 16px; font-weight: 700; 
    cursor: pointer; 
    transition: all 0.3s ease; 
    box-shadow: 
        0 3px 8px rgba(0,0,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.1);
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-family: 'Courier New', monospace;
    clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
    border-left: 3px dotted rgba(0,0,0,0.2);
    border-right: 3px dotted rgba(0,0,0,0.2);
    margin: 0 5px;
}

.btn::before {
    content: '';
    position: absolute; left: -6px; top: 50%;
    transform: translateY(-50%);
    width: 12px; height: 12px;
    background: var(--bg-color);
    border-radius: 50%;
    box-shadow: 
        inset 0 0 3px rgba(0,0,0,0.3),
        calc(100% + 12px) 0 0 0 var(--bg-color);
}

.btn::after {
    content: '';
    position: absolute; right: -6px; top: 50%;
    transform: translateY(-50%);
    width: 12px; height: 12px;
    background: var(--bg-color);
    border-radius: 50%;
    box-shadow: inset 0 0 3px rgba(0,0,0,0.3);
}

.btn:hover { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-color));
    transform: translateY(-2px); 
    box-shadow: 
        0 6px 16px rgba(0,0,0,0.3),
        inset 0 1px 0 rgba(255,255,255,0.2);
}

.btn:active { 
    transform: translateY(0); 
    box-shadow: 0 2px 4px rgba(0,0,0,0.2); 
}

.main-actions { display: flex; gap: 12px; margin-bottom: 10px; }
.main-actions .btn { flex: 1; }

.btn.secondary { 
    background: linear-gradient(135deg, var(--neutral-color), #5a6a62);
    border-color: var(--neutral-color);
}

.btn.secondary:hover { 
    background: linear-gradient(135deg, #5a6a62, var(--neutral-color));
}

/* ===== ëª¨ë‹¬ ê¸°ë³¸ ===== */
.modal-overlay { 
    display: none; 
    position: fixed; 
    top: 0; left: 0; 
    width: 100%; height: 100%; 
    background: rgba(44, 62, 66, 0.8); 
    backdrop-filter: blur(6px); 
    z-index: 1000; 
    align-items: center; 
    justify-content: center; 
}

/* ===== ë°ì´ ëª¨ë‹¬ (êµ°ë²ˆì¤„ ìŠ¤íƒ€ì¼) ===== */
.modal-content { 
    background: linear-gradient(135deg, #c0c0c0, #d3d3d3) !important;
    padding: 0; 
    border: 3px solid var(--tactical-border) !important;
    width: 90%; max-width: 800px; 
    max-height: 95vh; 
    overflow-y: auto; 
    box-shadow: 
        0 0 0 1px rgba(74, 103, 65, 0.3),
        0 20px 60px rgba(26, 43, 31, 0.5) !important;
    position: relative;
    clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px)) !important;
    border-left: 4px dotted rgba(74, 103, 65, 0.4) !important;
    border-right: 4px dotted rgba(74, 103, 65, 0.4) !important;
}

.modal-content::before {
    content: '' !important;
    position: absolute !important;
    left: -8px !important; top: 0 !important; bottom: 0 !important;
    width: 16px !important;
    background-image: 
        radial-gradient(circle at center, var(--bg-color) 40%, transparent 41%),
        radial-gradient(circle at center, rgba(0,0,0,0.2) 35%, transparent 36%) !important;
    background-size: 16px 40px !important;
    background-repeat: repeat-y !important;
    background-position: 0 0 !important;
    z-index: 10 !important;
}

.modal-content::after {
    content: '' !important;
    position: absolute !important;
    right: -8px !important; top: 0 !important; bottom: 0 !important;
    width: 16px !important;
    background-image: 
        radial-gradient(circle at center, var(--bg-color) 40%, transparent 41%),
        radial-gradient(circle at center, rgba(0,0,0,0.2) 35%, transparent 36%) !important;
    background-size: 16px 40px !important;
    background-repeat: repeat-y !important;
    background-position: 0 0 !important;
    z-index: 10 !important;
}

/* ===== ëª¨ë‹¬ í—¤ë” & ë°”ë”” ===== */
#dayModal .modal-header, #excelExportModal .modal-header, .food-modal-content .modal-header { 
    padding: 20px 25px !important; 
    border-bottom: 2px solid var(--tactical-border) !important; 
    background: linear-gradient(135deg, #a8a8a8, #b8b8b8) !important;
    position: relative !important;
    z-index: 2 !important;
}

#dayModal .modal-body { 
    padding: 25px !important; 
    position: relative !important; 
    z-index: 2 !important;
    background: transparent !important;
}

.modal-layout { display: block; }
.modal-side-column { display: flex; flex-direction: column; }

.modal-input-group { 
    background: linear-gradient(135deg, #ffffff, #f8faf7) !important; 
    padding: 20px; 
    border: 2px solid var(--border-color);
    box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.05),
        0 2px 8px rgba(0,0,0,0.1);
    clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
}

.modal-input-group h4 { 
    font-size: 16px; 
    margin-bottom: 15px; 
    padding-bottom: 10px; 
    border-bottom: 2px solid var(--tactical-border);
    color: var(--scope-green);
    font-weight: 700;
}

.modal-input-row { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
    gap: 15px; 
}

.modal-header { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    position: relative; 
    gap: 20px; 
}

.modal-title { flex: none; text-align: center; margin: 0; color: var(--scope-green); }

/* ===== ëª¨ë‹¬ ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ===== */
.date-nav-btn { 
    background: linear-gradient(135deg, var(--military-accent), var(--scope-green)); 
    border: 2px solid var(--tactical-border); 
    font-size: 20px; color: white; 
    cursor: pointer; 
    padding: 8px; 
    transition: all 0.3s ease; 
    width: 40px; height: 40px; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-weight: bold;
    clip-path: polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% 100%, 6px 100%, 0 calc(100% - 6px));
}

.date-nav-btn:hover { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark));
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.close-btn { 
    background: linear-gradient(135deg, var(--danger-color), #a0541a); 
    border: 2px solid var(--tactical-border); 
    font-size: 20px; 
    cursor: pointer; 
    color: white; 
    line-height: 1; 
    position: absolute; 
    right: 0; top: 50%; 
    transform: translateY(-50%);
    width: 35px; height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    clip-path: polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% 100%, 6px 100%, 0 calc(100% - 6px));
}

.close-btn:hover {
    background: linear-gradient(135deg, #a0541a, var(--danger-color));
    transform: translateY(-50%) scale(1.1);
}

/* ===== ì ìˆ˜ ë””ìŠ¤í”Œë ˆì´ ì¹´ë“œ (ìŒê° íš¨ê³¼) ===== */
.score-display-card { 
    background: linear-gradient(135deg, #ffffff, #f8faf7) !important; 
    padding: 20px; 
    text-align: center; 
    border: 2px solid var(--tactical-border);
    box-shadow: 
        0 4px 12px rgba(0,0,0,0.1),
        inset 0 1px 0 rgba(255,255,255,0.5);
    clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
}

.score-display-card .score { 
    font-size: 40px; 
    font-weight: 800; 
    color: var(--scope-green); 
    line-height: 1;
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 5px rgba(0,0,0,0.5));
    -webkit-background-clip: text;
    background-clip: text;
    position: relative;
}

.score-display-card .score.is-off { color: var(--neutral-color); }

.score-display-card div:last-child { 
    font-size: 14px; 
    color: var(--text-color-light); 
    margin-top: 5px;
    font-weight: 600;
}

/* ===== ìš´ë™ í† ê¸€ ===== */
.exercise-toggle-group { margin-bottom: 15px; }

.exercise-toggle-group label { 
    display: block; 
    color: var(--text-color); 
    font-weight: 700; 
    margin-bottom: 8px; 
    font-size: 14px; 
}

.exercise-toggle-btns { 
    display: flex; 
    border: 2px solid var(--tactical-border); 
    overflow: hidden;
    clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
}

.exercise-toggle-btn { 
    flex: 1; 
    padding: 12px; 
    border: none; 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    cursor: pointer; 
    font-weight: 700; 
    transition: all 0.3s ease; 
    font-size: 14px;
    border-right: 1px solid var(--tactical-border);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.exercise-toggle-btn:last-child { border-right: none; }

.exercise-toggle-btn.active { 
    background: linear-gradient(135deg, var(--success-color), #5a7a51); 
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* ===== ê°œì¸ ëª©í‘œ ì„¹ì…˜ ===== */
.personal-goals-section { 
    background: linear-gradient(135deg, #ffffff, #f8faf7) !important; 
    padding: 18px; 
    border: 2px solid var(--tactical-border);
    box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.05),
        0 2px 8px rgba(0,0,0,0.1);
    clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
}

#modalPersonalGoalsList { max-height: 150px; overflow-y: auto; }

.personal-goal-checkbox { 
    display: flex; 
    align-items: center; 
    gap: 12px; 
    padding: 12px; 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border-radius: 10px; 
    margin-bottom: 10px; 
    border: 2px solid var(--border-color);
    transition: all 0.2s ease;
}

.personal-goal-checkbox:hover {
    border-color: var(--scope-green);
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}

/* ===== ìˆ«ì ì…ë ¥ ê·¸ë£¹ (ìŒê° íš¨ê³¼) ===== */
.number-input-group { 
    display: flex; 
    align-items: center; 
    border: 2px solid var(--border-color); 
    border-radius: 8px; 
    overflow: hidden;
    background: linear-gradient(135deg, #ffffff, #f8faf7);
}

.number-input-group input { 
    border: none; 
    text-align: center; 
    flex: 1; 
    padding: 12px 8px; 
    background: transparent;
    font-weight: 700;
    color: var(--text-color);
    font-size: 18px;
    text-shadow: 
        0 1px 0 rgba(255,255,255,0.8),
        0 -1px 0 rgba(0,0,0,0.1);
}

.number-input-group input:focus { 
    box-shadow: none; 
    border: none; 
    outline: none;
}

.number-btn {
    width: 36px; height: 48px;
    border: none;
    background: linear-gradient(135deg, var(--military-accent), var(--scope-green));
    color: white;
    font-size: 18px; font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.number-btn:hover { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark));
    transform: scale(1.05);
}

.number-btn:active { 
    background: linear-gradient(135deg, var(--primary-dark), var(--scope-green));
    transform: scale(0.95);
}

/* ìˆ«ì ì…ë ¥ í•„ë“œì˜ ìŠ¤í•€ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { 
    -webkit-appearance: none; 
    margin: 0; 
}

/* ===== ì½”ë©˜íŠ¸ ì„¹ì…˜ ===== */
#commentDetails summary { 
    font-weight: 700; 
    color: var(--text-color); 
    cursor: pointer; 
    padding: 12px; 
    border-radius: 8px; 
    background: linear-gradient(135deg, var(--primary-light), #e8ede7); 
    border: 2px solid var(--tactical-border); 
    list-style: none; 
    position: relative; 
    padding-left: 35px;
    transition: all 0.2s ease;
}

#commentDetails summary::-webkit-details-marker { display: none; }

#commentDetails summary::before { 
    content: 'â–¶'; 
    position: absolute; 
    left: 12px; top: 50%; 
    transform: translateY(-50%); 
    font-size: 12px; 
    transition: transform 0.3s ease;
    color: var(--scope-green);
    font-weight: bold;
}

#commentDetails[open] > summary::before { 
    transform: translateY(-50%) rotate(90deg); 
}

#commentDetails summary:hover {
    background: linear-gradient(135deg, #e0e8df, var(--primary-light));
    border-color: var(--scope-green);
}

#modalCommentSection { margin-top: 25px; }

#modalComment { 
    width: 100%; 
    margin-top: 18px; 
    height: 90px; 
    resize: vertical; 
    font-size: 16px;
    border: 2px solid var(--border-color);
    background: linear-gradient(135deg, #ffffff, #f8faf7);
    border-radius: 8px;
    padding: 15px;
}

/* ===== ëª¨ë‹¬ í¼ ìŠ¤íƒ€ì¼ ===== */
#dayModal .form-group { margin-bottom: 0; }
#dayModal .form-group label { font-size: 13px; margin-bottom: 6px; }
#dayModal .form-group input { padding: 10px; font-size: 16px; }
#dayModal .modal-input-group,
#dayModal .score-display-card { margin-bottom: 5px; }
#dayModal .modal-layout > div:last-child { margin-bottom: 0; }
#modalPersonalGoalsList input[type="number"] { 
    font-size: 16px;
    font-weight: 600;
}

/* ===== ë²”ë¡€ ===== */
.legend { 
    display: flex; 
    justify-content: center; 
    flex-wrap: wrap; 
    margin: 20px 0 0; 
    font-size: 12px; 
    gap: 15px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1));
    border-radius: 8px;
    border: 1px solid var(--tactical-border);
}

.legend-item { 
    display: flex; 
    align-items: center; 
    gap: 6px;
    font-weight: 600;
    color: var(--text-color);
}

.legend-color { 
    width: 12px; height: 12px; 
    border-radius: 3px;
    border: 1px solid var(--tactical-border);
}

/* ===== D-Day í—¤ë” ===== */
.dday-header-container { 
    height: auto; 
    margin-bottom: 5px; 
    display: flex; 
    justify-content: space-between; 
    align-items: flex-start; 
    position: absolute; 
    top: 12px; left: 12px; right: 12px; 
    z-index: 10; 
    pointer-events: none; 
}

.dday-chip { 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.9), rgba(61, 92, 58, 0.9)); 
    backdrop-filter: blur(8px); 
    color: white; 
    padding: 6px 12px; 
    border-radius: 15px; 
    font-weight: 800; 
    font-size: 11px; 
    display: none; 
    box-shadow: 
        0 2px 8px rgba(0,0,0,0.3),
        0 0 0 1px rgba(255,255,255,0.2); 
    pointer-events: all; 
    border: 1px solid var(--tactical-border);
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.battery { 
    display: none; 
    width: 32px; height: 16px; 
    border: 2px solid var(--scope-green); 
    border-radius: 4px; 
    position: relative; 
    padding: 2px;
    background: rgba(255,255,255,0.9);
}

.battery::after { 
    content: ''; 
    position: absolute; 
    top: 50%; right: -5px; 
    transform: translateY(-50%); 
    width: 3px; height: 8px; 
    background: var(--scope-green); 
    border-radius: 0 2px 2px 0; 
}

.battery-level { 
    height: 100%; 
    border-radius: 2px; 
    transition: width 0.3s ease; 
}

.battery-level.green { background: var(--success-color); } 
.battery-level.yellow { background: var(--warning-color); } 
.battery-level.red { background: var(--danger-color); } 
.battery-level.black { background: var(--text-color); }

/* ===== ì˜ˆì‚° ê´€ë ¨ (ìŒê° íš¨ê³¼) ===== */
.budget-summary { display: flex; gap: 12px; margin-bottom: 20px; }

.budget-card { 
    flex: 1; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    color: var(--scope-green); 
    padding: 18px; 
    border-radius: 12px; 
    text-align: center;
    border: 2px solid var(--tactical-border);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.budget-card-title { 
    font-size: 12px; 
    opacity: 0.8; 
    margin-bottom: 10px; 
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.budget-card-value { 
    font-size: 24px; 
    font-weight: 800;
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 3px rgba(0,0,0,0.4));
    color: var(--scope-green);
}

#budgetPage .header p { 
    font-size: 16px; 
    font-weight: 700; 
    color: var(--text-color); 
}

/* ===== ê°œì¸ ëª©í‘œ ì•„ì´í…œ ===== */
.personal-goal-item { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border: 2px solid var(--border-color); 
    border-radius: 12px; 
    padding: 18px; 
    margin-bottom: 12px;
    transition: all 0.2s ease;
}

.personal-goal-item:hover {
    border-color: var(--scope-green);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.personal-goal-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 8px; 
}

.personal-goal-name { font-weight: 700; color: var(--text-color); }

.personal-goal-actions button { 
    padding: 6px 12px; 
    border-radius: 6px; 
    font-size: 12px; 
    border: 1px solid var(--tactical-border); 
    cursor: pointer; 
    color: white;
    font-weight: 600;
    transition: all 0.2s ease;
}

.edit-btn { background: linear-gradient(135deg, var(--warning-color), #c7941c); }
.delete-btn { background: linear-gradient(135deg, var(--danger-color), #a0541a); }
.complete-btn { background: linear-gradient(135deg, var(--success-color), #5a7a51); }
.reopen-btn { background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); }

.personal-goal-actions button:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.empty-goals { 
    text-align: center; 
    color: var(--text-color-light); 
    padding: 40px 20px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border-radius: 12px; 
    margin-top: 20px; 
    border: 2px solid var(--tactical-border); 
}

/* ===== ê¸°íƒ€ ì„¤ì •ë“¤ ===== */
.budget-settings, .dday-settings { margin-bottom: 30px; }
.budget-input, .dday-actions { display: flex; gap: 12px; align-items: center; }

.dday-item { 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border-radius: 12px; 
    padding: 15px 18px; 
    margin-bottom: 12px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    border: 2px solid var(--tactical-border);
    transition: all 0.2s ease;
}

.dday-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: var(--scope-green);
}

.budget-input button { 
    padding: 12px 20px; 
    background: linear-gradient(135deg, var(--success-color), #5a7a51); 
    color: white; 
    border: 2px solid var(--tactical-border); 
    border-radius: 8px; 
    font-weight: 700; 
    cursor: pointer;
    transition: all 0.3s ease;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.budget-input button:hover {
    background: linear-gradient(135deg, #5a7a51, var(--success-color));
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.wakeup-prompt { 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.15), rgba(61, 92, 58, 0.15)); 
    color: var(--scope-green); 
    padding: 25px; 
    border-radius: 15px; 
    text-align: center; 
    margin-bottom: 20px;
    border: 2px solid var(--tactical-border);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    font-weight: 600;
}

/* ===== ì›”ê°„/ì£¼ê°„ ìš”ì•½ (ìŒê° íš¨ê³¼) ===== */
.monthly-summary { 
    display: flex; 
    justify-content: space-around; 
    gap: 15px; 
    margin-bottom: 30px; 
}

.summary-card { 
    flex-basis: 30%; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    color: var(--scope-green); 
    padding: 25px; 
    border-radius: 15px; 
    text-align: center;
    border: 2px solid var(--tactical-border);
    transition: all 0.2s ease;
}

.summary-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    border-color: var(--scope-green);
}

.summary-title { 
    font-size: 14px; 
    opacity: 0.8; 
    margin-bottom: 12px; 
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.summary-value { 
    font-size: 26px; 
    font-weight: 800;
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 3px rgba(0,0,0,0.4));
    color: var(--scope-green);
}

.week-card { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border-radius: 15px; 
    padding: 25px; 
    margin-bottom: 15px; 
    border: 2px solid var(--tactical-border);
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.week-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    border-color: var(--scope-green);
}

.week-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 18px; 
    font-weight: 700;
    color: var(--text-color);
    border-bottom: 2px solid var(--tactical-border);
    padding-bottom: 10px;
}

.week-stats { 
    display: flex; 
    justify-content: space-around; 
    align-items: center; 
    text-align: center; 
    font-size: 24px; 
    font-weight: 700;
    color: var(--scope-green);
}

.week-stats > * {
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 3px rgba(0,0,0,0.4));
}

.empty-expenses { 
    text-align: center; 
    color: var(--text-color-light); 
    padding: 40px 20px; 
}

/* ===== í”¼ë“œë°± íŒì—… ===== */
.feedback-popup { 
    position: fixed; 
    top: 0; left: 0; 
    width: 100%; height: 100%; 
    background: rgba(44, 62, 66, 0.8); 
    display: none; 
    z-index: 2000; 
    animation: fadeIn 0.3s ease; 
    justify-content: center; 
    align-items: center;
    backdrop-filter: blur(8px);
}

.feedback-content { 
    position: relative; 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    padding: 45px; 
    border-radius: 25px; 
    width: 90%; 
    max-width: 400px; 
    text-align: center; 
    box-shadow: 
        0 0 0 3px var(--tactical-border),
        0 20px 60px rgba(0,0,0,0.4); 
    animation: popIn 0.5s ease;
    border: 2px solid var(--tactical-border);
}

.feedback-emoji { font-size: 60px; margin-bottom: 20px; display: block; }

.feedback-title { 
    font-size: 24px; 
    font-weight: 800; 
    margin-bottom: 15px; 
    color: var(--text-color);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.feedback-message { 
    font-size: 16px; 
    color: var(--text-color-light); 
    line-height: 1.6; 
    margin-bottom: 25px;
    font-weight: 500;
}

.feedback-celebration .feedback-title, 
.feedback-celebration .feedback-message, 
.feedback-reflection .feedback-title, 
.feedback-reflection .feedback-message, 
.feedback-disaster .feedback-title, 
.feedback-disaster .feedback-message, 
.feedback-encouragement .feedback-title, 
.feedback-encouragement .feedback-message, 
.feedback-warning .feedback-title, 
.feedback-warning .feedback-message { 
    color: rgba(255,255,255,0.95); 
}

.feedback-celebration { 
    background: linear-gradient(135deg, var(--success-color), #5a7a51);
    border-color: var(--success-color);
} 

.feedback-reflection { 
    background: linear-gradient(135deg, var(--warning-color), #c7941c);
    border-color: var(--warning-color);
} 

.feedback-disaster { 
    background: linear-gradient(135deg, #34495e, #2c3e50);
    border-color: #34495e;
} 

.feedback-encouragement { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark));
    border-color: var(--scope-green);
} 

.feedback-warning { 
    background: linear-gradient(135deg, var(--danger-color), #a0541a);
    border-color: var(--danger-color);
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes popIn { 
    from { opacity: 0; transform: scale(0.8) translateY(20px); } 
    to { opacity: 1; transform: scale(1) translateY(0); } 
}

.feedback-btn { 
    background: rgba(0,0,0,0.2); 
    color: white; 
    border: 2px solid rgba(255,255,255,0.4); 
    padding: 12px 30px; 
    border-radius: 25px; 
    font-size: 16px; 
    font-weight: 700; 
    cursor: pointer; 
    transition: all 0.3s ease; 
    margin: 0 10px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.feedback-btn:hover { 
    background: rgba(0,0,0,0.3); 
    border-color: rgba(255,255,255,0.6); 
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.feedback-budget-red { 
    background: linear-gradient(135deg, var(--danger-color), #a0541a) !important;
    border-color: var(--danger-color) !important;
}

.feedback-budget-black { 
    background: linear-gradient(135deg, #34495e, #2c3e50) !important;
    border-color: #34495e !important;
}

/* ===== ì§€ì¶œ ì…ë ¥ ===== */
.expense-input-row { 
    display: flex; 
    flex-direction: column;
    gap: 12px; 
    margin-top: 12px; 
}

.expense-input-row input { 
    flex: 1; 
    padding: 12px; 
    width: 100%;
    font-size: 14px; 
    border-radius: 8px;
    border: 2px solid var(--border-color);
    background: linear-gradient(135deg, #ffffff, #f8faf7);
}

.expense-input-row button { 
    flex-shrink: 0; 
    width: 100%; height: 48px; 
    border-radius: 12px; 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); 
    border: 2px solid var(--tactical-border); 
    color: white; 
    font-weight: bold; 
    cursor: pointer; 
    font-size: 24px; 
    line-height: 1; 
    transition: all 0.3s ease;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.expense-input-row button:hover { 
    background: linear-gradient(135deg, var(--primary-dark), var(--scope-green));
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.expense-item { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 8px 0; 
    font-size: 14px;
    border-bottom: 1px solid rgba(74, 103, 65, 0.1);
    font-weight: 500;
}

/* ===== D-Day ê´€ë ¨ ===== */
.dday-settings h4 { 
    margin-bottom: 15px;
    color: var(--scope-green);
    font-weight: 700;
    font-size: 18px;
}

.dday-item .dday-actions { display: flex; gap: 8px; }

.dday-item .dday-actions button { 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border: 2px solid var(--border-color); 
    width: 32px; height: 32px; 
    border-radius: 8px; 
    font-size: 14px; 
    cursor: pointer; 
    transition: all 0.3s ease; 
    color: var(--scope-green);
    font-weight: bold;
}

.dday-item .dday-actions button:hover { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); 
    color: white; 
    transform: scale(1.1);
    border-color: var(--scope-green);
}

/* ===== ì—‘ì…€ ì˜µì…˜ ===== */
.excel-option-item { 
    display: flex; 
    align-items: center; 
    padding: 10px 0; 
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 6px;
    padding-left: 10px;
}

.excel-option-item:hover {
    background: rgba(74, 103, 65, 0.1);
}

.excel-option-item input[type="radio"] { 
    width: 18px; height: 18px; 
    margin-right: 12px;
    accent-color: var(--scope-green);
}

.excel-option-item label { 
    font-size: 16px;
    font-weight: 500;
    color: var(--text-color);
}

#customDateRange { 
    display: flex; 
    gap: 12px; 
    align-items: center; 
    margin-top: 12px; 
    margin-bottom: 20px; 
}

#customDateRange input[type="date"] { 
    padding: 12px; 
    border-radius: 8px; 
    border: 2px solid var(--border-color); 
    flex: 1; 
    font-family: inherit;
    background: linear-gradient(135deg, #ffffff, #f8faf7);
}

/* ===== ìŒì‹ ê´€ë ¨ ===== */
.food-page-actions { display: flex; gap: 12px; margin-bottom: 12px; }

.food-page-actions .btn.secondary.danger { 
    background: linear-gradient(135deg, var(--danger-color), #a0541a); 
    color: white;
    border-color: var(--danger-color);
}

.food-date-header { 
    display: flex; 
    align-items: center; 
    text-align: center; 
    margin: 30px 0 15px; 
    color: var(--text-color-light); 
}

.food-date-header::before, .food-date-header::after { 
    content: ''; 
    flex: 1; 
    border-bottom: 2px solid var(--tactical-border); 
}

.food-date-header span { 
    padding: 0 20px; 
    font-size: 13px; 
    font-weight: 700;
    color: var(--scope-green);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.food-record-item { 
    display: grid; 
    grid-template-columns: 50px 30px 1fr auto; 
    gap: 15px; 
    align-items: center; 
    padding: 16px 8px; 
    border-bottom: 1px solid rgba(74, 103, 65, 0.2); 
    position: relative;
    transition: all 0.2s ease;
}

.food-record-item:hover {
    background: rgba(74, 103, 65, 0.05);
    transform: translateX(5px);
}

.food-record-item .food-admin-actions { 
    position: absolute; 
    right: 5px; top: 50%; 
    transform: translateY(-50%); 
    display: flex; 
    gap: 6px; 
    opacity: 0; 
    transition: opacity 0.2s; 
    pointer-events: none; 
}

.food-records.admin-mode .food-record-item .food-admin-actions { 
    opacity: 1; 
    pointer-events: auto; 
}

.food-admin-actions button { 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border: 1px solid var(--border-color); 
    width: 30px; height: 30px; 
    border-radius: 6px; 
    cursor: pointer; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    font-size: 13px; 
    transition: all 0.2s ease;
    font-weight: bold;
}

.food-admin-actions button.edit { 
    color: var(--warning-color); 
    border-color: var(--warning-color);
}

.food-admin-actions button.delete { 
    color: var(--danger-color);
    border-color: var(--danger-color);
}

.food-admin-actions button:hover { 
    background: var(--scope-green); 
    color: white;
    transform: scale(1.1);
}

/* ===== ìŒì‹ ëª¨ë‹¬ ===== */
.food-modal { 
    max-width: 420px; 
    background: linear-gradient(135deg, #c0c0c0, #d3d3d3);
    overflow: hidden;
    border: 3px solid var(--tactical-border);
    clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 12px 100%, 0 calc(100% - 12px));
    border-left: 3px dotted rgba(74, 103, 65, 0.4);
    border-right: 3px dotted rgba(74, 103, 65, 0.4);
    position: relative;
}

.food-modal::before {
    content: '';
    position: absolute;
    left: -6px; top: 0; bottom: 0;
    width: 12px;
    background-image: 
        radial-gradient(circle at center, var(--bg-color) 40%, transparent 41%),
        radial-gradient(circle at center, rgba(0,0,0,0.2) 35%, transparent 36%);
    background-size: 12px 35px;
    background-repeat: repeat-y;
    background-position: 0 15px;
    z-index: 10;
}

.food-modal::after {
    content: '';
    position: absolute;
    right: -6px; top: 0; bottom: 0;
    width: 12px;
    background-image: 
        radial-gradient(circle at center, var(--bg-color) 40%, transparent 41%),
        radial-gradient(circle at center, rgba(0,0,0,0.2) 35%, transparent 36%);
    background-size: 12px 35px;
    background-repeat: repeat-y;
    background-position: 0 15px;
    z-index: 10;
}

.food-modal .modal-header { 
    padding: 20px 25px; 
    background: linear-gradient(135deg, #a8a8a8, #b8b8b8);
    border-bottom: 2px solid var(--tactical-border); 
}

.food-modal .modal-header h2 { 
    font-size: 18px;
    color: var(--scope-green);
    font-weight: 700;
}

.food-modal .modal-body { 
    padding: 25px;
    background: inherit;
}

.food-modal .form-group { margin-bottom: 18px; }

.food-modal .form-group label { 
    font-size: 14px; 
    margin-bottom: 8px;
    font-weight: 700;
    color: var(--text-color);
}

.food-modal .form-group input, .food-modal .form-group select { 
    padding: 12px; 
    font-size: 15px;
    border: 2px solid var(--border-color);
    background: linear-gradient(135deg, #ffffff, #f8faf7);
}

.food-modal .quantity-input { display: flex; gap: 10px; }
.food-modal .quantity-input select { width: 100px; }

.food-modal .food-modal-actions { 
    margin-top: 25px; 
    display: flex; 
    gap: 12px; 
}

.food-modal .food-modal-actions .btn { 
    flex: 1; 
    padding: 15px; 
}

/* ===== ëª…ì˜ˆì˜ ì „ë‹¹ (ìŒê° íš¨ê³¼) ===== */
.fame-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
    gap: 12px; 
}

.fame-card { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border: 2px solid var(--tactical-border); 
    border-radius: 12px; 
    padding: 20px; 
    text-align: center;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.fame-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    border-color: var(--scope-green);
}

.fame-card-title { 
    font-size: 18px; 
    margin-bottom: 10px;
    color: var(--text-color);
    font-weight: 700;
}

.fame-card-value { 
    font-size: 22px; 
    font-weight: 800; 
    color: var(--scope-green);
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 3px rgba(0,0,0,0.4));
}

.fame-card-date { 
    font-size: 12px; 
    color: var(--text-color-light); 
    margin-top: 6px;
    font-weight: 600;
}

#wallOfShame .fame-card-value { color: var(--danger-color); }
#wallOfShame .fame-card:hover { border-color: var(--danger-color); }

/* ===== ëŒ“ê¸€ ê´€ë ¨ ===== */
.comment-history-list { 
    max-height: 450px; 
    overflow-y: auto; 
    padding-right: 8px; 
}

.comment-item { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border: 2px solid var(--border-color); 
    border-radius: 12px; 
    padding: 20px 25px; 
    margin-bottom: 15px;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.comment-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    border-color: var(--scope-green);
}

.comment-item-header { 
    font-size: 13px; 
    color: var(--text-color-light); 
    font-weight: 700; 
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.comment-item-body { 
    font-size: 15px; 
    line-height: 1.7; 
    white-space: pre-wrap; 
    word-break: break-word;
    color: var(--text-color);
    font-weight: 500;
}

.empty-comments { 
    text-align: center; 
    color: var(--text-color-light); 
    padding: 50px 25px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border-radius: 12px; 
    border: 2px solid var(--tactical-border); 
}

/* ===== ì˜ìˆ˜ì¦ ìŠ¤íƒ€ì¼ (ìŒê° íš¨ê³¼) ===== */
.receipt-container { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border-radius: 8px; 
    padding: 0; 
    margin-top: 0; margin-bottom: 25px; 
    box-shadow: 0 4px 16px rgba(0,0,0,0.15); 
    font-family: 'Courier New', monospace; 
    max-width: 100%; 
    overflow: hidden;
    border: 2px solid var(--tactical-border);
}

.receipt-header { 
    padding: 20px 25px 15px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1));
    border-bottom: 2px solid var(--tactical-border);
}

.receipt-title { 
    display: block; 
    text-align: center; 
    margin-bottom: 8px; 
    position: relative; 
}

.receipt-title h3 { 
    margin: 0; 
    font-size: 18px; 
    color: var(--scope-green); 
    font-weight: 800;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.budget-info { 
    display: flex; 
    flex-direction: column; 
    gap: 4px; 
    font-size: 11px; 
    color: var(--text-color); 
    font-weight: 700; 
    text-align: right; 
    position: absolute; 
    top: -8px; right: -10px; 
}

.receipt-header p { 
    margin: 0; 
    font-size: 12px; 
    color: var(--text-color-light); 
    text-align: center;
    font-weight: 600;
}

.receipt-divider { 
    height: 2px; 
    background: repeating-linear-gradient(
        to right, 
        var(--tactical-border) 0px, 
        var(--tactical-border) 4px, 
        transparent 4px, 
        transparent 8px
    ); 
    margin: 0 20px; 
}

.receipt-items { padding: 20px 25px 15px; }

.receipt-item { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 6px 10px; 
    font-size: 13px; 
    line-height: 1.4; 
}

.receipt-date { 
    color: var(--text-color-light); 
    font-size: 11px; 
    min-width: 70px; 
    margin-right: 20px;
    font-weight: 600;
}

.receipt-desc { 
    flex: 1; 
    font-weight: 700; 
    color: var(--text-color); 
    margin-right: 20px; 
}

.receipt-amount { 
    font-weight: 800; 
    color: var(--scope-green); 
    font-size: 13px; 
    text-align: right; 
    min-width: 80px;
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 3px rgba(0,0,0,0.4));
}

.receipt-total { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 20px 25px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    font-weight: 800; 
    font-size: 18px; 
    font-family: 'Courier New', monospace; 
    color: var(--scope-green);
    border-top: 2px solid var(--tactical-border);
    text-shadow: 
        0 2px 0 rgba(255,255,255,1),
        0 -2px 0 rgba(0,0,0,0.4),
        inset 0 2px 4px rgba(0,0,0,0.3);
    filter: drop-shadow(inset 0 0 3px rgba(0,0,0,0.4));
}

/* ===== ë¡œë”© & ìŠ¤ì¼ˆë ˆí†¤ ===== */
.calendar-cell.skeleton { 
    background: linear-gradient(135deg, #f5f5f5, #eeeeee); 
    border: 2px solid #e0e0e0; 
    position: relative; 
    overflow: hidden; 
}

.calendar-cell.skeleton::before { 
    content: ''; 
    position: absolute; 
    top: 0; left: -100%; 
    width: 100%; height: 100%; 
    background: linear-gradient(90deg, transparent, rgba(74, 103, 65, 0.1), transparent); 
    animation: shimmer 2s infinite; 
}

.calendar-cell.skeleton .cell-day-number { 
    color: #d5d5d5; 
    background: transparent; 
}

.calendar-cell.skeleton .cell-top-icons,
.calendar-cell.skeleton .cell-bottom-info { 
    background: transparent; 
}

@keyframes shimmer { 
    0% { left: -100%; } 
    100% { left: 100%; } 
}

.loading-indicator {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: var(--scope-green);
    font-size: 12px;
    z-index: 10;
    background: rgba(255, 255, 255, 0.95);
    padding: 8px 15px;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border: 2px solid var(--tactical-border);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ===== ëª©í‘œ íƒ­ ===== */
.goal-tabs { display: flex; gap: 12px; margin-bottom: 25px; }

.goal-tab { 
    padding: 10px 18px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border: 2px solid var(--tactical-border); 
    border-radius: 8px; 
    cursor: pointer; 
    font-size: 14px; 
    font-weight: 700; 
    transition: all 0.3s ease;
    color: var(--text-color);
}

.goal-tab.active { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); 
    color: white; 
    border-color: var(--scope-green);
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.goal-type-toggle { display: flex; gap: 5px; margin-bottom: 15px; }

.goal-type-toggle button { 
    flex: 1; 
    padding: 10px; 
    font-size: 14px; 
    border: 2px solid var(--tactical-border); 
    background: linear-gradient(135deg, var(--primary-light), #e8ede7); 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: 700; 
    transition: all 0.3s ease;
    color: var(--text-color);
}

.goal-type-toggle button.active { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); 
    color: white; 
    border-color: var(--scope-green);
}

#personalGoalsPage .header { text-align: left; }

/* ===== í€˜ìŠ¤íŠ¸ ì‹œìŠ¤í…œ ===== */
#dailyQuestModal .modal-header { 
    padding-top: 30px; 
    padding-bottom: 20px; 
}

.quest-tabs { display: flex; gap: 12px; margin-bottom: 25px; }

.quest-tab { 
    padding: 10px 18px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border: 2px solid var(--tactical-border); 
    border-radius: 8px; 
    cursor: pointer; 
    font-size: 14px; 
    font-weight: 700; 
    transition: all 0.3s ease;
    color: var(--text-color);
}

.quest-tab.active { 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); 
    color: white; 
    border-color: var(--scope-green);
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.quest-list { display: flex; flex-direction: column; gap: 12px; }

.quest-item { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border: 2px solid var(--border-color); 
    padding: 20px; 
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
}

.quest-item:hover { 
    transform: translateY(-3px); 
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    border-color: var(--scope-green);
}

.quest-item.completed { 
    background: linear-gradient(135deg, var(--success-color), #5a7a51); 
    color: white; 
    border-color: var(--success-color);
    box-shadow: 0 4px 16px rgba(74, 103, 65, 0.3);
}

.quest-item.completed .quest-reward { 
    color: rgba(255,255,255,0.9); 
}

.quest-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 10px; 
}

.quest-title { 
    font-weight: 700; 
    font-size: 14px;
    color: var(--text-color);
}

.quest-item.completed .quest-title {
    color: white;
}

.quest-reward { 
    font-size: 12px; 
    color: var(--scope-green); 
    font-weight: 700;
    padding: 4px 8px;
    background: rgba(74, 103, 65, 0.1);
    border-radius: 6px;
    border: 1px solid var(--scope-green);
}

.quest-desc { 
    font-size: 13px; 
    color: var(--text-color-light); 
    margin-bottom: 12px;
    line-height: 1.5;
    font-weight: 500;
}

.quest-item.completed .quest-desc {
    color: rgba(255,255,255,0.8);
}

.quest-progress { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
}

.quest-progress-bar { 
    flex: 1; 
    height: 8px; 
    background: rgba(74, 103, 65, 0.2); 
    border-radius: 4px; 
    margin-right: 12px; 
    overflow: hidden;
    border: 1px solid var(--tactical-border);
}

.quest-progress-fill { 
    height: 100%; 
    background: linear-gradient(135deg, var(--scope-green), var(--primary-dark)); 
    transition: width 0.3s ease;
    box-shadow: 0 0 8px rgba(74, 103, 65, 0.3);
}

.quest-progress-text { 
    font-size: 11px; 
    color: var(--text-color-light); 
    min-width: 50px; 
    text-align: right;
    font-weight: 700;
    text-shadow: 
        0 1px 0 rgba(255,255,255,0.5),
        0 -1px 0 rgba(0,0,0,0.1);
}

.quest-item.completed .quest-progress-bar { 
    background: rgba(255,255,255,0.3); 
}

.quest-item.completed .quest-progress-fill { 
    background: rgba(255,255,255,0.8); 
}

.quest-item.completed .quest-progress-text { 
    color: rgba(255,255,255,0.9); 
}

/* ===== ë³´ìƒ ì‹œìŠ¤í…œ ===== */
#rewardsModal .modal-header { 
    padding: 35px 25px 25px 25px; 
    border-bottom: 2px solid var(--tactical-border); 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    border-top-left-radius: 13px; 
    border-top-right-radius: 13px; 
}

.rewards-list { 
    display: flex; 
    flex-direction: column; 
    gap: 15px; 
    max-height: 400px; 
    overflow-y: auto; 
}

.reward-item { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border: 3px solid var(--border-color); 
    padding: 20px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px));
}

.reward-item:hover { 
    transform: translateY(-3px); 
    box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
}

.reward-item.bronze { 
    border-color: #CD7F32; 
    background: linear-gradient(135deg, #FFF8DC, #F5F5DC); 
}

.reward-item.silver { 
    border-color: #C0C0C0; 
    background: linear-gradient(135deg, #F8F8FF, #E6E6FA); 
}

.reward-item.gold { 
    border-color: #FFD700; 
    background: linear-gradient(135deg, #FFFACD, #FFEFD5); 
}

.reward-item.legend { 
    border-color: #9400D3; 
    background: linear-gradient(135deg, #F8F0FF, #E6E6FA); 
}

.reward-item.used { 
    opacity: 0.5; 
    filter: grayscale(50%); 
}

.reward-info { flex: 1; }

.reward-name { 
    font-weight: 700; 
    font-size: 16px; 
    margin-bottom: 6px;
    color: var(--text-color);
}

.reward-desc { 
    font-size: 13px; 
    color: var(--text-color-light);
    line-height: 1.4;
}

.reward-tier { 
    font-size: 11px; 
    font-weight: 700; 
    padding: 3px 8px; 
    border-radius: 6px; 
    margin-bottom: 6px; 
    display: inline-block;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.reward-tier.bronze { background: #CD7F32; color: white; }
.reward-tier.silver { background: #C0C0C0; color: white; }
.reward-tier.gold { background: #FFD700; color: #333; }
.reward-tier.legend { background: #9400D3; color: white; }

.reward-actions { display: flex; gap: 10px; }

.reward-btn { 
    padding: 10px 15px; 
    border: 2px solid var(--tactical-border); 
    border-radius: 8px; 
    font-size: 12px; 
    font-weight: 700; 
    cursor: pointer; 
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.reward-btn.use { 
    background: linear-gradient(135deg, var(--success-color), #5a7a51); 
    color: white;
    border-color: var(--success-color);
}

.reward-btn.use:hover { 
    background: linear-gradient(135deg, #5a7a51, var(--success-color));
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.reward-btn.delete { 
    background: linear-gradient(135deg, var(--danger-color), #a0541a); 
    color: white;
    border-color: var(--danger-color);
}

.reward-btn.delete:hover { 
    background: linear-gradient(135deg, #a0541a, var(--danger-color));
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.reward-btn:disabled { 
    opacity: 0.5; 
    cursor: not-allowed; 
}

.empty-rewards { 
    text-align: center; 
    padding: 50px 25px; 
    color: var(--text-color-light);
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1));
    border-radius: 12px;
    border: 2px solid var(--tactical-border);
}

/* ===== ì—…ì  ì‹œìŠ¤í…œ ===== */
.achievements-list { 
    display: flex; 
    flex-direction: column; 
    gap: 15px; 
    max-height: 400px; 
    overflow-y: auto; 
}

.achievement-item { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border: 3px solid var(--border-color); 
    padding: 20px; 
    display: flex; 
    align-items: center; 
    gap: 18px; 
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px));
}

.achievement-item.unlocked { 
    border-color: var(--success-color); 
    background: linear-gradient(135deg, #f8fff8, #e8f5e8);
    box-shadow: 0 4px 16px rgba(74, 103, 65, 0.2);
}

.achievement-item.locked { 
    opacity: 0.6; 
}

.achievement-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.achievement-emoji { 
    font-size: 28px; 
    min-width: 45px; 
    text-align: center; 
}

.achievement-info { flex: 1; }

.achievement-name { 
    font-weight: 700; 
    font-size: 16px; 
    margin-bottom: 6px;
    color: var(--text-color);
}

.achievement-desc { 
    font-size: 13px; 
    color: var(--text-color-light);
    line-height: 1.4;
}

.achievement-status { 
    font-size: 12px; 
    font-weight: 700; 
    padding: 6px 10px; 
    border-radius: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.achievement-status.unlocked { 
    background: var(--success-color); 
    color: white; 
}

.achievement-status.locked { 
    background: var(--border-color); 
    color: var(--text-color-light); 
}

.achievement-item.hidden { 
    background: linear-gradient(135deg, #2c3e50, #34495e); 
    color: #ecf0f1; 
    border-color: #34495e; 
}

.achievement-item.hidden .achievement-desc { 
    color: #bdc3c7; 
    font-style: italic; 
}

/* ===== í”„ë¡œí•„ ê´€ë ¨ ===== */
.profile-menu-item:hover { 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1)); 
    color: var(--scope-green);
    border-radius: 8px;
}

#profileWidget:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
}

#profileWidget { 
    transition: all 0.3s ease;
    border: 2px solid var(--tactical-border);
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1));
}

/* ===== ìŒì‹ ì—‘ìŠ¤í¬íŠ¸ ëª¨ë‹¬ ===== */
#foodExportModal .modal-content { 
    max-width: 90vw; 
    background: var(--container-bg); 
    padding: 0;
    border: 3px solid var(--tactical-border);
}

#foodExportPreview { 
    background: linear-gradient(135deg, #ffffff, #f8faf7); 
    border-radius: 8px; 
    padding: 0; 
    margin: 20px; 
    box-shadow: 0 4px 16px rgba(0,0,0,0.15); 
    font-family: 'Courier New', monospace;
    border: 2px solid var(--tactical-border);
}

.food-receipt-header { 
    padding: 20px 25px 15px; 
    background: linear-gradient(135deg, rgba(74, 103, 65, 0.1), rgba(61, 92, 58, 0.1));
    border-bottom: 2px solid var(--tactical-border);
}

.food-receipt-title { 
    display: block; 
    text-align: center; 
    margin-bottom: 8px; 
}

.food-receipt-title h3 { 
    margin: 0; 
    font-size: 18px; 
    color: var(--scope-green); 
    font-weight: 800;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.food-receipt-header p { 
    margin: 0; 
    font-size: 12px; 
    color: var(--text-color-light); 
    text-align: center;
    font-weight: 600;
}

.food-receipt-divider {
    height: 2px;
    background: repeating-linear-gradient(
        to right,
        var(--tactical-border) 0px,
        var(--tactical-border) 4px,
        transparent 4px,
        transparent 8px
    );
    margin: 0 20px;
}

.food-receipt-items { padding: 20px 25px 15px; }

.food-receipt-date-header { 
    font-weight: 800; 
    color: var(--scope-green); 
    font-size: 14px; 
    margin: 20px 0 10px 0; 
    padding-bottom: 8px; 
    border-bottom: 2px dashed var(--tactical-border);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.food-receipt-item { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 6px 0; 
    font-size: 13px; 
    line-height: 1.4; 
}

.food-receipt-time { 
    color: var(--text-color-light); 
    font-size: 11px; 
    min-width: 50px; 
    margin-right: 15px;
    font-weight: 600;
}

.food-receipt-desc { 
    flex: 1; 
    font-weight: 700; 
    color: var(--text-color); 
    margin-right: 15px; 
}

.food-receipt-quantity { 
    font-weight: 800; 
    color: var(--scope-green); 
    font-size: 13px; 
    text-align: right; 
    min-width: 70px; 
}

#foodExportModal .close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(135deg, var(--danger-color), #a0541a);
    border: 2px solid var(--tactical-border);
    width: 40px;
    height: 40px;
    border-radius: 8px;
    font-size: 20px;
    color: white;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    font-weight: bold;
}

#foodExportModal .close-btn:hover { 
    background: linear-gradient(135deg, #a0541a, var(--danger-color));
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* ===== ëª¨ë°”ì¼ ë°˜ì‘í˜• ===== */
@media (max-width: 767px) {
    .modal-content { 
        padding: 0; 
        width: 100%; height: 100%; 
        max-height: 100vh;
        border: none;
    }
    
    .food-modal { 
        width: 90%; 
        height: auto; 
        border-radius: 16px; 
        max-height: 90vh;
        border: 3px solid var(--tactical-border);
    }
    
    .food-modal .modal-body { 
        overflow-y: auto; 
        max-height: calc(90vh - 120px); 
    }
    
    #dayModal .modal-body { 
        padding: 25px 20px; 
    }
    
    .modal-input-group { 
        padding: 18px; 
    }
    
    .modal-input-group h4 { 
        font-size: 15px; 
    }
    
    #dayModal .form-group label { font-size: 13px; }
    
    #dayModal .modal-input-row { 
        grid-template-columns: 1fr; 
        gap: 15px; 
    }
    
    .exercise-toggle-btns { max-width: 200px; }
    
    .score-display-card, .personal-goals-section { 
        width: 100%; 
        max-width: none; 
        margin: 0; 
        padding: 18px; 
    }
    
    .score-display-card .score { font-size: 38px; }

    #modalTotalExpense { text-align: left !important; }
    
    .expense-item { font-size: 13px; word-break: break-all; }
    .expense-item span:first-child { flex-grow: 1; margin-right: 12px; }
    .expense-item > div { flex-shrink: 0; }
    
    .modal-actions-container { 
        padding: 0 20px 25px; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
    }
    
    .modal-actions-container .btn.delete { 
        order: 2; 
        background-color: transparent; 
        color: var(--text-color-light); 
        font-size: 14px; 
        font-weight: normal; 
        padding: 10px; 
        box-shadow: none; 
        margin-top: 12px; 
        max-width: 160px;
        border: 1px solid var(--border-color);
    }
    
    .modal-actions-container .btn.delete:hover { 
        background-color: var(--danger-color); 
        color: white;
        border-color: var(--danger-color);
    }
    
    .modal-actions-container .btn.save { order: 1; }

    #budgetPage .budget-summary { flex-wrap: wrap; }
    #budgetPage .budget-summary .budget-card:first-child { flex-basis: 100%; }
    #budgetPage .budget-card-value { font-size: 22px; }
    
    #dayModal .expense-input-row { flex-direction: column; gap: 12px; }
    #dayModal .expense-input-row input,
    #dayModal .expense-input-row button { width: 100%; }
    
    .dday-header-container { 
        top: 10px; 
        left: 5px; right: 5px; 
    }
    
    .container { 
        padding: 40px 16px 100px 16px; 
        border-width: 2px; 
        max-width: 100%; 
        margin: 0 10px; 
    }
    
    .dday-chip { 
        font-size: 10px; 
        padding: 4px 10px; 
    }
    
    .battery { width: 28px; height: 14px; }

    .receipt-item { font-size: 12px; }
    .receipt-date { min-width: 55px; margin-right: 12px; font-size: 10px; }
    .receipt-desc { margin-right: 12px; }
    .receipt-amount { min-width: 65px; font-size: 12px; }
    
    .budget-info { 
        flex-direction: column; 
        gap: 3px; 
        font-size: 10px; 
        text-align: right; 
    }
    
    .btn { min-height: 48px; }
    
    .calendar-cell {
        border: 1px solid var(--border-color);
        padding: 2px; /* íŒ¨ë”© ë” ì¤„ì„ */
        min-height: 40px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
        clip-path: polygon(0 0, calc(100% - 2px) 0, 100% 2px, 100% 100%, 2px 100%, 0 calc(100% - 2px)); /* í´ë¦½íŒ¨ìŠ¤ ì¤„ì„ */
    }
    .cell-day-number {font-size: 13px; }
    .cell-top-icons { font-size: 8px; }
    .cell-bottom-info { font-size: 7px; }
    .calendar-header-cell { padding: 8px 3px; font-size: 11px; }
    
    .date-nav-btn, .close-btn {
        min-width: 44px;
        min-height: 44px;
    }
    
    .month-nav {
        min-width: 44px;
        min-height: 44px;
    }
    
    #foodExportModal.modal-overlay { 
        background: var(--bg-color); 
        backdrop-filter: none; 
    }
    
    #foodExportModal .modal-content { 
        max-width: 100vw; 
        width: 100vw; 
        height: 100vh; 
        margin: 0; 
        padding: 0; 
        border-radius: 0; 
        box-shadow: none;
        border: none;
    }
    
    #foodExportPreview { 
        margin: 0; 
        border-radius: 0; 
        box-shadow: none; 
        height: calc(100vh - 60px); 
        overflow-y: auto;
        border: none;
    }
    
    #foodExportModal .close-btn {
        position: fixed;
        top: 15px;
        right: 15px;
        width: 45px;
        height: 45px;
        font-size: 22px;
        background: linear-gradient(135deg, var(--danger-color), #a0541a);
        color: white;
        z-index: 1000;
        border-radius: 50%;
    }
    
    #foodExportModal .modal-content > div:last-child { 
        position: fixed; 
        bottom: 0; 
        left: 0; right: 0; 
        background: var(--container-bg); 
        padding: 20px; 
        border-top: 2px solid var(--tactical-border);
        box-shadow: 0 -4px 12px rgba(0,0,0,0.2);
    }
}
    `
};

// í™•ì¥ëœ ì–¸ì–´ ë°ì´í„°
const LANGUAGE_DATA = {
    ko: {
        // ê¸°ë³¸ ì •ë³´
        langDisplay: "í•œêµ­ì–´",
        
        // ìº˜ë¦°ë” ê´€ë ¨
        routineCalendar: "ğŸ—“ï¸ ë£¨í‹´ ìº˜ë¦°ë”",
        monthNames: ["1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”", "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"],
        weekdays: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
        
        // ë©”ì¸ ë²„íŠ¼ë“¤
        statistics: "í†µê³„",
        goals: "ëª©í‘œ",
        budget: "ê°€ê³„ë¶€",
        diet: "ì‹ë‹¨",
        settings: "âš™ï¸ ì„¤ì •",
        
        // ì ìˆ˜ ë²”ë¡€
        excellent: "ìš°ìˆ˜(80+)",
        good: "ë³´í†µ(40+)",
        poor: "ë¯¸í¡(1+)",
        worst: "ìµœì•…(0ë¯¸ë§Œ)",
        restDay: "íœ´ì‹ì¼",
        
        // í€˜ìŠ¤íŠ¸ ê´€ë ¨
        questsTitle: "ğŸ§© í€˜ìŠ¤íŠ¸",
        questsSubtitle: "ê²½í—˜ì¹˜ë¥¼ íšë“í•˜ê³  ë ˆë²¨ì—…í•˜ì„¸ìš”!",
        dailyTab: "ì¼ê°„",
        weeklyTab: "ì£¼ê°„",
        monthlyTab: "ì›”ê°„",
        questLogTitle: "ğŸ§© í€˜ìŠ¤íŠ¸",
        questLogSubtitle: "í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ì—¬ ê²½í—˜ì¹˜ë¥¼ íšë“í•˜ì„¸ìš”!",
        
        // í”„ë¡œí•„ ìœ„ì ¯
        profileLevel: "LV.",
        profileNewbie: "ë‰´ë¹„",
        profileQuests: "í€˜ìŠ¤íŠ¸",
        profileRewards: "ë³´ìƒ ëª©ë¡",
        profileAchievements: "ì—…ì ",
        
        // ì¸ì¦ ê´€ë ¨
        googleLogin: "Google ë¡œê·¸ì¸",
        logout: "ë¡œê·¸ì•„ì›ƒ",
        syncing: "â˜ï¸ ë™ê¸°í™” ì¤‘...",
        
        // ëª©í‘œ ì„¤ì • í˜ì´ì§€
        missionSetup: "ğŸ¯ ëª©í‘œ ì„¤ì •",
        missionSetupSubtitle: "ì‹œì‘ì´ ë°˜! ëª©í‘œ ê¸°ìƒ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.",
        targetWakeTime: "ëª©í‘œ ê¸°ìƒ ì‹œê°„",
        targetWakeTimePlaceholder: "HH:MM (ì˜ˆ: 07:30)",
        autoSaveNote: "í•œ ë²ˆ ì„¤ì •í•˜ë©´ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.",
        saveAndStart: "ì €ì¥í•˜ê³  ì‹œì‘í•˜ê¸°",
        
        // ê¸°ìƒ í”„ë¡¬í”„íŠ¸ í˜ì´ì§€
        goodMorning: "ğŸŒ… ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”!",
        inputTodayWakeTime: "ì˜¤ëŠ˜ì˜ ê¸°ìƒ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",
        actualWakeTime: "ì‹¤ì œ ê¸°ìƒ ì‹œê°„",
        actualWakeTimePlaceholder: "HH:MM (ì˜ˆ: 07:30)",
        saveAndStartDaily: "ì €ì¥í•˜ê³  ì‹œì‘",
        skipForNow: "ë‚˜ì¤‘ì— ì…ë ¥",
        
        // ì¼ê°„ ëª¨ë‹¬
        timingProtocol: "â° ì¸ìƒì€ íƒ€ì´ë°",
        wakeTime: "ê¸°ìƒ ì‹œê°„",
        seatTime: "ì°©ì„ ì‹œê°„",
        sleepTime: "ì·¨ì¹¨ ì‹œê°„",
        sleepTimePlaceholder: "HH:MM (ìµì¼ 1ì‹œâ†’25:00)",
        
        focusModules: "ğŸ… ì§‘ì¤‘ì˜ ë½€ëª¨ë„ë¡œ",
        morning: "ì˜¤ì „",
        afternoon: "ì˜¤í›„",
        evening: "ì €ë…",
        
        personalMissions: "ğŸ¯ ê°œì¸ ëª©í‘œ",
        
        selfUpgrade: "ğŸ’ª ìê¸°ê³„ë°œ",
        didYouExercise: "ì˜¤ëŠ˜ ìš´ë™í–ˆë‚˜ìš”?",
        yes: "âœ”ï¸ Yes",
        no: "âœ–ï¸ No",
        exerciseTimeMin: "ìš´ë™ ì‹œê°„ (ë¶„)",
        writingChars: "ê¸€ì“°ê¸° (ì)",
        gamingMin: "ê²Œì„ (ë¶„)",
        
        creditUsage: "ğŸ’° ì§€ì¶œ ê¸°ë¡",
        todayTotalExpense: "ì˜¤ëŠ˜ ì´ ì§€ì¶œ:",
        expenseDescription: "ì§€ì¶œ ë‚´ì—­",
        amount: "ê¸ˆì•¡",
        
        dailyScore: "ì˜¤ëŠ˜ì˜ ì ìˆ˜",
        
        dailyLogEntry: "ğŸ’¬ ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ë‚¨ê¸°ê¸°",
        dailyLogPlaceholder: "ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë• ë‚˜ìš”? (ìµœëŒ€ 500ì)",
        
        restMode: "â˜•ï¸ ì˜¤ëŠ˜ ì‰¬ê¸° (Off Day)",
        
        endDaySession: "ì˜¤ëŠ˜ì˜ ì¼ì • ì¢…ë£Œ",
        delete: "ì‚­ì œ",
        
        // ê°œì¸ ëª©í‘œ í˜ì´ì§€
        missionObjectives: "ğŸ¯ ì§‘ì¤‘ ëª©í‘œ",
        missionObjectivesSubtitle: "ë‚˜ë§Œì˜ ëª©í‘œë¥¼ ì¶”ê°€í•˜ê³  ë‹¬ì„±ë¥ ì„ ê´€ë¦¬í•˜ì„¸ìš”.",
        active: "ì§„í–‰ ì¤‘",
        completed: "ì™„ë£Œ",
        createNewMission: "ìƒˆ ëª©í‘œ ì¶”ê°€",
        increaseGoodHabits: "ğŸ‘ ëŠ˜ë¦¬ê¸° (Good Habits)",
        decreaseBadHabits: "ğŸ‘ ì¤„ì´ê¸° (Bad Habits)",
        missionName: "ëª©í‘œ ì´ë¦„",
        missionNamePlaceholder: "ì˜ˆ: ìˆ˜í•™ ë¬¸ì œì§‘ í’€ê¸°",
        targetAmount: "ëª©í‘œëŸ‰",
        targetAmountPlaceholder: "ì˜ˆ: 200",
        unit: "ê¸°ê°„ (ì¼)",
        unitPlaceholder: "ì˜ˆ: 10",
        addMission: "ëª©í‘œ ì¶”ê°€",
        backToHub: "ëŒì•„ê°€ê¸°",
        
        // ì„¤ì • í˜ì´ì§€
        systemConfig: "âš™ï¸ ì„¤ì •",
        targetWakeTimeSetting: "â˜€ï¸ ëª©í‘œ ê¸°ìƒ ì‹œê°„",
        monthlyCreditLimit: "ğŸ’° ì›” ì˜ˆì‚° ì„¤ì •",
        monthlyBudgetPlaceholder: "ì›” ì˜ˆì‚° (ì›)",
        accountabilityPartner: "ğŸ¤ ì±…ì„ ê³µìœ  íŒŒíŠ¸ë„ˆ ì´ë©”ì¼",
        partnerEmailPlaceholder: "ì£¼ê°„ ë¦¬í¬íŠ¸ë¥¼ ë°›ì„ íŒŒíŠ¸ë„ˆì˜ ì´ë©”ì¼",
        autoSendNote: "ì£¼ê°„ í‰ê·  ì ìˆ˜ê°€ 40ì  ë¯¸ë§Œì¼ ê²½ìš°, íŒŒíŠ¸ë„ˆì—ê²Œ ìë™ìœ¼ë¡œ ì„±ê³¼ ë³´ê³ ì„œê°€ ë°œì†¡ë©ë‹ˆë‹¤.",
        ddayCountdown: "â° D-Day ì„¤ì •",
        addDday: "D-Day ì¶”ê°€",
        saveConfig: "ì„¤ì • ì €ì¥",
        viewLogHistory: "ğŸ’¬ ë‚˜ì˜ ê¸°ë¡ë“¤ ë³´ê¸°",
        exportToExcel: "ğŸ“ˆ ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°",
        exportDataBackup: "ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë°±ì—…)",
        importDataRestore: "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ë³µêµ¬)",
        cloudBackup: "â˜ï¸ í´ë¼ìš°ë“œ ë°±ì—…",
        cloudRestore: "ğŸ“¥ í´ë¼ìš°ë“œì—ì„œ ë³µì›",
        
        // ê°€ê³„ë¶€ í˜ì´ì§€
        credits: "ê°€ê³„ë¶€",
        
        // ì‹ë‹¨ í˜ì´ì§€
        rationLog: "ğŸ½ï¸ ì‹ë‹¨ ê¸°ë¡",
        rationLogSubtitle: "ì˜¤ëŠ˜ ë­˜ ë“œì…¨ë‚˜ìš”?",
        addRation: "+ ì‹ë‹¨ ì¶”ê°€",
        manage: "ğŸ”§ ê´€ë¦¬",
        manageMode: "ğŸ”§ ê´€ë¦¬",
        manageModeEnd: "âœ… ê´€ë¦¬ëª¨ë“œ ì¢…ë£Œ",
        exportAsImage: "ğŸ“¸ ì´ë¯¸ì§€ë¡œ ë‚´ë³´ë‚´ê¸°",
        
        // í†µê³„ í˜ì´ì§€
        monthlyAnalytics: "ğŸ“Š ì›”ê°„í†µê³„",
        avgScore: "í‰ê·  ì ìˆ˜",
        missionRate: "ê°œì¸ëª©í‘œ ë‹¬ì„±ë¥ ",
        writingBooks: "ê¸€ì“°ê¸° ì™„ì„±",
        hallOfFame: "ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ†",
        wallOfShame: "ğŸ§± ë°˜ì„±ì˜ ë²½ ğŸ§±",
        
        // í€˜ìŠ¤íŠ¸ ê´€ë ¨
        todaysQuests: "ğŸ”– ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸ (5ê°œ)",
        thisWeeksQuests: "ğŸ¥ ì´ë²ˆ ì£¼ í€˜ìŠ¤íŠ¸ (8ê°œ)",
        thisMonthsQuests: "â›³ ì´ë²ˆ ë‹¬ í€˜ìŠ¤íŠ¸",
        expPerQuest: "ì™„ë£Œí•œ í€˜ìŠ¤íŠ¸ë§ˆë‹¤",
        expGain: "ê²½í—˜ì¹˜ íšë“!",
        
        // ëª¨ë‹¬ ì œëª©ë“¤
        todaysQuestLog: "ğŸ”– ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸",
        levelUpGacha: "ğŸ° ë ˆë²¨ì—… ë³´ìƒ ë½‘ê¸°",
        rewardInventory: "ğŸ ë³´ìƒ ëª©ë¡",
        achievementList: "ğŸ… ì—…ì  ëª©ë¡",
        
        // ë²„íŠ¼ë“¤
        confirm: "í™•ì¸",
        cancel: "ì·¨ì†Œ",
        save: "ì €ì¥",
        close: "ë‹«ê¸°",
        use: "ì‚¬ìš©",
        useNow: "ì§€ê¸ˆ ì‚¬ìš©",
        saveForLater: "ë‚˜ì¤‘ì— ì‚¬ìš©",
        viewAllQuests: "ì „ì²´ í€˜ìŠ¤íŠ¸ ë³´ê¸°",
        
        // ë‹¨ìœ„ë“¤
        pieces: "ê°œ",
        cups: "ì”",
        packets: "ë´‰ì§€",
        slices: "ì¡°ê°",
        bowls: "ê·¸ë¦‡",
        servings: "ì¸ë¶„",
        bottles: "ë³‘",
        
        // ê¸°íƒ€
        noData: "ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤",
        loading: "ë°ì´í„° ë¡œë”© ì¤‘...",
        saveInProgress: "ì €ì¥ ì¤‘...",
        saveComplete: "ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."
    },
    
    en: {
        // ê¸°ë³¸ ì •ë³´
        langDisplay: "English",
        
        // ìº˜ë¦°ë” ê´€ë ¨
        routineCalendar: "ROUTINE SYSTEM",
        monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        weekdays: ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'],
        
        // ë©”ì¸ ë²„íŠ¼ë“¤
        statistics: "STATISTICS",
        goals: "MISSIONS",
        budget: "CREDITS",
        diet: "RATIONS",
        settings: "âš™ï¸ CONFIG",
        
        // ì ìˆ˜ ë²”ë¡€
        excellent: "EXCELLENT(80+)",
        good: "GOOD(40+)",
        poor: "BAD(1+)",
        worst: "CRITICAL(0-)",
        restDay: "REST DAY",
        
        // í€˜ìŠ¤íŠ¸ ê´€ë ¨
        questsTitle: "ğŸ§© QUEST LOG",
        questsSubtitle: "GAIN EXPERIENCE AND LEVEL UP!",
        dailyTab: "DAILY",
        weeklyTab: "WEEKLY",
        monthlyTab: "MONTHLY",
        questLogTitle: "ğŸ§© QUEST LOG",
        questLogSubtitle: "COMPLETE QUESTS TO GAIN EXPERIENCE POINTS!",
        
        // í”„ë¡œí•„ ìœ„ì ¯
        profileLevel: "LV.",
        profileNewbie: "NEWBIE",
        profileQuests: "QUESTS",
        profileRewards: "REWARDS",
        profileAchievements: "ACHIEVEMENTS",
        
        // ì¸ì¦ ê´€ë ¨
        googleLogin: "GOOGLE LOGIN",
        logout: "LOGOUT",
        syncing: "â˜ï¸ SYNCING...",
        
        // ëª©í‘œ ì„¤ì • í˜ì´ì§€
        missionSetup: "ğŸ¯ MISSION SETUP",
        missionSetupSubtitle: "CONFIGURE YOUR PRIMARY OBJECTIVE",
        targetWakeTime: "TARGET WAKE TIME",
        targetWakeTimePlaceholder: "HH:MM (EX: 07:30)",
        autoSaveNote: "AUTO-SAVE AFTER CONFIGURATION",
        saveAndStart: "SAVE & START GAME",
        
        // ê¸°ìƒ í”„ë¡¬í”„íŠ¸ í˜ì´ì§€
        goodMorning: "ğŸŒ… GOOD MORNING, PLAYER",
        inputTodayWakeTime: "INPUT TODAY'S WAKE TIME",
        actualWakeTime: "ACTUAL WAKE TIME",
        actualWakeTimePlaceholder: "HH:MM (EX: 07:30)",
        saveAndStartDaily: "SAVE & START",
        skipForNow: "SKIP FOR NOW",
        
        // ì¼ê°„ ëª¨ë‹¬
        timingProtocol: "â° TIMING PROTOCOL",
        wakeTime: "WAKE TIME",
        seatTime: "SEAT TIME",
        sleepTime: "SLEEP TIME",
        sleepTimePlaceholder: "HH:MM (NEXT DAY 1AMâ†’25:00)",
        
        focusModules: "ğŸ… FOCUS MODULES",
        morning: "MORNING",
        afternoon: "AFTERNOON",
        evening: "EVENING",
        
        personalMissions: "ğŸ¯ PERSONAL MISSIONS",
        
        selfUpgrade: "ğŸ’ª SELF UPGRADE",
        didYouExercise: "DID YOU EXERCISE TODAY?",
        yes: "âœ”ï¸ YES",
        no: "âœ–ï¸ NO",
        exerciseTimeMin: "EXERCISE TIME (MIN)",
        writingChars: "WRITING (CHARS)",
        gamingMin: "GAMING (MIN)",
        
        creditUsage: "ğŸ’° CREDIT USAGE",
        todayTotalExpense: "TODAY TOTAL EXPENSE:",
        expenseDescription: "EXPENSE DESCRIPTION",
        amount: "AMOUNT",
        
        dailyScore: "DAILY SCORE",
        
        dailyLogEntry: "ğŸ’¬ DAILY LOG ENTRY",
        dailyLogPlaceholder: "HOW WAS YOUR DAY? (MAX 500 CHARS)",
        
        restMode: "â˜•ï¸ REST DAY (OFF MODE)",
        
        endDaySession: "END DAY SESSION",
        delete: "DELETE",
        
        // ê°œì¸ ëª©í‘œ í˜ì´ì§€
        missionObjectives: "ğŸ¯ MISSION OBJECTIVES",
        missionObjectivesSubtitle: "CREATE AND MANAGE YOUR PERSONAL MISSIONS.",
        active: "ACTIVE",
        completed: "COMPLETED",
        createNewMission: "CREATE NEW MISSION",
        increaseGoodHabits: "ğŸ‘ INCREASE (GOOD HABITS)",
        decreaseBadHabits: "ğŸ‘ DECREASE (BAD HABITS)",
        missionName: "MISSION NAME",
        missionNamePlaceholder: "EX: SOLVE MATH PROBLEMS",
        targetAmount: "TARGET AMOUNT",
        targetAmountPlaceholder: "EX: 20",
        unit: "UNIT",
        unitPlaceholder: "EX: PAGES, MINUTES",
        addMission: "ADD MISSION",
        backToHub: "BACK TO HUB",
        
        // ì„¤ì • í˜ì´ì§€
        systemConfig: "âš™ï¸ SYSTEM CONFIG",
        targetWakeTimeSetting: "â˜€ï¸ TARGET WAKE TIME",
        monthlyCreditLimit: "ğŸ’° MONTHLY CREDIT LIMIT",
        monthlyBudgetPlaceholder: "MONTHLY BUDGET (CREDITS)",
        accountabilityPartner: "ğŸ¤ ACCOUNTABILITY PARTNER EMAIL",
        partnerEmailPlaceholder: "PARTNER'S EMAIL FOR WEEKLY REPORTS",
        autoSendNote: "AUTO-SEND REPORT IF WEEKLY AVERAGE < 40 POINTS",
        ddayCountdown: "â° D-DAY COUNTDOWN",
        addDday: "ADD D-DAY",
        saveConfig: "SAVE CONFIG",
        viewLogHistory: "ğŸ’¬ VIEW LOG HISTORY",
        exportToExcel: "ğŸ“ˆ EXPORT TO EXCEL",
        exportDataBackup: "EXPORT DATA (BACKUP)",
        importDataRestore: "IMPORT DATA (RESTORE)",
        cloudBackup: "â˜ï¸ CLOUD BACKUP",
        cloudRestore: "ğŸ“¥ CLOUD RESTORE",
        
        // ê°€ê³„ë¶€ í˜ì´ì§€
        credits: "CREDITS",
        
        // ì‹ë‹¨ í˜ì´ì§€
        rationLog: "ğŸ½ï¸ RATION LOG",
        rationLogSubtitle: "TRACK YOUR DAILY FOOD INTAKE",
        addRation: "+ ADD RATION",
        manage: "ğŸ”§ MANAGE",
        manageMode: "ğŸ”§ MANAGE",
        manageModeEnd: "âœ… END MANAGE MODE",
        exportAsImage: "ğŸ“¸ EXPORT AS IMAGE",
        
        // í†µê³„ í˜ì´ì§€
        monthlyAnalytics: "ğŸ“Š MONTHLY ANALYTICS",
        avgScore: "AVG SCORE",
        missionRate: "MISSION RATE",
        writingBooks: "WRITING BOOKS",
        hallOfFame: "ğŸ† HALL OF FAME ğŸ†",
        wallOfShame: "ğŸ§± WALL OF SHAME ğŸ§±",
        
        // í€˜ìŠ¤íŠ¸ ê´€ë ¨
        todaysQuests: "ğŸ”– TODAY'S QUESTS (5 AVAILABLE)",
        thisWeeksQuests: "ğŸ¥ THIS WEEK'S QUESTS (8 AVAILABLE)",
        thisMonthsQuests: "â›³ THIS MONTH'S QUESTS",
        expPerQuest: "+2 EXP PER COMPLETED QUEST!",
        expGain: "EXP PER COMPLETED QUEST!",
        
        // ëª¨ë‹¬ ì œëª©ë“¤
        todaysQuestLog: "ğŸ”– TODAY'S QUEST LOG",
        levelUpGacha: "ğŸ° LEVEL UP GACHA",
        rewardInventory: "ğŸ REWARD INVENTORY",
        achievementList: "ğŸ… ACHIEVEMENT LIST",
        
        // ë²„íŠ¼ë“¤
        confirm: "CONFIRM",
        cancel: "CANCEL",
        save: "SAVE",
        close: "CLOSE",
        use: "USE",
        useNow: "USE NOW",
        saveForLater: "SAVE FOR LATER",
        viewAllQuests: "VIEW ALL QUESTS",
        
        // ë‹¨ìœ„ë“¤
        pieces: "PIECES",
        cups: "CUPS",
        packets: "PACKETS",
        slices: "SLICES",
        bowls: "BOWLS",
        servings: "SERVINGS",
        bottles: "BOTTLES",
        
        // ê¸°íƒ€
        noData: "NO DATA RECORDED",
        loading: "DATA LOADING...",
        saveInProgress: "SAVING...",
        saveComplete: "ALL CHANGES SAVED."
    }
};

let currentLanguage = 'ko';
let currentTheme = 'light';

// í…Œë§ˆ ë³€ê²½ í•¨ìˆ˜
async function changeTheme(themeName) {
    currentTheme = themeName;
    
    // ê¸°ì¡´ ë™ì  ìŠ¤íƒ€ì¼ ì œê±°
    const existingStyle = document.getElementById('dynamic-theme-style');
    if (existingStyle) {
        existingStyle.remove();
    }
    
    if (themeName === 'light') {
        // ë¼ì´íŠ¸ í…Œë§ˆëŠ” ê¸°ë³¸ CSS ì‚¬ìš©
        console.log('ğŸ¨ ë¼ì´íŠ¸ í…Œë§ˆë¡œ ë³€ê²½ (ê¸°ë³¸ CSS ì‚¬ìš©)');
    } else if (THEME_STYLES[themeName]) {
        // ë‹¤ë¥¸ í…Œë§ˆë“¤ì€ ë™ì ìœ¼ë¡œ ì ìš©
        const styleElement = document.createElement('style');
        styleElement.id = 'dynamic-theme-style';
        styleElement.textContent = THEME_STYLES[themeName];
        document.head.appendChild(styleElement);
        console.log(`ğŸ¨ ${themeName} í…Œë§ˆë¡œ ë³€ê²½`);
    }
    
    await dbSet('userTheme', themeName);
    showExpGainNotification(0, `í…Œë§ˆê°€ ${themeName}ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
}

// í™•ì¥ëœ ì–¸ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
async function updateLanguageDisplay() {
    const lang = LANGUAGE_DATA[currentLanguage];
    
    // ===========================================
    // 1. í”„ë¡œí•„ ìœ„ì ¯ ì—…ë°ì´íŠ¸
    // ===========================================
    const profileTitle = document.getElementById('profileTitle');
    if (profileTitle && profileTitle.textContent.includes('ë‰´ë¹„')) {
        profileTitle.textContent = lang.profileNewbie;
    }
    
    // í”„ë¡œí•„ ë©”ë‰´ í•­ëª©ë“¤
    const menuItems = document.querySelectorAll('.profile-menu-item');
    if (menuItems.length >= 3) {
        menuItems[0].innerHTML = `<span>ğŸ¯</span> ${lang.profileQuests}`;
        menuItems[1].innerHTML = `<span>ğŸ</span> ${lang.profileRewards}`;
        menuItems[2].innerHTML = `<span>ğŸ…</span> ${lang.profileAchievements}`;
    }
    
    // ===========================================
    // 2. ì¸ì¦ ì»¨í…Œì´ë„ˆ ì—…ë°ì´íŠ¸
    // ===========================================
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    if (loginBtn) loginBtn.textContent = lang.googleLogin;
    if (logoutBtn) logoutBtn.textContent = lang.logout;
    
    // ë™ê¸°í™” ìƒíƒœ
    const syncStatus = document.getElementById('syncStatus');
    if (syncStatus && syncStatus.textContent.includes('ë™ê¸°í™”')) {
        syncStatus.textContent = lang.syncing;
    }
    
    // ===========================================
    // 3. ëª©í‘œ ì„¤ì • í˜ì´ì§€
    // ===========================================
    const goalSetupTitle = document.querySelector('#goalSetup .header h1');
    const goalSetupSubtitle = document.querySelector('#goalSetup .header p');
    if (goalSetupTitle) goalSetupTitle.textContent = lang.missionSetup;
    if (goalSetupSubtitle) goalSetupSubtitle.textContent = lang.missionSetupSubtitle;
    
    const targetWakeTimeLabel = document.querySelector('label[for="targetWakeTime"]');
    const targetWakeTimeInput = document.getElementById('targetWakeTime');
    const autoSaveNote = document.querySelector('#goalSetup small');
    const saveAndStartBtn = document.querySelector('#goalSetup .btn');
    
    if (targetWakeTimeLabel) targetWakeTimeLabel.textContent = lang.targetWakeTime;
    if (targetWakeTimeInput) targetWakeTimeInput.placeholder = lang.targetWakeTimePlaceholder;
    if (autoSaveNote) autoSaveNote.textContent = lang.autoSaveNote;
    if (saveAndStartBtn) saveAndStartBtn.textContent = lang.saveAndStart;
    
    // ===========================================
    // 4. ê¸°ìƒ í”„ë¡¬í”„íŠ¸ í˜ì´ì§€
    // ===========================================
    const wakeupTitle = document.querySelector('#wakeUpPrompt h2');
    const wakeupInputText = document.querySelector('#wakeUpPrompt .wakeup-prompt p:last-child');
    const actualWakeTimeLabel = document.querySelector('label[for="promptWakeTime"]');
    const actualWakeTimeInput = document.getElementById('promptWakeTime');
    const saveStartBtn = document.querySelector('#wakeUpPrompt .btn:first-of-type');
    const skipBtn = document.querySelector('#wakeUpPrompt .btn.secondary');
    
    if (wakeupTitle) wakeupTitle.textContent = lang.goodMorning;
    if (wakeupInputText) wakeupInputText.textContent = lang.inputTodayWakeTime;
    if (actualWakeTimeLabel) actualWakeTimeLabel.textContent = lang.actualWakeTime;
    if (actualWakeTimeInput) actualWakeTimeInput.placeholder = lang.actualWakeTimePlaceholder;
    if (saveStartBtn) saveStartBtn.textContent = lang.saveAndStartDaily;
    if (skipBtn) skipBtn.textContent = lang.skipForNow;
    
    // ===========================================
    // 5. ìº˜ë¦°ë” í˜ì´ì§€
    // ===========================================
    const calendarTitle = document.querySelector('#calendarPage .header h1');
    if (calendarTitle) {
        calendarTitle.textContent = lang.routineCalendar;
    }
    
    // ìš”ì¼ í—¤ë” ì—…ë°ì´íŠ¸
    const weekdayHeaders = document.querySelectorAll('.calendar-header-cell');
    weekdayHeaders.forEach((header, index) => {
        if (index < lang.weekdays.length) {
            header.textContent = lang.weekdays[index];
        }
    });
    
    // ì›”ë…„ í‘œì‹œ ì—…ë°ì´íŠ¸
    updateMonthYearDisplay();
    
    // ë©”ì¸ ë²„íŠ¼ë“¤ ì—…ë°ì´íŠ¸
    const mainActions = document.querySelectorAll('#calendarPage .main-actions .btn');
    if (mainActions.length >= 4) {
        mainActions[0].textContent = lang.statistics;
        mainActions[1].textContent = lang.goals;
        mainActions[2].textContent = lang.budget;
        mainActions[3].textContent = lang.diet;
    }
    
    // ì„¤ì • ë²„íŠ¼ ì—…ë°ì´íŠ¸
    const settingsBtn = document.querySelector('#calendarPage .btn.secondary');
    if (settingsBtn) {
        settingsBtn.textContent = lang.settings;
    }
    
    // ë²”ë¡€ ì—…ë°ì´íŠ¸
    const legendItems = document.querySelectorAll('.legend-item span');
    if (legendItems.length >= 5) {
        legendItems[0].textContent = lang.excellent;
        legendItems[1].textContent = lang.good;
        legendItems[2].textContent = lang.poor;
        legendItems[3].textContent = lang.worst;
        legendItems[4].textContent = lang.restDay;
    }
    
    // ===========================================
    // 6. ì¼ê°„ ëª¨ë‹¬ ì—…ë°ì´íŠ¸
    // ===========================================
    // íƒ€ì´ë° í”„ë¡œí† ì½œ ì„¹ì…˜
    const timingProtocolTitle = document.querySelector('#dayModal h4:first-of-type');
    if (timingProtocolTitle && timingProtocolTitle.textContent.includes('íƒ€ì´ë°')) {
        timingProtocolTitle.textContent = lang.timingProtocol;
    }
    
    const modalLabels = document.querySelectorAll('#dayModal label');
    modalLabels.forEach(label => {
        const forAttr = label.getAttribute('for');
        switch (forAttr) {
            case 'modalWakeTime':
                label.textContent = lang.wakeTime;
                break;
            case 'modalSeatTime':
                label.textContent = lang.seatTime;
                break;
            case 'modalSleepTime':
                label.textContent = lang.sleepTime;
                break;
            case 'modalMorningPomodoro':
                label.textContent = lang.morning;
                break;
            case 'modalAfternoonPomodoro':
                label.textContent = lang.afternoon;
                break;
            case 'modalEveningPomodoro':
                label.textContent = lang.evening;
                break;
            case 'modalExerciseMinutes':
                label.textContent = lang.exerciseTimeMin;
                break;
            case 'modalWriting':
                label.textContent = lang.writingChars;
                break;
            case 'modalGameTime':
                label.textContent = lang.gamingMin;
                break;
            case 'modalOffDay':
                label.textContent = lang.restMode;
                break;
        }
    });
    
    // ì„¹ì…˜ ì œëª©ë“¤
    const modalSectionTitles = document.querySelectorAll('#dayModal h4');
    modalSectionTitles.forEach(title => {
        const text = title.textContent;
        if (text.includes('ë½€ëª¨ë„ë¡œ')) title.textContent = lang.focusModules;
        else if (text.includes('ê°œì¸ ëª©í‘œ')) title.textContent = lang.personalMissions;
        else if (text.includes('ìê¸°ê³„ë°œ')) title.textContent = lang.selfUpgrade;
        else if (text.includes('ì§€ì¶œ')) title.textContent = lang.creditUsage;
    });
    
    // ìš´ë™ ê´€ë ¨
    const exerciseLabel = document.querySelector('.exercise-toggle-group label');
    if (exerciseLabel) exerciseLabel.textContent = lang.didYouExercise;
    
    const exerciseYesBtn = document.getElementById('exerciseBtnYes');
    const exerciseNoBtn = document.getElementById('exerciseBtnNo');
    if (exerciseYesBtn) exerciseYesBtn.textContent = lang.yes;
    if (exerciseNoBtn) exerciseNoBtn.textContent = lang.no;
    
    // í”Œë ˆì´ìŠ¤í™€ë”ë“¤
    const modalSleepTimeInput = document.getElementById('modalSleepTime');
    if (modalSleepTimeInput) modalSleepTimeInput.placeholder = lang.sleepTimePlaceholder;
    
    const expenseDescInput = document.getElementById('expenseDesc');
    const expenseAmountInput = document.getElementById('expenseAmount');
    if (expenseDescInput) expenseDescInput.placeholder = lang.expenseDescription;
    if (expenseAmountInput) expenseAmountInput.placeholder = lang.amount;
    
    // ì ìˆ˜ ì¹´ë“œ
    const scoreCard = document.querySelector('.score-display-card div:last-child');
    if (scoreCard && scoreCard.textContent.includes('ì ìˆ˜')) {
        scoreCard.textContent = lang.dailyScore;
    }
    
    // ì˜¤ëŠ˜ì˜ í•œë§ˆë””
    const commentSummary = document.querySelector('#commentDetails summary');
    const commentTextarea = document.getElementById('modalComment');
    if (commentSummary) commentSummary.textContent = lang.dailyLogEntry;
    if (commentTextarea) commentTextarea.placeholder = lang.dailyLogPlaceholder;
    
    // ëª¨ë‹¬ ì•¡ì…˜ ë²„íŠ¼ë“¤
    const endDayBtn = document.querySelector('.btn.save');
    const deleteBtn = document.querySelector('.btn.delete');
    if (endDayBtn) endDayBtn.textContent = lang.endDaySession;
    if (deleteBtn) deleteBtn.textContent = lang.delete;
    
    // ===========================================
    // 7. í€˜ìŠ¤íŠ¸ í˜ì´ì§€ ì—…ë°ì´íŠ¸
    // ===========================================
    const questTitle = document.querySelector('#questPage .header h1');
    const questSubtitle = document.querySelector('#questPage .header p');
    if (questTitle) questTitle.textContent = lang.questsTitle;
    if (questSubtitle) questSubtitle.textContent = lang.questsSubtitle;
    
    // í€˜ìŠ¤íŠ¸ íƒ­ ì—…ë°ì´íŠ¸
    const questTabs = document.querySelectorAll('.quest-tab');
    if (questTabs.length >= 3) {
        questTabs[0].textContent = lang.dailyTab;
        questTabs[1].textContent = lang.weeklyTab;
        questTabs[2].textContent = lang.monthlyTab;
    }
    
    // í€˜ìŠ¤íŠ¸ ì„¹ì…˜ ì œëª©ë“¤
    const questSectionTitles = document.querySelectorAll('#questPage h3');
    questSectionTitles.forEach(title => {
        const text = title.textContent;
        if (text.includes('ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸')) title.textContent = lang.todaysQuests;
        else if (text.includes('ì´ë²ˆ ì£¼ í€˜ìŠ¤íŠ¸')) title.textContent = lang.thisWeeksQuests;
        else if (text.includes('ì´ë²ˆ ë‹¬ í€˜ìŠ¤íŠ¸')) title.textContent = lang.thisMonthsQuests;
    });
    
    // ë°±íˆ¬í—ˆë¸Œ ë²„íŠ¼ë“¤
    const backToHubBtns = document.querySelectorAll('.btn.secondary');
    backToHubBtns.forEach(btn => {
        if (btn.textContent.includes('ëŒì•„ê°€ê¸°')) {
            btn.textContent = lang.backToHub;
        }
    });
    
    // ===========================================
    // 8. ê°œì¸ ëª©í‘œ í˜ì´ì§€
    // ===========================================
    const goalPageTitle = document.querySelector('#personalGoalsPage .header h1');
    const goalPageSubtitle = document.querySelector('#personalGoalsPage .header p');
    if (goalPageTitle) goalPageTitle.textContent = lang.missionObjectives;
    if (goalPageSubtitle) goalPageSubtitle.textContent = lang.missionObjectivesSubtitle;
    
    // ëª©í‘œ íƒ­ë“¤
    const goalTabs = document.querySelectorAll('.goal-tab');
    if (goalTabs.length >= 2) {
        goalTabs[0].textContent = lang.active;
        goalTabs[1].textContent = lang.completed;
    }
    
    // ìƒˆ ëª©í‘œ ì¶”ê°€ ì„¹ì…˜
    const newMissionTitle = document.querySelector('#personalGoalsPage h4');
    if (newMissionTitle) newMissionTitle.textContent = lang.createNewMission;
    
    const goalTypeButtons = document.querySelectorAll('.goal-type-toggle button');
    if (goalTypeButtons.length >= 2) {
        goalTypeButtons[0].textContent = lang.increaseGoodHabits;
        goalTypeButtons[1].textContent = lang.decreaseBadHabits;
    }
    
    // ëª©í‘œ ì…ë ¥ í•„ë“œë“¤
    const goalLabels = document.querySelectorAll('#personalGoalsPage label');
    goalLabels.forEach(label => {
        const forAttr = label.getAttribute('for');
        switch (forAttr) {
            case 'newGoalName':
                label.textContent = lang.missionName;
                break;
            case 'newGoalTarget':
                label.textContent = lang.targetAmount;
                break;
            case 'newGoalUnit':
                label.textContent = lang.unit;
                break;
        }
    });
    
    const goalInputs = document.querySelectorAll('#personalGoalsPage input');
    goalInputs.forEach(input => {
        const id = input.id;
        switch (id) {
            case 'newGoalName':
                input.placeholder = lang.missionNamePlaceholder;
                break;
            case 'newGoalTarget':
                input.placeholder = lang.targetAmountPlaceholder;
                break;
            case 'newGoalUnit':
                input.placeholder = lang.unitPlaceholder;
                break;
        }
    });
    
    const addMissionBtn = document.querySelector('#personalGoalsPage .btn:not(.secondary)');
    if (addMissionBtn && addMissionBtn.textContent.includes('ëª©í‘œ ì¶”ê°€')) {
        addMissionBtn.textContent = lang.addMission;
    }
    
    // ===========================================
    // 9. ì„¤ì • í˜ì´ì§€
    // ===========================================
    const settingsTitle = document.querySelector('#settingsPage .header h1');
    if (settingsTitle) settingsTitle.textContent = lang.systemConfig;
    
    const settingsLabels = document.querySelectorAll('#settingsPage label');
    settingsLabels.forEach(label => {
        const forAttr = label.getAttribute('for');
        const text = label.textContent;
        switch (forAttr) {
            case 'settingsWakeTime':
                label.textContent = lang.targetWakeTimeSetting;
                break;
            case 'monthlyBudgetInput':
                label.textContent = lang.monthlyCreditLimit;
                break;
            case 'partnerEmailInput':
                label.textContent = lang.accountabilityPartner;
                break;
        }
        
        if (text.includes('D-Day ì„¤ì •')) {
            label.textContent = lang.ddayCountdown;
        }
    });
    
    // ì„¤ì • ì…ë ¥ í”Œë ˆì´ìŠ¤í™€ë”ë“¤
    const monthlyBudgetInput = document.getElementById('monthlyBudgetInput');
    const partnerEmailInput = document.getElementById('partnerEmailInput');
    if (monthlyBudgetInput) monthlyBudgetInput.placeholder = lang.monthlyBudgetPlaceholder;
    if (partnerEmailInput) partnerEmailInput.placeholder = lang.partnerEmailPlaceholder;
    
    // ì„¤ì • í˜ì´ì§€ ë²„íŠ¼ë“¤
    const settingsButtons = document.querySelectorAll('#settingsPage .btn');
    settingsButtons.forEach(btn => {
        const text = btn.textContent;
        if (text.includes('ì„¤ì • ì €ì¥')) btn.textContent = lang.saveConfig;
        else if (text.includes('ë‚˜ì˜ ê¸°ë¡ë“¤')) btn.textContent = lang.viewLogHistory;
        else if (text.includes('ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°')) btn.textContent = lang.exportToExcel;
        else if (text.includes('ë°ì´í„° ë‚´ë³´ë‚´ê¸°')) btn.textContent = lang.exportDataBackup;
        else if (text.includes('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°')) btn.textContent = lang.importDataRestore;
        else if (text.includes('í´ë¼ìš°ë“œ ë°±ì—…')) btn.textContent = lang.cloudBackup;
        else if (text.includes('í´ë¼ìš°ë“œì—ì„œ ë³µì›')) btn.textContent = lang.cloudRestore;
        else if (text.includes('D-Day ì¶”ê°€')) btn.textContent = lang.addDday;
    });
    
    // ì„¤ì • í˜ì´ì§€ small í…ìŠ¤íŠ¸
    const settingsSmall = document.querySelector('#settingsPage small');
    if (settingsSmall) settingsSmall.textContent = lang.autoSendNote;
    
    // ===========================================
    // 10. ì‹ë‹¨ í˜ì´ì§€
    // ===========================================
    const foodPageTitle = document.querySelector('#foodPage .header h1');
    const foodPageSubtitle = document.querySelector('#foodPage .header p');
    if (foodPageTitle) foodPageTitle.textContent = lang.rationLog;
    if (foodPageSubtitle) foodPageSubtitle.textContent = lang.rationLogSubtitle;
    
    // ì‹ë‹¨ í˜ì´ì§€ ë²„íŠ¼ë“¤
    const foodButtons = document.querySelectorAll('#foodPage .btn');
    foodButtons.forEach(btn => {
        const text = btn.textContent;
        if (text.includes('ì‹ë‹¨ ì¶”ê°€')) btn.textContent = lang.addRation;
        else if (text.includes('ê´€ë¦¬')) btn.textContent = lang.manage;
        else if (text.includes('ì´ë¯¸ì§€ë¡œ ë‚´ë³´ë‚´ê¸°')) btn.textContent = lang.exportAsImage;
    });
    
    // ===========================================
    // 11. í†µê³„ í˜ì´ì§€
    // ===========================================
    const statsTitle = document.querySelector('#monthlyStatsPage .header h1');
    if (statsTitle) statsTitle.textContent = lang.monthlyAnalytics;
    
    // í†µê³„ ì¹´ë“œë“¤
    const statsTitles = document.querySelectorAll('.summary-title');
    statsTitles.forEach(title => {
        const text = title.textContent;
        if (text.includes('í‰ê·  ì ìˆ˜')) title.textContent = lang.avgScore;
        else if (text.includes('ê°œì¸ëª©í‘œ')) title.textContent = lang.missionRate;
        else if (text.includes('ê¸€ì“°ê¸°')) title.textContent = lang.writingBooks;
    });
    
    // ëª…ì˜ˆì˜ ì „ë‹¹ / ë°˜ì„±ì˜ ë²½
    const hallTitle = document.querySelector('.hall-of-fame-container h3');
    const shameTitle = document.querySelector('.wall-of-shame-container h3');
    if (hallTitle) hallTitle.textContent = lang.hallOfFame;
    if (shameTitle) shameTitle.textContent = lang.wallOfShame;
    
    // ===========================================
    // 12. ëª¨ë‹¬ë“¤ ì—…ë°ì´íŠ¸
    // ===========================================
    
    // ì¼ê°„ í€˜ìŠ¤íŠ¸ ëª¨ë‹¬
    const dailyQuestModalTitle = document.querySelector('#dailyQuestModal .modal-title');
    if (dailyQuestModalTitle) dailyQuestModalTitle.textContent = lang.todaysQuestLog;
    
    // ê°€ì±  ëª¨ë‹¬
    const gachaModalTitle = document.querySelector('#gachaModal .modal-title');
    if (gachaModalTitle) gachaModalTitle.textContent = lang.levelUpGacha;
    
    // ë³´ìƒ ëª¨ë‹¬
    const rewardsModalTitle = document.querySelector('#rewardsModal .modal-title');
    if (rewardsModalTitle) rewardsModalTitle.textContent = lang.rewardInventory;
    
    // ì—…ì  ëª¨ë‹¬
    const achievementsModalTitle = document.querySelector('#achievementsModal .modal-title');
    if (achievementsModalTitle) achievementsModalTitle.textContent = lang.achievementList;
    
    // ì¼ë°˜ì ì¸ ëª¨ë‹¬ ë²„íŠ¼ë“¤
    const modalButtons = document.querySelectorAll('.modal-content .btn, .feedback-btn');
    modalButtons.forEach(btn => {
        const text = btn.textContent;
        if (text.includes('í™•ì¸')) btn.textContent = lang.confirm;
        else if (text.includes('ì·¨ì†Œ')) btn.textContent = lang.cancel;
        else if (text.includes('ì €ì¥')) btn.textContent = lang.save;
        else if (text.includes('ë‹«ê¸°')) btn.textContent = lang.close;
        else if (text.includes('ì‚¬ìš©')) {
            if (text.includes('ì§€ê¸ˆ')) btn.textContent = lang.useNow;
            else if (text.includes('ë‚˜ì¤‘ì—')) btn.textContent = lang.saveForLater;
            else btn.textContent = lang.use;
        }
        else if (text.includes('ì „ì²´ í€˜ìŠ¤íŠ¸')) btn.textContent = lang.viewAllQuests;
    });
    
    // ===========================================
    // 13. ì‹ë‹¨ ëª¨ë‹¬ë“¤
    // ===========================================
    
    // ì‹ë‹¨ ë‹¨ìœ„ ì˜µì…˜ë“¤
    const foodUnitSelects = document.querySelectorAll('#foodUnitSelect option, #manualFoodUnit option');
    foodUnitSelects.forEach((option, index) => {
        const units = [lang.pieces, lang.cups, 'ML', 'G', 'PACKETS', lang.slices, lang.bowls, lang.servings, lang.bottles];
        if (index < units.length) {
            option.textContent = units[index];
        }
    });
    
    // ===========================================
    // 14. ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ë“¤
    // ===========================================
    const saveStatus = document.getElementById('saveStatus');
    if (saveStatus) {
        const text = saveStatus.textContent;
        if (text.includes('ì €ì¥ ì¤‘')) saveStatus.textContent = lang.saveInProgress;
        else if (text.includes('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤')) saveStatus.textContent = lang.saveComplete;
    }
    
    // ===========================================
    // 15. ë¡œë”© ë° ê¸°íƒ€ ìƒíƒœ ë©”ì‹œì§€ë“¤
    // ===========================================
    const loadingIndicator = document.getElementById('loadingIndicator');
    if (loadingIndicator) loadingIndicator.textContent = lang.loading;
    
    // ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ë“¤
    const emptyStates = document.querySelectorAll('.empty-goals, .empty-rewards, .empty-comments, .empty-expenses');
    emptyStates.forEach(empty => {
        if (empty.textContent.includes('ê¸°ë¡ëœ') || empty.textContent.includes('ì—†ìŠµë‹ˆë‹¤')) {
            const p = empty.querySelector('p');
            if (p) p.textContent = lang.noData;
        }
    });
}

// ì›”ë…„ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê°œì„ ë¨)
function updateMonthYearDisplay() {
    const monthYearEl = document.getElementById('monthYear');
    if (!monthYearEl) return;
    
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    if (currentLanguage === 'en') {
        monthYearEl.textContent = `${LANGUAGE_DATA.en.monthNames[month]} ${year}`;
    } else {
        monthYearEl.textContent = `${year}ë…„ ${month + 1}ì›”`;
    }
}

// ì–¸ì–´ ì „í™˜ í•¨ìˆ˜ (í™•ì¥ë¨)
async function toggleLanguage() {
    currentLanguage = currentLanguage === 'ko' ? 'en' : 'ko';
    await dbSet('userLanguage', currentLanguage);
    
    // bodyì— ì–¸ì–´ í´ë˜ìŠ¤ ì¶”ê°€/ì œê±°
    document.body.classList.remove('lang-ko', 'lang-en');
    document.body.classList.add(`lang-${currentLanguage}`);
    
    // ì „ì²´ ì–¸ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
    await updateLanguageDisplay();
    
    // í˜„ì¬ ì–¸ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
    const langDisplay = document.getElementById('currentLangDisplay');
    if (langDisplay) {
        langDisplay.textContent = LANGUAGE_DATA[currentLanguage].langDisplay;
    }
    
    console.log(`ğŸŒ ì–¸ì–´ê°€ ${currentLanguage}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    showExpGainNotification(0, `ì–¸ì–´ê°€ ${LANGUAGE_DATA[currentLanguage].langDisplay}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
}

// ì–¸ì–´ ì„¤ì • ë¡œë“œ í•¨ìˆ˜ (í™•ì¥ë¨)
async function loadUserSettings() {
    const savedTheme = await dbGet('userTheme');
    const savedLanguage = await dbGet('userLanguage');
    
    if (savedTheme && savedTheme !== 'light') {
        await changeTheme(savedTheme); 
    } else {
        currentTheme = 'light';
    }
    
    if (savedLanguage) {
        currentLanguage = savedLanguage;
        // ì–¸ì–´ ì„¤ì • í›„ ì „ì²´ UI ì—…ë°ì´íŠ¸
        setTimeout(async () => {
            await updateLanguageDisplay();
        }, 100);
    }
    
    // í˜„ì¬ ì–¸ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
    const langDisplay = document.getElementById('currentLangDisplay');
    if (langDisplay) {
        langDisplay.textContent = LANGUAGE_DATA[currentLanguage].langDisplay;
    }
}

// ë™ì  í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ í—¬í¼ í•¨ìˆ˜ë“¤
function updateDynamicText(selector, koText, enText) {
    const element = document.querySelector(selector);
    if (element) {
        element.textContent = currentLanguage === 'ko' ? koText : enText;
    }
}

function updatePlaceholder(selector, koText, enText) {
    const element = document.querySelector(selector);
    if (element) {
        element.placeholder = currentLanguage === 'ko' ? koText : enText;
    }
}

// íŠ¹ì • í˜ì´ì§€ ë¡œë“œ ì‹œ ì–¸ì–´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
async function updatePageLanguage(pageId) {
    const lang = LANGUAGE_DATA[currentLanguage];
    
    switch (pageId) {
        case 'calendarPage':
            updateMonthYearDisplay();
            break;
        case 'questPage':
            // í€˜ìŠ¤íŠ¸ í˜ì´ì§€ íŠ¹ì • ì—…ë°ì´íŠ¸
            await renderQuestPage();
            break;
        case 'personalGoalsPage':
            // ê°œì¸ ëª©í‘œ í˜ì´ì§€ íŠ¹ì • ì—…ë°ì´íŠ¸
            await renderPersonalGoalsList();
            break;
        // ë‹¤ë¥¸ í˜ì´ì§€ë“¤ë„ í•„ìš”ì— ë”°ë¼ ì¶”ê°€
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì •
window.addEventListener('load', function() { setupSecretDevTools(); });

// í€˜ìŠ¤íŠ¸ë§Œ ë¦¬ì…‹
async function resetQuests() {
    if (!confirm('ì •ë§ë¡œ ëª¨ë“  í€˜ìŠ¤íŠ¸ë¥¼ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    const allData = await dbGetAll();
    let count = 0;
    
    for (const item of allData) {
        if (item.key.startsWith('dailyQuests_') || 
            item.key.startsWith('weeklyQuests_') || 
            item.key.startsWith('monthlyQuests_')) {
            await dbDelete(item.key);
            count++;
        }
    }
    
    alert(`${count}ê°œ í€˜ìŠ¤íŠ¸ ë¦¬ì…‹ ì™„ë£Œ!`);
}

// ê²½í—˜ì¹˜ë§Œ ë¦¬ì…‹
async function resetExperience() {
    if (!confirm('ì •ë§ë¡œ ë ˆë²¨ê³¼ ê²½í—˜ì¹˜ë¥¼ ëª¨ë‘ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    const defaultLevelData = {
        totalExp: 0,
        level: 1,
        currentExp: 0,
        maxExp: 10,
        unlockedRewards: [],
        activeBuffs: {}
    };
    
    await dbSet('userLevelData', defaultLevelData);
    await updateProfileWidget();
    
    alert('ë ˆë²¨ê³¼ ê²½í—˜ì¹˜ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

// ì—…ì ë§Œ ë¦¬ì…‹
async function resetAchievements() {
    if (!confirm('ì •ë§ë¡œ ëª¨ë“  ì—…ì ì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në‹¬ì„±í•œ ì—…ì ë“¤ì´ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤!')) return;
    
    // ì—…ì  ë¦¬ì…‹
    await dbDelete('unlockedAchievements');
    
    // ì—…ì  ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ìƒˆë¡œê³ ì¹¨
    if (document.getElementById('achievementsModal').style.display === 'flex') {
        await renderAchievementsList();
    }
    
    alert('ëª¨ë“  ì—…ì ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
    console.log('ğŸ… ì—…ì  ë¦¬ì…‹ ì™„ë£Œ');
}

// ì „ì²´ ë¦¬ì…‹ í•¨ìˆ˜ì— ì—…ì  ë¦¬ì…‹ë„ ì¶”ê°€
async function resetAll() {
    if (!confirm('ì •ë§ë¡œ í€˜ìŠ¤íŠ¸, ê²½í—˜ì¹˜, ì—…ì ì„ ëª¨ë‘ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;
    
    // í€˜ìŠ¤íŠ¸ ë¦¬ì…‹
    const allData = await dbGetAll();
    let questCount = 0;
    
    for (const item of allData) {
        if (item.key.startsWith('dailyQuests_') || 
            item.key.startsWith('weeklyQuests_') || 
            item.key.startsWith('monthlyQuests_')) {
            await dbDelete(item.key);
            questCount++;
        }
    }
    
    // ê²½í—˜ì¹˜ ë¦¬ì…‹
    const defaultLevelData = {
        totalExp: 0,
        level: 1,
        currentExp: 0,
        maxExp: 10,
        unlockedRewards: [],
        activeBuffs: {}
    };
    
    await dbSet('userLevelData', defaultLevelData);
    
    // ì—…ì  ë¦¬ì…‹ ì¶”ê°€
    await dbDelete('unlockedAchievements');
    
    await updateProfileWidget();
    
    alert(`ì „ì²´ ë¦¬ì…‹ ì™„ë£Œ!\ní€˜ìŠ¤íŠ¸: ${questCount}ê°œ ì‚­ì œ\në ˆë²¨: 1ë¡œ ì´ˆê¸°í™”\nì—…ì : ëª¨ë‘ ì´ˆê¸°í™”`);
}

// ê°œì¸ ëª©í‘œ ì—…ì  í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
async function testPersonalGoalAchievements() {
    const today = new Date();
    const todayData = await getDayData(today);
    const allData = await dbGetAll();
    
    await checkPersonalGoalAchievements(today, todayData, allData);
    console.log('ğŸ¯ ê°œì¸ ëª©í‘œ ì—…ì  ì²´í¬ ì™„ë£Œ');
}

// ê¸°ì¡´ window.addEventListener('load', ...) ë¶€ë¶„ì„ ì•„ë˜ ì½”ë“œë¡œ í†µì§¸ë¡œ êµì²´í•´ì£¼ì„¸ìš”.

window.addEventListener('load', async function () {
    // 1. IndexedDB ì´ˆê¸°í™”ê°€ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.
    await localDB.init();
    await loadUserSettings(); // í…Œë§ˆ ë° ì–¸ì–´ ì„¤ì • ë¡œë“œ

    // 2. ì¸ì¦ ìƒíƒœ ë³€ê²½ì„ ê°ì§€í•˜ê³  ê·¸ì— ë§ê²Œ UIë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    auth.onAuthStateChanged(async (user) => {
        try {
            const result = await auth.getRedirectResult();
            if (result.user) {
                console.log('ë¦¬ë””ë ‰ì…˜ ë¡œê·¸ì¸ ì„±ê³µ:', result.user.displayName);
            }
        } catch (error) {
            console.error('ë¦¬ë””ë ‰ì…˜ ë¡œê·¸ì¸ ì—ëŸ¬:', error);
        }
        
        if (user) {
            currentUser = user;
            currentUserName = user.displayName || "ì‚¬ìš©ì";
            
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'block';
            document.getElementById('userInfo').textContent = `${user.displayName}ë‹˜`;
            document.getElementById('userInfo').style.display = 'block';
            
            startAutoSync();
            updateSyncStatus('â˜ï¸ ìë™ ë°±ì—… í™œì„±í™”');
            
        } else {
            currentUser = null;
            
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
            
            stopAutoSync();
            updateSyncStatus('ğŸ’¾ ë¡œì»¬ ì €ì¥ ì¤‘ (ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„° ë³´í˜¸)');
        }

        // 3. ì¸ì¦ ìƒíƒœê°€ ê²°ì •ëœ í›„ì— ì•±ì˜ ë©”ì¸ ë¡œì§ì„ ì‹œì‘í•©ë‹ˆë‹¤.
        //    (initAppì€ ì´ì œ ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì‹¤í–‰ë©ë‹ˆë‹¤)
        if (!document.body.dataset.appInitialized) {
             await initApp();
             document.body.dataset.appInitialized = 'true'; // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
        }
    });

    // ê¸°íƒ€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.getElementById('loginBtn').addEventListener('click', signIn);
    document.getElementById('logoutBtn').addEventListener('click', signOut);

    document.addEventListener('keydown', (e) => { 
        if (e.key === 'Escape') {
            closeDayModal(); closeFeedbackPopup(); closeReasonModal(); 
            closeFoodSuggestion(); closeManualFoodModal(); closeExcelModal();
        }
        if (document.getElementById('dayModal').style.display === 'flex') {
            if (e.key === 'ArrowLeft') navigateModalDate(-1);
            else if (e.key === 'ArrowRight') navigateModalDate(1);
        }
        if (document.getElementById('calendarPage').classList.contains('active')) { 
            if (e.key === 'ArrowLeft') changeMonth(-1); 
            else if (e.key === 'ArrowRight') changeMonth(1); 
        } 
    });
    
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', function (e) {
             if (e.target === this) {
                const closeBtn = this.querySelector('.close-btn');
                if(closeBtn) closeBtn.click();
             }
        });
    });
    
    const inputsToUpdateScoreAndSave = [
        'modalWakeTime', 'modalSeatTime', 'modalMorningPomodoro', 'modalAfternoonPomodoro', 
        'modalEveningPomodoro', 'modalGameTime', 'modalExerciseMinutes', 'modalWriting', 
        'modalSleepTime', 'modalOffDay', 'modalComment'
    ];
    inputsToUpdateScoreAndSave.forEach(id => {
        const el = document.getElementById(id);
        if(el) {
            const eventType = (el.type === 'checkbox' || el.tagName === 'SELECT') ? 'change' : 'input';
            el.addEventListener(eventType, () => {
                updateModalScore();
                autoSaveModalData();
            });
        }
    });
    
    document.addEventListener('input', function(e) {
        if (e.target.id && e.target.id.startsWith('personalGoal_')) {
            const goalId = e.target.id.replace('personalGoal_', '');
            updatePersonalGoalValue(goalId, e.target.value);
        }
    });
});
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</body>
</html>
